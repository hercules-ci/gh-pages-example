<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Release 0.8 (2005-04-11) - Nix 2.28.4 Reference Manual</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Nix 2.28.4 Reference Manual</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/NixOS/nix" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/NixOS/nix/tree/master/doc/manual/source/release-notes/rl-0.8.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="release-08-2005-04-11"><a class="header" href="#release-08-2005-04-11">Release 0.8 (2005-04-11)</a></h1>
<p>NOTE: the hashing scheme in Nix 0.8 changed (as detailed below). As a
result, <code>nix-pull</code> manifests and channels built for Nix 0.7 and below
will not work anymore. However, the Nix expression language has not
changed, so you can still build from source. Also, existing user
environments continue to work. Nix 0.8 will automatically upgrade the
database schema of previous installations when it is first run.</p>
<p>If you get the error message</p>
<pre><code>you have an old-style manifest `/nix/var/nix/manifests/[...]'; please
delete it
</code></pre>
<p>you should delete previously downloaded manifests:</p>
<pre><code>$ rm /nix/var/nix/manifests/*
</code></pre>
<p>If <code>nix-channel</code> gives the error message</p>
<pre><code>manifest `http://catamaran.labs.cs.uu.nl/dist/nix/channels/[channel]/MANIFEST'
is too old (i.e., for Nix &lt;= 0.7)
</code></pre>
<p>then you should unsubscribe from the offending channel (<code>nix-channel --remove URL</code>; leave out <code>/MANIFEST</code>), and subscribe to the same URL, with
<code>channels</code> replaced by <code>channels-v3</code> (e.g.,
<a href="http://catamaran.labs.cs.uu.nl/dist/nix/channels-v3/nixpkgs-unstable">http://catamaran.labs.cs.uu.nl/dist/nix/channels-v3/nixpkgs-unstable</a>).</p>
<p>Nix 0.8 has the following improvements:</p>
<ul>
<li>
<p>The cryptographic hashes used in store paths are now 160 bits long,
but encoded in base-32 so that they are still only 32 characters
long (e.g.,
<code>/nix/store/csw87wag8bqlqk7ipllbwypb14xainap-atk-1.9.0</code>). (This is
actually a 160 bit truncation of a SHA-256 hash.)</p>
</li>
<li>
<p>Big cleanups and simplifications of the basic store semantics. The
notion of “closure store expressions” is gone (and so is the notion
of “successors”); the file system references of a store path are now
just stored in the database.</p>
<p>For instance, given any store path, you can query its closure:</p>
<pre><code>$ nix-store -qR $(which firefox)
... lots of paths ...
</code></pre>
<p>Also, Nix now remembers for each store path the derivation that
built it (the “deriver”):</p>
<pre><code>$ nix-store -qR $(which firefox)
/nix/store/4b0jx7vq80l9aqcnkszxhymsf1ffa5jd-firefox-1.0.1.drv
</code></pre>
<p>So to see the build-time dependencies, you can do</p>
<pre><code>$ nix-store -qR $(nix-store -qd $(which firefox))
</code></pre>
<p>or, in a nicer format:</p>
<pre><code>$ nix-store -q --tree $(nix-store -qd $(which firefox))
</code></pre>
<p>File system references are also stored in reverse. For instance, you
can query all paths that directly or indirectly use a certain Glibc:</p>
<pre><code>$ nix-store -q --referrers-closure \
    /nix/store/8lz9yc6zgmc0vlqmn2ipcpkjlmbi51vv-glibc-2.3.4
</code></pre>
</li>
<li>
<p>The concept of fixed-output derivations has been formalised.
Previously, functions such as <code>fetchurl</code> in Nixpkgs used a hack
(namely, explicitly specifying a store path hash) to prevent changes
to, say, the URL of the file from propagating upwards through the
dependency graph, causing rebuilds of everything. This can now be
done cleanly by specifying the <code>outputHash</code> and <code>outputHashAlgo</code>
attributes. Nix itself checks that the content of the output has the
specified hash. (This is important for maintaining certain
invariants necessary for future work on secure shared stores.)</p>
</li>
<li>
<p>One-click installation :-) It is now possible to install any
top-level component in Nixpkgs directly, through the web — see,
e.g., <a href="http://catamaran.labs.cs.uu.nl/dist/nixpkgs-0.8/">http://catamaran.labs.cs.uu.nl/dist/nixpkgs-0.8/</a>. All you
have to do is associate <code>/nix/bin/nix-install-package</code> with the MIME
type <code>application/nix-package</code> (or the extension <code>.nixpkg</code>), and
clicking on a package link will cause it to be installed, with all
appropriate dependencies. If you just want to install some specific
application, this is easier than subscribing to a channel.</p>
</li>
<li>
<p><code>nix-store -r         PATHS</code> now builds all the derivations PATHS in parallel. Previously
it did them sequentially (though exploiting possible parallelism
between subderivations). This is nice for build farms.</p>
</li>
<li>
<p><code>nix-channel</code> has new operations <code>--list</code> and <code>--remove</code>.</p>
</li>
<li>
<p>New ways of installing components into user environments:</p>
<ul>
<li>
<p>Copy from another user environment:</p>
<pre><code>$ nix-env -i --from-profile .../other-profile firefox
</code></pre>
</li>
<li>
<p>Install a store derivation directly (bypassing the Nix
expression language entirely):</p>
<pre><code>$ nix-env -i /nix/store/z58v41v21xd3...-aterm-2.3.1.drv
</code></pre>
<p>(This is used to implement <code>nix-install-package</code>, which is
therefore immune to evolution in the Nix expression language.)</p>
</li>
<li>
<p>Install an already built store path directly:</p>
<pre><code>$ nix-env -i /nix/store/hsyj5pbn0d9i...-aterm-2.3.1
</code></pre>
</li>
<li>
<p>Install the result of a Nix expression specified as a
command-line argument:</p>
<pre><code>$ nix-env -f .../i686-linux.nix -i -E 'x: x.firefoxWrapper'
</code></pre>
<p>The difference with the normal installation mode is that <code>-E</code>
does not use the <code>name</code> attributes of derivations. Therefore,
this can be used to disambiguate multiple derivations with the
same name.</p>
</li>
</ul>
</li>
<li>
<p>A hash of the contents of a store path is now stored in the database
after a successful build. This allows you to check whether store
paths have been tampered with: <code>nix-store         --verify --check-contents</code>.</p>
</li>
<li>
<p>Implemented a concurrent garbage collector. It is now always safe to
run the garbage collector, even if other Nix operations are
happening simultaneously.</p>
<p>However, there can still be GC races if you use <code>nix-instantiate</code>
and <code>nix-store                 --realise</code> directly to build things. To prevent races, use the
<code>--add-root</code> flag of those commands.</p>
</li>
<li>
<p>The garbage collector now finally deletes paths in the right order
(i.e., topologically sorted under the “references” relation), thus
making it safe to interrupt the collector without risking a store
that violates the closure invariant.</p>
</li>
<li>
<p>Likewise, the substitute mechanism now downloads files in the right
order, thus preserving the closure invariant at all times.</p>
</li>
<li>
<p>The result of <code>nix-build</code> is now registered as a root of the garbage
collector. If the <code>./result</code> link is deleted, the GC root disappears
automatically.</p>
</li>
<li>
<p>The behaviour of the garbage collector can be changed globally by
setting options in <code>/nix/etc/nix/nix.conf</code>.</p>
<ul>
<li>
<p><code>gc-keep-derivations</code> specifies whether deriver links should be
followed when searching for live paths.</p>
</li>
<li>
<p><code>gc-keep-outputs</code> specifies whether outputs of derivations
should be followed when searching for live paths.</p>
</li>
<li>
<p><code>env-keep-derivations</code> specifies whether user environments
should store the paths of derivations when they are added (thus
keeping the derivations alive).</p>
</li>
</ul>
</li>
<li>
<p>New <code>nix-env</code> query flags <code>--drv-path</code> and <code>--out-path</code>.</p>
</li>
<li>
<p><code>fetchurl</code> allows SHA-1 and SHA-256 in addition to MD5. Just specify
the attribute <code>sha1</code> or <code>sha256</code> instead of <code>md5</code>.</p>
</li>
<li>
<p>Manual updates.</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../release-notes/rl-0.8.1.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../release-notes/rl-0.7.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../release-notes/rl-0.8.1.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../release-notes/rl-0.7.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../redirects.js"></script>


    </div>
    </body>
</html>
