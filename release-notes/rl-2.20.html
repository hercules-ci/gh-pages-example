<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Release 2.20 (2024-01-29) - Nix Reference Manual</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../custom.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Nix Reference Manual</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/NixOS/nix" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/NixOS/nix/tree/master/doc/manual/src/release-notes/rl-2.20.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="release-2200-2024-01-29"><a class="header" href="#release-2200-2024-01-29">Release 2.20.0 (2024-01-29)</a></h1>
<ul>
<li>
<p>Option <code>allowed-uris</code> can now match whole schemes in URIs without slashes <a href="https://github.com/NixOS/nix/pull/9547">#9547</a></p>
<p>If a scheme, such as <code>github:</code> is specified in the <code>allowed-uris</code> option, all URIs starting with <code>github:</code> are allowed.
Previously this only worked for schemes whose URIs used the <code>://</code> syntax.</p>
</li>
<li>
<p>Include cgroup stats when building through the daemon <a href="https://github.com/NixOS/nix/pull/9598">#9598</a></p>
<p>Nix now also reports cgroup statistics when building through the Nix daemon and when doing remote builds using <code>ssh-ng</code>,
if both sides of the connection are using Nix 2.20 or newer.</p>
</li>
<li>
<p>Disallow empty search regex in <code>nix search</code> <a href="https://github.com/NixOS/nix/pull/9481">#9481</a></p>
<p><a href="../command-ref/new-cli/nix3-search.html"><code>nix search</code></a> now requires a search regex to be passed. To show all packages, use <code>^</code>.</p>
</li>
<li>
<p>Add new <code>eval-system</code> setting <a href="https://github.com/NixOS/nix/pull/4093">#4093</a></p>
<p>Add a new <code>eval-system</code> option.
Unlike <code>system</code>, it just overrides the value of <code>builtins.currentSystem</code>.
This is more useful than overriding <code>system</code>, because you can build these derivations on remote builders which can work on the given system.
In contrast, <code>system</code> also affects scheduling which will cause Nix to build those derivations locally even if that doesn't make sense.</p>
<p><code>eval-system</code> only takes effect if it is non-empty.
If empty (the default) <code>system</code> is used as before, so there is no breakage.</p>
</li>
<li>
<p>Import-from-derivation builds the derivation in the build store <a href="https://github.com/NixOS/nix/pull/9661">#9661</a></p>
<p>When using <code>--eval-store</code>, <code>import</code>ing from a derivation will now result in the derivation being built on the build store, i.e. the store specified in the <code>store</code> Nix option.</p>
<p>Because the resulting Nix expression must be copied back to the evaluation store in order to be imported, this requires the evaluation store to trust the build store's signatures.</p>
</li>
<li>
<p>Mounted SSH Store <a href="https://github.com/NixOS/nix/issues/7890">#7890</a> <a href="https://github.com/NixOS/nix/pull/7912">#7912</a></p>
<p>Introduced the store <a href="../command-ref/new-cli/nix3-help-stores.html"><code>mounted-ssh-ng://</code></a>.
This store allows full access to a Nix store on a remote machine and additionally requires that the store be mounted in the local filesystem.</p>
</li>
<li>
<p>Rename <code>nix show-config</code> to <code>nix config show</code> <a href="https://github.com/NixOS/nix/issues/7672">#7672</a> <a href="https://github.com/NixOS/nix/pull/9477">#9477</a></p>
<p><code>nix show-config</code> was renamed to <code>nix config show</code>, and <code>nix doctor</code> was renamed to <code>nix config check</code>, to be more consistent with the rest of the command line interface.</p>
</li>
<li>
<p>Add command <code>nix hash convert</code> <a href="https://github.com/NixOS/nix/pull/9452">#9452</a></p>
<p>This replaces the old <code>nix hash to-*</code> commands, which are still available but will emit a deprecation warning. Please convert as follows:</p>
<ul>
<li><code>nix hash to-base16 $hash1 $hash2</code>: Use <code>nix hash convert --to base16 $hash1 $hash2</code> instead.</li>
<li><code>nix hash to-base32 $hash1 $hash2</code>: Use <code>nix hash convert --to nix32 $hash1 $hash2</code> instead.</li>
<li><code>nix hash to-base64 $hash1 $hash2</code>: Use <code>nix hash convert --to base64 $hash1 $hash2</code> instead.</li>
<li><code>nix hash to-sri $hash1 $hash2</code>: : Use <code>nix hash convert --to sri $hash1 $hash2</code> or even just <code>nix hash convert $hash1 $hash2</code> instead.</li>
</ul>
</li>
<li>
<p>Rename hash format <code>base32</code> to <code>nix32</code> <a href="https://github.com/NixOS/nix/pull/9452">#9452</a></p>
<p>Hash format <code>base32</code> was renamed to <code>nix32</code> since it used a special Nix-specific character set for
<a href="https://en.wikipedia.org/wiki/Base32">Base32</a>.</p>
</li>
<li>
<p><code>nix profile</code> now allows referring to elements by human-readable names <a href="https://github.com/NixOS/nix/pull/8678">#8678</a></p>
<p><a href="../command-ref/new-cli/nix3-profile.html"><code>nix profile</code></a> now uses names to refer to installed packages when running <a href="../command-ref/new-cli/nix3-profile-list.html"><code>list</code></a>, <a href="../command-ref/new-cli/nix3-profile-remove.html"><code>remove</code></a> or <a href="../command-ref/new-cli/nix3-profile-upgrade.html"><code>upgrade</code></a> as opposed to indices. Profile element names are generated when a package is installed and remain the same until the package is removed.</p>
<p><strong>Warning</strong>: The <code>manifest.nix</code> file used to record the contents of profiles has changed. Nix will automatically upgrade profiles to the new version when you modify the profile. After that, the profile can no longer be used by older versions of Nix.</p>
</li>
<li>
<p>Give <code>nix store add</code> a <code>--hash-algo</code> flag <a href="https://github.com/NixOS/nix/pull/9809">#9809</a></p>
<p>Adds a missing feature that was present in the old CLI, and matches our
plans to have similar flags for <code>nix hash convert</code> and <code>nix hash path</code>.</p>
</li>
<li>
<p>Coercion errors include the failing value</p>
<p>The <code>error: cannot coerce a &lt;TYPE&gt; to a string</code> message now includes the value
which caused the error.</p>
<p>Before:</p>
<pre><code>error: cannot coerce a set to a string
</code></pre>
<p>After:</p>
<pre><code>error: cannot coerce a set to a string: { aesSupport = «thunk»;
  avx2Support = «thunk»; avx512Support = «thunk»; avxSupport = «thunk»;
  canExecute = «thunk»; config = «thunk»; darwinArch = «thunk»; darwinMinVersion
  = «thunk»; darwinMinVersionVariable = «thunk»; darwinPlatform = «thunk»; «84
  attributes elided»}
</code></pre>
</li>
<li>
<p>Type errors include the failing value</p>
<p>In errors like <code>value is an integer while a list was expected</code>, the message now
includes the failing value.</p>
<p>Before:</p>
<pre><code>error: value is a set while a string was expected
</code></pre>
<p>After:</p>
<pre><code>error: expected a string but found a set: { ghc810 = «thunk»;
  ghc8102Binary = «thunk»; ghc8107 = «thunk»; ghc8107Binary = «thunk»;
  ghc865Binary = «thunk»; ghc90 = «thunk»; ghc902 = «thunk»; ghc92 = «thunk»;
  ghc924Binary = «thunk»; ghc925 = «thunk»;  «17 attributes elided»}
</code></pre>
</li>
<li>
<p>Source locations are printed more consistently in errors <a href="https://github.com/NixOS/nix/issues/561">#561</a> <a href="https://github.com/NixOS/nix/pull/9555">#9555</a></p>
<p>Source location information is now included in error messages more
consistently. Given this code:</p>
<pre><code class="language-nix">let
  attr = {foo = "bar";};
  key = {};
in
  attr.${key}
</code></pre>
<p>Previously, Nix would show this unhelpful message when attempting to evaluate
it:</p>
<pre><code>error:
       … while evaluating an attribute name

       error: value is a set while a string was expected
</code></pre>
<p>Now, the error message displays where the problematic value was found:</p>
<pre><code>error:
       … while evaluating an attribute name

         at bad.nix:4:11:

            3|   key = {};
            4| in attr.${key}
             |           ^
            5|

       error: expected a string but found a set
</code></pre>
</li>
<li>
<p>Some stack overflow segfaults are fixed <a href="https://github.com/NixOS/nix/issues/9616">#9616</a> <a href="https://github.com/NixOS/nix/pull/9617">#9617</a></p>
<p>The number of nested function calls has been restricted, to detect and report
infinite function call recursions. The default maximum call depth is 10,000 and
can be set with <a href="../command-ref/conf-file.html#conf-max-call-depth">the <code>max-call-depth</code>
option</a>.</p>
<p>This replaces the <code>stack overflow (possible infinite recursion)</code> message.</p>
</li>
<li>
<p>Better error reporting for <code>with</code> expressions <a href="https://github.com/NixOS/nix/pull/9658">#9658</a></p>
<p><code>with</code> expressions using non-attrset values to resolve variables are now reported with proper positions, e.g.</p>
<pre><code>nix-repl&gt; with 1; a
error:
       … while evaluating the first subexpression of a with expression
         at «string»:1:1:
            1| with 1; a
             | ^

       error: expected a set but found an integer
</code></pre>
</li>
<li>
<p>Functions are printed with more detail <a href="https://github.com/NixOS/nix/issues/7145">#7145</a> <a href="https://github.com/NixOS/nix/pull/9606">#9606</a></p>
<p><code>nix repl</code>, <code>nix eval</code>, <code>builtins.trace</code>, and most other places values are
printed will now include function names and source location information:</p>
<pre><code>$ nix repl nixpkgs
nix-repl&gt; builtins.map
«primop map»

nix-repl&gt; builtins.map lib.id
«partially applied primop map»

nix-repl&gt; builtins.trace lib.id "my-value"
trace: «lambda id @ /nix/store/8rrzq23h2zq7sv5l2vhw44kls5w0f654-source/lib/trivial.nix:26:5»
"my-value"
</code></pre>
</li>
<li>
<p>Flake operations like <code>nix develop</code> will no longer fail when run in a Git
repository where the <code>flake.lock</code> file is <code>.gitignore</code>d
<a href="https://github.com/NixOS/nix/issues/8854">#8854</a>
<a href="https://github.com/NixOS/nix/pull/9324">#9324</a></p>
</li>
<li>
<p>Nix commands will now respect Ctrl-C
<a href="https://github.com/NixOS/nix/issues/7145">#7145</a>
<a href="https://github.com/NixOS/nix/pull/6995">#6995</a>
<a href="https://github.com/NixOS/nix/pull/9687">#9687</a></p>
<p>Previously, many Nix commands would hang indefinitely if Ctrl-C was pressed
while performing various operations (including <code>nix develop</code>, <code>nix flake update</code>, and so on). With several fixes to Nix's signal handlers, Nix
commands will now exit quickly after Ctrl-C is pressed.</p>
</li>
<li>
<p><code>nix copy</code> to a <code>ssh-ng</code> store now needs <code>--substitute-on-destination</code> (a.k.a. <code>-s</code>)
in order to substitute paths on the remote store instead of copying them.
The behavior is consistent with <code>nix copy</code> to a different kind of remote store.
Previously this behavior was controlled by the
<code>builders-use-substitutes</code> setting and <code>--substitute-on-destination</code> was ignored.</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../release-notes/rl-2.21.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../release-notes/rl-2.19.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../release-notes/rl-2.21.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../release-notes/rl-2.19.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../redirects.js"></script>


    </div>
    </body>
</html>
