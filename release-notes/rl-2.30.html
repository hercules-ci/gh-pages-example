<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Release 2.30 (2025-07-07) - Nix 2.31.2+1 Reference Manual</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Nix 2.31.2+1 Reference Manual</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/NixOS/nix" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/NixOS/nix/tree/master/doc/manual/source/release-notes/rl-2.30.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="release-2300-2025-07-07"><a class="header" href="#release-2300-2025-07-07">Release 2.30.0 (2025-07-07)</a></h1>
<h2 id="backward-incompatible-changes-and-deprecations"><a class="header" href="#backward-incompatible-changes-and-deprecations">Backward-incompatible changes and deprecations</a></h2>
<ul>
<li>
<p><a href="../command-ref/conf-file.html#conf-build-dir"><code>build-dir</code></a> no longer defaults to <code>$TMPDIR</code></p>
<p>The directory in which temporary build directories are created no longer defaults
to <code>TMPDIR</code> or <code>/tmp</code>, to avoid builders making their directories
world-accessible. This behavior allowed escaping the build sandbox and can
cause build impurities even when not used maliciously. We now default to <code>builds</code>
in <code>NIX_STATE_DIR</code> (which is <code>/nix/var/nix/builds</code> in the default configuration).</p>
</li>
<li>
<p>Deprecate manually making structured attrs using the <code>__json</code> attribute <a href="https://github.com/NixOS/nix/pull/13220">#13220</a></p>
<p>The proper way to create a derivation using <a href="../language/advanced-attributes.html#adv-attr-structuredAttrs">structured attrs</a> in the Nix language is by using <code>__structuredAttrs = true</code> with <a href="../language/builtins.html#builtins-derivation"><code>builtins.derivation</code></a>.
However, by exploiting how structured attrs are implementated, it has also been possible to create them by setting the <code>__json</code> environment variable to a serialized JSON string.
This sneaky alternative method is now deprecated, and may be disallowed in future versions of Nix.</p>
</li>
<li>
<p>Rename <code>nix profile install</code> to <a href="../command-ref/new-cli/nix3-profile-add.html"><code>nix profile add</code></a> <a href="https://github.com/NixOS/nix/pull/13224">#13224</a></p>
<p>The command <code>nix profile install</code> has been renamed to <a href="../command-ref/new-cli/nix3-profile-add.html"><code>nix profile add</code></a> (though the former is still available as an alias). This is because the verb "add" is a better antonym for the verb "remove" (i.e. <code>nix profile remove</code>). Nix also does not have install hooks or general behavior often associated with "installing".</p>
</li>
</ul>
<h2 id="performance-improvements"><a class="header" href="#performance-improvements">Performance improvements</a></h2>
<p>This release has a number performance improvements, in particular:</p>
<ul>
<li>
<p>Reduce the size of value from 24 to 16 bytes <a href="https://github.com/NixOS/nix/pull/13407">#13407</a></p>
<p>This shaves off a very significant amount of memory used for evaluation (~20% percent reduction in maximum heap size and ~17% in total bytes).</p>
</li>
</ul>
<h2 id="features"><a class="header" href="#features">Features</a></h2>
<ul>
<li>
<p>Add <a href="../advanced-topics/eval-profiler.html">stack sampling evaluation profiler</a> <a href="https://github.com/NixOS/nix/pull/13220">#13220</a></p>
<p>The Nix evaluator now supports <a href="../advanced-topics/eval-profiler.html">stack sampling evaluation profiling</a> via the <a href="../command-ref/conf-file.html#conf-eval-profiler"><code>--eval-profiler flamegraph</code></a> setting.
It outputs collapsed call stack information to the file specified by
<a href="../command-ref/conf-file.html#conf-eval-profile-file"><code>--eval-profile-file</code></a> (<code>nix.profile</code> by default) in a format directly consumable
by <code>flamegraph.pl</code> and compatible tools like <a href="https://speedscope.app/">speedscope</a>.
Sampling frequency can be configured via <a href="../command-ref/conf-file.html#conf-eval-profiler-frequency"><code>--eval-profiler-frequency</code></a> (99 Hz by default).</p>
<p>Unlike the existing <a href="../command-ref/conf-file.html#conf-trace-function-calls"><code>--trace-function-calls</code></a>, this profiler includes the name of the function
being called when it's available.</p>
</li>
<li>
<p><a href="../command-ref/new-cli/nix3-repl.html"><code>nix repl</code></a> prints which variables were loaded <a href="https://github.com/NixOS/nix/pull/11406">#11406</a></p>
<p>Instead of <code>Added &lt;n&gt; variables</code> it now prints the first 10 variables that were added to the global scope.</p>
</li>
<li>
<p><code>nix flake archive</code>: Add <a href="../command-ref/new-cli/nix3-flake-archive.html#opt-no-check-sigs"><code>--no-check-sigs</code></a> option <a href="https://github.com/NixOS/nix/pull/13277">#13277</a></p>
<p>This is useful when using <a href="../command-ref/new-cli/nix3-flake-archive.html"><code>nix flake archive</code></a> with the destination set to a remote store.</p>
</li>
<li>
<p>Emit warnings for IFDs with <a href="../command-ref/conf-file.html#conf-trace-import-from-derivation"><code>trace-import-from-derivation</code></a> option <a href="https://github.com/NixOS/nix/pull/13279">#13279</a></p>
<p>While we have the setting <a href="../command-ref/conf-file.html#conf-allow-import-from-derivation"><code>allow-import-from-derivation</code></a> to deny import-from-derivation (IFD), sometimes users would like to observe IFDs during CI processes to gradually phase out the idiom. The new setting <code>trace-import-from-derivation</code>, when set, logs a simple warning to the console.</p>
</li>
<li>
<p><code>json-log-path</code> setting <a href="https://github.com/NixOS/nix/pull/13003">#13003</a></p>
<p>New setting <a href="../command-ref/conf-file.html#conf-json-log-path"><code>json-log-path</code></a> that sends a copy of all Nix log messages (in JSON format) to a file or Unix domain socket.</p>
</li>
<li>
<p>Non-flake inputs now contain a <code>sourceInfo</code> attribute <a href="https://github.com/NixOS/nix/issues/13164">#13164</a> <a href="https://github.com/NixOS/nix/pull/13170">#13170</a></p>
<p>Flakes have always had a <code>sourceInfo</code> attribute which describes the source of the flake.
The <code>sourceInfo.outPath</code> is often identical to the flake's <code>outPath</code>. However, it can differ when the flake is located in a subdirectory of its source.</p>
<p>Non-flake inputs (i.e. inputs with <a href="../command-ref/new-cli/nix3-flake.html"><code>flake = false</code></a>) can also be located at some path <em>within</em> a wider source.
This usually happens when defining a relative path input within the same source as the parent flake, e.g. <code>inputs.foo.url = ./some-file.nix</code>.
Such relative inputs will now inherit their parent's <code>sourceInfo</code>.</p>
<p>This also means it is now possible to use <code>?dir=subdir</code> on non-flake inputs.</p>
<p>This iterates on the work done in 2.26 to improve relative path support (<a href="https://github.com/NixOS/nix/pull/10089">#10089</a>),
and resolves a regression introduced in 2.28 relating to nested relative path inputs (<a href="https://github.com/NixOS/nix/issues/13164">#13164</a>).</p>
</li>
</ul>
<h2 id="miscellaneous-changes"><a class="header" href="#miscellaneous-changes">Miscellaneous changes</a></h2>
<ul>
<li>
<p><a href="../language/builtins.html#builtins-sort"><code>builtins.sort</code></a> uses PeekSort <a href="https://github.com/NixOS/nix/pull/12623">#12623</a></p>
<p>Previously it used libstdc++'s <code>std::stable_sort()</code>. However, that implementation is not reliable if the user-supplied comparison function is not a strict weak ordering.</p>
</li>
<li>
<p>Revert incomplete closure mixed download and build feature <a href="https://github.com/NixOS/nix/issues/77">#77</a> <a href="https://github.com/NixOS/nix/issues/12628">#12628</a> <a href="https://github.com/NixOS/nix/pull/13176">#13176</a></p>
<p>Since Nix 1.3 (<a href="https://github.com/NixOS/nix/commit/299141ecbd08bae17013226dbeae71e842b4fdd7">commit <code>299141e</code></a> in 2013) Nix has attempted to mix together upstream fresh builds and downstream substitutions when remote substuters contain an "incomplete closure" (have some store objects, but not the store objects they reference).
This feature is now removed.</p>
<p>In the worst case, removing this feature could cause more building downstream, but it should not cause outright failures, since this is not happening for opaque store objects that we don't know how to build if we decide not to substitute.
In practice, however, we doubt even more building is very likely to happen.
Remote stores that are missing dependencies in arbitrary ways (e.g. corruption) don't seem to be very common.</p>
<p>On the contrary, when remote stores fail to implement the <a href="../store/store-object.html#closure-property">closure property</a>, it is usually an <em>intentional</em> choice on the part of the remote store, because it wishes to serve as an "overlay" store over another store, such as <code>https://cache.nixos.org</code>.
If an "incomplete closure" is encountered in that situation, the right fix is not to do some sort of "franken-building" as this feature implemented, but instead to make sure both substituters are enabled in the settings.</p>
<p>(In the future, we should make it easier for remote stores to indicate this to clients, to catch settings that won't work in general before a missing dependency is actually encountered.)</p>
</li>
</ul>
<h2 id="contributors"><a class="header" href="#contributors">Contributors</a></h2>
<p>This release was made possible by the following 32 contributors:</p>
<ul>
<li>Cole Helbling <a href="https://github.com/cole-h"><strong>(@cole-h)</strong></a></li>
<li>Eelco Dolstra <a href="https://github.com/edolstra"><strong>(@edolstra)</strong></a></li>
<li>Egor Konovalov <a href="https://github.com/egorkonovalov"><strong>(@egorkonovalov)</strong></a></li>
<li>Farid Zakaria <a href="https://github.com/fzakaria"><strong>(@fzakaria)</strong></a></li>
<li>Graham Christensen <a href="https://github.com/grahamc"><strong>(@grahamc)</strong></a></li>
<li>gustavderdrache <a href="https://github.com/gustavderdrache"><strong>(@gustavderdrache)</strong></a></li>
<li>Gwenn Le Bihan <a href="https://github.com/gwennlbh"><strong>(@gwennlbh)</strong></a></li>
<li>h0nIg <a href="https://github.com/h0nIg"><strong>(@h0nIg)</strong></a></li>
<li>Jade Masker <a href="https://github.com/donottellmetonottellyou"><strong>(@donottellmetonottellyou)</strong></a></li>
<li>jayeshv <a href="https://github.com/jayeshv"><strong>(@jayeshv)</strong></a></li>
<li>Jeremy Fleischman <a href="https://github.com/jfly"><strong>(@jfly)</strong></a></li>
<li>John Ericson <a href="https://github.com/Ericson2314"><strong>(@Ericson2314)</strong></a></li>
<li>Jonas Chevalier <a href="https://github.com/zimbatm"><strong>(@zimbatm)</strong></a></li>
<li>Jörg Thalheim <a href="https://github.com/Mic92"><strong>(@Mic92)</strong></a></li>
<li>kstrafe <a href="https://github.com/kstrafe"><strong>(@kstrafe)</strong></a></li>
<li>Luc Perkins <a href="https://github.com/lucperkins"><strong>(@lucperkins)</strong></a></li>
<li>Matt Sturgeon <a href="https://github.com/MattSturgeon"><strong>(@MattSturgeon)</strong></a></li>
<li>Nikita Krasnov <a href="https://github.com/synalice"><strong>(@synalice)</strong></a></li>
<li>Peder Bergebakken Sundt <a href="https://github.com/pbsds"><strong>(@pbsds)</strong></a></li>
<li>pennae <a href="https://github.com/pennae"><strong>(@pennae)</strong></a></li>
<li>Philipp Otterbein</li>
<li>Pol Dellaiera <a href="https://github.com/drupol"><strong>(@drupol)</strong></a></li>
<li>PopeRigby <a href="https://github.com/poperigby"><strong>(@poperigby)</strong></a></li>
<li>Raito Bezarius</li>
<li>Robert Hensing <a href="https://github.com/roberth"><strong>(@roberth)</strong></a></li>
<li>Samuli Thomasson <a href="https://github.com/SimSaladin"><strong>(@SimSaladin)</strong></a></li>
<li>Sergei Zimmerman <a href="https://github.com/xokdvium"><strong>(@xokdvium)</strong></a></li>
<li>Seth Flynn <a href="https://github.com/getchoo"><strong>(@getchoo)</strong></a></li>
<li>Stefan Boca <a href="https://github.com/stefanboca"><strong>(@stefanboca)</strong></a></li>
<li>tomberek <a href="https://github.com/tomberek"><strong>(@tomberek)</strong></a></li>
<li>Tristan Ross <a href="https://github.com/RossComputerGuy"><strong>(@RossComputerGuy)</strong></a></li>
<li>Valentin Gagarin <a href="https://github.com/fricklerhandwerk"><strong>(@fricklerhandwerk)</strong></a></li>
<li>Vladimír Čunát <a href="https://github.com/vcunat"><strong>(@vcunat)</strong></a></li>
<li>Wolfgang Walther <a href="https://github.com/wolfgangwalther"><strong>(@wolfgangwalther)</strong></a></li>
</ul>
<!-- markdown links -->

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../release-notes/rl-2.31.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../release-notes/rl-2.29.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../release-notes/rl-2.31.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../release-notes/rl-2.29.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../redirects.js"></script>



    </div>
    </body>
</html>
