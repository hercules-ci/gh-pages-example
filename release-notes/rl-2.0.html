<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Release 2.0 (2018-02-22) - Nix 2.28.4 Reference Manual</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Nix 2.28.4 Reference Manual</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/NixOS/nix" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/NixOS/nix/tree/master/doc/manual/source/release-notes/rl-2.0.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="release-20-2018-02-22"><a class="header" href="#release-20-2018-02-22">Release 2.0 (2018-02-22)</a></h1>
<p>The following incompatible changes have been made:</p>
<ul>
<li>
<p>The manifest-based substituter mechanism
(<code>download-using-manifests</code>) has been
<a href="https://github.com/NixOS/nix/commit/867967265b80946dfe1db72d40324b4f9af988ed">removed</a>.
It has been superseded by the binary cache substituter mechanism
since several years. As a result, the following programs have been
removed:</p>
<ul>
<li>
<p><code>nix-pull</code></p>
</li>
<li>
<p><code>nix-generate-patches</code></p>
</li>
<li>
<p><code>bsdiff</code></p>
</li>
<li>
<p><code>bspatch</code></p>
</li>
</ul>
</li>
<li>
<p>The “copy from other stores” substituter mechanism
(<code>copy-from-other-stores</code> and the <code>NIX_OTHER_STORES</code> environment
variable) has been removed. It was primarily used by the NixOS
installer to copy available paths from the installation medium. The
replacement is to use a chroot store as a substituter (e.g.
<code>--substituters /mnt</code>), or to build into a chroot store (e.g.
<code>--store /mnt --substituters /</code>).</p>
</li>
<li>
<p>The command <code>nix-push</code> has been removed as part of the effort to
eliminate Nix's dependency on Perl. You can use <code>nix copy</code> instead,
e.g. <code>nix copy                 --to file:///tmp/my-binary-cache paths…</code></p>
</li>
<li>
<p>The “nested” log output feature (<code>--log-type                 pretty</code>) has been removed. As a result, <code>nix-log2xml</code> was also
removed.</p>
</li>
<li>
<p>OpenSSL-based signing has been
<a href="https://github.com/NixOS/nix/commit/f435f8247553656774dd1b2c88e9de5d59cab203">removed</a>.
This feature was never well-supported. A better alternative is
provided by the <code>secret-key-files</code> and <code>trusted-public-keys</code>
options.</p>
</li>
<li>
<p>Failed build caching has been
<a href="https://github.com/NixOS/nix/commit/8cffec84859cec8b610a2a22ab0c4d462a9351ff">removed</a>.
This feature was introduced to support the Hydra continuous build
system, but Hydra no longer uses it.</p>
</li>
<li>
<p><code>nix-mode.el</code> has been removed from Nix. It is now <a href="https://github.com/NixOS/nix-mode">a separate
repository</a> and can be installed
through the MELPA package repository.</p>
</li>
</ul>
<p>This release has the following new features:</p>
<ul>
<li>
<p>It introduces a new command named <code>nix</code>, which is intended to
eventually replace all <code>nix-*</code> commands with a more consistent and
better designed user interface. It currently provides replacements
for some (but not all) of the functionality provided by <code>nix-store</code>,
<code>nix-build</code>, <code>nix-shell -p</code>, <code>nix-env -qa</code>, <code>nix-instantiate --eval</code>, <code>nix-push</code> and <code>nix-copy-closure</code>. It has the following
major features:</p>
<ul>
<li>
<p>Unlike the legacy commands, it has a consistent way to refer to
packages and package-like arguments (like store paths). For
example, the following commands all copy the GNU Hello package
to a remote machine:</p>
<pre><code>nix copy --to ssh://machine nixpkgs.hello

nix copy --to ssh://machine /nix/store/0i2jd68mp5g6h2sa5k9c85rb80sn8hi9-hello-2.10

nix copy --to ssh://machine '(with import &lt;nixpkgs&gt; {}; hello)'
</code></pre>
<p>By contrast, <code>nix-copy-closure</code> only accepted store paths as
arguments.</p>
</li>
<li>
<p>It is self-documenting: <code>--help</code> shows all available
command-line arguments. If <code>--help</code> is given after a subcommand,
it shows examples for that subcommand. <code>nix                                                                 --help-config</code> shows all configuration options.</p>
</li>
<li>
<p>It is much less verbose. By default, it displays a single-line
progress indicator that shows how many packages are left to be
built or downloaded, and (if there are running builds) the most
recent line of builder output. If a build fails, it shows the
last few lines of builder output. The full build log can be
retrieved using <code>nix                                                                 log</code>.</p>
</li>
<li>
<p>It
<a href="https://github.com/NixOS/nix/commit/b8283773bd64d7da6859ed520ee19867742a03ba">provides</a>
all <code>nix.conf</code> configuration options as command line flags. For
example, instead of <code>--option                                                                 http-connections 100</code> you can write <code>--http-connections 100</code>.
Boolean options can be written as <code>--foo</code> or <code>--no-foo</code> (e.g.
<code>--no-auto-optimise-store</code>).</p>
</li>
<li>
<p>Many subcommands have a <code>--json</code> flag to write results to stdout
in JSON format.</p>
</li>
</ul>
<blockquote>
<p><strong>Warning</strong></p>
<p>Please note that the <code>nix</code> command is a work in progress and the
interface is subject to change.</p>
</blockquote>
<p>It provides the following high-level (“porcelain”) subcommands:</p>
<ul>
<li>
<p><code>nix build</code> is a replacement for <code>nix-build</code>.</p>
</li>
<li>
<p><code>nix run</code> executes a command in an environment in which the
specified packages are available. It is (roughly) a replacement
for <code>nix-shell                                                                 -p</code>. Unlike that command, it does not execute the command in a
shell, and has a flag (<code>-c</code>) that specifies the unquoted command
line to be executed.</p>
<p>It is particularly useful in conjunction with chroot stores,
allowing Linux users who do not have permission to install Nix
in <code>/nix/store</code> to still use binary substitutes that assume
<code>/nix/store</code>. For example,</p>
<pre><code>nix run --store ~/my-nix nixpkgs.hello -c hello --greeting 'Hi everybody!'
</code></pre>
<p>downloads (or if not substitutes are available, builds) the GNU
Hello package into <code>~/my-nix/nix/store</code>, then runs <code>hello</code> in a
mount namespace where <code>~/my-nix/nix/store</code> is mounted onto
<code>/nix/store</code>.</p>
</li>
<li>
<p><code>nix search</code> replaces <code>nix-env                                                                 -qa</code>. It searches the available packages for occurrences of a
search string in the attribute name, package name or
description. Unlike <code>nix-env -qa</code>, it has a cache to speed up
subsequent searches.</p>
</li>
<li>
<p><code>nix copy</code> copies paths between arbitrary Nix stores,
generalising <code>nix-copy-closure</code> and <code>nix-push</code>.</p>
</li>
<li>
<p><code>nix repl</code> replaces the external program <code>nix-repl</code>. It provides
an interactive environment for evaluating and building Nix
expressions. Note that it uses <code>linenoise-ng</code> instead of GNU
Readline.</p>
</li>
<li>
<p><code>nix upgrade-nix</code> upgrades Nix to the latest stable version.
This requires that Nix is installed in a profile. (Thus it won’t
work on NixOS, or if it’s installed outside of the Nix store.)</p>
</li>
<li>
<p><code>nix verify</code> checks whether store paths are unmodified and/or
“trusted” (see below). It replaces <code>nix-store --verify</code> and
<code>nix-store                                                                 --verify-path</code>.</p>
</li>
<li>
<p><code>nix log</code> shows the build log of a package or path. If the
build log is not available locally, it will try to obtain it
from the configured substituters (such as
<a href="https://cache.nixos.org/">cache.nixos.org</a>, which now
provides build logs).</p>
</li>
<li>
<p><code>nix edit</code> opens the source code of a package in your editor.</p>
</li>
<li>
<p><code>nix eval</code> replaces <code>nix-instantiate --eval</code>.</p>
</li>
<li>
<p><code>nix                                                                 why-depends</code> shows why one store path has another in its
closure. This is primarily useful to finding the causes of
closure bloat. For example,</p>
<pre><code>nix why-depends nixpkgs.vlc nixpkgs.libdrm.dev
</code></pre>
<p>shows a chain of files and fragments of file contents that cause
the VLC package to have the “dev” output of <code>libdrm</code> in its
closure — an undesirable situation.</p>
</li>
<li>
<p><code>nix path-info</code> shows information about store paths, replacing
<code>nix-store -q</code>. A useful feature is the option <code>--closure-size</code>
(<code>-S</code>). For example, the following command show the closure
sizes of every path in the current NixOS system closure, sorted
by size:</p>
<pre><code>nix path-info -rS /run/current-system | sort -nk2
</code></pre>
</li>
<li>
<p><code>nix optimise-store</code> replaces <code>nix-store --optimise</code>. The main
difference is that it has a progress indicator.</p>
</li>
</ul>
<p>A number of low-level (“plumbing”) commands are also available:</p>
<ul>
<li>
<p><code>nix ls-store</code> and <code>nix                                                                 ls-nar</code> list the contents of a store path or NAR file. The
former is primarily useful in conjunction with remote stores,
e.g.</p>
<pre><code>nix ls-store --store https://cache.nixos.org/ -lR /nix/store/0i2jd68mp5g6h2sa5k9c85rb80sn8hi9-hello-2.10
</code></pre>
<p>lists the contents of path in a binary cache.</p>
</li>
<li>
<p><code>nix cat-store</code> and <code>nix                                                                 cat-nar</code> allow extracting a file from a store path or NAR file.</p>
</li>
<li>
<p><code>nix dump-path</code> writes the contents of a store path to stdout in
NAR format. This replaces <code>nix-store --dump</code>.</p>
</li>
<li>
<p><code>nix                                                                 show-derivation</code> displays a store derivation in JSON format.
This is an alternative to <code>pp-aterm</code>.</p>
</li>
<li>
<p><code>nix                                                                 add-to-store</code> replaces <code>nix-store                                                                 --add</code>.</p>
</li>
<li>
<p><code>nix sign-paths</code> signs store paths.</p>
</li>
<li>
<p><code>nix copy-sigs</code> copies signatures from one store to another.</p>
</li>
<li>
<p><code>nix show-config</code> shows all configuration options and their
current values.</p>
</li>
</ul>
</li>
<li>
<p>The store abstraction that Nix has had for a long time to support
store access via the Nix daemon has been extended
significantly. In particular, substituters (which used to be
external programs such as <code>download-from-binary-cache</code>) are now
subclasses of the abstract <code>Store</code> class. This allows many Nix
commands to operate on such store types. For example, <code>nix path-info</code> shows information about paths in your local Nix store,
while <code>nix path-info --store https://cache.nixos.org/</code> shows
information about paths in the specified binary cache. Similarly,
<code>nix-copy-closure</code>, <code>nix-push</code> and substitution are all instances
of the general notion of copying paths between different kinds of
Nix stores.</p>
<p>Stores are specified using an URI-like syntax, e.g.
<a href="https://cache.nixos.org/">https://cache.nixos.org/</a> or <a href="ssh://machine">ssh://machine</a>. The following store
types are supported:</p>
<ul>
<li>
<p><code>LocalStore</code> (stori URI <code>local</code> or an absolute path) and the
misnamed <code>RemoteStore</code> (<code>daemon</code>) provide access to a local Nix
store, the latter via the Nix daemon. You can use <code>auto</code> or the
empty string to auto-select a local or daemon store depending on
whether you have write permission to the Nix store. It is no
longer necessary to set the <code>NIX_REMOTE</code> environment variable to
use the Nix daemon.</p>
<p>As noted above, <code>LocalStore</code> now supports chroot builds,
allowing the “physical” location of the Nix store (e.g.
<code>/home/alice/nix/store</code>) to differ from its “logical” location
(typically <code>/nix/store</code>). This allows non-root users to use Nix
while still getting the benefits from prebuilt binaries from
<a href="https://cache.nixos.org/">cache.nixos.org</a>.</p>
</li>
<li>
<p><code>BinaryCacheStore</code> is the abstract superclass of all binary
cache stores. It supports writing build logs and NAR content
listings in JSON format.</p>
</li>
<li>
<p><code>HttpBinaryCacheStore</code> (<code>http://</code>, <code>https://</code>) supports binary
caches via HTTP or HTTPS. If the server supports <code>PUT</code> requests,
it supports uploading store paths via commands such as <code>nix                                                                 copy</code>.</p>
</li>
<li>
<p><code>LocalBinaryCacheStore</code> (<code>file://</code>) supports binary caches in
the local filesystem.</p>
</li>
<li>
<p><code>S3BinaryCacheStore</code> (<code>s3://</code>) supports binary caches stored in
Amazon S3, if enabled at compile time.</p>
</li>
<li>
<p><code>LegacySSHStore</code> (<code>ssh://</code>) is used to implement remote builds
and <code>nix-copy-closure</code>.</p>
</li>
<li>
<p><code>SSHStore</code> (<code>ssh-ng://</code>) supports arbitrary Nix operations on a
remote machine via the same protocol used by <code>nix-daemon</code>.</p>
</li>
</ul>
</li>
<li>
<p>Security has been improved in various ways:</p>
<ul>
<li>
<p>Nix now stores signatures for local store paths. When paths are
copied between stores (e.g., copied from a binary cache to a
local store), signatures are propagated.</p>
<p>Locally-built paths are signed automatically using the secret
keys specified by the <code>secret-key-files</code> store option.
Secret/public key pairs can be generated using <code>nix-store                                                                 --generate-binary-cache-key</code>.</p>
<p>In addition, locally-built store paths are marked as “ultimately
trusted”, but this bit is not propagated when paths are copied
between stores.</p>
</li>
<li>
<p>Content-addressable store paths no longer require signatures —
they can be imported into a store by unprivileged users even if
they lack signatures.</p>
</li>
<li>
<p>The command <code>nix verify</code> checks whether the specified paths are
trusted, i.e., have a certain number of trusted signatures, are
ultimately trusted, or are content-addressed.</p>
</li>
<li>
<p>Substitutions from binary caches
<a href="https://github.com/NixOS/nix/commit/ecbc3fedd3d5bdc5a0e1a0a51b29062f2874ac8b">now</a>
require signatures by default. This was already the case on
NixOS.</p>
</li>
<li>
<p>In Linux sandbox builds, we
<a href="https://github.com/NixOS/nix/commit/eba840c8a13b465ace90172ff76a0db2899ab11b">now</a>
use <code>/build</code> instead of <code>/tmp</code> as the temporary build directory.
This fixes potential security problems when a build accidentally
stores its <code>TMPDIR</code> in some security-sensitive place, such as an
RPATH.</p>
</li>
</ul>
</li>
<li>
<p><em>Pure evaluation mode</em>. With the <code>--pure-eval</code> flag, Nix enables a
variant of the existing restricted evaluation mode that forbids
access to anything that could cause different evaluations of the
same command line arguments to produce a different result. This
includes builtin functions such as <code>builtins.getEnv</code>, but more
importantly, <em>all</em> filesystem or network access unless a content
hash or commit hash is specified. For example, calls to
<code>builtins.fetchGit</code> are only allowed if a <code>rev</code> attribute is
specified.</p>
<p>The goal of this feature is to enable true reproducibility and
traceability of builds (including NixOS system configurations) at
the evaluation level. For example, in the future, <code>nixos-rebuild</code>
might build configurations from a Nix expression in a Git repository
in pure mode. That expression might fetch other repositories such as
Nixpkgs via <code>builtins.fetchGit</code>. The commit hash of the top-level
repository then uniquely identifies a running system, and, in
conjunction with that repository, allows it to be reproduced or
modified.</p>
</li>
<li>
<p>There are several new features to support binary reproducibility
(i.e. to help ensure that multiple builds of the same derivation
produce exactly the same output). When <code>enforce-determinism</code> is set
to <code>false</code>, it’s <a href="https://github.com/NixOS/nix/commit/8bdf83f936adae6f2c907a6d2541e80d4120f051">no
longer</a>
a fatal error if build rounds produce different output. Also, a hook
named <code>diff-hook</code> is
<a href="https://github.com/NixOS/nix/commit/9a313469a4bdea2d1e8df24d16289dc2a172a169">provided</a>
to allow you to run tools such as <code>diffoscope</code> when build rounds
produce different output.</p>
</li>
<li>
<p>Configuring remote builds is a lot easier now. Provided you are not
using the Nix daemon, you can now just specify a remote build
machine on the command line, e.g. <code>--option builders                 'ssh://my-mac x86_64-darwin'</code>. The environment variable
<code>NIX_BUILD_HOOK</code> has been removed and is no longer needed. The
environment variable <code>NIX_REMOTE_SYSTEMS</code> is still supported for
compatibility, but it is also possible to specify builders in
<code>nix.conf</code> by setting the option <code>builders =                 @path</code>.</p>
</li>
<li>
<p>If a fixed-output derivation produces a result with an incorrect
hash, the output path is moved to the location corresponding to the
actual hash and registered as valid. Thus, a subsequent build of the
fixed-output derivation with the correct hash is unnecessary.</p>
</li>
<li>
<p><code>nix-shell</code>
<a href="https://github.com/NixOS/nix/commit/ea59f39326c8e9dc42dfed4bcbf597fbce58797c">now</a>
sets the <code>IN_NIX_SHELL</code> environment variable during evaluation and
in the shell itself. This can be used to perform different actions
depending on whether you’re in a Nix shell or in a regular build.
Nixpkgs provides <code>lib.inNixShell</code> to check this variable during
evaluation.</p>
</li>
<li>
<p><code>NIX_PATH</code> is now lazy, so URIs in the path are only downloaded if
they are needed for evaluation.</p>
</li>
<li>
<p>You can now use <code>channel:</code> as a short-hand for
<a href="https://nixos.org/channels//nixexprs.tar.xz">https://nixos.org/channels//nixexprs.tar.xz</a>. For example,
<code>nix-build channel:nixos-15.09 -A hello</code> will build the GNU Hello
package from the <code>nixos-15.09</code> channel. In the future, this may
use Git to fetch updates more efficiently.</p>
</li>
<li>
<p>When <code>--no-build-output</code> is given, the last 10 lines of the build
log will be shown if a build fails.</p>
</li>
<li>
<p>Networking has been improved:</p>
<ul>
<li>
<p>HTTP/2 is now supported. This makes binary cache lookups <a href="https://github.com/NixOS/nix/commit/90ad02bf626b885a5dd8967894e2eafc953bdf92">much
more
efficient</a>.</p>
</li>
<li>
<p>We now retry downloads on many HTTP errors, making binary caches
substituters more resilient to temporary failures.</p>
</li>
<li>
<p>HTTP credentials can now be configured via the standard <code>netrc</code>
mechanism.</p>
</li>
<li>
<p>If S3 support is enabled at compile time, <a href="s3://">s3://</a> URIs are
<a href="https://github.com/NixOS/nix/commit/9ff9c3f2f80ba4108e9c945bbfda2c64735f987b">supported</a>
in all places where Nix allows URIs.</p>
</li>
<li>
<p>Brotli compression is now supported. In particular,
<a href="https://cache.nixos.org/">cache.nixos.org</a> build logs are now compressed
using Brotli.</p>
</li>
</ul>
</li>
<li>
<p><code>nix-env</code>
<a href="https://github.com/NixOS/nix/commit/b0cb11722626e906a73f10dd9a0c9eea29faf43a">now</a>
ignores packages with bad derivation names (in particular those
starting with a digit or containing a dot).</p>
</li>
<li>
<p>Many configuration options have been renamed, either because they
were unnecessarily verbose (e.g. <code>build-use-sandbox</code> is now just
<code>sandbox</code>) or to reflect generalised behaviour (e.g. <code>binary-caches</code>
is now <code>substituters</code> because it allows arbitrary store URIs). The
old names are still supported for compatibility.</p>
</li>
<li>
<p>The <code>max-jobs</code> option can
<a href="https://github.com/NixOS/nix/commit/7251d048fa812d2551b7003bc9f13a8f5d4c95a5">now</a>
be set to <code>auto</code> to use the number of CPUs in the system.</p>
</li>
<li>
<p>Hashes can
<a href="https://github.com/NixOS/nix/commit/c0015e87af70f539f24d2aa2bc224a9d8b84276b">now</a>
be specified in base-64 format, in addition to base-16 and the
non-standard base-32.</p>
</li>
<li>
<p><code>nix-shell</code> now uses <code>bashInteractive</code> from Nixpkgs, rather than the
<code>bash</code> command that happens to be in the caller’s <code>PATH</code>. This is
especially important on macOS where the <code>bash</code> provided by the
system is seriously outdated and cannot execute <code>stdenv</code>’s setup
script.</p>
</li>
<li>
<p>Nix can now automatically trigger a garbage collection if free disk
space drops below a certain level during a build. This is configured
using the <code>min-free</code> and <code>max-free</code> options.</p>
</li>
<li>
<p><code>nix-store -q --roots</code> and <code>nix-store --gc --print-roots</code> now show
temporary and in-memory roots.</p>
</li>
<li>
<p>Nix can now be extended with plugins. See the documentation of the
<code>plugin-files</code> option for more details.</p>
</li>
</ul>
<p>The Nix language has the following new features:</p>
<ul>
<li>
<p>It supports floating point numbers. They are based on the C++
<code>float</code> type and are supported by the existing numerical operators.
Export and import to and from JSON and XML works, too.</p>
</li>
<li>
<p>Derivation attributes can now reference the outputs of the
derivation using the <code>placeholder</code> builtin function. For example,
the attribute</p>
<pre><code>configureFlags = "--prefix=${placeholder "out"} --includedir=${placeholder "dev"}";
</code></pre>
<p>will cause the <code>configureFlags</code> environment variable to contain the
actual store paths corresponding to the <code>out</code> and <code>dev</code> outputs.</p>
</li>
</ul>
<p>The following builtin functions are new or extended:</p>
<ul>
<li>
<p><code>builtins.fetchGit</code> allows Git repositories to be fetched at
evaluation time. Thus it differs from the <code>fetchgit</code> function in
Nixpkgs, which fetches at build time and cannot be used to fetch Nix
expressions during evaluation. A typical use case is to import
external NixOS modules from your configuration, e.g.</p>
<pre><code>imports = [ (builtins.fetchGit https://github.com/edolstra/dwarffs + "/module.nix") ];
</code></pre>
</li>
<li>
<p>Similarly, <code>builtins.fetchMercurial</code> allows you to fetch Mercurial
repositories.</p>
</li>
<li>
<p><code>builtins.path</code> generalises <code>builtins.filterSource</code> and path
literals (e.g. <code>./foo</code>). It allows specifying a store path name that
differs from the source path name (e.g. <code>builtins.path { path = ./foo; name = "bar";                 }</code>) and also supports filtering out unwanted files.</p>
</li>
<li>
<p><code>builtins.fetchurl</code> and <code>builtins.fetchTarball</code> now support <code>sha256</code>
and <code>name</code> attributes.</p>
</li>
<li>
<p><code>builtins.split</code> splits a string using a POSIX extended regular
expression as the separator.</p>
</li>
<li>
<p><code>builtins.partition</code> partitions the elements of a list into two
lists, depending on a Boolean predicate.</p>
</li>
<li>
<p><code>&lt;nix/fetchurl.nix&gt;</code> now uses the content-addressable tarball cache
at <a href="http://tarballs.nixos.org/">http://tarballs.nixos.org/</a>, just like <code>fetchurl</code> in Nixpkgs.
(f2682e6e18a76ecbfb8a12c17e3a0ca15c084197)</p>
</li>
<li>
<p>In restricted and pure evaluation mode, builtin functions that
download from the network (such as <code>fetchGit</code>) are permitted to
fetch underneath a list of URI prefixes specified in the option
<code>allowed-uris</code>.</p>
</li>
</ul>
<p>The Nix build environment has the following changes:</p>
<ul>
<li>
<p>Values such as Booleans, integers, (nested) lists and attribute sets
can
<a href="https://github.com/NixOS/nix/commit/6de33a9c675b187437a2e1abbcb290981a89ecb1">now</a>
be passed to builders in a non-lossy way. If the special attribute
<code>__structuredAttrs</code> is set to <code>true</code>, the other derivation
attributes are serialised in JSON format and made available to the
builder via the file <code>.attrs.json</code> in the builder’s temporary
directory. This obviates the need for <code>passAsFile</code> since JSON files
have no size restrictions, unlike process environments.</p>
<p><a href="https://github.com/NixOS/nix/commit/2d5b1b24bf70a498e4c0b378704cfdb6471cc699">As a convenience to Bash
builders</a>,
Nix writes a script named <code>.attrs.sh</code> to the builder’s directory
that initialises shell variables corresponding to all attributes
that are representable in Bash. This includes non-nested
(associative) arrays. For example, the attribute <code>hardening.format =                 true</code> ends up as the Bash associative array element
<code>${hardening[format]}</code>.</p>
</li>
<li>
<p>Builders can
<a href="https://github.com/NixOS/nix/commit/88e6bb76de5564b3217be9688677d1c89101b2a3">now</a>
communicate what build phase they are in by writing messages to the
file descriptor specified in <code>NIX_LOG_FD</code>. The current phase is
shown by the <code>nix</code> progress indicator.</p>
</li>
<li>
<p>In Linux sandbox builds, we
<a href="https://github.com/NixOS/nix/commit/a2d92bb20e82a0957067ede60e91fab256948b41">now</a>
provide a default <code>/bin/sh</code> (namely <code>ash</code> from BusyBox).</p>
</li>
<li>
<p>In structured attribute mode, <code>exportReferencesGraph</code>
<a href="https://github.com/NixOS/nix/commit/c2b0d8749f7e77afc1c4b3e8dd36b7ee9720af4a">exports</a>
extended information about closures in JSON format. In particular,
it includes the sizes and hashes of paths. This is primarily useful
for NixOS image builders.</p>
</li>
<li>
<p>Builds are
<a href="https://github.com/NixOS/nix/commit/21948deed99a3295e4d5666e027a6ca42dc00b40">now</a>
killed as soon as Nix receives EOF on the builder’s stdout or
stderr. This fixes a bug that allowed builds to hang Nix
indefinitely, regardless of timeouts.</p>
</li>
<li>
<p>The <code>sandbox-paths</code> configuration option can now specify optional
paths by appending a <code>?</code>, e.g. <code>/dev/nvidiactl?</code> will bind-mount
<code>/dev/nvidiactl</code> only if it exists.</p>
</li>
<li>
<p>On Linux, builds are now executed in a user namespace with UID 1000
and GID 100.</p>
</li>
</ul>
<p>A number of significant internal changes were made:</p>
<ul>
<li>
<p>Nix no longer depends on Perl and all Perl components have been
rewritten in C++ or removed. The Perl bindings that used to be part
of Nix have been moved to a separate package, <code>nix-perl</code>.</p>
</li>
<li>
<p>All <code>Store</code> classes are now thread-safe. <code>RemoteStore</code> supports
multiple concurrent connections to the daemon. This is primarily
useful in multi-threaded programs such as <code>hydra-queue-runner</code>.</p>
</li>
</ul>
<p>This release has contributions from Adrien Devresse, Alexander Ried,
Alex Cruice, Alexey Shmalko, AmineChikhaoui, Andy Wingo, Aneesh Agrawal,
Anthony Cowley, Armijn Hemel, aszlig, Ben Gamari, Benjamin Hipple,
Benjamin Staffin, Benno Fünfstück, Bjørn Forsman, Brian McKenna, Charles
Strahan, Chase Adams, Chris Martin, Christian Theune, Chris Warburton,
Daiderd Jordan, Dan Connolly, Daniel Peebles, Dan Peebles, davidak,
David McFarland, Dmitry Kalinkin, Domen Kožar, Eelco Dolstra, Emery
Hemingway, Eric Litak, Eric Wolf, Fabian Schmitthenner, Frederik
Rietdijk, Gabriel Gonzalez, Giorgio Gallo, Graham Christensen, Guillaume
Maudoux, Harmen, Iavael, James Broadhead, James Earl Douglas, Janus
Troelsen, Jeremy Shaw, Joachim Schiele, Joe Hermaszewski, Joel Moberg,
Johannes 'fish' Ziemke, Jörg Thalheim, Jude Taylor, kballou, Keshav
Kini, Kjetil Orbekk, Langston Barrett, Linus Heckemann, Ludovic Courtès,
Manav Rathi, Marc Scholten, Markus Hauck, Matt Audesse, Matthew Bauer,
Matthias Beyer, Matthieu Coudron, N1X, Nathan Zadoks, Neil Mayhew,
Nicolas B. Pierron, Niklas Hambüchen, Nikolay Amiantov, Ole Jørgen
Brønner, Orivej Desh, Peter Simons, Peter Stuart, Pyry Jahkola, regnat,
Renzo Carbonara, Rhys, Robert Vollmert, Scott Olson, Scott R. Parish,
Sergei Trofimovich, Shea Levy, Sheena Artrip, Spencer Baugh, Stefan
Junker, Susan Potter, Thomas Tuegel, Timothy Allen, Tristan Hume, Tuomas
Tynkkynen, tv, Tyson Whitehead, Vladimír Čunát, Will Dietz, wmertens,
Wout Mertens, zimbatm and Zoran Plesivčak.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../release-notes/rl-2.1.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../release-notes/rl-1.11.10.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../release-notes/rl-2.1.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../release-notes/rl-1.11.10.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../redirects.js"></script>


    </div>
    </body>
</html>
