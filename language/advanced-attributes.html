<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Advanced Attributes - Nix 2.31.3 Reference Manual</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../custom-80d08c7f.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-374ccf4d.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-f3fccd7f.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Nix 2.31.3 Reference Manual</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/NixOS/nix" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>
                        <a href="https://github.com/NixOS/nix/tree/master/doc/manual/source/language/advanced-attributes.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <span class=fa-svg id="git-edit-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M421.7 220.3l-11.3 11.3-22.6 22.6-205 205c-6.6 6.6-14.8 11.5-23.8 14.1L30.8 511c-8.4 2.5-17.5 .2-23.7-6.1S-1.5 489.7 1 481.2L38.7 353.1c2.6-9 7.5-17.2 14.1-23.8l205-205 22.6-22.6 11.3-11.3 33.9 33.9 62.1 62.1 33.9 33.9zM96 353.9l-9.3 9.3c-.9 .9-1.6 2.1-2 3.4l-25.3 86 86-25.3c1.3-.4 2.5-1.1 3.4-2l9.3-9.3H112c-8.8 0-16-7.2-16-16V353.9zM453.3 19.3l39.4 39.4c25 25 25 65.5 0 90.5l-14.5 14.5-22.6 22.6-11.3 11.3-33.9-33.9-62.1-62.1L314.3 67.7l11.3-11.3 22.6-22.6 14.5-14.5c25-25 65.5-25 90.5 0z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="advanced-attributes"><a class="header" href="#advanced-attributes">Advanced Attributes</a></h1>
<p>Derivations can declare some infrequently used optional attributes.</p>
<h2 id="inputs"><a class="header" href="#inputs">Inputs</a></h2>
<ul>
<li>
<p><a href="#adv-attr-exportReferencesGraph" id="adv-attr-exportReferencesGraph"><code>exportReferencesGraph</code></a><br>This attribute allows builders access to the references graph of
their inputs. The attribute is a list of inputs in the Nix store
whose references graph the builder needs to know. The value of
this attribute should be a list of pairs <code>[ name1 path1 name2 path2 ...  ]</code>. The references graph of each <em>pathN</em> will be stored
in a text file <em>nameN</em> in the temporary build directory. The text
files have the format used by <code>nix-store --register-validity</code>
(with the deriver fields left empty). For example, when the
following derivation is built:</p>
<pre><code class="language-nix">derivation {
  ...
  exportReferencesGraph = [ "libfoo-graph" libfoo ];
};
</code></pre>
<p>the references graph of <code>libfoo</code> is placed in the file
<code>libfoo-graph</code> in the temporary build directory.</p>
<p><code>exportReferencesGraph</code> is useful for builders that want to do
something with the closure of a store path. Examples include the
builders in NixOS that generate the initial ramdisk for booting
Linux (a <code>cpio</code> archive containing the closure of the boot script)
and the ISO-9660 image for the installation CD (which is populated
with a Nix store containing the closure of a bootable NixOS
configuration).</p>
</li>
<li>
<p><a href="#adv-attr-passAsFile" id="adv-attr-passAsFile"><code>passAsFile</code></a><br>A list of names of attributes that should be passed via files rather
than environment variables. For example, if you have</p>
<pre><code class="language-nix">passAsFile = ["big"];
big = "a very long string";
</code></pre>
<p>then when the builder runs, the environment variable <code>bigPath</code>
will contain the absolute path to a temporary file containing <code>a very long string</code>. That is, for any attribute <em>x</em> listed in
<code>passAsFile</code>, Nix will pass an environment variable <code>xPath</code>
holding the path of the file containing the value of attribute
<em>x</em>. This is useful when you need to pass large strings to a
builder, since most operating systems impose a limit on the size
of the environment (typically, a few hundred kilobyte).</p>
</li>
<li>
<p><a href="#adv-attr-structuredAttrs" id="adv-attr-structuredAttrs"><code>__structuredAttrs</code></a><br>If the special attribute <code>__structuredAttrs</code> is set to <code>true</code>, the other derivation
attributes are serialised into a file in JSON format.</p>
<p>This obviates the need for <a href="#adv-attr-passAsFile"><code>passAsFile</code></a> since JSON files have no size restrictions, unlike process environments.
It also makes it possible to tweak derivation settings in a structured way;
see <a href="#adv-attr-outputChecks"><code>outputChecks</code></a> for example.</p>
<p>See the <a href="../store/derivation/index.html#structured-attrs">corresponding section in the derivation page</a> for further details.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>If set to <code>true</code>, other advanced attributes such as <a href="#adv-attr-allowedReferences"><code>allowedReferences</code></a>, <a href="#adv-attr-allowedRequisites"><code>allowedRequisites</code></a>,
<a href="#adv-attr-disallowedReferences"><code>disallowedReferences</code></a> and <a href="#adv-attr-disallowedRequisites"><code>disallowedRequisites</code></a>, maxSize, and maxClosureSize.
will have no effect.</p>
</blockquote>
</li>
</ul>
<h2 id="output-checks"><a class="header" href="#output-checks">Output checks</a></h2>
<p>See the <a href="../store/derivation/outputs/index.html">corresponding section in the derivation output page</a>.</p>
<ul>
<li>
<p><a href="#adv-attr-allowedReferences" id="adv-attr-allowedReferences"><code>allowedReferences</code></a><br>The optional attribute <code>allowedReferences</code> specifies a list of legal
references (dependencies) of the output of the builder. For example,</p>
<pre><code class="language-nix">allowedReferences = [];
</code></pre>
<p>enforces that the output of a derivation cannot have any runtime
dependencies on its inputs. To allow an output to have a runtime
dependency on itself, use <code>"out"</code> as a list item. This is used in
NixOS to check that generated files such as initial ramdisks for
booting Linux don’t have accidental dependencies on other paths in
the Nix store.</p>
</li>
<li>
<p><a href="#adv-attr-allowedRequisites" id="adv-attr-allowedRequisites"><code>allowedRequisites</code></a><br>This attribute is similar to <code>allowedReferences</code>, but it specifies
the legal requisites of the whole closure, so all the dependencies
recursively. For example,</p>
<pre><code class="language-nix">allowedRequisites = [ foobar ];
</code></pre>
<p>enforces that the output of a derivation cannot have any other
runtime dependency than <code>foobar</code>, and in addition it enforces that
<code>foobar</code> itself doesn’t introduce any other dependency itself.</p>
</li>
<li>
<p><a href="#adv-attr-disallowedReferences" id="adv-attr-disallowedReferences"><code>disallowedReferences</code></a><br>The optional attribute <code>disallowedReferences</code> specifies a list of
illegal references (dependencies) of the output of the builder. For
example,</p>
<pre><code class="language-nix">disallowedReferences = [ foo ];
</code></pre>
<p>enforces that the output of a derivation cannot have a direct
runtime dependencies on the derivation <code>foo</code>.</p>
</li>
<li>
<p><a href="#adv-attr-disallowedRequisites" id="adv-attr-disallowedRequisites"><code>disallowedRequisites</code></a><br>This attribute is similar to <code>disallowedReferences</code>, but it
specifies illegal requisites for the whole closure, so all the
dependencies recursively. For example,</p>
<pre><code class="language-nix">disallowedRequisites = [ foobar ];
</code></pre>
<p>enforces that the output of a derivation cannot have any runtime
dependency on <code>foobar</code> or any other derivation depending recursively
on <code>foobar</code>.</p>
</li>
<li>
<p><a href="#adv-attr-outputChecks" id="adv-attr-outputChecks"><code>outputChecks</code></a><br>When using <a href="#adv-attr-structuredAttrs">structured attributes</a>, the <code>outputChecks</code>
attribute allows defining checks per-output.</p>
<p>In addition to
<a href="#adv-attr-allowedReferences"><code>allowedReferences</code></a>, <a href="#adv-attr-allowedRequisites"><code>allowedRequisites</code></a>,
<a href="#adv-attr-disallowedReferences"><code>disallowedReferences</code></a> and <a href="#adv-attr-disallowedRequisites"><code>disallowedRequisites</code></a>,
the following attributes are available:</p>
<ul>
<li><code>maxSize</code> defines the maximum size of the resulting <a href="../store/store-object.html">store object</a>.</li>
<li><code>maxClosureSize</code> defines the maximum size of the output’s closure.</li>
<li><code>ignoreSelfRefs</code> controls whether self-references should be considered when
checking for allowed references/requisites.</li>
</ul>
<p>Example:</p>
<pre><code class="language-nix">__structuredAttrs = true;

outputChecks.out = {
  # The closure of 'out' must not be larger than 256 MiB.
  maxClosureSize = 256 * 1024 * 1024;

  # It must not refer to the C compiler or to the 'dev' output.
  disallowedRequisites = [ stdenv.cc "dev" ];
};

outputChecks.dev = {
  # The 'dev' output must not be larger than 128 KiB.
  maxSize = 128 * 1024;
};
</code></pre>
</li>
</ul>
<h2 id="other-output-modifications"><a class="header" href="#other-output-modifications">Other output modifications</a></h2>
<ul>
<li>
<p><a href="#adv-attr-unsafeDiscardReferences" id="adv-attr-unsafeDiscardReferences"><code>unsafeDiscardReferences</code></a><br>When using <a href="#adv-attr-structuredAttrs">structured attributes</a>, the
attribute <code>unsafeDiscardReferences</code> is an attribute set with a boolean value for each output name.
If set to <code>true</code>, it disables scanning the output for runtime dependencies.</p>
<p>Example:</p>
<pre><code class="language-nix">__structuredAttrs = true;
unsafeDiscardReferences.out = true;
</code></pre>
<p>This is useful, for example, when generating self-contained filesystem images with
their own embedded Nix store: hashes found inside such an image refer
to the embedded store and not to the host’s Nix store.</p>
</li>
</ul>
<h2 id="build-scheduling"><a class="header" href="#build-scheduling">Build scheduling</a></h2>
<ul>
<li>
<p><a href="#adv-attr-preferLocalBuild" id="adv-attr-preferLocalBuild"><code>preferLocalBuild</code></a><br>If this attribute is set to <code>true</code> and <a href="../command-ref/conf-file.html#conf-builders">distributed building is enabled</a>, then, if possible, the derivation will be built locally instead of being forwarded to a remote machine.
This is useful for derivations that are cheapest to build locally.</p>
</li>
<li>
<p><a href="#adv-attr-allowSubstitutes" id="adv-attr-allowSubstitutes"><code>allowSubstitutes</code></a><br>If this attribute is set to <code>false</code>, then Nix will always build this derivation (locally or remotely); it will not try to substitute its outputs.
This is useful for derivations that are cheaper to build than to substitute.</p>
<p>This attribute can be ignored by setting <a href="../command-ref/conf-file.html#conf-always-allow-substitutes"><code>always-allow-substitutes</code></a> to <code>true</code>.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>If set to <code>false</code>, the <a href="./derivations.html#attr-builder"><code>builder</code></a> should be able to run on the system type specified in the <a href="./derivations.html#attr-system"><code>system</code> attribute</a>, since the derivation cannot be substituted.</p>
</blockquote>
</li>
<li>
<p><a href="#adv-attr-requiredSystemFeatures" id="adv-attr-requiredSystemFeatures"><code>requiredSystemFeatures</code></a><br>If a derivation has the <code>requiredSystemFeatures</code> attribute, then Nix will only build it on a machine that has the corresponding features set in its <a href="../command-ref/conf-file.html#conf-system-features"><code>system-features</code> configuration</a>.</p>
<p>For example, setting</p>
<pre><code class="language-nix">requiredSystemFeatures = [ "kvm" ];
</code></pre>
<p>ensures that the derivation can only be built on a machine with the <code>kvm</code> feature.</p>
</li>
</ul>
<h1 id="impure-builder-configuration"><a class="header" href="#impure-builder-configuration">Impure builder configuration</a></h1>
<ul>
<li>
<p><a href="#adv-attr-impureEnvVars" id="adv-attr-impureEnvVars"><code>impureEnvVars</code></a><br>This attribute allows you to specify a list of environment variables
that should be passed from the environment of the calling user to
the builder. Usually, the environment is cleared completely when the
builder is executed, but with this attribute you can allow specific
environment variables to be passed unmodified. For example,
<code>fetchurl</code> in Nixpkgs has the line</p>
<pre><code class="language-nix">impureEnvVars = [ "http_proxy" "https_proxy" ... ];
</code></pre>
<p>to make it use the proxy server configuration specified by the user
in the environment variables <code>http_proxy</code> and friends.</p>
<p>This attribute is only allowed in <a href="../glossary.html#gloss-fixed-output-derivation">fixed-output derivations</a>,
where impurities such as these are okay since (the hash
of) the output is known in advance. It is ignored for all other
derivations.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p><code>impureEnvVars</code> implementation takes environment variables from
the current builder process. When a daemon is building its
environmental variables are used. Without the daemon, the
environmental variables come from the environment of the
<code>nix-build</code>.</p>
</blockquote>
<p>If the <a href="../development/experimental-features.html#xp-feature-configurable-impure-env"><code>configurable-impure-env</code> experimental
feature</a>
is enabled, these environment variables can also be controlled
through the
<a href="../command-ref/conf-file.html#conf-impure-env"><code>impure-env</code></a>
configuration setting.</p>
</li>
</ul>
<h2 id="setting-the-derivation-type"><a class="header" href="#setting-the-derivation-type">Setting the derivation type</a></h2>
<p>As discussed in <a href="../store/derivation/outputs/index.html">Derivation Outputs and Types of Derivations</a>, there are multiples kinds of derivations / kinds of derivation outputs.
The choice of the following attributes determines which kind of derivation we are making.</p>
<ul>
<li>
<p><a href="#adv-attr-__contentAddressed"><code>__contentAddressed</code></a></p>
</li>
<li>
<p><a href="#adv-attr-outputHash"><code>outputHash</code></a></p>
</li>
<li>
<p><a href="#adv-attr-outputHashAlgo"><code>outputHashAlgo</code></a></p>
</li>
<li>
<p><a href="#adv-attr-outputHashMode"><code>outputHashMode</code></a></p>
</li>
</ul>
<p>The three types of derivations are chosen based on the following combinations of these attributes.
All other combinations are invalid.</p>
<ul>
<li>
<p><a href="../store/derivation/outputs/input-address.html">Input-addressing derivations</a></p>
<p>This is the default for <code>builtins.derivation</code>.
Nix only currently supports one kind of input-addressing, so no other information is needed.</p>
<p><code>__contentAddressed = false;</code> may also be included, but is not needed, and will trigger the experimental feature check.</p>
</li>
<li>
<p><a href="../glossary.html#gloss-fixed-output-derivation">Fixed-output derivations</a></p>
<p>All of <a href="#adv-attr-outputHash"><code>outputHash</code></a>, <a href="#adv-attr-outputHashAlgo"><code>outputHashAlgo</code></a>, and <a href="#adv-attr-outputHashMode"><code>outputHashMode</code></a>.</p>
<!--

`__contentAddressed` is ignored, because fixed-output derivations always content-address their outputs, by definition.

**TODO CHECK**

-->
</li>
<li>
<p><a href="../store/derivation/outputs/content-address.html">(Floating) content-addressing derivations</a></p>
<p>Both <a href="#adv-attr-outputHashAlgo"><code>outputHashAlgo</code></a> and <a href="#adv-attr-outputHashMode"><code>outputHashMode</code></a>, <code>__contentAddressed = true;</code>, and <em>not</em> <code>outputHash</code>.</p>
<p>If an output hash was given, then the derivation output would be “fixed” not “floating”.</p>
</li>
</ul>
<p>Here is more information on the <code>output*</code> attributes, and what values they may be set to:</p>
<ul>
<li>
<p><a href="#adv-attr-outputHashMode" id="adv-attr-outputHashMode"><code>outputHashMode</code></a></p>
<p>This specifies how the files of a content-addressing derivation output are digested to produce a content address.</p>
<p>This works in conjunction with <a href="#adv-attr-outputHashAlgo"><code>outputHashAlgo</code></a>.
Specifying one without the other is an error (unless [<code>outputHash</code> is also specified and includes its own hash algorithm as described below).</p>
<p>The <code>outputHashMode</code> attribute determines how the hash is computed.
It must be one of the following values:</p>
<ul>
<li>
<p><a href="../store/store-object/content-address.html#method-flat"><code>"flat"</code></a></p>
<p>This is the default.</p>
</li>
<li>
<p><a href="../store/store-object/content-address.html#method-nix-archive"><code>"recursive"</code> or <code>"nar"</code></a></p>
<blockquote>
<p><strong>Compatibility</strong></p>
<p><code>"recursive"</code> is the traditional way of indicating this,
and is supported since 2005 (virtually the entire history of Nix).
<code>"nar"</code> is more clear, and consistent with other parts of Nix (such as the CLI),
however support for it is only added in Nix version 2.21.</p>
</blockquote>
</li>
<li>
<p><a href="../store/store-object/content-address.html#method-text"><code>"text"</code></a></p>
<blockquote>
<p><strong>Warning</strong></p>
<p>The use of this method for derivation outputs is part of the <a href="../development/experimental-features.html#xp-feature-dynamic-derivations"><code>dynamic-derivations</code></a> experimental feature.</p>
</blockquote>
</li>
<li>
<p><a href="../store/store-object/content-address.html#method-git"><code>"git"</code></a></p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This method is part of the <a href="../development/experimental-features.html#xp-feature-git-hashing"><code>git-hashing</code></a> experimental feature.</p>
</blockquote>
</li>
</ul>
<p>See <a href="../store/store-object/content-address.html">content-addressing store objects</a> for more information about the process this flag controls.</p>
</li>
<li>
<p><a href="#adv-attr-outputHashAlgo" id="adv-attr-outputHashAlgo"><code>outputHashAlgo</code></a></p>
<p>This specifies the hash algorithm used to digest the <a href="../store/file-system-object.html">file system object</a> data of a content-addressing derivation output.</p>
<p>This works in conjunction with <a href="#adv-attr-outputHashAlgo"><code>outputHashMode</code></a>.
Specifying one without the other is an error (unless <code>outputHash</code> is also specified and includes its own hash algorithm as described below).</p>
<p>The <code>outputHashAlgo</code> attribute specifies the hash algorithm used to compute the hash.
It can currently be <code>"blake3"</code>, <code>"sha1"</code>, <code>"sha256"</code>, <code>"sha512"</code>, or <code>null</code>.</p>
<p><code>outputHashAlgo</code> can only be <code>null</code> when <code>outputHash</code> follows the SRI format, because in that case the choice of hash algorithm is determined by <code>outputHash</code>.</p>
</li>
<li>
<p><a href="#adv-attr-outputHashAlgo" id="adv-attr-outputHashAlgo"><code>outputHash</code></a>; <a href="#adv-attr-outputHashMode" id="adv-attr-outputHashMode"><code>outputHash</code></a></p>
<p>This will specify the output hash of the single output of a <a href="../glossary.html#gloss-fixed-output-derivation">fixed-output derivation</a>.</p>
<p>The <code>outputHash</code> attribute must be a string containing the hash in either hexadecimal or “nix32” encoding, or following the format for integrity metadata as defined by <a href="https://www.w3.org/TR/SRI/">SRI</a>.
The “nix32” encoding is an adaptation of base-32 encoding.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>The <a href="../language/builtins.html#builtins-convertHash"><code>convertHash</code></a> function shows how to convert between different encodings.
The <a href="../command-ref/nix-hash.html"><code>nix-hash</code> command</a> has information about obtaining the hash for some contents, as well as converting to and from encodings.</p>
</blockquote>
</li>
<li>
<p><a href="#adv-attr-__contentAddressed" id="adv-attr-__contentAddressed"><code>__contentAddressed</code></a></p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This attribute is part of an <a href="../development/experimental-features.html">experimental feature</a>.</p>
<p>To use this attribute, you must enable the
[<code>ca-derivations</code>][xp-feature-ca-derivations] experimental feature.
For example, in <a href="../command-ref/conf-file.html">nix.conf</a> you could add:</p>
<pre><code>extra-experimental-features = ca-derivations
</code></pre>
</blockquote>
<p>This is a boolean with a default of <code>false</code>.
It determines whether the derivation is floating content-addressing.</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../language/derivations.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../language/import-from-derivation.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../language/derivations.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../language/import-from-derivation.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-862e895d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="../redirects-4afb32ee.js"></script>



    </div>
    </body>
</html>
