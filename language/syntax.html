<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Syntax and semantics - Nix 2.28.3 Reference Manual</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Nix 2.28.3 Reference Manual</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/NixOS/nix" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/NixOS/nix/tree/master/doc/manual/source/language/syntax.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="language-constructs"><a class="header" href="#language-constructs">Language Constructs</a></h1>
<p>This section covers syntax and semantics of the Nix language.</p>
<h2 id="basic-literals"><a class="header" href="#basic-literals">Basic Literals</a></h2>
<h3 id="string-literal"><a class="header" href="#string-literal">String</a></h3>
<p>See <a href="string-literals.html">String literals</a>.</p>
<h3 id="number-literal"><a class="header" href="#number-literal">Number</a></h3>
<!-- TODO(@rhendric, #10970): split this into int and float -->
<p>Numbers, which can be <em>integers</em> (like <code>123</code>) or <em>floating point</em>
(like <code>123.43</code> or <code>.27e13</code>).</p>
<p>Integers in the Nix language are 64-bit <a href="https://en.wikipedia.org/wiki/Two%27s_complement">two's complement</a> signed integers, with a range of -9223372036854775808 to 9223372036854775807, inclusive.</p>
<p>Note that negative numeric literals are actually parsed as unary negation of positive numeric literals.
This means that the minimum integer <code>-9223372036854775808</code> cannot be written as-is as a literal, since the positive number <code>9223372036854775808</code> is one past the maximum range.</p>
<p>See <a href="./operators.html#arithmetic">arithmetic</a> and <a href="./operators.html#comparison">comparison</a> operators for semantics.</p>
<h3 id="path-literal"><a class="header" href="#path-literal">Path</a></h3>
<p><em>Paths</em> can be expressed by path literals such as <code>./builder.sh</code>.</p>
<p>A path literal must contain at least one slash to be recognised as such.
For instance, <code>builder.sh</code> is not a path:
it's parsed as an expression that selects the attribute <code>sh</code> from the variable <code>builder</code>.</p>
<p>Path literals are resolved relative to their <a href="../glossary.html#gloss-base-directory">base directory</a>.
Path literals may also refer to absolute paths by starting with a slash.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>Absolute paths make expressions less portable.
In the case where a function translates a path literal into an absolute path string for a configuration file, it is recommended to write a string literal instead.
This avoids some confusion about whether files at that location will be used during evaluation.
It also avoids unintentional situations where some function might try to copy everything at the location into the store.</p>
</blockquote>
<p>If the first component of a path is a <code>~</code>, it is interpreted such that the rest of the path were relative to the user's home directory.
For example, <code>~/foo</code> would be equivalent to <code>/home/edolstra/foo</code> for a user whose home directory is <code>/home/edolstra</code>.
Path literals that start with <code>~</code> are not allowed in <a href="../command-ref/conf-file.html#conf-pure-eval">pure</a> evaluation.</p>
<p>Path literals can also include [string interpolation], besides being <a href="./string-interpolation.html#interpolated-expressions">interpolated into other expressions</a>.</p>
<p>At least one slash (<code>/</code>) must appear <em>before</em> any interpolated expression for the result to be recognized as a path.</p>
<p><code>a.${foo}/b.${bar}</code> is a syntactically valid number division operation.
<code>./a.${foo}/b.${bar}</code> is a path.</p>
<p><a href="./constructs/lookup-path.html">Lookup path</a> literals such as <code>&lt;nixpkgs&gt;</code> also resolve to path values.</p>
<h2 id="list-literal"><a class="header" href="#list-literal">List</a></h2>
<p>Lists are formed by enclosing a whitespace-separated list of values
between square brackets. For example,</p>
<pre><code class="language-nix">[ 123 ./foo.nix "abc" (f { x = y; }) ]
</code></pre>
<p>defines a list of four elements, the last being the result of a call to
the function <code>f</code>. Note that function calls have to be enclosed in
parentheses. If they had been omitted, e.g.,</p>
<pre><code class="language-nix">[ 123 ./foo.nix "abc" f { x = y; } ]
</code></pre>
<p>the result would be a list of five elements, the fourth one being a
function and the fifth being a set.</p>
<p>Note that lists are only lazy in values, and they are strict in length.</p>
<p>Elements in a list can be accessed using <a href="./builtins.html#builtins-elemAt"><code>builtins.elemAt</code></a>.</p>
<h2 id="attrs-literal"><a class="header" href="#attrs-literal">Attribute Set</a></h2>
<p>An attribute set is a collection of name-value-pairs called <em>attributes</em>.</p>
<p>Attribute sets are written enclosed in curly brackets (<code>{ }</code>).
Attribute names and attribute values are separated by an equal sign (<code>=</code>).
Each value can be an arbitrary expression, terminated by a semicolon (<code>;</code>)</p>
<p>An attribute name is a string without context, and is denoted by a <a href="./identifiers.html#names">name</a> (an <a href="./identifiers.html#identifiers">identifier</a> or <a href="string-literals.html">string literal</a>).</p>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>attrset</em> → <code>{</code> { <em>name</em> <code>=</code> <em>expr</em> <code>;</code> } <code>}</code></p>
</blockquote>
<p>Attributes can appear in any order.
An attribute name may only occur once in each attribute set.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>This defines an attribute set with attributes named:</p>
<ul>
<li><code>x</code> with the value <code>123</code>, an integer</li>
<li><code>text</code> with the value <code>"Hello"</code>, a string</li>
<li><code>y</code> where the value is the result of applying the function <code>f</code> to the attribute set <code>{ bla = 456; }</code></li>
</ul>
<pre><code class="language-nix">{
  x = 123;
  text = "Hello";
  y = f { bla = 456; };
}
</code></pre>
</blockquote>
<p>Attributes in nested attribute sets can be written using <em>attribute paths</em>.</p>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>attrset</em> → <code>{</code> { <em>attrpath</em> <code>=</code> <em>expr</em> <code>;</code> } <code>}</code></p>
</blockquote>
<p>An attribute path is a dot-separated list of <a href="./identifiers.html#names">names</a>.</p>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>attrpath</em> = <em>name</em> { <code>.</code> <em>name</em> }</p>
</blockquote>
<!-- -->
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">{ a.b.c = 1; a.b.d = 2; }
</code></pre>
<pre><code>{
  a = {
    b = {
      c = 1;
      d = 2;
    };
  };
}
</code></pre>
</blockquote>
<p>Attribute names can also be set implicitly by using the <a href="#inheriting-attributes"><code>inherit</code> keyword</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">{ inherit (builtins) true; }
</code></pre>
<pre><code>{ true = true; }
</code></pre>
</blockquote>
<p>Attributes can be accessed with the <a href="./operators.html#attribute-selection"><code>.</code> operator</a>.</p>
<p>Example:</p>
<pre><code class="language-nix">{ a = "Foo"; b = "Bar"; }.a
</code></pre>
<p>This evaluates to <code>"Foo"</code>.</p>
<p>It is possible to provide a default value in an attribute selection using the <code>or</code> keyword.</p>
<p>Example:</p>
<pre><code class="language-nix">{ a = "Foo"; b = "Bar"; }.c or "Xyzzy"
</code></pre>
<pre><code class="language-nix">{ a = "Foo"; b = "Bar"; }.c.d.e.f.g or "Xyzzy"
</code></pre>
<p>will both evaluate to <code>"Xyzzy"</code> because there is no <code>c</code> attribute in the set.</p>
<p>You can use arbitrary double-quoted strings as attribute names:</p>
<pre><code class="language-nix">{ "$!@#?" = 123; }."$!@#?"
</code></pre>
<pre><code class="language-nix">let bar = "bar"; in
{ "foo ${bar}" = 123; }."foo ${bar}"
</code></pre>
<p>Both will evaluate to <code>123</code>.</p>
<p>Attribute names support [string interpolation]:</p>
<pre><code class="language-nix">let bar = "foo"; in
{ foo = 123; }.${bar}
</code></pre>
<pre><code class="language-nix">let bar = "foo"; in
{ ${bar} = 123; }.foo
</code></pre>
<p>Both will evaluate to <code>123</code>.</p>
<p>In the special case where an attribute name inside of a set declaration
evaluates to <code>null</code> (which is normally an error, as <code>null</code> cannot be coerced to
a string), that attribute is simply not added to the set:</p>
<pre><code class="language-nix">{ ${if foo then "bar" else null} = true; }
</code></pre>
<p>This will evaluate to <code>{}</code> if <code>foo</code> evaluates to <code>false</code>.</p>
<p>A set that has a <a href="#attr-__functor" id="attr-__functor"><code>__functor</code></a> attribute whose value is callable (i.e. is
itself a function or a set with a <code>__functor</code> attribute whose value is
callable) can be applied as if it were a function, with the set itself
passed in first , e.g.,</p>
<pre><code class="language-nix">let add = { __functor = self: x: x + self.x; };
    inc = add // { x = 1; };
in inc 1
</code></pre>
<p>evaluates to <code>2</code>. This can be used to attach metadata to a function
without the caller needing to treat it specially, or to implement a form
of object-oriented programming, for example.</p>
<h2 id="recursive-sets"><a class="header" href="#recursive-sets">Recursive sets</a></h2>
<p>Recursive sets are like normal <a href="./types.html#attribute-set">attribute sets</a>, but the attributes can refer to each other.</p>
<blockquote>
<p><em>rec-attrset</em> = <code>rec {</code> [ <em>name</em> <code>=</code> <em>expr</em> <code>;</code> <code>]</code>... <code>}</code></p>
</blockquote>
<p>Example:</p>
<pre><code class="language-nix">rec {
  x = y;
  y = 123;
}.x
</code></pre>
<p>This evaluates to <code>123</code>.</p>
<p>Note that without <code>rec</code> the binding <code>x = y;</code> would
refer to the variable <code>y</code> in the surrounding scope, if one exists, and
would be invalid if no such variable exists. That is, in a normal
(non-recursive) set, attributes are not added to the lexical scope; in a
recursive set, they are.</p>
<p>Recursive sets of course introduce the danger of infinite recursion. For
example, the expression</p>
<pre><code class="language-nix">rec {
  x = y;
  y = x;
}.x
</code></pre>
<p>will crash with an <code>infinite recursion encountered</code> error message.</p>
<h2 id="let-expressions"><a class="header" href="#let-expressions">Let-expressions</a></h2>
<p>A let-expression allows you to define local variables for an expression.</p>
<blockquote>
<p><em>let-in</em> = <code>let</code> [ <em>identifier</em> = <em>expr</em> ]... <code>in</code> <em>expr</em></p>
</blockquote>
<p>Example:</p>
<pre><code class="language-nix">let
  x = "foo";
  y = "bar";
in x + y
</code></pre>
<p>This evaluates to <code>"foobar"</code>.</p>
<h2 id="inheriting-attributes"><a class="header" href="#inheriting-attributes">Inheriting attributes</a></h2>
<p>When defining an <a href="./types.html#attribute-set">attribute set</a> or in a <a href="#let-expressions">let-expression</a> it is often convenient to copy variables from the surrounding lexical scope (e.g., when you want to propagate attributes).
This can be shortened using the <code>inherit</code> keyword.</p>
<p>Example:</p>
<pre><code class="language-nix">let x = 123; in
{
  inherit x;
  y = 456;
}
</code></pre>
<p>is equivalent to</p>
<pre><code class="language-nix">let x = 123; in
{
  x = x;
  y = 456;
}
</code></pre>
<p>and both evaluate to <code>{ x = 123; y = 456; }</code>.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>This works because <code>x</code> is added to the lexical scope by the <code>let</code> construct.</p>
</blockquote>
<p>It is also possible to inherit attributes from another attribute set.</p>
<p>Example:</p>
<p>In this fragment from <code>all-packages.nix</code>,</p>
<pre><code class="language-nix">graphviz = (import ../tools/graphics/graphviz) {
  inherit fetchurl stdenv libpng libjpeg expat x11 yacc;
  inherit (xorg) libXaw;
};

xorg = {
  libX11 = ...;
  libXaw = ...;
  ...
}

libpng = ...;
libjpg = ...;
...
</code></pre>
<p>the set used in the function call to the function defined in
<code>../tools/graphics/graphviz</code> inherits a number of variables from the
surrounding scope (<code>fetchurl</code> ... <code>yacc</code>), but also inherits <code>libXaw</code>
(the X Athena Widgets) from the <code>xorg</code> set.</p>
<p>Summarizing the fragment</p>
<pre><code class="language-nix">...
inherit x y z;
inherit (src-set) a b c;
...
</code></pre>
<p>is equivalent to</p>
<pre><code class="language-nix">...
x = x; y = y; z = z;
a = src-set.a; b = src-set.b; c = src-set.c;
...
</code></pre>
<p>when used while defining local variables in a let-expression or while
defining a set.</p>
<p>In a <code>let</code> expression, <code>inherit</code> can be used to selectively bring specific attributes of a set into scope. For example</p>
<pre><code class="language-nix">let
  x = { a = 1; b = 2; };
  inherit (builtins) attrNames;
in
{
  names = attrNames x;
}
</code></pre>
<p>is equivalent to</p>
<pre><code class="language-nix">let
  x = { a = 1; b = 2; };
in
{
  names = builtins.attrNames x;
}
</code></pre>
<p>both evaluate to <code>{ names = [ "a" "b" ]; }</code>.</p>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<p>Functions have the following form:</p>
<pre><code class="language-nix">pattern: body
</code></pre>
<p>The pattern specifies what the argument of the function must look like,
and binds variables in the body to (parts of) the argument. There are
three kinds of patterns:</p>
<ul>
<li>
<p>If a pattern is a single identifier, then the function matches any
argument. Example:</p>
<pre><code class="language-nix">let negate = x: !x;
    concat = x: y: x + y;
in if negate true then concat "foo" "bar" else ""
</code></pre>
<p>Note that <code>concat</code> is a function that takes one argument and returns
a function that takes another argument. This allows partial
parameterisation (i.e., only filling some of the arguments of a
function); e.g.,</p>
<pre><code class="language-nix">map (concat "foo") [ "bar" "bla" "abc" ]
</code></pre>
<p>evaluates to <code>[ "foobar" "foobla" "fooabc" ]</code>.</p>
</li>
<li>
<p>A <em>set pattern</em> of the form <code>{ name1, name2, …, nameN }</code> matches a
set containing the listed attributes, and binds the values of those
attributes to variables in the function body. For example, the
function</p>
<pre><code class="language-nix">{ x, y, z }: z + y + x
</code></pre>
<p>can only be called with a set containing exactly the attributes <code>x</code>,
<code>y</code> and <code>z</code>. No other attributes are allowed. If you want to allow
additional arguments, you can use an ellipsis (<code>...</code>):</p>
<pre><code class="language-nix">{ x, y, z, ... }: z + y + x
</code></pre>
<p>This works on any set that contains at least the three named
attributes.</p>
</li>
<li>
<p>It is possible to provide <em>default values</em> for attributes, in
which case they are allowed to be missing. A default value is
specified by writing <code>name ?  e</code>, where <em>e</em> is an arbitrary
expression. For example,</p>
<pre><code class="language-nix">{ x, y ? "foo", z ? "bar" }: z + y + x
</code></pre>
<p>specifies a function that only requires an attribute named <code>x</code>, but
optionally accepts <code>y</code> and <code>z</code>.</p>
</li>
<li>
<p>An <code>@</code>-pattern provides a means of referring to the whole value
being matched:</p>
<pre><code class="language-nix">args@{ x, y, z, ... }: z + y + x + args.a
</code></pre>
<p>but can also be written as:</p>
<pre><code class="language-nix">{ x, y, z, ... } @ args: z + y + x + args.a
</code></pre>
<p>Here <code>args</code> is bound to the argument <em>as passed</em>, which is further
matched against the pattern <code>{ x, y, z, ... }</code>.
The <code>@</code>-pattern makes mainly sense with an ellipsis(<code>...</code>) as
you can access attribute names as <code>a</code>, using <code>args.a</code>, which was
given as an additional attribute to the function.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p><code>args@</code> binds the name <code>args</code> to the attribute set that is passed to the function.
In particular, <code>args</code> does <em>not</em> include any default values specified with <code>?</code> in the function's set pattern.</p>
<p>For instance</p>
<pre><code class="language-nix">let
  f = args@{ a ? 23, ... }: [ a args ];
in
  f {}
</code></pre>
<p>is equivalent to</p>
<pre><code class="language-nix">let
  f = args @ { ... }: [ (args.a or 23) args ];
in
  f {}
</code></pre>
<p>and both expressions will evaluate to:</p>
<pre><code class="language-nix">[ 23 {} ]
</code></pre>
</blockquote>
</li>
<li>
<p>All bindings introduced by the function are in scope in the entire function expression; not just in the body.
It can therefore be used in default values.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>A parameter (<code>x</code>), is used in the default value for another parameter (<code>y</code>):</p>
<pre><code class="language-nix">let
  f = { x, y ? [x] }: { inherit y; };
in
  f { x = 3; }
</code></pre>
<p>This evaluates to:</p>
<pre><code class="language-nix">{
  y = [ 3 ];
}
</code></pre>
</blockquote>
<blockquote>
<p><strong>Example</strong></p>
<p>The binding of an <code>@</code> pattern, <code>args</code>, is used in the default value for a parameter, <code>x</code>:</p>
<pre><code class="language-nix">let
  f = args@{ x ? args.a, ... }: x;
in
  f { a = 1; }
</code></pre>
<p>This evaluates to:</p>
<pre><code class="language-nix">1
</code></pre>
</blockquote>
</li>
</ul>
<p>Note that functions do not have names. If you want to give them a name,
you can bind them to an attribute, e.g.,</p>
<pre><code class="language-nix">let concat = { x, y }: x + y;
in concat { x = "foo"; y = "bar"; }
</code></pre>
<h2 id="conditionals"><a class="header" href="#conditionals">Conditionals</a></h2>
<p>Conditionals look like this:</p>
<pre><code class="language-nix">if e1 then e2 else e3
</code></pre>
<p>where <em>e1</em> is an expression that should evaluate to a Boolean value
(<code>true</code> or <code>false</code>).</p>
<h2 id="assertions"><a class="header" href="#assertions">Assertions</a></h2>
<p>Assertions are generally used to check that certain requirements on or
between features and dependencies hold. They look like this:</p>
<pre><code class="language-nix">assert e1; e2
</code></pre>
<p>where <em>e1</em> is an expression that should evaluate to a Boolean value. If
it evaluates to <code>true</code>, <em>e2</em> is returned; otherwise expression
evaluation is aborted and a backtrace is printed.</p>
<p>Here is a Nix expression for the Subversion package that shows how
assertions can be used:.</p>
<pre><code class="language-nix">{ localServer ? false
, httpServer ? false
, sslSupport ? false
, pythonBindings ? false
, javaSwigBindings ? false
, javahlBindings ? false
, stdenv, fetchurl
, openssl ? null, httpd ? null, db4 ? null, expat, swig ? null, j2sdk ? null
}:

assert localServer -&gt; db4 != null; ①
assert httpServer -&gt; httpd != null &amp;&amp; httpd.expat == expat; ②
assert sslSupport -&gt; openssl != null &amp;&amp; (httpServer -&gt; httpd.openssl == openssl); ③
assert pythonBindings -&gt; swig != null &amp;&amp; swig.pythonSupport;
assert javaSwigBindings -&gt; swig != null &amp;&amp; swig.javaSupport;
assert javahlBindings -&gt; j2sdk != null;

stdenv.mkDerivation {
  name = "subversion-1.1.1";
  ...
  openssl = if sslSupport then openssl else null; ④
  ...
}
</code></pre>
<p>The points of interest are:</p>
<ol>
<li>
<p>This assertion states that if Subversion is to have support for
local repositories, then Berkeley DB is needed. So if the Subversion
function is called with the <code>localServer</code> argument set to <code>true</code> but
the <code>db4</code> argument set to <code>null</code>, then the evaluation fails.</p>
<p>Note that <code>-&gt;</code> is the <a href="https://en.wikipedia.org/wiki/Truth_table#Logical_implication">logical
implication</a>
Boolean operation.</p>
</li>
<li>
<p>This is a more subtle condition: if Subversion is built with Apache
(<code>httpServer</code>) support, then the Expat library (an XML library) used
by Subversion should be same as the one used by Apache. This is
because in this configuration Subversion code ends up being linked
with Apache code, and if the Expat libraries do not match, a build-
or runtime link error or incompatibility might occur.</p>
</li>
<li>
<p>This assertion says that in order for Subversion to have SSL support
(so that it can access <code>https</code> URLs), an OpenSSL library must be
passed. Additionally, it says that <em>if</em> Apache support is enabled,
then Apache's OpenSSL should match Subversion's. (Note that if
Apache support is not enabled, we don't care about Apache's
OpenSSL.)</p>
</li>
<li>
<p>The conditional here is not really related to assertions, but is
worth pointing out: it ensures that if SSL support is disabled, then
the Subversion derivation is not dependent on OpenSSL, even if a
non-<code>null</code> value was passed. This prevents an unnecessary rebuild of
Subversion if OpenSSL changes.</p>
</li>
</ol>
<h2 id="with-expressions"><a class="header" href="#with-expressions">With-expressions</a></h2>
<p>A <em>with-expression</em>,</p>
<pre><code class="language-nix">with e1; e2
</code></pre>
<p>introduces the set <em>e1</em> into the lexical scope of the expression <em>e2</em>.
For instance,</p>
<pre><code class="language-nix">let as = { x = "foo"; y = "bar"; };
in with as; x + y
</code></pre>
<p>evaluates to <code>"foobar"</code> since the <code>with</code> adds the <code>x</code> and <code>y</code> attributes
of <code>as</code> to the lexical scope in the expression <code>x + y</code>. The most common
use of <code>with</code> is in conjunction with the <code>import</code> function. E.g.,</p>
<pre><code class="language-nix">with (import ./definitions.nix); ...
</code></pre>
<p>makes all attributes defined in the file <code>definitions.nix</code> available as
if they were defined locally in a <code>let</code>-expression.</p>
<p>The bindings introduced by <code>with</code> do not shadow bindings introduced by
other means, e.g.</p>
<pre><code class="language-nix">let a = 3; in with { a = 1; }; let a = 4; in with { a = 2; }; ...
</code></pre>
<p>establishes the same scope as</p>
<pre><code class="language-nix">let a = 1; in let a = 2; in let a = 3; in let a = 4; in ...
</code></pre>
<p>Variables coming from outer <code>with</code> expressions <em>are</em> shadowed:</p>
<pre><code class="language-nix">with { a = "outer"; };
with { a = "inner"; };
a
</code></pre>
<p>Does evaluate to <code>"inner"</code>.</p>
<h2 id="comments"><a class="header" href="#comments">Comments</a></h2>
<ul>
<li>
<p>Inline comments start with <code>#</code> and run until the end of the line.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix"># A number
2 # Equals 1 + 1
</code></pre>
<pre><code class="language-console">2
</code></pre>
</blockquote>
</li>
<li>
<p>Block comments start with <code>/*</code> and run until the next occurrence of <code>*/</code>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">/*
Block comments
can span multiple lines.
*/ "hello"
</code></pre>
<pre><code class="language-console">"hello"
</code></pre>
</blockquote>
<p>This means that block comments cannot be nested.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">/* /* nope */ */ 1
</code></pre>
<pre><code class="language-console">error: syntax error, unexpected '*'

       at «string»:1:15:

            1| /* /* nope */ *
             |               ^
</code></pre>
</blockquote>
<p>Consider escaping nested comments and unescaping them in post-processing.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">/* /* nested *\/ */ 1
</code></pre>
<pre><code class="language-console">1
</code></pre>
</blockquote>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../language/string-context.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../language/variables.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../language/string-context.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../language/variables.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../redirects.js"></script>


    </div>
    </body>
</html>
