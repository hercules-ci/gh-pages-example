<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Nix 2.28.3 Reference Manual</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Nix 2.28.3 Reference Manual</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/NixOS/nix" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Nix is a <em>purely functional package manager</em>.  This means that it
treats packages like values in purely functional programming languages
such as Haskell — they are built by functions that don’t have
side-effects, and they never change after they have been built.  Nix
stores packages in the <em>Nix store</em>, usually the directory
<code>/nix/store</code>, where each package has its own unique subdirectory such
as</p>
<pre><code>/nix/store/b6gvzjyb2pg0kjfwrjmg1vfhh54ad73z-firefox-33.1/
</code></pre>
<p>where <code>b6gvzjyb2pg0…</code> is a unique identifier for the package that
captures all its dependencies (it’s a cryptographic hash of the
package’s build dependency graph).  This enables many powerful
features.</p>
<h2 id="multiple-versions"><a class="header" href="#multiple-versions">Multiple versions</a></h2>
<p>You can have multiple versions or variants of a package
installed at the same time.  This is especially important when
different applications have dependencies on different versions of the
same package — it prevents the “DLL hell”.  Because of the hashing
scheme, different versions of a package end up in different paths in
the Nix store, so they don’t interfere with each other.</p>
<p>An important consequence is that operations like upgrading or
uninstalling an application cannot break other applications, since
these operations never “destructively” update or delete files that are
used by other packages.</p>
<h2 id="complete-dependencies"><a class="header" href="#complete-dependencies">Complete dependencies</a></h2>
<p>Nix helps you make sure that package dependency specifications are
complete.  In general, when you’re making a package for a package
management system like RPM, you have to specify for each package what
its dependencies are, but there are no guarantees that this
specification is complete.  If you forget a dependency, then the
package will build and work correctly on <em>your</em> machine if you have
the dependency installed, but not on the end user's machine if it's
not there.</p>
<p>Since Nix on the other hand doesn’t install packages in “global”
locations like <code>/usr/bin</code> but in package-specific directories, the
risk of incomplete dependencies is greatly reduced.  This is because
tools such as compilers don’t search in per-packages directories such
as <code>/nix/store/5lbfaxb722zp…-openssl-0.9.8d/include</code>, so if a package
builds correctly on your system, this is because you specified the
dependency explicitly. This takes care of the build-time dependencies.</p>
<p>Once a package is built, runtime dependencies are found by scanning
binaries for the hash parts of Nix store paths (such as <code>r8vvq9kq…</code>).
This sounds risky, but it works extremely well.</p>
<h2 id="multi-user-support"><a class="header" href="#multi-user-support">Multi-user support</a></h2>
<p>Nix has multi-user support.  This means that non-privileged users can
securely install software.  Each user can have a different <em>profile</em>,
a set of packages in the Nix store that appear in the user’s <code>PATH</code>.
If a user installs a package that another user has already installed
previously, the package won’t be built or downloaded a second time.
At the same time, it is not possible for one user to inject a Trojan
horse into a package that might be used by another user.</p>
<h2 id="atomic-upgrades-and-rollbacks"><a class="header" href="#atomic-upgrades-and-rollbacks">Atomic upgrades and rollbacks</a></h2>
<p>Since package management operations never overwrite packages in the
Nix store but just add new versions in different paths, they are
<em>atomic</em>.  So during a package upgrade, there is no time window in
which the package has some files from the old version and some files
from the new version — which would be bad because a program might well
crash if it’s started during that period.</p>
<p>And since packages aren’t overwritten, the old versions are still
there after an upgrade.  This means that you can <em>roll back</em> to the
old version:</p>
<pre><code class="language-console">$ nix-env --upgrade --attr nixpkgs.some-package
$ nix-env --rollback
</code></pre>
<h2 id="garbage-collection"><a class="header" href="#garbage-collection">Garbage collection</a></h2>
<p>When you uninstall a package like this…</p>
<pre><code class="language-console">$ nix-env --uninstall firefox
</code></pre>
<p>the package isn’t deleted from the system right away (after all, you
might want to do a rollback, or it might be in the profiles of other
users).  Instead, unused packages can be deleted safely by running the
<em>garbage collector</em>:</p>
<pre><code class="language-console">$ nix-collect-garbage
</code></pre>
<p>This deletes all packages that aren’t in use by any user profile or by
a currently running program.</p>
<h2 id="functional-package-language"><a class="header" href="#functional-package-language">Functional package language</a></h2>
<p>Packages are built from <em>Nix expressions</em>, which is a simple
functional language.  A Nix expression describes everything that goes
into a package build task (a “derivation”): other packages, sources,
the build script, environment variables for the build script, etc.
Nix tries very hard to ensure that Nix expressions are
<em>deterministic</em>: building a Nix expression twice should yield the same
result.</p>
<p>Because it’s a functional language, it’s easy to support
building variants of a package: turn the Nix expression into a
function and call it any number of times with the appropriate
arguments.  Due to the hashing scheme, variants don’t conflict with
each other in the Nix store.</p>
<h2 id="transparent-sourcebinary-deployment"><a class="header" href="#transparent-sourcebinary-deployment">Transparent source/binary deployment</a></h2>
<p>Nix expressions generally describe how to build a package from
source, so an installation action like</p>
<pre><code class="language-console">$ nix-env --install --attr nixpkgs.firefox
</code></pre>
<p><em>could</em> cause quite a bit of build activity, as not only Firefox but
also all its dependencies (all the way up to the C library and the
compiler) would have to be built, at least if they are not already in the
Nix store.  This is a <em>source deployment model</em>.  For most users,
building from source is not very pleasant as it takes far too long.
However, Nix can automatically skip building from source and instead
use a <em>binary cache</em>, a web server that provides pre-built
binaries. For instance, when asked to build
<code>/nix/store/b6gvzjyb2pg0…-firefox-33.1</code> from source, Nix would first
check if the file <code>https://cache.nixos.org/b6gvzjyb2pg0….narinfo</code>
exists, and if so, fetch the pre-built binary referenced from there;
otherwise, it would fall back to building from source.</p>
<h2 id="nix-packages-collection"><a class="header" href="#nix-packages-collection">Nix Packages collection</a></h2>
<p>We provide a large set of Nix expressions containing hundreds of
existing Unix packages, the <em>Nix Packages collection</em> (Nixpkgs).</p>
<h2 id="managing-build-environments"><a class="header" href="#managing-build-environments">Managing build environments</a></h2>
<p>Nix is extremely useful for developers as it makes it easy to
automatically set up the build environment for a package. Given a Nix
expression that describes the dependencies of your package, the
command <code>nix-shell</code> will build or download those dependencies if
they’re not already in your Nix store, and then start a Bash shell in
which all necessary environment variables (such as compiler search
paths) are set.</p>
<p>For example, the following command gets all dependencies of the
Pan newsreader, as described by <a href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/networking/newsreaders/pan/default.nix">its
Nix expression</a>:</p>
<pre><code class="language-console">$ nix-shell '&lt;nixpkgs&gt;' --attr pan
</code></pre>
<p>You’re then dropped into a shell where you can edit, build and test
the package:</p>
<pre><code class="language-console">[nix-shell]$ unpackPhase
[nix-shell]$ cd pan-*
[nix-shell]$ configurePhase
[nix-shell]$ buildPhase
[nix-shell]$ ./pan/gui/pan
</code></pre>
<h2 id="portability"><a class="header" href="#portability">Portability</a></h2>
<p>Nix runs on Linux and macOS.</p>
<h2 id="nixos"><a class="header" href="#nixos">NixOS</a></h2>
<p>NixOS is a Linux distribution based on Nix.  It uses Nix not just for
package management but also to manage the system configuration (e.g.,
to build configuration files in <code>/etc</code>).  This means, among other
things, that it is easy to roll back the entire configuration of the
system to an earlier state.  Also, users can install software without
root privileges.  For more information and downloads, see the <a href="https://nixos.org/">NixOS
homepage</a>.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>Nix is released under the terms of the <a href="http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html">GNU LGPLv2.1 or (at your
option) any later
version</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="quick-start"><a class="header" href="#quick-start">Quick Start</a></h1>
<p>This chapter is for impatient people who don't like reading documentation.
For more in-depth information you are kindly referred to subsequent chapters.</p>
<ol>
<li>
<p>Install Nix:</p>
<pre><code class="language-console">$ curl -L https://nixos.org/nix/install | sh
</code></pre>
<p>The install script will use <code>sudo</code>, so make sure you have sufficient rights.</p>
<p>For other installation methods, see the detailed <a href="installation/index.html">installation instructions</a>.</p>
</li>
<li>
<p>Run software without installing it permanently:</p>
<pre><code class="language-console">$ nix-shell --packages cowsay lolcat
</code></pre>
<p>This downloads the specified packages with all their dependencies, and drops you into a Bash shell where the commands provided by those packages are present.
This will not affect your normal environment:</p>
<pre><code class="language-console">[nix-shell:~]$ cowsay Hello, Nix! | lolcat
</code></pre>
<p>Exiting the shell will make the programs disappear again:</p>
<pre><code class="language-console">[nix-shell:~]$ exit
$ lolcat
lolcat: command not found
</code></pre>
</li>
<li>
<p>Search for more packages on <a href="https://search.nixos.org/">search.nixos.org</a> to try them out.</p>
</li>
<li>
<p>Free up storage space:</p>
<pre><code class="language-console">$ nix-collect-garbage
</code></pre>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>This section describes how to install and configure Nix for first-time use.</p>
<p>The current recommended option on Linux and MacOS is <a href="installation/index.html#multi-user">multi-user</a>.</p>
<h2 id="multi-user"><a class="header" href="#multi-user">Multi-user</a></h2>
<p>This installation offers better sharing, improved isolation, and more security
over a single user installation.</p>
<p>This option requires either:</p>
<ul>
<li>Linux running systemd, with SELinux disabled</li>
<li>MacOS</li>
</ul>
<blockquote>
<p><strong>Updating to macOS 15 Sequoia</strong></p>
<p>If you recently updated to macOS 15 Sequoia and are getting</p>
<pre><code class="language-console">error: the user '_nixbld1' in the group 'nixbld' does not exist
</code></pre>
<p>when running Nix commands, refer to GitHub issue <a href="https://github.com/NixOS/nix/issues/10892">NixOS/nix#10892</a> for instructions to fix your installation without reinstalling.</p>
</blockquote>
<pre><code class="language-console">$ curl -L https://nixos.org/nix/install | sh -s -- --daemon
</code></pre>
<h2 id="single-user"><a class="header" href="#single-user">Single-user</a></h2>
<blockquote>
<p>Single-user is not supported on Mac.</p>
</blockquote>
<p>This installation has less requirements than the multi-user install, however it
cannot offer equivalent sharing, isolation, or security.</p>
<p>This option is suitable for systems without systemd.</p>
<pre><code class="language-console">$ curl -L https://nixos.org/nix/install | sh -s -- --no-daemon
</code></pre>
<h2 id="distributions"><a class="header" href="#distributions">Distributions</a></h2>
<p>The Nix community maintains installers for several distributions.</p>
<p>They can be found in the <a href="https://github.com/nix-community/nix-installers"><code>nix-community/nix-installers</code></a> repository.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="supported-platforms"><a class="header" href="#supported-platforms">Supported Platforms</a></h1>
<p>Nix is currently supported on the following platforms:</p>
<ul>
<li>
<p>Linux (i686, x86_64, aarch64).</p>
</li>
<li>
<p>macOS (x86_64, aarch64).</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installing-a-binary-distribution"><a class="header" href="#installing-a-binary-distribution">Installing a Binary Distribution</a></h1>
<blockquote>
<p><strong>Updating to macOS 15 Sequoia</strong></p>
<p>If you recently updated to macOS 15 Sequoia and are getting</p>
<pre><code class="language-console">error: the user '_nixbld1' in the group 'nixbld' does not exist
</code></pre>
<p>when running Nix commands, refer to GitHub issue <a href="https://github.com/NixOS/nix/issues/10892">NixOS/nix#10892</a> for instructions to fix your installation without reinstalling.</p>
</blockquote>
<p>To install the latest version Nix, run the following command:</p>
<pre><code class="language-console">$ curl -L https://nixos.org/nix/install | sh
</code></pre>
<p>This performs the default type of installation for your platform:</p>
<ul>
<li><a href="installation/installing-binary.html#multi-user-installation">Multi-user</a>:
<ul>
<li>Linux with systemd and without SELinux</li>
<li>macOS</li>
</ul>
</li>
<li><a href="installation/installing-binary.html#single-user-installation">Single-user</a>:
<ul>
<li>Linux without systemd</li>
<li>Linux with SELinux</li>
</ul>
</li>
</ul>
<p>We recommend the multi-user installation if it supports your platform and you can authenticate with <code>sudo</code>.</p>
<p>The installer can configured with various command line arguments and environment variables.
To show available command line flags:</p>
<pre><code class="language-console">$ curl -L https://nixos.org/nix/install | sh -s -- --help
</code></pre>
<p>To check what it does and how it can be customised further, <a href="installation/installing-binary.html#installing-from-a-binary-tarball">download and edit the second-stage installation script</a>.</p>
<h1 id="installing-a-pinned-nix-version-from-a-url"><a class="header" href="#installing-a-pinned-nix-version-from-a-url">Installing a pinned Nix version from a URL</a></h1>
<p>Version-specific installation URLs for all Nix versions since 1.11.16 can be found at <a href="https://releases.nixos.org/?prefix=nix/">releases.nixos.org</a>.
The directory for each version contains the corresponding SHA-256 hash.</p>
<p>All installation scripts are invoked the same way:</p>
<pre><code class="language-console">$ export VERSION=2.19.2 
$ curl -L https://releases.nixos.org/nix/nix-$VERSION/install | sh
</code></pre>
<h1 id="multi-user-installation"><a class="header" href="#multi-user-installation">Multi User Installation</a></h1>
<p>The multi-user Nix installation creates system users and a system service for the Nix daemon.</p>
<p>Supported systems:</p>
<ul>
<li>Linux running systemd, with SELinux disabled</li>
<li>macOS</li>
</ul>
<p>To explicitly instruct the installer to perform a multi-user installation on your system:</p>
<pre><code class="language-console">$ bash &lt;(curl -L https://nixos.org/nix/install) --daemon
</code></pre>
<p>You can run this under your usual user account or <code>root</code>.
The script will invoke <code>sudo</code> as needed.</p>
<h1 id="single-user-installation"><a class="header" href="#single-user-installation">Single User Installation</a></h1>
<p>To explicitly select a single-user installation on your system:</p>
<pre><code class="language-console">$ bash &lt;(curl -L https://nixos.org/nix/install) --no-daemon
</code></pre>
<p>In a single-user installation, <code>/nix</code> is owned by the invoking user.
The script will invoke <code>sudo</code> to create <code>/nix</code> if it doesn’t already exist.
If you don’t have <code>sudo</code>, manually create <code>/nix</code> as <code>root</code>:</p>
<pre><code class="language-console">$ su root
# mkdir /nix
# chown alice /nix
</code></pre>
<h1 id="installing-from-a-binary-tarball"><a class="header" href="#installing-from-a-binary-tarball">Installing from a binary tarball</a></h1>
<p>You can also download a binary tarball that contains Nix and all its dependencies:</p>
<ul>
<li>Choose a <a href="https://releases.nixos.org/?prefix=nix/">version</a> and <a href="installation/../development/building.html#platforms">system type</a></li>
<li>Download and unpack the tarball</li>
<li>Run the installer</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-console">$ pushd $(mktemp -d)
$ export VERSION=2.19.2
$ export SYSTEM=x86_64-linux
$ curl -LO https://releases.nixos.org/nix/nix-$VERSION/nix-$VERSION-$SYSTEM.tar.xz
$ tar xfj nix-$VERSION-$SYSTEM.tar.xz
$ cd nix-$VERSION-$SYSTEM
$ ./install
$ popd
</code></pre>
</blockquote>
<p>The installer can be customised with the environment variables declared in the file named <code>install-multi-user</code>.</p>
<h2 id="native-packages-for-linux-distributions"><a class="header" href="#native-packages-for-linux-distributions">Native packages for Linux distributions</a></h2>
<p>The Nix community maintains installers for some Linux distributions in their native packaging format(https://nix-community.github.io/nix-installers/).</p>
<h1 id="macos-installation"><a class="header" href="#macos-installation">macOS Installation</a></h1>
<!-- anchors to catch existing links -->
<p><a name="sect-macos-installation-change-store-prefix"></a><a name="sect-macos-installation-encrypted-volume"></a><a name="sect-macos-installation-symlink"></a><a name="sect-macos-installation-recommended-notes"></a></p>
<p>We believe we have ironed out how to cleanly support the read-only root file system
on modern macOS. New installs will do this automatically.</p>
<p>This section previously detailed the situation, options, and trade-offs,
but it now only outlines what the installer does. You don't need to know
this to run the installer, but it may help if you run into trouble:</p>
<ul>
<li>create a new APFS volume for your Nix store</li>
<li>update <code>/etc/synthetic.conf</code> to direct macOS to create a "synthetic"
empty root directory to mount your volume</li>
<li>specify mount options for the volume in <code>/etc/fstab</code>
<ul>
<li><code>rw</code>: read-write</li>
<li><code>noauto</code>: prevent the system from auto-mounting the volume (so the
LaunchDaemon mentioned below can control mounting it, and to avoid
masking problems with that mounting service).</li>
<li><code>nobrowse</code>: prevent the Nix Store volume from showing up on your
desktop; also keeps Spotlight from spending resources to index
this volume</li>
</ul>
<!-- TODO:
- `suid`: honor setuid? surely not? ...
- `owners`: honor file ownership on the volume

  For now I'll avoid pretending to understand suid/owners more
  than I do. There've been some vague reports of file-ownership
  and permission issues, particularly in cloud/VM/headless setups.
  My pet theory is that this has something to do with these setups
  not having a token that gets delegated to initial/admin accounts
  on macOS. See scripts/create-darwin-volume.sh for a little more.

  In any case, by Dec 4 2021, it _seems_ like some combination of
  suid, owners, and calling diskutil enableOwnership have stopped
  new reports from coming in. But I hesitate to celebrate because we
  haven't really named and catalogued the behavior, understood what
  we're fixing, and validated that all 3 components are essential.
-->
</li>
<li>if you have FileVault enabled
<ul>
<li>generate an encryption password</li>
<li>put it in your system Keychain</li>
<li>use it to encrypt the volume</li>
</ul>
</li>
<li>create a system LaunchDaemon to mount this volume early enough in the
boot process to avoid problems loading or restoring any programs that
need access to your Nix store</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installing-nix-from-source"><a class="header" href="#installing-nix-from-source">Installing Nix from Source</a></h1>
<p>If no binary package is available or if you want to hack on Nix, you
can build Nix from its Git repository.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h1>
<ul>
<li>
<p>GNU Autoconf (<a href="https://www.gnu.org/software/autoconf/">https://www.gnu.org/software/autoconf/</a>) and the
autoconf-archive macro collection
(<a href="https://www.gnu.org/software/autoconf-archive/">https://www.gnu.org/software/autoconf-archive/</a>). These are
needed to run the bootstrap script.</p>
</li>
<li>
<p>GNU Make.</p>
</li>
<li>
<p>Bash Shell. The <code>./configure</code> script relies on bashisms, so Bash is
required.</p>
</li>
<li>
<p>A version of GCC or Clang that supports C++20.</p>
</li>
<li>
<p><code>pkg-config</code> to locate dependencies. If your distribution does not
provide it, you can get it from
<a href="http://www.freedesktop.org/wiki/Software/pkg-config">http://www.freedesktop.org/wiki/Software/pkg-config</a>.</p>
</li>
<li>
<p>The OpenSSL library to calculate cryptographic hashes. If your
distribution does not provide it, you can get it from
<a href="https://www.openssl.org">https://www.openssl.org</a>.</p>
</li>
<li>
<p>The <code>libbrotlienc</code> and <code>libbrotlidec</code> libraries to provide
implementation of the Brotli compression algorithm. They are
available for download from the official repository
<a href="https://github.com/google/brotli">https://github.com/google/brotli</a>.</p>
</li>
<li>
<p>cURL and its library. If your distribution does not provide it, you
can get it from <a href="https://curl.haxx.se/">https://curl.haxx.se/</a>.</p>
</li>
<li>
<p>The SQLite embedded database library, version 3.6.19 or higher. If
your distribution does not provide it, please install it from
<a href="http://www.sqlite.org/">http://www.sqlite.org/</a>.</p>
</li>
<li>
<p>The <a href="http://www.hboehm.info/gc/">Boehm garbage collector (<code>bdw-gc</code>)</a> to reduce
the evaluator’s memory consumption (optional).</p>
<p>To enable it, install
<code>pkgconfig</code> and the Boehm garbage collector, and pass the flag
<code>--enable-gc</code> to <code>configure</code>.</p>
</li>
<li>
<p>The <code>boost</code> library of version 1.66.0 or higher. It can be obtained
from the official web site <a href="https://www.boost.org/">https://www.boost.org/</a>.</p>
</li>
<li>
<p>The <code>editline</code> library of version 1.14.0 or higher. It can be
obtained from the its repository
<a href="https://github.com/troglobit/editline">https://github.com/troglobit/editline</a>.</p>
</li>
<li>
<p>The <code>libsodium</code> library for verifying cryptographic signatures
of contents fetched from binary caches.
It can be obtained from the official web site
<a href="https://libsodium.org">https://libsodium.org</a>.</p>
</li>
<li>
<p>Recent versions of Bison and Flex to build the parser. (This is
because Nix needs GLR support in Bison and reentrancy support in
Flex.) For Bison, you need version 2.6, which can be obtained from
the <a href="ftp://alpha.gnu.org/pub/gnu/bison">GNU FTP server</a>. For Flex,
you need version 2.5.35, which is available on
<a href="http://lex.sourceforge.net/">SourceForge</a>. Slightly older versions
may also work, but ancient versions like the ubiquitous 2.5.4a
won't.</p>
</li>
<li>
<p>The <code>libseccomp</code> is used to provide syscall filtering on Linux. This
is an optional dependency and can be disabled passing a
<code>--disable-seccomp-sandboxing</code> option to the <code>configure</code> script (Not
recommended unless your system doesn't support <code>libseccomp</code>). To get
the library, visit <a href="https://github.com/seccomp/libseccomp">https://github.com/seccomp/libseccomp</a>.</p>
</li>
<li>
<p>On 64-bit x86 machines only, <code>libcpuid</code> library
is used to determine which microarchitecture levels are supported
(e.g., as whether to have <code>x86_64-v2-linux</code> among additional system types).
The library is available from its homepage
<a href="http://libcpuid.sourceforge.net">http://libcpuid.sourceforge.net</a>.
This is an optional dependency and can be disabled
by providing a <code>--disable-cpuid</code> to the <code>configure</code> script.</p>
</li>
<li>
<p>Unless <code>./configure --disable-unit-tests</code> is specified, GoogleTest (GTest) and
RapidCheck are required, which are available at
<a href="https://google.github.io/googletest/">https://google.github.io/googletest/</a> and
<a href="https://github.com/emil-e/rapidcheck">https://github.com/emil-e/rapidcheck</a> respectively.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="obtaining-the-source"><a class="header" href="#obtaining-the-source">Obtaining the Source</a></h1>
<p>The most recent sources of Nix can be obtained from its <a href="https://github.com/NixOS/nix">Git
repository</a>. For example, the following
command will check out the latest revision into a directory called
<code>nix</code>:</p>
<pre><code class="language-console">$ git clone https://github.com/NixOS/nix
</code></pre>
<p>Likewise, specific releases can be obtained from the
<a href="https://github.com/NixOS/nix/tags">tags</a> of the repository.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="building-nix-from-source"><a class="header" href="#building-nix-from-source">Building Nix from Source</a></h1>
<p>Nix is built with <a href="https://mesonbuild.com/">Meson</a>.
It is broken up into multiple Meson packages, which are optionally combined in a single project using Meson's <a href="https://mesonbuild.com/Subprojects.html">subprojects</a> feature.</p>
<p>There are no mandatory extra steps to the building process:
generic Meson installation instructions like <a href="https://mesonbuild.com/Quick-guide.html#using-meson-as-a-distro-packager">this</a> should work.</p>
<p>The installation path can be specified by passing the <code>-Dprefix=prefix</code>
to <code>configure</code>. The default installation directory is <code>/usr/local</code>. You
can change this to any location you like. You must have write permission
to the <em>prefix</em> path.</p>
<p>Nix keeps its <em>store</em> (the place where packages are stored) in
<code>/nix/store</code> by default. This can be changed using
<code>-Dstore-dir=path</code>.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>It is best <em>not</em> to change the Nix store from its default, since doing
so makes it impossible to use pre-built binaries from the standard
Nixpkgs channels — that is, all packages will need to be built from
source.</p>
</blockquote>
<p>Nix keeps state (such as its database and log files) in <code>/nix/var</code> by
default. This can be changed using <code>-Dlocalstatedir=path</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-nix-within-docker"><a class="header" href="#using-nix-within-docker">Using Nix within Docker</a></h1>
<p>To run the latest stable release of Nix with Docker run the following command:</p>
<pre><code class="language-console">$ docker run -ti ghcr.io/nixos/nix
Unable to find image 'ghcr.io/nixos/nix:latest' locally
latest: Pulling from ghcr.io/nixos/nix
5843afab3874: Pull complete
b52bf13f109c: Pull complete
1e2415612aa3: Pull complete
Digest: sha256:27f6e7f60227e959ee7ece361f75d4844a40e1cc6878b6868fe30140420031ff
Status: Downloaded newer image for ghcr.io/nixos/nix:latest
35ca4ada6e96:/# nix --version
nix (Nix) 2.3.12
35ca4ada6e96:/# exit
</code></pre>
<h1 id="what-is-included-in-nixs-docker-image"><a class="header" href="#what-is-included-in-nixs-docker-image">What is included in Nix's Docker image?</a></h1>
<p>The official Docker image is created using <code>pkgs.dockerTools.buildLayeredImage</code>
(and not with <code>Dockerfile</code> as it is usual with Docker images). You can still
base your custom Docker image on it as you would do with any other Docker
image.</p>
<p>The Docker image is also not based on any other image and includes minimal set
of runtime dependencies that are required to use Nix:</p>
<ul>
<li>pkgs.nix</li>
<li>pkgs.bashInteractive</li>
<li>pkgs.coreutils-full</li>
<li>pkgs.gnutar</li>
<li>pkgs.gzip</li>
<li>pkgs.gnugrep</li>
<li>pkgs.which</li>
<li>pkgs.curl</li>
<li>pkgs.less</li>
<li>pkgs.wget</li>
<li>pkgs.man</li>
<li>pkgs.cacert.out</li>
<li>pkgs.findutils</li>
</ul>
<h1 id="docker-image-with-the-latest-development-version-of-nix"><a class="header" href="#docker-image-with-the-latest-development-version-of-nix">Docker image with the latest development version of Nix</a></h1>
<p>To get the latest image that was built by <a href="https://hydra.nixos.org">Hydra</a> run
the following command:</p>
<pre><code class="language-console">$ curl -L https://hydra.nixos.org/job/nix/master/dockerImage.x86_64-linux/latest/download/1 | docker load
$ docker run -ti nix:2.5pre20211105
</code></pre>
<p>You can also build a Docker image from source yourself:</p>
<pre><code class="language-console">$ nix build ./\#hydraJobs.dockerImage.x86_64-linux
$ docker load -i ./result/image.tar.gz
$ docker run -ti nix:2.5pre20211105
</code></pre>
<h1 id="docker-image-with-non-root-nix"><a class="header" href="#docker-image-with-non-root-nix">Docker image with non-root Nix</a></h1>
<p>If you would like to run Nix in a container under a user other than <code>root</code>,
you can build an image with a non-root single-user installation of Nix
by specifying the <code>uid</code>, <code>gid</code>, <code>uname</code>, and <code>gname</code> arguments to <code>docker.nix</code>:</p>
<pre><code class="language-console">$ nix build --file docker.nix \
    --arg uid 1000 \
    --arg gid 1000 \
    --argstr uname user \
    --argstr gname user \
    --argstr name nix-user \
    --out-link nix-user.tar.gz
$ docker load -i nix-user.tar.gz
$ docker run -ti nix-user
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="security"><a class="header" href="#security">Security</a></h1>
<p>Nix has two basic security models. First, it can be used in “single-user
mode”, which is similar to what most other package management tools do:
there is a single user (typically root) who performs all package
management operations. All other users can then use the installed
packages, but they cannot perform package management operations
themselves.</p>
<p>Alternatively, you can configure Nix in “multi-user mode”. In this
model, all users can perform package management operations — for
instance, every user can install software without requiring root
privileges. Nix ensures that this is secure. For instance, it’s not
possible for one user to overwrite a package used by another user with a
Trojan horse.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="single-user-mode"><a class="header" href="#single-user-mode">Single-User Mode</a></h1>
<p>In single-user mode, all Nix operations that access the database in
<code>prefix/var/nix/db</code> or modify the Nix store in <code>prefix/store</code> must be
performed under the user ID that owns those directories. This is
typically root. (If you install from RPM packages, that’s in fact the
default ownership.) However, on single-user machines, it is often
convenient to <code>chown</code> those directories to your normal user account so
that you don’t have to <code>su</code> to root all the time.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multi-user-mode"><a class="header" href="#multi-user-mode">Multi-User Mode</a></h1>
<p>To allow a Nix store to be shared safely among multiple users, it is
important that users are not able to run builders that modify the Nix
store or database in arbitrary ways, or that interfere with builds
started by other users. If they could do so, they could install a Trojan
horse in some package and compromise the accounts of other users.</p>
<p>To prevent this, the Nix store and database are owned by some privileged
user (usually <code>root</code>) and builders are executed under special user
accounts (usually named <code>nixbld1</code>, <code>nixbld2</code>, etc.). When a unprivileged
user runs a Nix command, actions that operate on the Nix store (such as
builds) are forwarded to a <em>Nix daemon</em> running under the owner of the
Nix store/database that performs the operation.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>Multi-user mode has one important limitation: only root and a set of
trusted users specified in <code>nix.conf</code> can specify arbitrary binary
caches. So while unprivileged users may install packages from
arbitrary Nix expressions, they may not get pre-built binaries.</p>
</blockquote>
<h2 id="setting-up-the-build-users"><a class="header" href="#setting-up-the-build-users">Setting up the build users</a></h2>
<p>The <em>build users</em> are the special UIDs under which builds are performed.
They should all be members of the <em>build users group</em> <code>nixbld</code>. This
group should have no other members. The build users should not be
members of any other group. On Linux, you can create the group and users
as follows:</p>
<pre><code class="language-console">$ groupadd -r nixbld
$ for n in $(seq 1 10); do useradd -c "Nix build user $n" \
    -d /var/empty -g nixbld -G nixbld -M -N -r -s "$(which nologin)" \
    nixbld$n; done
</code></pre>
<p>This creates 10 build users. There can never be more concurrent builds
than the number of build users, so you may want to increase this if you
expect to do many builds at the same time.</p>
<h2 id="running-the-daemon"><a class="header" href="#running-the-daemon">Running the daemon</a></h2>
<p>The <a href="installation/../command-ref/nix-daemon.html">Nix daemon</a> should be started as
follows (as <code>root</code>):</p>
<pre><code class="language-console">$ nix-daemon
</code></pre>
<p>You’ll want to put that line somewhere in your system’s boot scripts.</p>
<p>To let unprivileged users use the daemon, they should set the
<a href="installation/../command-ref/env-common.html"><code>NIX_REMOTE</code> environment variable</a> to
<code>daemon</code>. So you should put a line like</p>
<pre><code class="language-console">export NIX_REMOTE=daemon
</code></pre>
<p>into the users’ login scripts.</p>
<h2 id="restricting-access"><a class="header" href="#restricting-access">Restricting access</a></h2>
<p>To limit which users can perform Nix operations, you can use the
permissions on the directory <code>/nix/var/nix/daemon-socket</code>. For instance,
if you want to restrict the use of Nix to the members of a group called
<code>nix-users</code>, do</p>
<pre><code class="language-console">$ chgrp nix-users /nix/var/nix/daemon-socket
$ chmod ug=rwx,o= /nix/var/nix/daemon-socket
</code></pre>
<p>This way, users who are not in the <code>nix-users</code> group cannot connect to
the Unix domain socket <code>/nix/var/nix/daemon-socket/socket</code>, so they
cannot perform Nix operations.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="environment-variables"><a class="header" href="#environment-variables">Environment Variables</a></h1>
<p>To use Nix, some environment variables should be set. In particular,
<code>PATH</code> should contain the directories <code>prefix/bin</code> and
<code>~/.nix-profile/bin</code>. The first directory contains the Nix tools
themselves, while <code>~/.nix-profile</code> is a symbolic link to the current
<em>user environment</em> (an automatically generated package consisting of
symlinks to installed packages). The simplest way to set the required
environment variables is to include the file
<code>prefix/etc/profile.d/nix.sh</code> in your <code>~/.profile</code> (or similar), like
this:</p>
<pre><code class="language-bash">source prefix/etc/profile.d/nix.sh
</code></pre>
<h1 id="nix_ssl_cert_file"><a class="header" href="#nix_ssl_cert_file"><code>NIX_SSL_CERT_FILE</code></a></h1>
<p>If you need to specify a custom certificate bundle to account for an
HTTPS-intercepting man in the middle proxy, you must specify the path to
the certificate bundle in the environment variable <code>NIX_SSL_CERT_FILE</code>.</p>
<p>If you don't specify a <code>NIX_SSL_CERT_FILE</code> manually, Nix will install
and use its own certificate bundle.</p>
<p>Set the environment variable and install Nix</p>
<pre><code class="language-console">$ export NIX_SSL_CERT_FILE=/etc/ssl/my-certificate-bundle.crt
$ curl -L https://nixos.org/nix/install | sh
</code></pre>
<p>In the shell profile and rc files (for example, <code>/etc/bashrc</code>,
<code>/etc/zshrc</code>), add the following line:</p>
<pre><code class="language-bash">export NIX_SSL_CERT_FILE=/etc/ssl/my-certificate-bundle.crt
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>You must not add the export and then do the install, as the Nix
installer will detect the presence of Nix configuration, and abort.</p>
</blockquote>
<p>If you use the Nix daemon, you should also add the following to
<code>/etc/nix/nix.conf</code>:</p>
<pre><code>ssl-cert-file = /etc/ssl/my-certificate-bundle.crt
</code></pre>
<h2 id="proxy-environment-variables"><a class="header" href="#proxy-environment-variables">Proxy Environment Variables</a></h2>
<p>The Nix installer has special handling for these proxy-related
environment variables: <code>http_proxy</code>, <code>https_proxy</code>, <code>ftp_proxy</code>,
<code>all_proxy</code>, <code>no_proxy</code>, <code>HTTP_PROXY</code>, <code>HTTPS_PROXY</code>, <code>FTP_PROXY</code>,
<code>ALL_PROXY</code>, <code>NO_PROXY</code>.</p>
<p>If any of these variables are set when running the Nix installer, then
the installer will create an override file at
<code>/etc/systemd/system/nix-daemon.service.d/override.conf</code> so <code>nix-daemon</code>
will use them.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="upgrading-nix"><a class="header" href="#upgrading-nix">Upgrading Nix</a></h1>
<blockquote>
<p><strong>Note</strong></p>
<p>These upgrade instructions apply where Nix was installed following the <a href="installation/./index.html">installation instructions in this manual</a>.</p>
</blockquote>
<p>Check which Nix version will be installed, for example from one of the <a href="http://channels.nixos.org/">release channels</a> such as <code>nixpkgs-unstable</code>:</p>
<pre><code class="language-console">$ nix-shell -p nix -I nixpkgs=channel:nixpkgs-unstable --run "nix --version"
nix (Nix) 2.18.1
</code></pre>
<blockquote>
<p><strong>Warning</strong></p>
<p>Writing to the <a href="installation/../store/types/local-store.html">local store</a> with a newer version of Nix, for example by building derivations with <a href="installation/../command-ref/nix-build.html"><code>nix-build</code></a> or <a href="installation/../command-ref/nix-store/realise.html"><code>nix-store --realise</code></a>, may change the database schema!
Reverting to an older version of Nix may therefore require purging the store database before it can be used.</p>
</blockquote>
<h2 id="linux-multi-user"><a class="header" href="#linux-multi-user">Linux multi-user</a></h2>
<pre><code class="language-console">$ sudo su
# nix-env --install --file '&lt;nixpkgs&gt;' --attr nix cacert -I nixpkgs=channel:nixpkgs-unstable
# systemctl daemon-reload
# systemctl restart nix-daemon
</code></pre>
<h2 id="macos-multi-user"><a class="header" href="#macos-multi-user">macOS multi-user</a></h2>
<pre><code class="language-console">$ sudo nix-env --install --file '&lt;nixpkgs&gt;' --attr nix cacert -I nixpkgs=channel:nixpkgs-unstable
$ sudo launchctl remove org.nixos.nix-daemon
$ sudo launchctl load /Library/LaunchDaemons/org.nixos.nix-daemon.plist
</code></pre>
<h2 id="single-user-all-platforms"><a class="header" href="#single-user-all-platforms">Single-user all platforms</a></h2>
<pre><code class="language-console">$ nix-env --install --file '&lt;nixpkgs&gt;' --attr nix cacert -I nixpkgs=channel:nixpkgs-unstable
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="uninstalling-nix"><a class="header" href="#uninstalling-nix">Uninstalling Nix</a></h1>
<h2 id="multi-user-1"><a class="header" href="#multi-user-1">Multi User</a></h2>
<p>Removing a <a href="installation/./installing-binary.html#multi-user-installation">multi-user installation</a> depends on the operating system.</p>
<h3 id="linux"><a class="header" href="#linux">Linux</a></h3>
<p>If you are on Linux with systemd:</p>
<ol>
<li>
<p>Remove the Nix daemon service:</p>
<pre><code class="language-console">sudo systemctl stop nix-daemon.service
sudo systemctl disable nix-daemon.socket nix-daemon.service
sudo systemctl daemon-reload
</code></pre>
</li>
</ol>
<p>Remove files created by Nix:</p>
<pre><code class="language-console">sudo rm -rf /etc/nix /etc/profile.d/nix.sh /etc/tmpfiles.d/nix-daemon.conf /nix ~root/.nix-channels ~root/.nix-defexpr ~root/.nix-profile ~root/.cache/nix
</code></pre>
<p>Remove build users and their group:</p>
<pre><code class="language-console">for i in $(seq 1 32); do
  sudo userdel nixbld$i
done
sudo groupdel nixbld
</code></pre>
<p>There may also be references to Nix in</p>
<ul>
<li><code>/etc/bash.bashrc</code></li>
<li><code>/etc/bashrc</code></li>
<li><code>/etc/profile</code></li>
<li><code>/etc/zsh/zshrc</code></li>
<li><code>/etc/zshrc</code></li>
</ul>
<p>which you may remove.</p>
<h3 id="macos"><a class="header" href="#macos">macOS</a></h3>
<blockquote>
<p><strong>Updating to macOS 15 Sequoia</strong></p>
<p>If you recently updated to macOS 15 Sequoia and are getting</p>
<pre><code class="language-console">error: the user '_nixbld1' in the group 'nixbld' does not exist
</code></pre>
<p>when running Nix commands, refer to GitHub issue <a href="https://github.com/NixOS/nix/issues/10892">NixOS/nix#10892</a> for instructions to fix your installation without reinstalling.</p>
</blockquote>
<ol>
<li>
<p>If system-wide shell initialisation files haven't been altered since installing Nix, use the backups made by the installer:</p>
<pre><code class="language-console">sudo mv /etc/zshrc.backup-before-nix /etc/zshrc
sudo mv /etc/bashrc.backup-before-nix /etc/bashrc
sudo mv /etc/bash.bashrc.backup-before-nix /etc/bash.bashrc
</code></pre>
<p>Otherwise, edit <code>/etc/zshrc</code>, <code>/etc/bashrc</code>, and <code>/etc/bash.bashrc</code> to remove the lines sourcing <code>nix-daemon.sh</code>, which should look like this:</p>
<pre><code class="language-bash"># Nix
if [ -e '/nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh' ]; then
  . '/nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh'
fi
# End Nix
</code></pre>
</li>
<li>
<p>Stop and remove the Nix daemon services:</p>
<pre><code class="language-console">sudo launchctl unload /Library/LaunchDaemons/org.nixos.nix-daemon.plist
sudo rm /Library/LaunchDaemons/org.nixos.nix-daemon.plist
sudo launchctl unload /Library/LaunchDaemons/org.nixos.darwin-store.plist
sudo rm /Library/LaunchDaemons/org.nixos.darwin-store.plist
</code></pre>
<p>This stops the Nix daemon and prevents it from being started next time you boot the system.</p>
</li>
<li>
<p>Remove the <code>nixbld</code> group and the <code>_nixbuildN</code> users:</p>
<pre><code class="language-console">sudo dscl . -delete /Groups/nixbld
for u in $(sudo dscl . -list /Users | grep _nixbld); do sudo dscl . -delete /Users/$u; done
</code></pre>
<p>This will remove all the build users that no longer serve a purpose.</p>
</li>
<li>
<p>Edit fstab using <code>sudo vifs</code> to remove the line mounting the Nix Store volume on <code>/nix</code>, which looks like</p>
<pre><code>UUID=&lt;uuid&gt; /nix apfs rw,noauto,nobrowse,suid,owners
</code></pre>
<p>or</p>
<pre><code>LABEL=Nix\040Store /nix apfs rw,nobrowse
</code></pre>
<p>by setting the cursor on the respective line using the arrow keys, and pressing <code>dd</code>, and then <code>:wq</code> to save the file.</p>
<p>This will prevent automatic mounting of the Nix Store volume.</p>
</li>
<li>
<p>Edit <code>/etc/synthetic.conf</code> to remove the <code>nix</code> line.
If this is the only line in the file you can remove it entirely:</p>
<pre><code class="language-bash">if [ -f /etc/synthetic.conf ]; then
  if [ "$(cat /etc/synthetic.conf)" = "nix" ]; then
    sudo rm /etc/synthetic.conf
  else
    sudo vi /etc/synthetic.conf
  fi
fi
</code></pre>
<p>This will prevent the creation of the empty <code>/nix</code> directory.</p>
</li>
<li>
<p>Remove the files Nix added to your system, except for the store:</p>
<pre><code class="language-console">sudo rm -rf /etc/nix /var/root/.nix-profile /var/root/.nix-defexpr /var/root/.nix-channels ~/.nix-profile ~/.nix-defexpr ~/.nix-channels
</code></pre>
</li>
<li>
<p>Remove the Nix Store volume:</p>
<pre><code class="language-console">sudo diskutil apfs deleteVolume /nix
</code></pre>
<p>This will remove the Nix Store volume and everything that was added to the store.</p>
<p>If the output indicates that the command couldn't remove the volume, you should make sure you don't have an <em>unmounted</em> Nix Store volume.
Look for a "Nix Store" volume in the output of the following command:</p>
<pre><code class="language-console">diskutil list
</code></pre>
<p>If you <em>do</em> find a "Nix Store" volume, delete it by running <code>diskutil apfs deleteVolume</code> with the store volume's <code>diskXsY</code> identifier.</p>
<p>If you get an error that the volume is in use by the kernel, reboot and immediately delete the volume before starting any other process.</p>
</li>
</ol>
<blockquote>
<p><strong>Note</strong></p>
<p>After you complete the steps here, you will still have an empty <code>/nix</code> directory.
This is an expected sign of a successful uninstall.
The empty <code>/nix</code> directory will disappear the next time you reboot.</p>
<p>You do not have to reboot to finish uninstalling Nix.
The uninstall is complete.
macOS (Catalina+) directly controls root directories, and its read-only root will prevent you from manually deleting the empty <code>/nix</code> mountpoint.</p>
</blockquote>
<h2 id="single-user-1"><a class="header" href="#single-user-1">Single User</a></h2>
<p>To remove a <a href="installation/./installing-binary.html#single-user-installation">single-user installation</a> of Nix, run:</p>
<pre><code class="language-console">rm -rf /nix ~/.nix-channels ~/.nix-defexpr ~/.nix-profile
</code></pre>
<p>You might also want to manually remove references to Nix from your <code>~/.profile</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nix-store"><a class="header" href="#nix-store">Nix Store</a></h1>
<p>The <em>Nix store</em> is an abstraction to store immutable file system data (such as software packages) that can have dependencies on other such data.</p>
<p>There are <a href="store/./types/index.html">multiple types of Nix stores</a> with different capabilities, such as the default one on the <a href="store/./types/local-store.html">local filesystem</a> (<code>/nix/store</code>) or <a href="store/./types/http-binary-cache-store.html">binary caches</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="file-system-object"><a class="header" href="#file-system-object">File System Object</a></h1>
<p>Nix uses a simplified model of the file system, which consists of file system objects.
Every file system object is one of the following:</p>
<ul>
<li>
<p>File</p>
<ul>
<li>A possibly empty sequence of bytes for contents</li>
<li>A single boolean representing the <a href="https://en.m.wikipedia.org/wiki/File-system_permissions#Permissions">executable</a> permission</li>
</ul>
</li>
<li>
<p>Directory</p>
<p>Mapping of names to child file system objects</p>
</li>
<li>
<p><a href="https://en.m.wikipedia.org/wiki/Symbolic_link">Symbolic link</a></p>
<p>An arbitrary string.
Nix does not assign any semantics to symbolic links.</p>
</li>
</ul>
<p>File system objects and their children form a tree.
A bare file or symlink can be a root file system object.</p>
<p>Nix does not encode any other file system notions such as <a href="https://en.m.wikipedia.org/wiki/Hard_link">hard links</a>, <a href="https://en.m.wikipedia.org/wiki/File-system_permissions">permissions</a>, timestamps, or other metadata.</p>
<h2 id="examples-of-file-system-objects"><a class="header" href="#examples-of-file-system-objects">Examples of file system objects</a></h2>
<p>A plain file:</p>
<pre><code>50 B, executable: false
</code></pre>
<p>An executable file:</p>
<pre><code>122 KB, executable: true
</code></pre>
<p>A symlink:</p>
<pre><code>-&gt; /usr/bin/sh
</code></pre>
<p>A directory with contents:</p>
<pre><code>├── bin
│   └── hello: 35 KB, executable: true
└── share
    ├── info
    │   └── hello.info: 36 KB, executable: false
    └── man
        └── man1
            └── hello.1.gz: 790 B, executable: false
</code></pre>
<p>A directory that contains a symlink and other directories:</p>
<pre><code>├── bin -&gt; share/go/bin
├── nix-support/
└── share/
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="content-addressing-file-system-objects"><a class="header" href="#content-addressing-file-system-objects">Content-Addressing File System Objects</a></h1>
<p>For many operations, Nix needs to calculate <a href="store/file-system-object/../../glossary.html#gloss-content-address">a content addresses</a> of <a href="store/file-system-object/../file-system-object.html">a file system object</a> (FSO).
Usually this is needed as part of
<a href="store/file-system-object/../store-object/content-address.html">content addressing store objects</a>,
since store objects always have a root file system object.
But some command-line utilities also just work on "raw" file system objects, not part of any store object.</p>
<p>Every content addressing scheme Nix uses ultimately involves feeding data into a <a href="https://en.wikipedia.org/wiki/Hash_function">hash function</a>, and getting back an opaque fixed-size digest which is deemed a content address.
The various <em>methods</em> of content addressing thus differ in how abstract data (in this case, a file system object and its descendants) are fed into the hash function.</p>
<h2 id="serial"><a class="header" href="#serial">Serialising File System Objects</a></h2>
<p>The simplest method is to serialise the entire file system object tree into a single binary string, and then hash that binary string, yielding the content address.
In this section we describe the currently-supported methods of serialising file system objects.</p>
<h3 id="serial-flat"><a class="header" href="#serial-flat">Flat</a></h3>
<p>A single file object can just be hashed by its contents.
This is not enough information to encode the fact that the file system object is a file,
but if we <em>already</em> know that the FSO is a single non-executable file by other means, it is sufficient.</p>
<p>Because the hashed data is just the raw file, as is, this choice is good for compatibility with other systems.
For example, Unix commands like <code>sha256sum</code> or <code>sha1sum</code> will produce hashes for single files that match this.</p>
<h3 id="serial-nix-archive"><a class="header" href="#serial-nix-archive">Nix Archive (NAR)</a></h3>
<p>For the other cases of <a href="store/file-system-object/../file-system-object.html">file system objects</a>, especially directories with arbitrary descendants, we need a more complex serialisation format.
Examples of such serialisations are the ZIP and TAR file formats.
However, for our purposes these formats have two problems:</p>
<ul>
<li>
<p>They do not have a canonical serialisation, meaning that given an FSO, there can
be many different serialisations.
For instance, TAR files can have variable amounts of padding between archive members;
and some archive formats leave the order of directory entries undefined.
This would be bad because we use serialisation to compute cryptographic hashes over file system objects, and for those hashes to be useful as a content address or for integrity checking, uniqueness is crucial.
Otherwise, correct hashes would report false mismatches, and the store would fail to find the content.</p>
</li>
<li>
<p>They store more information than we have in our notion of FSOs, such as time stamps.
This can cause FSOs that Nix should consider equal to hash to different values on different machines, just because the dates differ.</p>
</li>
<li>
<p>As a practical consideration, the TAR format is the only truly universal format in the Unix environment.
It has many problems, such as an inability to deal with long file names and files larger than 2^33 bytes.
Current implementations such as GNU Tar work around these limitations in various ways.</p>
</li>
</ul>
<p>For these reasons, Nix has its very own archive format—the Nix Archive (NAR) format,
which is carefully designed to avoid the problems described above.</p>
<p>The exact specification of the Nix Archive format is in <a href="store/file-system-object/../../protocols/nix-archive.html">specified here</a>.</p>
<h2 id="content-addressing-file-system-objects-beyond-a-single-serialisation-pass"><a class="header" href="#content-addressing-file-system-objects-beyond-a-single-serialisation-pass">Content addressing File System Objects beyond a single serialisation pass</a></h2>
<p>Serialising the entire tree and then hashing that binary string is not the only option for content addressing, however.
Another technique is that of a <a href="https://en.wikipedia.org/wiki/Merkle_tree">Merkle graph</a>, where previously computed hashes are included in subsequent byte strings to be hashed.</p>
<p>In particular, the Merkle graphs can match the original graph structure of file system objects:
we can first hash (serialised) child file system objects, and then hash parent objects using the hashes of their children in the serialisation (to be hashed) of the parent file system objects.</p>
<p>Currently, there is one such Merkle DAG content addressing method supported.</p>
<h3 id="git"><a class="header" href="#git">Git (<a href="store/file-system-object/../../development/experimental-features.html#xp-feature-git-hashing">experimental</a>)</a></h3>
<blockquote>
<p><strong>Warning</strong></p>
<p>This method is part of the <a href="store/file-system-object/../../development/experimental-features.html#xp-feature-git-hashing"><code>git-hashing</code></a> experimental feature.</p>
</blockquote>
<p>Git's file system model is very close to Nix's, and so Git's content addressing method is a pretty good fit.
Just as with regular Git, files and symlinks are hashed as git "blobs", and directories are hashed as git "trees".</p>
<p>However, one difference between Nix's and Git's file system model needs special treatment.
Plain files, executable files, and symlinks are not differentiated as distinctly addressable objects, but by their context: by the directory entry that refers to them.
That means so long as the root object is a directory, there is no problem:
every non-directory object is owned by a parent directory, and the entry that refers to it provides the missing information.
However, if the root object is not a directory, then we have no way of knowing which one of an executable file, non-executable file, or symlink it is supposed to be.</p>
<p>In response to this, we have decided to treat a bare file as non-executable file.
This is similar to do what we do with <a href="store/file-system-object/content-address.html#serial-flat">flat serialisation</a>, which also lacks this information.
To avoid an address collision, attempts to hash a bare executable file or symlink will result in an error (just as would happen for flat serialisation also).
Thus, Git can encode some, but not all of Nix's "File System Objects", and this sort of content-addressing is likewise partial.</p>
<p>In the future, we may support a Git-like hash for such file system objects, or we may adopt another Merkle DAG format which is capable of representing all Nix file system objects.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="store-object"><a class="header" href="#store-object">Store Object</a></h2>
<p>A Nix store is a collection of <em>store objects</em> with <em>references</em> between them.
A store object consists of</p>
<ul>
<li>A <a href="store/./file-system-object.html">file system object</a> as data</li>
<li>A set of <a href="store/./store-path.html">store paths</a> as references to other store objects</li>
</ul>
<p>Store objects are <a href="https://en.wikipedia.org/wiki/Immutable_object">immutable</a>:
Once created, they do not change until they are deleted.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="content-addressing-store-objects"><a class="header" href="#content-addressing-store-objects">Content-Addressing Store Objects</a></h1>
<p>Just <a href="store/store-object/../file-system-object/content-address.html">like</a> <a href="store/store-object/../file-system-object.html">File System Objects</a>,
<a href="store/store-object/../store-object.html">Store Objects</a> can also be <a href="store/store-object/../../glossary.html#gloss-content-addressed">content-addressed</a>,
unless they are <a href="store/store-object/../../glossary.html#gloss-input-addressed-store-object">input-addressed</a>.</p>
<p>For store objects, the content address we produce will take the form of a <a href="store/store-object/../store-path.html">Store Path</a> rather than regular hash.
In particular, the content-addressing scheme will ensure that the digest of the store path is solely computed from the</p>
<ul>
<li>file system object graph (the root one and its children, if it has any)</li>
<li>references</li>
<li><a href="store/store-object/../store-path.html#store-directory">store directory</a></li>
<li>name</li>
</ul>
<p>of the store object, and not any other information, which would not be an intrinsic property of that store object.</p>
<p>For the full specification of the algorithms involved, see the <a href="store/store-object/../../protocols/store-path.html">specification of store path digests</a>.</p>
<h2 id="content-addressing-each-part-of-a-store-object"><a class="header" href="#content-addressing-each-part-of-a-store-object">Content addressing each part of a store object</a></h2>
<h3 id="file-system-objects"><a class="header" href="#file-system-objects">File System Objects</a></h3>
<p>With all currently-supported store object content-addressing methods, the file system object is always <a href="store/store-object/../file-system-object/content-address.html">content-addressed</a> first, and then that hash is incorporated into content address computation for the store object.</p>
<h3 id="references"><a class="header" href="#references">References</a></h3>
<h4 id="references-to-other-store-objects"><a class="header" href="#references-to-other-store-objects">References to other store objects</a></h4>
<p>With all currently supported store object content addressing methods,
other objects are referred to by their regular (string-encoded-) <a href="store/store-object/../store-path.html">store paths</a>.</p>
<h4 id="self-references"><a class="header" href="#self-references">Self-references</a></h4>
<p>Self-references however cannot be referred to by their path, because we are in the midst of describing how to compute that path!</p>
<blockquote>
<p>The alternative would require finding as hash function fixed point, i.e. the solution to an equation in the form</p>
<pre><code>digest = hash(..... || digest || ....)
</code></pre>
<p>which is computationally infeasible.
As far as we know, this is equivalent to finding a hash collision.</p>
</blockquote>
<p>Instead we have a "has self-reference" boolean, which ends up affecting the digest:
In all currently-supported store object content-addressing methods, when hashing the file system object data, any occurence of store object's own store path in the digested data is replaced with a <a href="https://en.wikipedia.org/wiki/Sentinel_value">sentinel value</a>.
The hashes of these modified input streams are used instead.</p>
<p>When validating the content address of a store object after the fact, the above process works as written.
However, when first creating the store object we don't know the store object's store path, as explained just above.
We therefore, strictly speaking, do not know what value we will be replacing with the sentinel value in the inputs to hash functions.
What instead happens is that the provisional store object --- the data from which we wish to create a store object --- is paired with a provisional "scratch" store path (that presumably was chosen when the data was created).
That provisional store path is instead what is replaced with the sentinel value, rather than the final store object which we do not yet know.</p>
<blockquote>
<p><strong>Design note</strong></p>
<p>It is an informal property of content-addressed store objects that the choice of provisional store path should not matter.
In other words, if a provisional store object is prepared in the same way except for the choice of provision store path, the provisional data need not be identical.
But, after the sentinel value is substituted in place of each provisional store object's provision store path, the final so-normalized data <em>should</em> be identical.</p>
<p>If, conversely, the data after this normalization process is still different, we'll compute a different content-address.
The method of preparing the provisional self-referenced data has <em>failed</em> to be deterministic in the sense of not <em>leaking</em> the choice of provisional store path --- a choice which is supposed to be arbitrary --- into the final store object.</p>
<p>This property is informal because at this stage, we are just described store objects, which have no formal notion of their origin.
Without such a formal notion, there is nothing to formally accuse of being insufficiently deterministic.
Where we cover <a href="store/store-object/../../store/derivation/index.html">derivations</a>, we will have a chance to make this a formal property, not of content-addressed store objects themselves, but of derivations that <em>produce</em> content-addressed store objects.</p>
</blockquote>
<h3 id="name-and-store-directory"><a class="header" href="#name-and-store-directory">Name and Store Directory</a></h3>
<p>These two items affect the digest in a way that is standard for store path digest computations and not specific to content-addressing.
Consult the <a href="store/store-object/../../protocols/store-path.html">specification of store path digests</a> for further details.</p>
<h2 id="content-addressing-methods"><a class="header" href="#content-addressing-methods">Content addressing Methods</a></h2>
<p>For historical reasons, we don't support all features in all combinations.
Each currently supported method of content addressing chooses a single method of file system object hashing, and may offer some restrictions on references.
The names and store directories are unrestricted however.</p>
<h3 id="method-flat"><a class="header" href="#method-flat">Flat</a></h3>
<p>This uses the corresponding <a href="store/store-object/../file-system-object/content-address.html#serial-flat">Flat</a> method of file system object content addressing.</p>
<p>References are not supported: store objects with flat hashing <em>and</em> references can not be created.</p>
<h3 id="method-text"><a class="header" href="#method-text">Text</a></h3>
<p>This also uses the corresponding <a href="store/store-object/../file-system-object/content-address.html#serial-flat">Flat</a> method of file system object content addressing.</p>
<p>References to other store objects are supported, but self-references are not.</p>
<p>This is the only store-object content-addressing method that is not named identically with a corresponding file system object method.
It is somewhat obscure, mainly used for "drv files"
(derivations serialized as store objects in their <a href="store/store-object/../../protocols/derivation-aterm.html">"ATerm" file format</a>).
Prefer another method if possible.</p>
<h3 id="method-nix-archive"><a class="header" href="#method-nix-archive">Nix Archive</a></h3>
<p>This uses the corresponding <a href="store/store-object/../file-system-object/content-address.html#serial-nix-archive">Nix Archive</a> method of file system object content addressing.</p>
<p>References (to other store objects and self-references alike) are supported so long as the hash algorithm is SHA-256, but not (neither kind) otherwise.</p>
<h3 id="method-git"><a class="header" href="#method-git">Git</a></h3>
<blockquote>
<p><strong>Warning</strong></p>
<p>This method is part of the <a href="store/store-object/../../development/experimental-features.html#xp-feature-git-hashing"><code>git-hashing</code></a> experimental feature.</p>
</blockquote>
<p>This uses the corresponding <a href="store/store-object/../file-system-object/content-address.html#serial-git">Git</a> method of file system object content addressing.</p>
<p>References are not supported.</p>
<p>Only SHA-1 is supported at this time.
If <a href="https://git-scm.com/docs/hash-function-transition">SHA-256-based Git</a>
becomes more widespread, this restriction will be revisited.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="store-path"><a class="header" href="#store-path">Store Path</a></h1>
<blockquote>
<p><strong>Example</strong></p>
<p><code>/nix/store/a040m110amc4h71lds2jmr8qrkj2jhxd-git-2.38.1</code></p>
<p>A rendered store path</p>
</blockquote>
<p>Nix implements references to <a href="store/./index.html#store-object">store objects</a> as <em>store paths</em>.</p>
<p>Think of a store path as an <a href="https://en.m.wikipedia.org/wiki/Opaque_data_type">opaque</a>, <a href="https://en.m.wikipedia.org/wiki/Unique_identifier">unique identifier</a>:
The only way to obtain store path is by adding or building store objects.
A store path will always reference exactly one store object.</p>
<p>Store paths are pairs of</p>
<ul>
<li>A 20-byte digest for identification</li>
<li>A symbolic name for people to read</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<ul>
<li>Digest: <code>b6gvzjyb2pg0kjfwrjmg1vfhh54ad73z</code></li>
<li>Name:   <code>firefox-33.1</code></li>
</ul>
</blockquote>
<p>To make store objects accessible to operating system processes, stores have to expose store objects through the file system.</p>
<p>A store path is rendered to a file system path as the concatenation of</p>
<ul>
<li><a href="store/store-path.html#store-directory">Store directory</a> (typically <code>/nix/store</code>)</li>
<li>Path separator (<code>/</code>)</li>
<li>Digest rendered in a custom variant of <a href="https://en.wikipedia.org/wiki/Base32">Base32</a> (20 arbitrary bytes become 32 ASCII characters)</li>
<li>Hyphen (<code>-</code>)</li>
<li>Name</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<pre><code>  /nix/store/b6gvzjyb2pg0kjfwrjmg1vfhh54ad73z-firefox-33.1
  |--------| |------------------------------| |----------|
store directory            digest                 name
</code></pre>
</blockquote>
<p>Exactly how the digest is calculated depends on the type of store path.
Store path digests are <em>supposed</em> to be opaque, and so for most operations, it is not necessary to know the details.
That said, the manual has a full <a href="store/../protocols/store-path.html">specification of store path digests</a>.</p>
<h2 id="store-directory"><a class="header" href="#store-directory">Store Directory</a></h2>
<p>Every <a href="store/./index.html">Nix store</a> has a store directory.</p>
<p>Not every store can be accessed through the file system.
But if the store has a file system representation, the store directory contains the store’s <a href="store/./file-system-object.html">file system objects</a>, which can be addressed by <a href="store/store-path.html#store-path">store paths</a>.</p>
<p>This means a store path is not just derived from the referenced store object itself, but depends on the store that the store object is in.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>The store directory defaults to <code>/nix/store</code>, but is in principle arbitrary.</p>
</blockquote>
<p>It is important which store a given store object belongs to:
Files in the store object can contain store paths, and processes may read these paths.
Nix can only guarantee referential integrity if store paths do not cross store boundaries.</p>
<p>Therefore one can only copy store objects to a different store if</p>
<ul>
<li>
<p>The source and target stores' directories match</p>
<p>or</p>
</li>
<li>
<p>The store object in question has no references, that is, contains no store paths</p>
</li>
</ul>
<p>One cannot copy a store object to a store with a different store directory.
Instead, it has to be rebuilt, together with all its dependencies.
It is in general not enough to replace the store directory string in file contents, as this may render executables unusable by invalidating their internal offsets or checksums.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="store-derivation-and-deriving-path"><a class="header" href="#store-derivation-and-deriving-path">Store Derivation and Deriving Path</a></h1>
<p>Besides functioning as a <a href="store/derivation/../../glossary.html#gloss-content-addressed-store">content-addressed store</a>, the Nix store layer works as a <a href="store/derivation/../../glossary.html#gloss-build-system">build system</a>.
Other systems (like Git or IPFS) also store and transfer immutable data, but they don't concern themselves with <em>how</em> that data was created.</p>
<p>This is where Nix distinguishes itself.
<em>Derivations</em> represent individual build steps, and <em>deriving paths</em> are needed to refer to the <em>outputs</em> of those build steps before they are built.</p>
<!-- The two concepts need to be introduced together because, as described below, each depends on the other. -->
<h2 id="store-derivation"><a class="header" href="#store-derivation">Store Derivation</a></h2>
<p>A derivation is a specification for running an executable on precisely defined input to produce on more <a href="store/derivation/../../store/store-object.html">store objects</a>.
These store objects are known as the derivation's <em>outputs</em>.</p>
<p>Derivations are <em>built</em>, in which case the process is spawned according to the spec, and when it exits, required to leave behind files which will (after post-processing) become the outputs of the derivation.
This process is described in detail in <a href="store/derivation/../../store/building.html">Building</a>.</p>
<!--
Some of these things are described directly below, but we envision with more material the exposition will probably want to migrate to separate pages benough this.
See outputs spec for an example of this one that migrated to its own page.
-->
<p>A derivation consists of:</p>
<ul>
<li>
<p>A name</p>
</li>
<li>
<p>An <a href="store/derivation/index.html#inputs">inputs specification</a>, a set of <a href="store/derivation/index.html#deriving-path">deriving paths</a></p>
</li>
<li>
<p>An <a href="store/derivation/./outputs/index.html">outputs specification</a>, specifying which outputs should be produced, and various metadata about them.</p>
</li>
<li>
<p>The <a href="store/derivation/index.html#system">"system" type</a> (e.g. <code>x86_64-linux</code>) where the executable is to run.</p>
</li>
<li>
<p>The <a href="store/derivation/index.html#process-creation-fields">process creation fields</a>: to spawn the arbitrary process which will perform the build step.</p>
</li>
</ul>
<h3 id="derivation-path"><a class="header" href="#derivation-path">Referencing derivations</a></h3>
<p>Derivations are always referred to by the <a href="store/derivation/../../store/store-path.html">store path</a> of the store object they are encoded to.
See the <a href="store/derivation/index.html#derivation-encoding">encoding section</a> for more details on how this encoding works, and thus what exactly what store path we would end up with for a given derivation.</p>
<p>The store path of the store object which encodes a derivation is often called a <em>derivation path</em> for brevity.</p>
<h2 id="deriving-path"><a class="header" href="#deriving-path">Deriving path</a></h2>
<p>Deriving paths are a way to refer to <a href="store/derivation/../../store/store-object.html">store objects</a> that may or may not yet be <a href="store/derivation/../../glossary.html#gloss-realise">realised</a>.
There are two forms:</p>
<ul>
<li>
<p><a href="store/derivation/index.html#deriving-path-constant" id="deriving-path-constant"><em>constant</em></a>: just a <a href="store/derivation/../../store/store-path.html">store path</a>.
It can be made <a href="store/derivation/../../glossary.html#gloss-validity">valid</a> by copying it into the store: from the evaluator, command line interface or another store.</p>
</li>
<li>
<p><a href="store/derivation/index.html#deriving-path-output" id="deriving-path-output"><em>output</em></a>: a pair of a <a href="store/derivation/../../store/store-path.html">store path</a> to a <a href="store/derivation/index.html#store-derivation">store derivation</a> and an <a href="store/derivation/./outputs/index.html">output</a> name.</p>
</li>
</ul>
<p>In pseudo code:</p>
<pre><code class="language-typescript">type OutputName = String;

type ConstantPath = {
  path: StorePath;
};

type OutputPath = {
  drvPath: StorePath;
  output: OutputName;
};

type DerivingPath = ConstantPath | OutputPath;
</code></pre>
<p>Deriving paths are necessary because, in general and particularly for <a href="store/derivation/../../glossary.html#gloss-content-addressing-derivation">content-addressing derivations</a>, the <a href="store/derivation/../../store/store-path.html">store path</a> of an <a href="store/derivation/./outputs/index.html">output</a> is not known in advance.
We can use an output deriving path to refer to such an output, instead of the store path which we do not yet know.</p>
<h2 id="parts-of-a-derivation"><a class="header" href="#parts-of-a-derivation">Parts of a derivation</a></h2>
<p>A derivation is constructed from the parts documented in the following subsections.</p>
<h3 id="inputs"><a class="header" href="#inputs">Inputs</a></h3>
<p>The inputs are a set of <a href="store/derivation/index.html#deriving-path">deriving paths</a>, referring to all store objects needed in order to perform this build step.</p>
<p>The <a href="store/derivation/index.html#process-creation-fields">process creation fields</a> will presumably include many <a href="store/derivation/../../store/store-path.html">store paths</a>:</p>
<ul>
<li>The path to the executable normally starts with a store path</li>
<li>The arguments and environment variables likely contain many other store paths.</li>
</ul>
<p>But rather than somehow scanning all the other fields for inputs, Nix requires that all inputs be explicitly collected in the inputs field. It is instead the responsibility of the creator of a derivation (e.g. the evaluator) to ensure that every store object referenced in another field (e.g. referenced by store path) is included in this inputs field.</p>
<h3 id="system"><a class="header" href="#system">System</a></h3>
<p>The system type on which the <a href="store/derivation/index.html#attr-builder"><code>builder</code></a> executable is meant to be run.</p>
<p>A necessary condition for Nix to schedule a given derivation on some <a href="store/derivation/../../glossary.html#gloss-nix-instance">Nix instance</a> is for the "system" of that derivation to match that instance's <a href="store/derivation/../../command-ref/conf-file.html#conf-system"><code>system</code> configuration option</a> or <a href="store/derivation/../../command-ref/conf-file.html#conf-extra-platforms"><code>extra-platforms</code> configuration option</a>.</p>
<p>By putting the <code>system</code> in each derivation, Nix allows <em>heterogenous</em> build plans, where not all steps can be run on the same machine or same sort of machine.
Nix can schedule builds such that it automatically builds on other platforms by <a href="store/derivation/../../advanced-topics/distributed-builds.html">forwarding build requests</a> to other Nix instances.</p>
<h3 id="process-creation-fields"><a class="header" href="#process-creation-fields">Process creation fields</a></h3>
<p>These are the three fields which describe how to spawn the process which (along with any of its own child processes) will perform the build.
You may note that this has everything needed for an <code>execve</code> system call.</p>
<h4 id="builder"><a class="header" href="#builder">Builder</a></h4>
<p>This is the path to an executable that will perform the build and produce the <a href="store/derivation/./outputs/index.html">outputs</a>.</p>
<h4 id="args"><a class="header" href="#args">Arguments</a></h4>
<p>Command-line arguments to be passed to the <a href="store/derivation/index.html#builder"><code>builder</code></a> executable.</p>
<p>Note that these are the arguments after the first argument.
The first argument passed to the <code>builder</code> will be the value of <code>builder</code>, as per the usual convention on Unix.
See <a href="https://en.wikipedia.org/wiki/Argv">Wikipedia</a> for details.</p>
<h4 id="env"><a class="header" href="#env">Environment Variables</a></h4>
<p>Environment variables which will be passed to the <a href="store/derivation/index.html#builder">builder</a> executable.</p>
<h3 id="placeholders"><a class="header" href="#placeholders">Placeholders</a></h3>
<p>Placeholders are opaque values used within the <a href="store/derivation/index.html#process-creation-fields">process creation fields</a> to [store objects] for which we don't yet know <a href="store/derivation/../../store/store-path.html">store path</a>s.
They are strings in the form <code>/&lt;hash&gt;</code> that are embedded anywhere within the strings of those fields, and we are <a href="https://github.com/NixOS/nix/issues/12361">considering</a> to add store-path-like placeholders.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>Output Deriving Path exist to solve the same problem as placeholders --- that is, referring to store objects for which we don't yet know a store path.
They also have a string syntax with <code>^</code>, <a href="store/derivation/index.html#deriving-path-encoding">described in the encoding section</a>.
We could use that syntax instead of <code>/&lt;hash&gt;</code> for placeholders, but its human-legibility would cause problems.</p>
</blockquote>
<p>There are two types of placeholder, corresponding to the two cases where this problem arises:</p>
<ul>
<li>
<p><a href="store/derivation/index.html#output-placeholder" id="output-placeholder">Output placeholder</a>:</p>
<p>This is a placeholder for a derivation's own output.</p>
</li>
<li>
<p><a href="store/derivation/index.html#input-placeholder" id="input-placeholder">Input placeholder</a>:</p>
<p>This is a placeholder to a derivation's non-constant <a href="store/derivation/index.html#inputs">input</a>,
i.e. an input that is an [output derived path].</p>
</li>
</ul>
<blockquote>
<p><strong>Explanation</strong></p>
<p>In general, we need to realise <a href="store/derivation/../../glossary.html#gloss-realise">realise</a> a <a href="store/derivation/../../store/store-object.html">store object</a> in order to be sure to have a store object for it.
But for these two cases this is either impossible or impractical:</p>
<ul>
<li>
<p>In the output case this is impossible:</p>
<p>We cannot build the output until we have a correct derivation, and we cannot have a correct derivation (without using placeholders) until we have the output path.</p>
</li>
<li>
<p>In the input case this is impractical:</p>
<p>If we always build a dependency first, and then refer to its output by store path, we would lose the ability for a derivation graph to describe an entire build plan consisting of multiple build steps.</p>
</li>
</ul>
</blockquote>
<h2 id="encoding"><a class="header" href="#encoding">Encoding</a></h2>
<h3 id="derivation-encoding"><a class="header" href="#derivation-encoding">Derivation</a></h3>
<p>There are two formats, documented separately:</p>
<ul>
<li>
<p>The legacy <a href="store/derivation/../../protocols/derivation-aterm.html">"ATerm" format</a></p>
</li>
<li>
<p>The experimental, currently under development and changing <a href="store/derivation/../../protocols/json/derivation.html">JSON format</a></p>
</li>
</ul>
<p>Every derivation has a canonical choice of encoding used to serialize it to a store object.
This ensures that there is a canonical <a href="store/derivation/../../store/store-path.html">store path</a> used to refer to the derivation, as described in <a href="store/derivation/index.html#derivation-path">Referencing derivations</a>.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>Currently, the canonical encoding for every derivation is the "ATerm" format,
but this is subject to change for types derivations which are not yet stable.</p>
</blockquote>
<p>Regardless of the format used, when serializing a derivation to a store object, that store object will be content-addressed.</p>
<p>In the common case, the inputs to store objects are either:</p>
<ul>
<li>
<p><a href="store/derivation/index.html#deriving-path-constant">constant deriving paths</a> for content-addressed source objects, which are "initial inputs" rather than the outputs of some other derivation</p>
</li>
<li>
<p>the outputs of other derivations</p>
</li>
</ul>
<p>If those other derivations <em>also</em> abide by this common case (and likewise for transitive inputs), then the entire closure of the serialized derivation will be content-addressed.</p>
<h3 id="deriving-path-encoding"><a class="header" href="#deriving-path-encoding">Deriving Path</a></h3>
<ul>
<li>
<p><em>constant</em></p>
<p>Constant deriving paths are encoded simply as the underlying store path is.
Thus, we see that every encoded store path is also a valid encoded (constant) deriving path.</p>
</li>
<li>
<p><em>output</em></p>
<p>Output deriving paths are encoded by</p>
<ul>
<li>
<p>encoding of a store path referring to a derivation</p>
</li>
<li>
<p>a <code>^</code> separator (or <code>!</code> in some legacy contexts)</p>
</li>
<li>
<p>the name of an output of the previously referred derivation</p>
</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<pre><code>/nix/store/lxrn8v5aamkikg6agxwdqd1jz7746wz4-firefox-98.0.2.drv^out
</code></pre>
<p>This parses like so:</p>
<pre><code>/nix/store/lxrn8v5aamkikg6agxwdqd1jz7746wz4-firefox-98.0.2.drv^out
|------------------------------------------------------------| |-|
store path (usual encoding)                                    output name
                                                          |--|
                                                          note the ".drv"
</code></pre>
</blockquote>
</li>
</ul>
<h2 id="extending-the-model-to-be-higher-order"><a class="header" href="#extending-the-model-to-be-higher-order">Extending the model to be higher-order</a></h2>
<p><strong>Experimental feature</strong>: <a href="store/derivation/../../development/experimental-features.html#xp-feature-dynamic-derivations"><code>dynamic-derivations</code></a></p>
<p>So far, we have used store paths to refer to derivations.
That works because we've implicitly assumed that all derivations are created <em>statically</em> --- created by some mechanism out of band, and then manually inserted into the store.
But what if derivations could also be created dynamically within Nix?
In other words, what if derivations could be the outputs of other derivations?</p>
<blockquote>
<p><strong>Note</strong></p>
<p>In the parlance of "Build Systems à la carte", we are generalizing the Nix store layer to be a "Monadic" instead of "Applicative" build system.</p>
</blockquote>
<p>How should we refer to such derivations?
A deriving path works, the same as how we refer to other derivation outputs.
But what about a dynamic derivations output?
(i.e. how do we refer to the output of a derivation, which is itself an output of a derivation?)
For that we need to generalize the definition of deriving path, replacing the store path used to refer to the derivation with a nested deriving path:</p>
<pre><code class="language-diff"> type OutputPath = {
-  drvPath: StorePath;
+  drvPath: DerivingPath;
   output: OutputName;
 };
</code></pre>
<p>Now, the <code>drvPath</code> field of <code>OutputPath</code> is itself a <code>DerivingPath</code> instead of a <code>StorePath</code>.</p>
<p>With that change, here is updated definition:</p>
<pre><code class="language-typescript">type OutputName = String;

type ConstantPath = {
  path: StorePath;
};

type OutputPath = {
  drvPath: DerivingPath;
  output: OutputName;
};

type DerivingPath = ConstantPath | OutputPath;
</code></pre>
<p>Under this extended model, <code>DerivingPath</code>s are thus inductively built up from a root <code>ConstantPath</code>, wrapped with zero or more outer <code>OutputPath</code>s.</p>
<h3 id="deriving-path-encoding"><a class="header" href="#deriving-path-encoding">Encoding</a></h3>
<p>The encoding is adjusted in the natural way, encoding the <code>drv</code> field recursively using the same deriving path encoding.
The result of this is that it is possible to have a chain of <code>^&lt;output-name&gt;</code> at the end of the final string, as opposed to just a single one.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code>/nix/store/lxrn8v5aamkikg6agxwdqd1jz7746wz4-firefox-98.0.2.drv^foo.drv^bar.drv^out
|----------------------------------------------------------------------------| |-|
inner deriving path (usual encoding)                                           output name
|--------------------------------------------------------------------| |-----|
even more inner deriving path (usual encoding)                         output name
|------------------------------------------------------------| |-----|
innermost constant store path (usual encoding)                 output name
</code></pre>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="derivation-outputs-and-types-of-derivations"><a class="header" href="#derivation-outputs-and-types-of-derivations">Derivation Outputs and Types of Derivations</a></h1>
<p>As stated on the <a href="store/derivation/outputs/../index.html#store-derivation">main pages on derivations</a>,
a derivation produces <a href="store/derivation/outputs/../../../store/store-object.html">store objects</a>, which are known as the <em>outputs</em> of the derivation.
Indeed, the entire point of derivations is to produce these outputs, and to reliably and reproducably produce these derivations each time the derivation is run.</p>
<p>One of the parts of a derivation is its <em>outputs specification</em>, which specifies certain information about the outputs the derivation produces when run.
The outputs specification is a map, from names to specifications for individual outputs.</p>
<h2 id="outputs"><a class="header" href="#outputs">Output Names</a></h2>
<p>Output names can be any string which is also a valid <a href="store/derivation/outputs/../../../store/store-path.html">store path</a> name.
The name mapped to each output specification is not actually the name of the output.
In the general case, the output store object has name <code>derivationName + "-" + outputSpecName</code>, not any other metadata about it.
However, an output spec named "out" describes and output store object whose name is just the derivation name.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>A derivation is named <code>hello</code>, and has two outputs, <code>out</code>, and <code>dev</code></p>
<ul>
<li>
<p>The derivation's path will be: <code>/nix/store/&lt;hash&gt;-hello.drv</code>.</p>
</li>
<li>
<p>The store path of <code>out</code> will be: <code>/nix/store/&lt;hash&gt;-hello</code>.</p>
</li>
<li>
<p>The store path of <code>dev</code> will be: <code>/nix/store/&lt;hash&gt;-hello-dev</code>.</p>
</li>
</ul>
</blockquote>
<p>The outputs are the derivations are the <a href="store/derivation/outputs/../../../store/store-object.html">store objects</a> it is obligated to produce.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>The formal terminology here is somewhat at odds with everyday communication in the Nix community today.
"output" in casual usage tends to refer to either to the actual output store object, or the notional output spec, depending on context.</p>
<p>For example "hello's <code>dev</code> output" means the store object referred to by the store path <code>/nix/store/&lt;hash&gt;-hello-dev</code>.
It is unusual to call this the "<code>hello-dev</code> output", even though <code>hello-dev</code> is the actual name of that store object.</p>
</blockquote>
<h2 id="types-of-output-addressing"><a class="header" href="#types-of-output-addressing">Types of output addressing</a></h2>
<p>The main information contained in an output specification is how the derivation output is addressed.
In particular, the specification decides:</p>
<ul>
<li>
<p>whether the output is <a href="store/derivation/outputs/./content-address.html">content-addressed</a> or <a href="store/derivation/outputs/./input-address.html">input-addressed</a></p>
</li>
<li>
<p>if the content is content-addressed, how is it content addressed</p>
</li>
<li>
<p>if the content is content-addressed, <a href="store/derivation/outputs/./content-address.html#fixed-content-addressing">what is its content address</a> (and thus what is its [store path])</p>
</li>
</ul>
<h2 id="types-of-derivations"><a class="header" href="#types-of-derivations">Types of derivations</a></h2>
<p>The sections on each type of derivation output addressing ended up discussing other attributes of the derivation besides its outputs, such as purity, scheduling, determinism, etc.
This is no concidence; for the type of a derivation is in fact one-for-one with the type of its outputs:</p>
<ul>
<li>A derivation that produces <em>xyz-addressed</em> outputs is an <em>xyz-addressing</em> derivations.</li>
</ul>
<p>The rules for this are fairly concise:</p>
<ul>
<li>
<p>All the outputs must be of the same type / use the same addressing</p>
<ul>
<li>
<p>The derivation must have at least one output</p>
</li>
<li>
<p>Additionally, if the outputs are fixed content-addressed, there must be exactly one output, whose specification is mapped from the name <code>out</code>.
(The name <code>out</code> is special, according to the rules described above.
Having only one output and calling its specification <code>out</code> means the single output is effectively anonymous; the store path just has the derivation name.)</p>
<p>(This is an arbitrary restriction that could be lifted.)</p>
</li>
</ul>
</li>
<li>
<p>The output is either <em>fixed</em> or <em>floating</em>, indicating whether the store path is known prior to building it.</p>
<ul>
<li>
<p>With fixed content-addressing it is fixed.</p>
<blockquote>
<p>A <em>fixed content-addressing</em> derivation is also called a <em>fixed-output derivation</em>, since that is the only currently-implemented form of fixed-output addressing</p>
</blockquote>
</li>
<li>
<p>With floating content-addressing or input-addressing it is floating.</p>
</li>
</ul>
<blockquote>
<p>Thus, historically with Nix, with no experimental features enabled, <em>all</em> outputs are fixed.</p>
</blockquote>
</li>
<li>
<p>The derivation may be <em>pure</em> or <em>impure</em>, indicating what read access to the outside world the <a href="store/derivation/outputs/../index.html#builder">builder</a> has.</p>
<ul>
<li>
<p>An input-addressing derivation <em>must</em> be pure.</p>
<blockquote>
<p>If it is impure, we would have a large problem, because an input-addressed derivation always produces outputs with the same paths.</p>
</blockquote>
</li>
<li>
<p>A content-addressing derivation may be pure or impure</p>
</li>
<li>
<p>If it is impure, it may be be fixed (typical), or it may be floating if the additional <a href="store/derivation/outputs/../../../development/experimental-features.html#xp-feature-impure-derivations"><code>impure-derivations</code></a> experimental feature is enabled.</p>
</li>
<li>
<p>If it is pure, it must be floating.</p>
</li>
<li>
<p>Pure, fixed content-addressing derivations are not suppported</p>
<blockquote>
<p>There is no use for this forth combination.
The sole purpose of an output's store path being fixed is to support the derivation being impure.</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="content-addressing-derivation-outputs"><a class="header" href="#content-addressing-derivation-outputs">Content-addressing derivation outputs</a></h1>
<p>The content-addressing of an output only depends on that store object itself, not any other information external (such has how it was made, when it was made, etc.).
As a consequence, a store object will be content-addressed the same way regardless of whether it was manually inserted into the store, outputted by some derivation, or outputted by a some other derivation.</p>
<p>The output spec for a content-addressed output must contains the following field:</p>
<ul>
<li><em>method</em>: how the data of the store object is digested into a content address</li>
</ul>
<p>The possible choices of <em>method</em> are described in the <a href="store/derivation/outputs/../../../store/store-object/content-address.html">section on content-addressing store objects</a>.
Given the method, the output's name (computed from the derivation name and output spec mapping as described above), and the data of the store object, the output's store path will be computed as described in that section.</p>
<h2 id="fixed"><a class="header" href="#fixed">Fixed-output content-addressing</a></h2>
<p>In this case the content address of the <em>fixed</em> in advanced by the derivation itself.
In other words, when the derivation has finished <a href="store/derivation/outputs/../../../store/building.html">building</a>, and the provisional output' content-address is computed as part of the process to turn it into a <em>bona fide</em> store object, the calculated content address must much that given in the derivation, or the build of that derivation will be deemed a failure.</p>
<p>The output spec for an output with a fixed content addresses additionally contains:</p>
<ul>
<li><em>hash</em>, the hash expected from digesting the store object's file system objects.
This hash may be of a freely-chosen hash algorithm (that Nix supports)</li>
</ul>
<blockquote>
<p><strong>Design note</strong></p>
<p>In principle, the output spec could also specify the references the store object should have, since the references and file system objects are equally parts of a content-addressed store object proper that contribute to its content-addressed.
However, at this time, the references are not not done because all fixed content-addressed outputs are required to have no references (including no self-reference).</p>
<p>Also in principle, rather than specifying the references and file system object data with separate hashes, a single hash that constraints both could be used.
This could be done with the final store path's digest, or better yet, the hash that will become the store path's digest before it is truncated.</p>
<p>These possible future extensions are included to elucidate the core property of fixed-output content addressing --- that all parts of the output must be cryptographically fixed with one or more hashes --- separate from the particulars of the currently-supported store object content-addressing schemes.</p>
</blockquote>
<h3 id="design-rationale"><a class="header" href="#design-rationale">Design rationale</a></h3>
<p>What is the purpose of fixing an output's content address in advanced?
In abstract terms, the answer is carefully controlled impurity.
Unlike a regular derivation, the <a href="store/derivation/outputs/../../../store/derivation/index.html#builder">builder</a> executable of a derivation that produced fixed outputs has access to the network.
The outputs' guaranteed content-addresses are supposed to mitigate the risk of the builder being given these capabilities;
regardless of what the builder does <em>during</em> the build, it cannot influence downstream builds in unanticipated ways because all information it passed downstream flows through the outputs whose content-addresses are fixed.</p>
<p>In concrete terms, the purpose of this feature is fetching fixed input data like source code from the network.
For example, consider a family of "fetch URL" derivations.
These derivations download files from given URL.
To ensure that the downloaded file has not been modified, each derivation must also specify a cryptographic hash of the file.
For example,</p>
<pre><code class="language-jsonc">{
  "outputs: {
    "out": {
      "method": "nar",
      "hashAlgo": "sha256",
      "hash: "1md7jsfd8pa45z73bz1kszpp01yw6x5ljkjk2hx7wl800any6465",
    },
  },
  "env": {
    "url": "http://ftp.gnu.org/pub/gnu/hello/hello-2.1.1.tar.gz"
    // ...
  },
  // ...
}
</code></pre>
<p>It sometimes happens that the URL of the file changes,
e.g., because servers are reorganised or no longer available.
In these cases, we then must update the call to <code>fetchurl</code>, e.g.,</p>
<pre><code class="language-diff">   "env": {
-    "url": "http://ftp.gnu.org/pub/gnu/hello/hello-2.1.1.tar.gz"
+    "url": "ftp://ftp.nluug.nl/pub/gnu/hello/hello-2.1.1.tar.gz"
     // ...
   },
</code></pre>
<p>If a <code>fetchurl</code> derivation's outputs were <a href="store/derivation/outputs/./input-address.html">input-addressed</a>, the output paths of the derivation and of <em>all derivations depending on it</em> would change.
For instance, if we were to change the URL of the Glibc source distribution in Nixpkgs (a package on which almost all other packages depend on Linux) massive rebuilds would be needed.
This is unfortunate for a change which we know cannot have a real effect as it propagates upwards through the dependency graph.</p>
<p>For content-addressed outputs (fixed or floating), on the other hand, the outputs' store path only depends on the derivation's name, data, and the <code>method</code> of the outputs' specs.
The rest of the derivation is ignored for the purpose of computing the output path.</p>
<blockquote>
<p><strong>History Note</strong></p>
<p>Fixed content-addressing is especially important both today and historically as the <em>only</em> form of content-addressing that is stabilized.
This is why the rationale above contrasts it with <a href="store/derivation/outputs/./input-address.html">input addressing</a>.</p>
</blockquote>
<h2 id="floating"><a class="header" href="#floating">(Floating) Content-Addressing</a></h2>
<blockquote>
<p><strong>Warning</strong>
This is part of an <a href="store/derivation/outputs/../../../development/experimental-features.html">experimental feature</a>.</p>
<p>To use this type of output addressing, you must enable the
<a href="store/derivation/outputs/../../../development/experimental-features.html#xp-feature-ca-derivations"><code>ca-derivations</code></a> experimental feature.
For example, in <a href="store/derivation/outputs/../../../command-ref/conf-file.html">nix.conf</a> you could add:</p>
<pre><code>extra-experimental-features = ca-derivations
</code></pre>
</blockquote>
<p>With this experimemental feature enabled, derivation outputs can also be content-addressed <em>without</em> fixing in the output spec what the outputs' content address must be.</p>
<h3 id="purity"><a class="header" href="#purity">Purity</a></h3>
<p>Because the derivation output is not fixed (just like with <a href="store/derivation/outputs/./input-address.html">input addressing</a>), the <a href="store/derivation/outputs/../../../store/derivation/index.html#builder">builder</a> is not given any impure capabilities [^purity].</p>
<blockquote>
<p><strong>Configuration note</strong></p>
<p>Strictly speaking, the extent to which sandboxing and deprivilaging is possible varies with the environment Nix is running in.
Nix's configuration settings indicate what level of sandboxing is required or enabled.
Builds of derivations will fail if they request an absense of sandboxing which is not allowed.
Builds of derivations will also fail if the level of sandboxing specified in the configure exceeds what is possible in teh given environment.</p>
<p>(The "environment", in this case, consists of attributes such as the Operating System Nix runs atop, along with the operating-system-specific privilages that Nix has been granted.
Because of how conventional operating systems like macos, Linux, etc. work, granting builders <em>fewer</em> privilages may ironically require that Nix be run with <em>more</em> privilages.)</p>
</blockquote>
<p>That said, derivations producing floating content-addressed outputs may declare their builders as impure (like the builders of derivations producing producing fixed outputs).
This is provisionally supported as part of the <a href="store/derivation/outputs/../../../development/experimental-features.html#xp-feature-impure-derivations"><code>impure-derivations</code></a> experimental feature.</p>
<h3 id="compatibility-negotiation"><a class="header" href="#compatibility-negotiation">Compatibility negotiation</a></h3>
<p>Any derivation producing a floating content-addresssed output implicitly requires the <code>ca-derivations</code> <a href="store/derivation/outputs/../../../command-ref/conf-file.html#conf-system-features">system feature</a>.
This prevents scheduling the building of the derivation on a machine without the experimental feature enabled.
Even once the experimental feature is stabilized, this is still useful in order to be allow using remote builder running odler versions of Nix, or alternative implementations that do not support floating content addressing.</p>
<h3 id="determinism"><a class="header" href="#determinism">Determinism</a></h3>
<p>In the earlier <a href="store/derivation/outputs/../../../store/store-object/content-address.html#self-references">discussion of how self-references are handled when content-addressing store objects</a>, it was pointed out that methods of producing store objects ought to be deterministic regardless of the choice of provisional store path.
For store objects produced by manually inserting into the store to create a store object, the "method of production" is an informally concept --- formally, Nix has no idea where the store object came from, and content-addressing is crucial in order to ensure that the derivation is <em>intrinsically</em> tamper-proof.
But for store objects produced by derivation, the "method is quite formal" --- the whole point of derivations is to be a formal notion of building, after all.
In this case, we can elevate this informal property to a formal one.</p>
<p>A <em>determinstic</em> content-addressing derivation should produce outputs with the same content addresses:</p>
<ol>
<li>Every time the builder is run</li>
</ol>
<p>This is because either the builder is completely sandboxed, or because all any remaining impurities that leak inside the build sandbox are ignored by the builder and do not influence its behavior.</p>
<ol start="2">
<li>Regardless of the choice of any provisional outputs paths</li>
</ol>
<p>Provisional store paths must be chosen for any output that has a self-reference.
The choice of provisional store path can be thought of as an impurity, since it is an arbitrary choice.</p>
<p>If provisional outputs paths are deterministically chosen, we are in the first branch of part (1).
The builder the data it produces based on it in arbitrary ways, but this gets us closer to to <a href="store/derivation/outputs/./input-address.html">input addressing</a>.
Deterministically choosing the provisional path may be considered "complete sandboxing" by removing an impurity, but this is unsatisfactory</p>
  <!--

  TODO
  (Both these points will be expanded-upon below.)

  -->
<p>If provisional outputs paths are randomly chosen, we are in the second branch of part (1).
The builder <em>must</em> not let the random input affect the final outputs it produces, and multiple builds may be performed and the compared in order to ensure that this is in fact the case.</p>
<h3 id="floating-versus-fixed"><a class="header" href="#floating-versus-fixed">Floating versus Fixed</a></h3>
<p>While the distinction between content- and input-addressing is one of <em>mechanism</em>, the distinction between fixed and floating content addressing is more one of <em>policy</em>.
A fixed output that passes its content address check is just like a floating output.
It is only in the potential for that check to fail that they are different.</p>
<blockquote>
<p><strong>Design Note</strong></p>
<p>In a future world where floating content-addressing is also stable, we in principle no longer need separate <a href="store/derivation/outputs/content-address.html#fixed">fixed</a> content-addressing.
Instead, we could always use floating content-addressing, and separately assert the precise value content address of a given store object to be used as an input (of another derivation).
A stand-alone assertion object of this sort is not yet implemented, but its possible creation is tracked in <a href="https://github.com/NixOS/nix/issues/11955">Issue #11955</a>.</p>
<p>In the current version of Nix, fixed outputs which fail their hash check are still registered as valid store objects, just not registered as outputs of the derivation which produced them.
This is an optimization that means if the wrong output hash is specified in a derivation, and then the derivation is recreated with the right output hash, derivation does not need to be rebuilt --- avoiding downloading potentially large amounts of data twice.
This optimisation prefigures the design above:
If the output hash assertion was removed outside the derivation itself, Nix could additionally not only register that outputted store object like today, but could also make note that derivation did in fact successfully download some data.
For example, for the "fetch URL" example above, making such a note is tantamount to recording what data is available at the time of download at the given URL.
It would only be when Nix subsequently tries to build something with that (refining our example) downloaded source code that Nix would be forced to check the output hash assertion, preventing it from e.g. building compromised malware.</p>
<p>Recapping, Nix would</p>
<ol>
<li>successfully download data</li>
<li>insert that data into the store</li>
<li>associate (presumably with some sort of expiration policy) the downloaded data with the derivation that downloaded it</li>
</ol>
<p>But only use the downloaded store object in subsequent derivations that depended upon the assertion if the assertion passed.</p>
<p>This possible future extension is included to illustrate this distinction:</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="input-addressing-derivation-outputs"><a class="header" href="#input-addressing-derivation-outputs">Input-addressing derivation outputs</a></h1>
<p>"Input addressing" means the address the store object by the <em>way it was made</em> rather than <em>what it is</em>.
That is to say, an input-addressed output's store path is a function not of the output itself, but of the derivation that produced it.
Even if two store paths have the same contents, if they are produced in different ways, and one is input-addressed, then they will have different store paths, and thus guaranteed to not be the same store object.</p>
<!---

### Modulo fixed-output derivations

**TODO hash derivation modulo.**

So how do we compute the hash part of the output path of a derivation?
This is done by the function `hashDrv`, shown in Figure 5.10.
It distinguishes between two cases.
If the derivation is a fixed-output derivation, then it computes a hash over just the `outputHash` attributes.

If the derivation is not a fixed-output derivation, we replace each element in the derivation’s inputDrvs with the result of a call to `hashDrv` for that element.
(The derivation at each store path in `inputDrvs` is converted from its on-disk ATerm representation back to a `StoreDrv` by the function `parseDrv`.) In essence, `hashDrv` partitions store derivations into equivalence classes, and for hashing purpose it replaces each store path in a derivation graph with its equivalence class.

The recursion in Figure 5.10 is inefficient:
it will call itself once for each path by which a subderivation can be reached, i.e., `O(V k)` times for a derivation graph with `V` derivations and with out-degree of at most `k`.
In the actual implementation, memoisation is used to reduce this to `O(V + E)` complexity for a graph with E edges.

-->
<div style="break-before: page; page-break-before: always;"></div><h1 id="building"><a class="header" href="#building">Building</a></h1>
<h2 id="normalizing-derivation-inputs"><a class="header" href="#normalizing-derivation-inputs">Normalizing derivation inputs</a></h2>
<ul>
<li>Each input must be <a href="store/../glossary.html#gloss-realise">realised</a> prior to building the derivation in question.</li>
</ul>
<ul>
<li>Once this is done, the derivation is <em>normalized</em>, replacing each input deriving path with its store path, which we now know from realising the input.</li>
</ul>
<h2 id="builder-execution"><a class="header" href="#builder-execution">Builder Execution</a></h2>
<p>The <a href="store/./derivation/index.html#builder"><code>builder</code></a> is executed as follows:</p>
<ul>
<li>
<p>A temporary directory is created under the directory specified by
<code>TMPDIR</code> (default <code>/tmp</code>) where the build will take place. The
current directory is changed to this directory.</p>
</li>
<li>
<p>The environment is cleared and set to the derivation attributes, as
specified above.</p>
</li>
<li>
<p>In addition, the following variables are set:</p>
<ul>
<li>
<p><code>NIX_BUILD_TOP</code> contains the path of the temporary directory for
this build.</p>
</li>
<li>
<p>Also, <code>TMPDIR</code>, <code>TEMPDIR</code>, <code>TMP</code>, <code>TEMP</code> are set to point to the
temporary directory. This is to prevent the builder from
accidentally writing temporary files anywhere else. Doing so
might cause interference by other processes.</p>
</li>
<li>
<p><code>PATH</code> is set to <code>/path-not-set</code> to prevent shells from
initialising it to their built-in default value.</p>
</li>
<li>
<p><code>HOME</code> is set to <code>/homeless-shelter</code> to prevent programs from
using <code>/etc/passwd</code> or the like to find the user's home
directory, which could cause impurity. Usually, when <code>HOME</code> is
set, it is used as the location of the home directory, even if
it points to a non-existent path.</p>
</li>
<li>
<p><code>NIX_STORE</code> is set to the path of the top-level Nix store
directory (typically, <code>/nix/store</code>).</p>
</li>
<li>
<p><code>NIX_ATTRS_JSON_FILE</code> &amp; <code>NIX_ATTRS_SH_FILE</code> if <code>__structuredAttrs</code>
is set to <code>true</code> for the derivation. A detailed explanation of this
behavior can be found in the
<a href="store/../language/advanced-attributes.html#adv-attr-structuredAttrs">section about structured attrs</a>.</p>
</li>
<li>
<p>For each output declared in <code>outputs</code>, the corresponding
environment variable is set to point to the intended path in the
Nix store for that output. Each output path is a concatenation
of the cryptographic hash of all build inputs, the <code>name</code>
attribute and the output name. (The output name is omitted if
it’s <code>out</code>.)</p>
</li>
</ul>
</li>
<li>
<p>If an output path already exists, it is removed. Also, locks are
acquired to prevent multiple <a href="store/../glossary.html#gloss-nix-instance">Nix instances</a> from performing the same
build at the same time.</p>
</li>
<li>
<p>A log of the combined standard output and error is written to
<code>/nix/var/log/nix</code>.</p>
</li>
<li>
<p>The builder is executed with the arguments specified by the
attribute <code>args</code>. If it exits with exit code 0, it is considered to
have succeeded.</p>
</li>
<li>
<p>The temporary directory is removed (unless the <code>-K</code> option was
specified).</p>
</li>
</ul>
<h2 id="processing-outputs"><a class="header" href="#processing-outputs">Processing outputs</a></h2>
<p>If the builder exited successfully, the following steps happen in order to turn the output directories left behind by the builder into proper store objects:</p>
<ul>
<li>
<p><strong>Normalize the file permissions</strong></p>
<p>Nix sets the last-modified timestamp on all files
in the build result to 1 (00:00:01 1/1/1970 UTC), sets the group to
the default group, and sets the mode of the file to 0444 or 0555
(i.e., read-only, with execute permission enabled if the file was
originally executable). Any possible <code>setuid</code> and <code>setgid</code>
bits are cleared.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>Setuid and setgid programs are not currently supported by Nix.
This is because the Nix archives used in deployment have no concept of ownership information,
and because it makes the build result dependent on the user performing the build.</p>
</blockquote>
</li>
<li>
<p><strong>Calculate the references</strong></p>
<p>Nix scans each output path for
references to input paths by looking for the hash parts of the input
paths. Since these are potential runtime dependencies, Nix registers
them as dependencies of the output paths.</p>
<p>Nix also scans for references to other outputs' paths in the same way, because outputs are allowed to refer to each other.
If the outputs' references to each other form a cycle, this is an error, because the references of store objects much be acyclic.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><p>Nix supports different types of stores:</p>
<ul>
<li><a href="store/types/./dummy-store.html">Dummy Store</a></li>
<li><a href="store/types/./experimental-local-overlay-store.html">Experimental Local Overlay Store</a></li>
<li><a href="store/types/./experimental-ssh-store.html">Experimental SSH Store</a></li>
<li><a href="store/types/./experimental-ssh-store-with-filesystem-mounted.html">Experimental SSH Store with filesystem mounted</a></li>
<li><a href="store/types/./http-binary-cache-store.html">HTTP Binary Cache Store</a></li>
<li><a href="store/types/./local-binary-cache-store.html">Local Binary Cache Store</a></li>
<li><a href="store/types/./local-daemon-store.html">Local Daemon Store</a></li>
<li><a href="store/types/./local-store.html">Local Store</a></li>
<li><a href="store/types/./s3-binary-cache-store.html">S3 Binary Cache Store</a></li>
<li><a href="store/types/./ssh-store.html">SSH Store</a></li>
</ul>
<h2 id="store-url-format"><a class="header" href="#store-url-format">Store URL format</a></h2>
<p>Stores are specified using a URL-like syntax. For example, the command</p>
<pre><code class="language-console"># nix path-info --store https://cache.nixos.org/ --json \
  /nix/store/a7gvj343m05j2s32xcnwr35v31ynlypr-coreutils-9.1
</code></pre>
<p>fetches information about a store path in the HTTP binary cache
located at https://cache.nixos.org/, which is a type of store.</p>
<p>Store URLs can specify <strong>store settings</strong> using URL query strings,
i.e. by appending <code>?name1=value1&amp;name2=value2&amp;...</code> to the URL. For
instance,</p>
<pre><code>--store ssh://machine.example.org?ssh-key=/path/to/my/key
</code></pre>
<p>tells Nix to access the store on a remote machine via the SSH
protocol, using <code>/path/to/my/key</code> as the SSH private key. The
supported settings for each store type are documented below.</p>
<p>The special store URL <code>auto</code> causes Nix to automatically select a
store as follows:</p>
<ul>
<li>
<p>Use the <a href="store/types/./local-store.html">local store</a> <code>/nix/store</code> if <code>/nix/var/nix</code>
is writable by the current user.</p>
</li>
<li>
<p>Otherwise, if <code>/nix/var/nix/daemon-socket/socket</code> exists, <a href="store/types/./local-daemon-store.html">connect
to the Nix daemon listening on that socket</a>.</p>
</li>
<li>
<p>Otherwise, on Linux only, use the <a href="store/types/./local-store.html">local chroot store</a>
<code>~/.local/share/nix/root</code>, which will be created automatically if it
does not exist.</p>
</li>
<li>
<p>Otherwise, use the <a href="store/types/./local-store.html">local store</a> <code>/nix/store</code>.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dummy-store"><a class="header" href="#dummy-store">Dummy Store</a></h1>
<p><strong>Store URL format</strong>: <code>dummy://</code></p>
<p>This store type represents a store that contains no store paths and
cannot be written to. It's useful when you want to use the Nix
evaluator when no actual Nix store exists, e.g.</p>
<pre><code class="language-console"># nix eval --store dummy:// --expr '1 + 2'
</code></pre>
<h2 id="settings"><a class="header" href="#settings">Settings</a></h2>
<ul>
<li>
<p><span id="store-dummy-store-path-info-cache-size"><a href="store/types/dummy-store.html#store-dummy-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-dummy-store-priority"><a href="store/types/dummy-store.html#store-dummy-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-dummy-store-store"><a href="store/types/dummy-store.html#store-dummy-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-dummy-store-system-features"><a href="store/types/dummy-store.html#store-dummy-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="store/types/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-dummy-store-trusted"><a href="store/types/dummy-store.html#store-dummy-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="store/types/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-dummy-store-want-mass-query"><a href="store/types/dummy-store.html#store-dummy-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="experimental-local-overlay-store"><a class="header" href="#experimental-local-overlay-store">Experimental Local Overlay Store</a></h1>
<blockquote>
<p><strong>Warning</strong></p>
<p>This store is part of an
<a href="store/types/../../development/experimental-features.html">experimental feature</a>.</p>
<p>To use this store, make sure the
<a href="store/types/../../development/experimental-features.html#xp-feature-local-overlay-store"><code>local-overlay-store</code> experimental feature</a>
is enabled.
For example, include the following in <a href="store/types/../../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = local-overlay-store
</code></pre>
</blockquote>
<p><strong>Store URL format</strong>: <code>local-overlay</code></p>
<p>This store type is a variation of the [local store] designed to leverage Linux's <a href="https://docs.kernel.org/filesystems/overlayfs.html">Overlay Filesystem</a> (OverlayFS for short).
Just as OverlayFS combines a lower and upper filesystem by treating the upper one as a patch against the lower, the local overlay store combines a lower store with an upper almost-[local store].
("almost" because while the upper filesystems for OverlayFS is valid on its own, the upper almost-store is not a valid local store on its own because some references will dangle.)
To use this store, you will first need to configure an OverlayFS mountpoint <a href="store/types/experimental-local-overlay-store.html#example-filesystem-layout">appropriately</a> as Nix will not do this for you (though it will verify the mountpoint is configured correctly).</p>
<h3 id="conceptual-parts-of-a-local-overlay-store"><a class="header" href="#conceptual-parts-of-a-local-overlay-store">Conceptual parts of a local overlay store</a></h3>
<p><em>This is a more abstract/conceptual description of the parts of a layered store, an authoritative reference.
For more "practical" instructions, see the worked-out example in the next subsection.</em></p>
<p>The parts of a local overlay store are as follows:</p>
<ul>
<li>
<p><strong>Lower store</strong>:</p>
<blockquote>
<p>Specified with the <a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-lower-store"><code>lower-store</code></a> setting.</p>
</blockquote>
<p>This is any store implementation that includes a store directory as part of the native operating system filesystem.
For example, this could be a [local store], [local daemon store], or even another local overlay store.</p>
<p>The local overlay store never tries to modify the lower store in any way.
Something else could modify the lower store, but there are restrictions on this
Nix itself requires that this store only grow, and not change in other ways.
For example, new store objects can be added, but deleting or modifying store objects is not allowed in general, because that will confuse and corrupt any local overlay store using those objects.
(In addition, the underlying filesystem overlay mechanism may impose additional restrictions, see below.)</p>
<p>The lower store must not change while it is mounted as part of an overlay store.
To ensure it does not, you might want to mount the store directory read-only (which then requires the [read-only] parameter to be set to <code>true</code>).</p>
<ul>
<li>
<p><strong>Lower store directory</strong>:</p>
<blockquote>
<p>Specified with <code>lower-store.real</code> setting.</p>
</blockquote>
<p>This is the directory used/exposed by the lower store.</p>
<p>As specified above, Nix requires the local store can only grow not change in other ways.
Linux's OverlayFS in addition imposes the further requirement that this directory cannot change at all.
That means that, while any local overlay store exists that is using this store as a lower store, this directory must not change.</p>
</li>
<li>
<p><strong>Lower metadata source</strong>:</p>
<blockquote>
<p>Not directly specified.
A consequence of the <code>lower-store</code> setting, depending on the type of lower store chosen.</p>
</blockquote>
<p>This is abstract, just some way to read the metadata of lower store <a href="store/types/../../store/store-object.html">store objects</a>.
For example it could be a SQLite database (for the [local store]), or a socket connection (for the [local daemon store]).</p>
<p>This need not be writable.
As stated above a local overlay store never tries to modify its lower store.
The lower store's metadata is considered part of the lower store, just as the store's <a href="store/types/../../store/file-system-object.html">file system objects</a> that appear in the store directory are.</p>
</li>
</ul>
</li>
<li>
<p><strong>Upper almost-store</strong>:</p>
<blockquote>
<p>Not directly specified.
Instead the constituent parts are independently specified as described below.</p>
</blockquote>
<p>This is almost but not quite just a [local store].
That is because taken in isolation, not as part of a local overlay store, by itself, it would appear corrupted.
But combined with everything else as part of an overlay local store, it is valid.</p>
<ul>
<li>
<p><strong>Upper layer directory</strong>:</p>
<blockquote>
<p>Specified with <a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-upper-layer"><code>upper-layer</code></a> setting.</p>
</blockquote>
<p>This contains additional <a href="store/types/../../store/store-object.html">store objects</a>
(or, strictly speaking, their <a href="store/types/../../store/file-system-object.html">file system objects</a> that the local overlay store will extend the lower store with).</p>
</li>
<li>
<p><strong>Upper store directory</strong>:</p>
<blockquote>
<p>Specified with the <a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-real"><code>real</code></a> setting.
This the same as the base local store setting, and can also be indirectly specified with the <a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-root"><code>root</code></a> setting.</p>
</blockquote>
<p>This contains all the store objects from each of the two directories.</p>
<p>The lower store directory and upper layer directory are combined via OverlayFS to create this directory.
Nix doesn't do this itself, because it typically wouldn't have the permissions to do so, so it is the responsibility of the user to set this up first.
Nix can, however, optionally check that the OverlayFS mount settings appear as expected, matching Nix's own settings.</p>
</li>
<li>
<p><strong>Upper SQLite database</strong>:</p>
<blockquote>
<p>Not directly specified.
The location of the database instead depends on the <a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-state"><code>state</code></a> setting.
It is always <code>${state}/db</code>.</p>
</blockquote>
<p>This contains the metadata of all of the upper layer <a href="store/types/../../store/store-object.html">store objects</a> (everything beyond their file system objects), and also duplicate copies of some lower layer store object's metadta.
The duplication is so the metadata for the <a href="store/types/../../glossary.html#gloss-closure">closure</a> of upper layer <a href="store/types/../../store/store-object.html">store objects</a> can be found entirely within the upper layer.
(This allows us to use the same SQL Schema as the [local store]'s SQLite database, as foreign keys in that schema enforce closure metadata to be self-contained in this way.)</p>
</li>
</ul>
</li>
</ul>
<h3 id="example-filesystem-layout"><a class="header" href="#example-filesystem-layout">Example filesystem layout</a></h3>
<p>Here is a worked out example of usage, following the concepts in the previous section.</p>
<p>Say we have the following paths:</p>
<ul>
<li>
<p><code>/mnt/example/merged-store/nix/store</code></p>
</li>
<li>
<p><code>/mnt/example/store-a/nix/store</code></p>
</li>
<li>
<p><code>/mnt/example/store-b</code></p>
</li>
</ul>
<p>Then the following store URI can be used to access a local-overlay store at <code>/mnt/example/merged-store</code>:</p>
<pre><code>local-overlay://?root=/mnt/example/merged-store&amp;lower-store=/mnt/example/store-a&amp;upper-layer=/mnt/example/store-b
</code></pre>
<p>The lower store directory is located at <code>/mnt/example/store-a/nix/store</code>, while the upper layer is at <code>/mnt/example/store-b</code>.</p>
<p>Before accessing the overlay store you will need to ensure the OverlayFS mount is set up correctly:</p>
<pre><code class="language-shell">mount -t overlay overlay \
  -o lowerdir="/mnt/example/store-a/nix/store" \
  -o upperdir="/mnt/example/store-b" \
  -o workdir="/mnt/example/workdir" \
  "/mnt/example/merged-store/nix/store"
</code></pre>
<p>Note that OverlayFS requires <code>/mnt/example/workdir</code> to be on the same volume as the <code>upperdir</code>.</p>
<p>By default, Nix will check that the mountpoint as been set up correctly and fail with an error if it has not.
You can override this behaviour by passing <a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-check-mount"><code>check-mount=false</code></a> if you need to.</p>
<h2 id="settings-1"><a class="header" href="#settings-1">Settings</a></h2>
<ul>
<li>
<p><span id="store-experimental-local-overlay-store-check-mount"><a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-check-mount"><code>check-mount</code></a></span></p>
<p>Check that the overlay filesystem is correctly mounted.</p>
<p>Nix does not manage the overlayfs mount point itself, but the correct
functioning of the overlay store does depend on this mount point being set up
correctly. Rather than just assume this is the case, check that the lowerdir
and upperdir options are what we expect them to be. This check is on by
default, but can be disabled if needed.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-log"><a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-log"><code>log</code></a></span></p>
<p>directory where Nix will store log files.</p>
<p><strong>Default:</strong> <code>/nix/var/log/nix</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-lower-store"><a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-lower-store"><code>lower-store</code></a></span></p>
<p><a href="store/types/../../command-ref/new-cli/nix3-help-stores.html#store-url-format">Store URL</a>
for the lower store. The default is <code>auto</code> (i.e. use the Nix daemon or <code>/nix/store</code> directly).</p>
<p>Must be a store with a store dir on the file system.
Must be used as OverlayFS lower layer for this store's store dir.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-path-info-cache-size"><a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-priority"><a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-read-only"><a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-read-only"><code>read-only</code></a></span></p>
<p>Allow this store to be opened when its <a href="store/types/../../glossary.html#gloss-nix-database">database</a> is on a read-only filesystem.</p>
<p>Normally Nix will attempt to open the store database in read-write mode, even for querying (when write access is not needed), causing it to fail if the database is on a read-only filesystem.</p>
<p>Enable read-only mode to disable locking and open the SQLite database with the <a href="https://www.sqlite.org/c3ref/open.html"><code>immutable</code> parameter</a> set.</p>
<blockquote>
<p><strong>Warning</strong>
Do not use this unless the filesystem is read-only.</p>
<p>Using it when the filesystem is writable can cause incorrect query results or corruption errors if the database is changed by another process.
While the filesystem the database resides on might appear to be read-only, consider whether another user or system might have write access to it.</p>
</blockquote>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-real"><a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-real"><code>real</code></a></span></p>
<p>Physical path of the Nix store.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-remount-hook"><a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-remount-hook"><code>remount-hook</code></a></span></p>
<p>Script or other executable to run when overlay filesystem needs remounting.</p>
<p>This is occasionally necessary when deleting a store path that exists in both upper and lower layers.
In such a situation, bypassing OverlayFS and deleting the path in the upper layer directly
is the only way to perform the deletion without creating a "whiteout".
However this causes the OverlayFS kernel data structures to get out-of-sync,
and can lead to 'stale file handle' errors; remounting solves the problem.</p>
<p>The store directory is passed as an argument to the invoked executable.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-require-sigs"><a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-require-sigs"><code>require-sigs</code></a></span></p>
<p>Whether store paths copied into this store should have a trusted signature.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-root"><a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-root"><code>root</code></a></span></p>
<p>Directory prefixed to all other paths.</p>
<p><strong>Default:</strong> ``</p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-state"><a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-state"><code>state</code></a></span></p>
<p>Directory where Nix will store state.</p>
<p><strong>Default:</strong> <code>/dummy</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-store"><a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-system-features"><a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="store/types/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-trusted"><a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="store/types/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-upper-layer"><a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-upper-layer"><code>upper-layer</code></a></span></p>
<p>Directory containing the OverlayFS upper layer for this store's store dir.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-want-mass-query"><a href="store/types/experimental-local-overlay-store.html#store-experimental-local-overlay-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="experimental-ssh-store"><a class="header" href="#experimental-ssh-store">Experimental SSH Store</a></h1>
<p><strong>Store URL format</strong>: <code>ssh-ng://[username@]hostname</code></p>
<p>Experimental store type that allows full access to a Nix store on a
remote machine.</p>
<h2 id="settings-2"><a class="header" href="#settings-2">Settings</a></h2>
<ul>
<li>
<p><span id="store-experimental-ssh-store-base64-ssh-public-host-key"><a href="store/types/experimental-ssh-store.html#store-experimental-ssh-store-base64-ssh-public-host-key"><code>base64-ssh-public-host-key</code></a></span></p>
<p>The public host key of the remote machine.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-compress"><a href="store/types/experimental-ssh-store.html#store-experimental-ssh-store-compress"><code>compress</code></a></span></p>
<p>Whether to enable SSH compression.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-max-connection-age"><a href="store/types/experimental-ssh-store.html#store-experimental-ssh-store-max-connection-age"><code>max-connection-age</code></a></span></p>
<p>Maximum age of a connection before it is closed.</p>
<p><strong>Default:</strong> <code>4294967295</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-max-connections"><a href="store/types/experimental-ssh-store.html#store-experimental-ssh-store-max-connections"><code>max-connections</code></a></span></p>
<p>Maximum number of concurrent connections to the Nix daemon.</p>
<p><strong>Default:</strong> <code>1</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-path-info-cache-size"><a href="store/types/experimental-ssh-store.html#store-experimental-ssh-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-priority"><a href="store/types/experimental-ssh-store.html#store-experimental-ssh-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-remote-program"><a href="store/types/experimental-ssh-store.html#store-experimental-ssh-store-remote-program"><code>remote-program</code></a></span></p>
<p>Path to the <code>nix-daemon</code> executable on the remote machine.</p>
<p><strong>Default:</strong> <code>nix-daemon</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-remote-store"><a href="store/types/experimental-ssh-store.html#store-experimental-ssh-store-remote-store"><code>remote-store</code></a></span></p>
<p><a href="store/types/../../store/types/index.html#store-url-format">Store URL</a>
to be used on the remote machine. The default is <code>auto</code>
(i.e. use the Nix daemon or <code>/nix/store</code> directly).</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-ssh-key"><a href="store/types/experimental-ssh-store.html#store-experimental-ssh-store-ssh-key"><code>ssh-key</code></a></span></p>
<p>Path to the SSH private key used to authenticate to the remote machine.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-store"><a href="store/types/experimental-ssh-store.html#store-experimental-ssh-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-system-features"><a href="store/types/experimental-ssh-store.html#store-experimental-ssh-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="store/types/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-trusted"><a href="store/types/experimental-ssh-store.html#store-experimental-ssh-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="store/types/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-want-mass-query"><a href="store/types/experimental-ssh-store.html#store-experimental-ssh-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="experimental-ssh-store-with-filesystem-mounted"><a class="header" href="#experimental-ssh-store-with-filesystem-mounted">Experimental SSH Store with filesystem mounted</a></h1>
<blockquote>
<p><strong>Warning</strong></p>
<p>This store is part of an
<a href="store/types/../../development/experimental-features.html">experimental feature</a>.</p>
<p>To use this store, make sure the
<a href="store/types/../../development/experimental-features.html#xp-feature-mounted-ssh-store"><code>mounted-ssh-store</code> experimental feature</a>
is enabled.
For example, include the following in <a href="store/types/../../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = mounted-ssh-store
</code></pre>
</blockquote>
<p><strong>Store URL format</strong>: <code>mounted-ssh-ng://[username@]hostname</code></p>
<p>Experimental store type that allows full access to a Nix store on a remote machine,
and additionally requires that store be mounted in the local file system.</p>
<p>The mounting of that store is not managed by Nix, and must by managed manually.
It could be accomplished with SSHFS or NFS, for example.</p>
<p>The local file system is used to optimize certain operations.
For example, rather than serializing Nix archives and sending over the Nix channel,
we can directly access the file system data via the mount-point.</p>
<p>The local file system is also used to make certain operations possible that wouldn't otherwise be.
For example, persistent GC roots can be created if they reside on the same file system as the remote store:
the remote side will create the symlinks necessary to avoid race conditions.</p>
<h2 id="settings-3"><a class="header" href="#settings-3">Settings</a></h2>
<ul>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-base64-ssh-public-host-key"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-base64-ssh-public-host-key"><code>base64-ssh-public-host-key</code></a></span></p>
<p>The public host key of the remote machine.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-compress"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-compress"><code>compress</code></a></span></p>
<p>Whether to enable SSH compression.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-log"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-log"><code>log</code></a></span></p>
<p>directory where Nix will store log files.</p>
<p><strong>Default:</strong> <code>/nix/var/log/nix</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-max-connection-age"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-max-connection-age"><code>max-connection-age</code></a></span></p>
<p>Maximum age of a connection before it is closed.</p>
<p><strong>Default:</strong> <code>4294967295</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-max-connections"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-max-connections"><code>max-connections</code></a></span></p>
<p>Maximum number of concurrent connections to the Nix daemon.</p>
<p><strong>Default:</strong> <code>1</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-path-info-cache-size"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-priority"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-real"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-real"><code>real</code></a></span></p>
<p>Physical path of the Nix store.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-remote-program"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-remote-program"><code>remote-program</code></a></span></p>
<p>Path to the <code>nix-daemon</code> executable on the remote machine.</p>
<p><strong>Default:</strong> <code>nix-daemon</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-remote-store"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-remote-store"><code>remote-store</code></a></span></p>
<p><a href="store/types/../../store/types/index.html#store-url-format">Store URL</a>
to be used on the remote machine. The default is <code>auto</code>
(i.e. use the Nix daemon or <code>/nix/store</code> directly).</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-root"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-root"><code>root</code></a></span></p>
<p>Directory prefixed to all other paths.</p>
<p><strong>Default:</strong> ``</p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-ssh-key"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-ssh-key"><code>ssh-key</code></a></span></p>
<p>Path to the SSH private key used to authenticate to the remote machine.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-state"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-state"><code>state</code></a></span></p>
<p>Directory where Nix will store state.</p>
<p><strong>Default:</strong> <code>/dummy</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-store"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-system-features"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="store/types/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-trusted"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="store/types/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-want-mass-query"><a href="store/types/experimental-ssh-store-with-filesystem-mounted.html#store-experimental-ssh-store-with-filesystem-mounted-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="http-binary-cache-store"><a class="header" href="#http-binary-cache-store">HTTP Binary Cache Store</a></h1>
<p><strong>Store URL format</strong>: <code>http://...</code>, <code>https://...</code></p>
<p>This store allows a binary cache to be accessed via the HTTP
protocol.</p>
<h2 id="settings-4"><a class="header" href="#settings-4">Settings</a></h2>
<ul>
<li>
<p><span id="store-http-binary-cache-store-compression"><a href="store/types/http-binary-cache-store.html#store-http-binary-cache-store-compression"><code>compression</code></a></span></p>
<p>NAR compression method (<code>xz</code>, <code>bzip2</code>, <code>gzip</code>, <code>zstd</code>, or <code>none</code>).</p>
<p><strong>Default:</strong> <code>xz</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-compression-level"><a href="store/types/http-binary-cache-store.html#store-http-binary-cache-store-compression-level"><code>compression-level</code></a></span></p>
<p>The <em>preset level</em> to be used when compressing NARs.
The meaning and accepted values depend on the compression method selected.
<code>-1</code> specifies that the default compression level should be used.</p>
<p><strong>Default:</strong> <code>-1</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-index-debug-info"><a href="store/types/http-binary-cache-store.html#store-http-binary-cache-store-index-debug-info"><code>index-debug-info</code></a></span></p>
<p>Whether to index DWARF debug info files by build ID. This allows <a href="https://github.com/edolstra/dwarffs"><code>dwarffs</code></a> to
fetch debug info on demand</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-local-nar-cache"><a href="store/types/http-binary-cache-store.html#store-http-binary-cache-store-local-nar-cache"><code>local-nar-cache</code></a></span></p>
<p>Path to a local cache of NARs fetched from this binary cache, used by commands such as <code>nix store cat</code>.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-parallel-compression"><a href="store/types/http-binary-cache-store.html#store-http-binary-cache-store-parallel-compression"><code>parallel-compression</code></a></span></p>
<p>Enable multi-threaded compression of NARs. This is currently only available for <code>xz</code> and <code>zstd</code>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-path-info-cache-size"><a href="store/types/http-binary-cache-store.html#store-http-binary-cache-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-priority"><a href="store/types/http-binary-cache-store.html#store-http-binary-cache-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-secret-key"><a href="store/types/http-binary-cache-store.html#store-http-binary-cache-store-secret-key"><code>secret-key</code></a></span></p>
<p>Path to the secret key used to sign the binary cache.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-store"><a href="store/types/http-binary-cache-store.html#store-http-binary-cache-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-system-features"><a href="store/types/http-binary-cache-store.html#store-http-binary-cache-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="store/types/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-trusted"><a href="store/types/http-binary-cache-store.html#store-http-binary-cache-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="store/types/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-want-mass-query"><a href="store/types/http-binary-cache-store.html#store-http-binary-cache-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-write-nar-listing"><a href="store/types/http-binary-cache-store.html#store-http-binary-cache-store-write-nar-listing"><code>write-nar-listing</code></a></span></p>
<p>Whether to write a JSON file that lists the files in each NAR.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="local-binary-cache-store"><a class="header" href="#local-binary-cache-store">Local Binary Cache Store</a></h1>
<p><strong>Store URL format</strong>: <code>file://</code><em>path</em></p>
<p>This store allows reading and writing a binary cache stored in <em>path</em>
in the local filesystem. If <em>path</em> does not exist, it will be created.</p>
<p>For example, the following builds or downloads <code>nixpkgs#hello</code> into
the local store and then copies it to the binary cache in
<code>/tmp/binary-cache</code>:</p>
<pre><code># nix copy --to file:///tmp/binary-cache nixpkgs#hello
</code></pre>
<h2 id="settings-5"><a class="header" href="#settings-5">Settings</a></h2>
<ul>
<li>
<p><span id="store-local-binary-cache-store-compression"><a href="store/types/local-binary-cache-store.html#store-local-binary-cache-store-compression"><code>compression</code></a></span></p>
<p>NAR compression method (<code>xz</code>, <code>bzip2</code>, <code>gzip</code>, <code>zstd</code>, or <code>none</code>).</p>
<p><strong>Default:</strong> <code>xz</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-compression-level"><a href="store/types/local-binary-cache-store.html#store-local-binary-cache-store-compression-level"><code>compression-level</code></a></span></p>
<p>The <em>preset level</em> to be used when compressing NARs.
The meaning and accepted values depend on the compression method selected.
<code>-1</code> specifies that the default compression level should be used.</p>
<p><strong>Default:</strong> <code>-1</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-index-debug-info"><a href="store/types/local-binary-cache-store.html#store-local-binary-cache-store-index-debug-info"><code>index-debug-info</code></a></span></p>
<p>Whether to index DWARF debug info files by build ID. This allows <a href="https://github.com/edolstra/dwarffs"><code>dwarffs</code></a> to
fetch debug info on demand</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-local-nar-cache"><a href="store/types/local-binary-cache-store.html#store-local-binary-cache-store-local-nar-cache"><code>local-nar-cache</code></a></span></p>
<p>Path to a local cache of NARs fetched from this binary cache, used by commands such as <code>nix store cat</code>.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-parallel-compression"><a href="store/types/local-binary-cache-store.html#store-local-binary-cache-store-parallel-compression"><code>parallel-compression</code></a></span></p>
<p>Enable multi-threaded compression of NARs. This is currently only available for <code>xz</code> and <code>zstd</code>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-path-info-cache-size"><a href="store/types/local-binary-cache-store.html#store-local-binary-cache-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-priority"><a href="store/types/local-binary-cache-store.html#store-local-binary-cache-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-secret-key"><a href="store/types/local-binary-cache-store.html#store-local-binary-cache-store-secret-key"><code>secret-key</code></a></span></p>
<p>Path to the secret key used to sign the binary cache.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-store"><a href="store/types/local-binary-cache-store.html#store-local-binary-cache-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-system-features"><a href="store/types/local-binary-cache-store.html#store-local-binary-cache-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="store/types/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-trusted"><a href="store/types/local-binary-cache-store.html#store-local-binary-cache-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="store/types/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-want-mass-query"><a href="store/types/local-binary-cache-store.html#store-local-binary-cache-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-write-nar-listing"><a href="store/types/local-binary-cache-store.html#store-local-binary-cache-store-write-nar-listing"><code>write-nar-listing</code></a></span></p>
<p>Whether to write a JSON file that lists the files in each NAR.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="local-daemon-store"><a class="header" href="#local-daemon-store">Local Daemon Store</a></h1>
<p><strong>Store URL format</strong>: <code>daemon</code>, <code>unix://</code><em>path</em></p>
<p>This store type accesses a Nix store by talking to a Nix daemon
listening on the Unix domain socket <em>path</em>. The store pseudo-URL
<code>daemon</code> is equivalent to <code>unix:///nix/var/nix/daemon-socket/socket</code>.</p>
<h2 id="settings-6"><a class="header" href="#settings-6">Settings</a></h2>
<ul>
<li>
<p><span id="store-local-daemon-store-log"><a href="store/types/local-daemon-store.html#store-local-daemon-store-log"><code>log</code></a></span></p>
<p>directory where Nix will store log files.</p>
<p><strong>Default:</strong> <code>/nix/var/log/nix</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-max-connection-age"><a href="store/types/local-daemon-store.html#store-local-daemon-store-max-connection-age"><code>max-connection-age</code></a></span></p>
<p>Maximum age of a connection before it is closed.</p>
<p><strong>Default:</strong> <code>4294967295</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-max-connections"><a href="store/types/local-daemon-store.html#store-local-daemon-store-max-connections"><code>max-connections</code></a></span></p>
<p>Maximum number of concurrent connections to the Nix daemon.</p>
<p><strong>Default:</strong> <code>1</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-path-info-cache-size"><a href="store/types/local-daemon-store.html#store-local-daemon-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-priority"><a href="store/types/local-daemon-store.html#store-local-daemon-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-real"><a href="store/types/local-daemon-store.html#store-local-daemon-store-real"><code>real</code></a></span></p>
<p>Physical path of the Nix store.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-root"><a href="store/types/local-daemon-store.html#store-local-daemon-store-root"><code>root</code></a></span></p>
<p>Directory prefixed to all other paths.</p>
<p><strong>Default:</strong> ``</p>
</li>
<li>
<p><span id="store-local-daemon-store-state"><a href="store/types/local-daemon-store.html#store-local-daemon-store-state"><code>state</code></a></span></p>
<p>Directory where Nix will store state.</p>
<p><strong>Default:</strong> <code>/dummy</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-store"><a href="store/types/local-daemon-store.html#store-local-daemon-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-system-features"><a href="store/types/local-daemon-store.html#store-local-daemon-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="store/types/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-local-daemon-store-trusted"><a href="store/types/local-daemon-store.html#store-local-daemon-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="store/types/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-want-mass-query"><a href="store/types/local-daemon-store.html#store-local-daemon-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="local-store"><a class="header" href="#local-store">Local Store</a></h1>
<p><strong>Store URL format</strong>: <code>local</code>, <em>root</em></p>
<p>This store type accesses a Nix store in the local filesystem directly
(i.e. not via the Nix daemon). <em>root</em> is an absolute path that is
prefixed to other directories such as the Nix store directory. The
store pseudo-URL <code>local</code> denotes a store that uses <code>/</code> as its root
directory.</p>
<p>A store that uses a <em>root</em> other than <code>/</code> is called a <em>chroot
store</em>. With such stores, the store directory is "logically" still
<code>/nix/store</code>, so programs stored in them can only be built and
executed by <code>chroot</code>-ing into <em>root</em>. Chroot stores only support
building and running on Linux when <a href="https://man7.org/linux/man-pages/man7/mount_namespaces.7.html"><code>mount namespaces</code></a> and <a href="https://man7.org/linux/man-pages/man7/user_namespaces.7.html"><code>user namespaces</code></a> are
enabled.</p>
<p>For example, the following uses <code>/tmp/root</code> as the chroot environment
to build or download <code>nixpkgs#hello</code> and then execute it:</p>
<pre><code class="language-console"># nix run --store /tmp/root nixpkgs#hello
Hello, world!
</code></pre>
<p>Here, the "physical" store location is <code>/tmp/root/nix/store</code>, and
Nix's store metadata is in <code>/tmp/root/nix/var/nix/db</code>.</p>
<p>It is also possible, but not recommended, to change the "logical"
location of the Nix store from its default of <code>/nix/store</code>. This makes
it impossible to use default substituters such as
<code>https://cache.nixos.org/</code>, and thus you may have to build everything
locally. Here is an example:</p>
<pre><code class="language-console"># nix build --store 'local?store=/tmp/my-nix/store&amp;state=/tmp/my-nix/state&amp;log=/tmp/my-nix/log' nixpkgs#hello
</code></pre>
<h2 id="settings-7"><a class="header" href="#settings-7">Settings</a></h2>
<ul>
<li>
<p><span id="store-local-store-log"><a href="store/types/local-store.html#store-local-store-log"><code>log</code></a></span></p>
<p>directory where Nix will store log files.</p>
<p><strong>Default:</strong> <code>/nix/var/log/nix</code></p>
</li>
<li>
<p><span id="store-local-store-path-info-cache-size"><a href="store/types/local-store.html#store-local-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-local-store-priority"><a href="store/types/local-store.html#store-local-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-local-store-read-only"><a href="store/types/local-store.html#store-local-store-read-only"><code>read-only</code></a></span></p>
<p>Allow this store to be opened when its <a href="store/types/../../glossary.html#gloss-nix-database">database</a> is on a read-only filesystem.</p>
<p>Normally Nix will attempt to open the store database in read-write mode, even for querying (when write access is not needed), causing it to fail if the database is on a read-only filesystem.</p>
<p>Enable read-only mode to disable locking and open the SQLite database with the <a href="https://www.sqlite.org/c3ref/open.html"><code>immutable</code> parameter</a> set.</p>
<blockquote>
<p><strong>Warning</strong>
Do not use this unless the filesystem is read-only.</p>
<p>Using it when the filesystem is writable can cause incorrect query results or corruption errors if the database is changed by another process.
While the filesystem the database resides on might appear to be read-only, consider whether another user or system might have write access to it.</p>
</blockquote>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-local-store-real"><a href="store/types/local-store.html#store-local-store-real"><code>real</code></a></span></p>
<p>Physical path of the Nix store.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-local-store-require-sigs"><a href="store/types/local-store.html#store-local-store-require-sigs"><code>require-sigs</code></a></span></p>
<p>Whether store paths copied into this store should have a trusted signature.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="store-local-store-root"><a href="store/types/local-store.html#store-local-store-root"><code>root</code></a></span></p>
<p>Directory prefixed to all other paths.</p>
<p><strong>Default:</strong> ``</p>
</li>
<li>
<p><span id="store-local-store-state"><a href="store/types/local-store.html#store-local-store-state"><code>state</code></a></span></p>
<p>Directory where Nix will store state.</p>
<p><strong>Default:</strong> <code>/dummy</code></p>
</li>
<li>
<p><span id="store-local-store-store"><a href="store/types/local-store.html#store-local-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-local-store-system-features"><a href="store/types/local-store.html#store-local-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="store/types/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-local-store-trusted"><a href="store/types/local-store.html#store-local-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="store/types/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-local-store-want-mass-query"><a href="store/types/local-store.html#store-local-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="s3-binary-cache-store"><a class="header" href="#s3-binary-cache-store">S3 Binary Cache Store</a></h1>
<p><strong>Store URL format</strong>: <code>s3://</code><em>bucket-name</em></p>
<p>This store allows reading and writing a binary cache stored in an AWS S3 (or S3-compatible service) bucket.
This store shares many idioms with the <a href="store/types/../../store/types/http-binary-cache-store.html">HTTP Binary Cache Store</a>.</p>
<p>For AWS S3, the binary cache URL for a bucket named <code>example-nix-cache</code> will be exactly <a href="s3://example-nix-cache">s3://example-nix-cache</a>.
For S3 compatible binary caches, consult that cache's documentation.</p>
<h3 id="anonymous-reads-to-your-s3-compatible-binary-cache"><a class="header" href="#anonymous-reads-to-your-s3-compatible-binary-cache">Anonymous reads to your S3-compatible binary cache</a></h3>
<blockquote>
<p>If your binary cache is publicly accessible and does not require authentication,
it is simplest to use the [HTTP Binary Cache Store] rather than S3 Binary Cache Store with
<a href="https://example-nix-cache.s3.amazonaws.com">https://example-nix-cache.s3.amazonaws.com</a> instead of <a href="s3://example-nix-cache">s3://example-nix-cache</a>.</p>
</blockquote>
<p>Your bucket will need a
<a href="https://docs.aws.amazon.com/AmazonS3/v1/userguide/bucket-policies.html">bucket policy</a>
like the following to be accessible:</p>
<pre><code class="language-json">{
    "Id": "DirectReads",
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowDirectReads",
            "Action": [
                "s3:GetObject",
                "s3:GetBucketLocation"
            ],
            "Effect": "Allow",
            "Resource": [
                "arn:aws:s3:::example-nix-cache",
                "arn:aws:s3:::example-nix-cache/*"
            ],
            "Principal": "*"
        }
    ]
}
</code></pre>
<h3 id="authentication"><a class="header" href="#authentication">Authentication</a></h3>
<p>Nix will use the
<a href="https://docs.aws.amazon.com/sdk-for-cpp/v1/developer-guide/credentials.html">default credential provider chain</a>
for authenticating requests to Amazon S3.</p>
<p>Note that this means Nix will read environment variables and files with different idioms than with Nix's own settings, as implemented by the AWS SDK.
Consult the documentation linked above for further details.</p>
<h3 id="authenticated-reads-to-your-s3-binary-cache"><a class="header" href="#authenticated-reads-to-your-s3-binary-cache">Authenticated reads to your S3 binary cache</a></h3>
<p>Your bucket will need a bucket policy allowing the desired users to perform the <code>s3:GetObject</code> and <code>s3:GetBucketLocation</code> action on all objects in the bucket.
The <a href="store/types/s3-binary-cache-store.html#anonymous-reads-to-your-s3-compatible-binary-cache">anonymous policy given above</a> can be updated to have a restricted <code>Principal</code> to support this.</p>
<h3 id="authenticated-writes-to-your-s3-compatible-binary-cache"><a class="header" href="#authenticated-writes-to-your-s3-compatible-binary-cache">Authenticated writes to your S3-compatible binary cache</a></h3>
<p>Your account will need an IAM policy to support uploading to the bucket:</p>
<pre><code class="language-json">{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "UploadToCache",
      "Effect": "Allow",
      "Action": [
        "s3:AbortMultipartUpload",
        "s3:GetBucketLocation",
        "s3:GetObject",
        "s3:ListBucket",
        "s3:ListBucketMultipartUploads",
        "s3:ListMultipartUploadParts",
        "s3:PutObject"
      ],
      "Resource": [
        "arn:aws:s3:::example-nix-cache",
        "arn:aws:s3:::example-nix-cache/*"
      ]
    }
  ]
}
</code></pre>
<h3 id="examples"><a class="header" href="#examples">Examples</a></h3>
<p>With bucket policies and authentication set up as described above, uploading works via <a href="store/types/../../command-ref/new-cli/nix3-copy.html"><code>nix copy</code></a> (experimental).</p>
<ul>
<li>
<p>To upload with a specific credential profile for Amazon S3:</p>
<pre><code class="language-console">$ nix copy nixpkgs.hello \
  --to 's3://example-nix-cache?profile=cache-upload&amp;region=eu-west-2'
</code></pre>
</li>
<li>
<p>To upload to an S3-compatible binary cache:</p>
<pre><code class="language-console">$ nix copy nixpkgs.hello --to \
  's3://example-nix-cache?profile=cache-upload&amp;scheme=https&amp;endpoint=minio.example.com'
</code></pre>
</li>
</ul>
<h2 id="settings-8"><a class="header" href="#settings-8">Settings</a></h2>
<ul>
<li>
<p><span id="store-s3-binary-cache-store-buffer-size"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-buffer-size"><code>buffer-size</code></a></span></p>
<p>Size (in bytes) of each part in multi-part uploads.</p>
<p><strong>Default:</strong> <code>5242880</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-compression"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-compression"><code>compression</code></a></span></p>
<p>NAR compression method (<code>xz</code>, <code>bzip2</code>, <code>gzip</code>, <code>zstd</code>, or <code>none</code>).</p>
<p><strong>Default:</strong> <code>xz</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-compression-level"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-compression-level"><code>compression-level</code></a></span></p>
<p>The <em>preset level</em> to be used when compressing NARs.
The meaning and accepted values depend on the compression method selected.
<code>-1</code> specifies that the default compression level should be used.</p>
<p><strong>Default:</strong> <code>-1</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-endpoint"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-endpoint"><code>endpoint</code></a></span></p>
<p>The URL of the endpoint of an S3-compatible service such as MinIO.
Do not specify this setting if you're using Amazon S3.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>This endpoint must support HTTPS and will use path-based
addressing instead of virtual host based addressing.</p>
</blockquote>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-index-debug-info"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-index-debug-info"><code>index-debug-info</code></a></span></p>
<p>Whether to index DWARF debug info files by build ID. This allows <a href="https://github.com/edolstra/dwarffs"><code>dwarffs</code></a> to
fetch debug info on demand</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-local-nar-cache"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-local-nar-cache"><code>local-nar-cache</code></a></span></p>
<p>Path to a local cache of NARs fetched from this binary cache, used by commands such as <code>nix store cat</code>.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-log-compression"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-log-compression"><code>log-compression</code></a></span></p>
<p>Compression method for <code>log/*</code> files. It is recommended to
use a compression method supported by most web browsers
(e.g. <code>brotli</code>).</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-ls-compression"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-ls-compression"><code>ls-compression</code></a></span></p>
<p>Compression method for <code>.ls</code> files.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-multipart-upload"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-multipart-upload"><code>multipart-upload</code></a></span></p>
<p>Whether to use multi-part uploads.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-narinfo-compression"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-narinfo-compression"><code>narinfo-compression</code></a></span></p>
<p>Compression method for <code>.narinfo</code> files.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-parallel-compression"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-parallel-compression"><code>parallel-compression</code></a></span></p>
<p>Enable multi-threaded compression of NARs. This is currently only available for <code>xz</code> and <code>zstd</code>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-path-info-cache-size"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-priority"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-profile"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-profile"><code>profile</code></a></span></p>
<p>The name of the AWS configuration profile to use. By default
Nix will use the <code>default</code> profile.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-region"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-region"><code>region</code></a></span></p>
<p>The region of the S3 bucket. If your bucket is not in
<code>us–east-1</code>, you should always explicitly specify the region
parameter.</p>
<p><strong>Default:</strong> <code>us-east-1</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-scheme"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-scheme"><code>scheme</code></a></span></p>
<p>The scheme used for S3 requests, <code>https</code> (default) or <code>http</code>. This
option allows you to disable HTTPS for binary caches which don't
support it.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>HTTPS should be used if the cache might contain sensitive
information.</p>
</blockquote>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-secret-key"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-secret-key"><code>secret-key</code></a></span></p>
<p>Path to the secret key used to sign the binary cache.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-store"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-system-features"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="store/types/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-trusted"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="store/types/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-want-mass-query"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-write-nar-listing"><a href="store/types/s3-binary-cache-store.html#store-s3-binary-cache-store-write-nar-listing"><code>write-nar-listing</code></a></span></p>
<p>Whether to write a JSON file that lists the files in each NAR.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ssh-store"><a class="header" href="#ssh-store">SSH Store</a></h1>
<p><strong>Store URL format</strong>: <code>ssh://[username@]hostname</code></p>
<p>This store type allows limited access to a remote store on another
machine via SSH.</p>
<h2 id="settings-9"><a class="header" href="#settings-9">Settings</a></h2>
<ul>
<li>
<p><span id="store-ssh-store-base64-ssh-public-host-key"><a href="store/types/ssh-store.html#store-ssh-store-base64-ssh-public-host-key"><code>base64-ssh-public-host-key</code></a></span></p>
<p>The public host key of the remote machine.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-ssh-store-compress"><a href="store/types/ssh-store.html#store-ssh-store-compress"><code>compress</code></a></span></p>
<p>Whether to enable SSH compression.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-ssh-store-max-connections"><a href="store/types/ssh-store.html#store-ssh-store-max-connections"><code>max-connections</code></a></span></p>
<p>Maximum number of concurrent SSH connections.</p>
<p><strong>Default:</strong> <code>1</code></p>
</li>
<li>
<p><span id="store-ssh-store-path-info-cache-size"><a href="store/types/ssh-store.html#store-ssh-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-ssh-store-priority"><a href="store/types/ssh-store.html#store-ssh-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-ssh-store-remote-program"><a href="store/types/ssh-store.html#store-ssh-store-remote-program"><code>remote-program</code></a></span></p>
<p>Path to the <code>nix-store</code> executable on the remote machine.</p>
<p><strong>Default:</strong> <code>nix-store</code></p>
</li>
<li>
<p><span id="store-ssh-store-remote-store"><a href="store/types/ssh-store.html#store-ssh-store-remote-store"><code>remote-store</code></a></span></p>
<p><a href="store/types/../../store/types/index.html#store-url-format">Store URL</a>
to be used on the remote machine. The default is <code>auto</code>
(i.e. use the Nix daemon or <code>/nix/store</code> directly).</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-ssh-store-ssh-key"><a href="store/types/ssh-store.html#store-ssh-store-ssh-key"><code>ssh-key</code></a></span></p>
<p>Path to the SSH private key used to authenticate to the remote machine.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-ssh-store-store"><a href="store/types/ssh-store.html#store-ssh-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-ssh-store-system-features"><a href="store/types/ssh-store.html#store-ssh-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="store/types/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-ssh-store-trusted"><a href="store/types/ssh-store.html#store-ssh-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="store/types/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-ssh-store-want-mass-query"><a href="store/types/ssh-store.html#store-ssh-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="store/types/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nix-language"><a class="header" href="#nix-language">Nix Language</a></h1>
<p>The Nix language is designed for conveniently creating and composing <em>derivations</em> – precise descriptions of how contents of existing files are used to derive new files.</p>
<blockquote>
<p><strong>Tip</strong></p>
<p>These pages are written as a reference.
If you are learning Nix, nix.dev has a good <a href="https://nix.dev/tutorials/nix-language">introduction to the Nix language</a>.</p>
</blockquote>
<p>The language is:</p>
<ul>
<li>
<p><em>domain-specific</em></p>
<p>It comes with <a href="language/../language/builtins.html">built-in functions</a> to integrate with the Nix store, which manages files and performs the derivations declared in the Nix language.</p>
</li>
<li>
<p><em>declarative</em></p>
<p>There is no notion of executing sequential steps.
Dependencies between operations are established only through data.</p>
</li>
<li>
<p><em>pure</em></p>
<p>Values cannot change during computation.
Functions always produce the same output if their input does not change.</p>
</li>
<li>
<p><em>functional</em></p>
<p>Functions are like any other value.
Functions can be assigned to names, taken as arguments, or returned by functions.</p>
</li>
<li>
<p><em>lazy</em></p>
<p>Values are only computed when they are needed.</p>
</li>
<li>
<p><em>dynamically typed</em></p>
<p>Type errors are only detected when expressions are evaluated.</p>
</li>
</ul>
<h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<p>This is an incomplete overview of language features, by example.</p>
<table>
 <tr>
  <th>
   Example
  </th>
  <th>
   Description
  </th>
 </tr>
 <tr>
  <td>
<p><em>Basic values (<a href="language/../language/types.html#primitives">primitives</a>)</em></p>
  </td>
  <td>
  </td>
 </tr>
 <tr>
  <td>
<p><code>"hello world"</code></p>
  </td>
  <td>
<p>A <a href="language/../language/types.html#type-string">string</a></p>
  </td>
 </tr>
 <tr>
  <td>
<pre><code>''
  multi
   line
    string
''
</code></pre>
  </td>
  <td>
   <!-- FIXME: using two no-break spaces, because apparently mdBook swallows the second regular space! -->
<p>A multi-line string. Strips common prefixed whitespace. Evaluates to <code>"multi\n line\n  string"</code>.</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code># Explanation</code></p>
  </td>
  <td>
<p>A <a href="language/../language/syntax.html#comments">comment</a>.</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>"hello ${ { a = "world"; }.a }"</code></p>
<p><code>"1 2 ${toString 3}"</code></p>
<p><code>"${pkgs.bash}/bin/sh"</code></p>
  </td>
  <td>
<p><a href="language/../language/string-interpolation.html">String interpolation</a> (expands to <code>"hello world"</code>, <code>"1 2 3"</code>, <code>"/nix/store/&lt;hash&gt;-bash-&lt;version&gt;/bin/sh"</code>)</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>true</code>, <code>false</code></p>
  </td>
  <td>
<p><a href="language/../language/types.html#type-boolean">Booleans</a></p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>null</code></p>
  </td>
  <td>
<p><a href="language/../language/types.html#type-null">Null</a> value</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>123</code></p>
  </td>
  <td>
<p>An <a href="language/../language/types.html#type-int">integer</a></p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>3.141</code></p>
  </td>
  <td>
<p>A <a href="language/../language/types.html#type-float">floating point number</a></p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>/etc</code></p>
  </td>
  <td>
<p>An absolute <a href="language/../language/types.html#type-path">path</a></p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>./foo.png</code></p>
  </td>
  <td>
<p>A <a href="language/../language/types.html#type-path">path</a> relative to the file containing this Nix expression</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>~/.config</code></p>
  </td>
  <td>
<p>A home <a href="language/../language/types.html#type-path">path</a>. Evaluates to the <code>"&lt;user's home directory&gt;/.config"</code>.</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>&lt;nixpkgs&gt;</code></p>
  </td>
  <td>
<p>A <a href="language/../language/constructs/lookup-path.html">lookup path</a> for Nix files. Value determined by <a href="language/../command-ref/env-common.html#env-NIX_PATH"><code>$NIX_PATH</code> environment variable</a>.</p>
  </td>
 </tr>
 <tr>
  <td>
<p><em>Compound values</em></p>
  </td>
  <td>
  </td>
 </tr>
 <tr>
  <td>
<p><code>{ x = 1; y = 2; }</code></p>
  </td>
  <td>
<p>An <a href="language/../language/types.html#attribute-set">attribute set</a> with attributes named <code>x</code> and <code>y</code></p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>{ foo.bar = 1; }</code></p>
  </td>
  <td>
<p>A nested set, equivalent to <code>{ foo = { bar = 1; }; }</code></p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>rec { x = "foo"; y = x + "bar"; }</code></p>
  </td>
  <td>
<p>A <a href="language/../language/syntax.html#recursive-sets">recursive set</a>, equivalent to <code>{ x = "foo"; y = "foobar"; }</code>.</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>[ "foo" "bar" "baz" ]</code></p>
<p><code>[ 1 2 3 ]</code></p>
<p><code>[ (f 1) { a = 1; b = 2; } [ "c" ] ]</code></p>
  </td>
  <td>
<p><a href="language/../language/types.html#list">Lists</a> with three elements.</p>
  </td>
 </tr>
 <tr>
  <td>
<p><em>Operators</em></p>
  </td>
  <td>
  </td>
 </tr>
 <tr>
  <td>
<p><code>"foo" + "bar"</code></p>
  </td>
  <td>
<p>String concatenation</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>1 + 2</code></p>
  </td>
  <td>
<p>Integer addition</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>"foo" == "f" + "oo"</code></p>
  </td>
  <td>
<p>Equality test (evaluates to <code>true</code>)</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>"foo" != "bar"</code></p>
  </td>
  <td>
<p>Inequality test (evaluates to <code>true</code>)</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>!true</code></p>
  </td>
  <td>
<p>Boolean negation</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>{ x = 1; y = 2; }.x</code></p>
  </td>
  <td>
<p><a href="language/../language/types.html#attribute-set">Attribute selection</a> (evaluates to <code>1</code>)</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>{ x = 1; y = 2; }.z or 3</code></p>
  </td>
  <td>
<p><a href="language/../language/types.html#attribute-set">Attribute selection</a> with default (evaluates to <code>3</code>)</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>{ x = 1; y = 2; } // { z = 3; }</code></p>
  </td>
  <td>
<p>Merge two sets (attributes in the right-hand set taking precedence)</p>
  </td>
 </tr>
 <tr>
  <td>
<p><em>Control structures</em></p>
  </td>
  <td>
  </td>
 </tr>
 <tr>
  <td>
<p><code>if 1 + 1 == 2 then "yes!" else "no!"</code></p>
  </td>
  <td>
<p><a href="language/../language/syntax.html#conditionals">Conditional expression</a>.</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>assert 1 + 1 == 2; "yes!"</code></p>
  </td>
  <td>
<p><a href="language/../language/syntax.html#assertions">Assertion</a> check (evaluates to <code>"yes!"</code>).</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>let x = "foo"; y = "bar"; in x + y</code></p>
  </td>
  <td>
<p>Variable definition. See <a href="language/../language/syntax.html#let-expressions"><code>let</code>-expressions</a>.</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>with builtins; head [ 1 2 3 ]</code></p>
  </td>
  <td>
<p>Add all attributes from the given set to the scope (evaluates to <code>1</code>).</p>
<p>See <a href="language/../language/syntax.html#with-expressions"><code>with</code>-expressions</a> for details and shadowing caveats.</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>inherit pkgs src;</code></p>
  </td>
  <td>
<p>Adds the variables to the current scope (attribute set or <code>let</code> binding).
Desugars to <code>pkgs = pkgs; src = src;</code>.
See <a href="language/../language/syntax.html#inheriting-attributes">Inheriting attributes</a>.</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>inherit (pkgs) lib stdenv;</code></p>
  </td>
  <td>
<p>Adds the attributes, from the attribute set in parentheses, to the current scope (attribute set or <code>let</code> binding).
Desugars to <code>lib = pkgs.lib; stdenv = pkgs.stdenv;</code>.
See <a href="language/../language/syntax.html#inheriting-attributes">Inheriting attributes</a>.</p>
  </td>
 </tr>
 <tr>
  <td>
<p><em><a href="language/../language/syntax.html#functions">Functions</a> (lambdas)</em></p>
  </td>
  <td>
  </td>
 </tr>
 <tr>
  <td>
<p><code>x: x + 1</code></p>
  </td>
  <td>
<p>A <a href="language/../language/syntax.html#functions">function</a> that expects an integer and returns it increased by 1.</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>x: y: x + y</code></p>
  </td>
  <td>
<p>Curried <a href="language/../language/syntax.html#functions">function</a>, equivalent to <code>x: (y: x + y)</code>. Can be used like a function that takes two arguments and returns their sum.</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>(x: x + 1) 100</code></p>
  </td>
  <td>
<p>A <a href="language/../language/syntax.html#functions">function</a> call (evaluates to 101)</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>let inc = x: x + 1; in inc (inc (inc 100))</code></p>
  </td>
  <td>
<p>A <a href="language/../language/syntax.html#functions">function</a> bound to a variable and subsequently called by name (evaluates to 103)</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>{ x, y }: x + y</code></p>
  </td>
  <td>
<p>A <a href="language/../language/syntax.html#functions">function</a> that expects a set with required attributes <code>x</code> and <code>y</code> and concatenates them</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>{ x, y ? "bar" }: x + y</code></p>
  </td>
  <td>
<p>A <a href="language/../language/syntax.html#functions">function</a> that expects a set with required attribute <code>x</code> and optional <code>y</code>, using <code>"bar"</code> as default value for <code>y</code></p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>{ x, y, ... }: x + y</code></p>
  </td>
  <td>
<p>A <a href="language/../language/syntax.html#functions">function</a> that expects a set with required attributes <code>x</code> and <code>y</code> and ignores any other attributes</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>{ x, y } @ args: x + y</code></p>
<p><code>args @ { x, y }: x + y</code></p>
  </td>
  <td>
<p>A <a href="language/../language/syntax.html#functions">function</a> that expects a set with required attributes <code>x</code> and <code>y</code>, and binds the whole set to <code>args</code></p>
  </td>
 </tr>
 <tr>
  <td>
<p><em>Built-in functions</em></p>
  </td>
  <td>
  </td>
 </tr>
 <tr>
  <td>
<p><code>import ./foo.nix</code></p>
  </td>
  <td>
<p>Load and return Nix expression in given file.
See <a href="language/../language/builtins.html#builtins-import">import</a>.</p>
  </td>
 </tr>
 <tr>
  <td>
<p><code>map (x: x + x) [ 1 2 3 ]</code></p>
  </td>
  <td>
<p>Apply a function to every element of a list (evaluates to <code>[ 2 4 6 ]</code>).
See <a href="language/../language/builtins.html#builtins-map"><code>map</code></a>.</p>
  </td>
 </tr>
</table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="data-types"><a class="header" href="#data-types">Data Types</a></h1>
<p>Every value in the Nix language has one of the following types:</p>
<ul>
<li><a href="language/types.html#type-int">Integer</a></li>
<li><a href="language/types.html#type-float">Float</a></li>
<li><a href="language/types.html#type-bool">Boolean</a></li>
<li><a href="language/types.html#type-string">String</a></li>
<li><a href="language/types.html#type-path">Path</a></li>
<li><a href="language/types.html#type-null">Null</a></li>
<li><a href="language/types.html#type-attrs">Attribute set</a></li>
<li><a href="language/types.html#type-list">List</a></li>
<li><a href="language/types.html#type-function">Function</a></li>
<li><a href="language/types.html#type-external">External</a></li>
</ul>
<h2 id="primitives"><a class="header" href="#primitives">Primitives</a></h2>
<h3 id="type-int"><a class="header" href="#type-int">Integer</a></h3>
<p>An <em>integer</em> in the Nix language is a signed 64-bit integer.</p>
<p>Non-negative integers can be expressed as <a href="language/syntax.html#number-literal">integer literals</a>.
Negative integers are created with the <a href="language/./operators.html#arithmetic">arithmetic negation operator</a>.
The function <a href="language/builtins.html#builtins-isInt"><code>builtins.isInt</code></a> can be used to determine if a value is an integer.</p>
<h3 id="type-float"><a class="header" href="#type-float">Float</a></h3>
<p>A <em>float</em> in the Nix language is a 64-bit <a href="https://en.wikipedia.org/wiki/IEEE_754">IEEE 754</a> floating-point number.</p>
<p>Most non-negative floats can be expressed as <a href="language/syntax.html#number-literal">float literals</a>.
Negative floats are created with the <a href="language/./operators.html#arithmetic">arithmetic negation operator</a>.
The function <a href="language/builtins.html#builtins-isFloat"><code>builtins.isFloat</code></a> can be used to determine if a value is a float.</p>
<h3 id="type-bool"><a class="header" href="#type-bool">Boolean</a></h3>
<p>A <em>boolean</em> in the Nix language is one of <em>true</em> or <em>false</em>.</p>
<!-- TODO: mention the top-level environment -->
<p>These values are available as attributes of <a href="language/builtins.html#builtins-builtins"><code>builtins</code></a> as <a href="language/builtins.html#builtins-true"><code>builtins.true</code></a> and <a href="language/builtins.html#builtins-false"><code>builtins.false</code></a>.
The function <a href="language/builtins.html#builtins-isBool"><code>builtins.isBool</code></a> can be used to determine if a value is a boolean.</p>
<h3 id="type-string"><a class="header" href="#type-string">String</a></h3>
<p>A <em>string</em> in the Nix language is an immutable, finite-length sequence of bytes, along with a <a href="language/string-context.html">string context</a>.
Nix does not assume or support working natively with character encodings.</p>
<p>String values without string context can be expressed as <a href="language/string-literals.html">string literals</a>.
The function <a href="language/builtins.html#builtins-isString"><code>builtins.isString</code></a> can be used to determine if a value is a string.</p>
<h3 id="type-path"><a class="header" href="#type-path">Path</a></h3>
<p>A <em>path</em> in the Nix language is an immutable, finite-length sequence of bytes starting with <code>/</code>, representing a POSIX-style, canonical file system path.
Path values are distinct from string values, even if they contain the same sequence of bytes.
Operations that produce paths will simplify the result as the standard C function <a href="https://pubs.opengroup.org/onlinepubs/9699919799/functions/realpath.html"><code>realpath</code></a> would, except that there is no symbolic link resolution.</p>
<p>Paths are suitable for referring to local files, and are often preferable over strings.</p>
<ul>
<li>Path values do not contain trailing or duplicate slashes, <code>.</code>, or <code>..</code>.</li>
<li>Relative path literals are automatically resolved relative to their <a href="language/../glossary.html#gloss-base-directory">base directory</a>.</li>
<li>Tooling can recognize path literals and provide additional features, such as autocompletion, refactoring automation and jump-to-file.</li>
</ul>
<p>A file is not required to exist at a given path in order for that path value to be valid, but a path that is converted to a string with <a href="language/string-interpolation.html#interpolated-expression">string interpolation</a> or <a href="language/operators.html#string-and-path-concatenation">string-and-path concatenation</a> must resolve to a readable file or directory which will be copied into the Nix store.
For instance, evaluating <code>"${./foo.txt}"</code> will cause <code>foo.txt</code> from the same directory to be copied into the Nix store and result in the string <code>"/nix/store/&lt;hash&gt;-foo.txt"</code>.
Operations such as <a href="language/builtins.html#builtins-import"><code>import</code></a> can also expect a path to resolve to a readable file or directory.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>The Nix language assumes that all input files will remain <em>unchanged</em> while evaluating a Nix expression.
For example, assume you used a file path in an interpolated string during a <code>nix repl</code> session.
Later in the same session, after having changed the file contents, evaluating the interpolated string with the file path again might not return a new <a href="language/../store/store-path.html">store path</a>, since Nix might not re-read the file contents.
Use <code>:r</code> to reset the repl as needed.</p>
</blockquote>
<p>Path values can be expressed as <a href="language/syntax.html#path-literal">path literals</a>.
The function <a href="language/builtins.html#builtins-isPath"><code>builtins.isPath</code></a> can be used to determine if a value is a path.</p>
<h3 id="type-null"><a class="header" href="#type-null">Null</a></h3>
<p>There is a single value of type <em>null</em> in the Nix language.</p>
<!-- TODO: mention the top-level environment -->
<p>This value is available as an attribute on the <a href="language/builtins.html#builtins-builtins"><code>builtins</code></a> attribute set as <a href="language/builtins.html#builtins-null"><code>builtins.null</code></a>.</p>
<h2 id="compound-values"><a class="header" href="#compound-values">Compound values</a></h2>
<h3 id="type-attrs"><a class="header" href="#type-attrs">Attribute set</a></h3>
<!-- TODO(@rhendric, #10970): fill this out -->
<p>An attribute set can be constructed with an <a href="language/syntax.html#attrs-literal">attribute set literal</a>.
The function <a href="language/builtins.html#builtins-isAttrs"><code>builtins.isAttrs</code></a> can be used to determine if a value is an attribute set.</p>
<h3 id="type-list"><a class="header" href="#type-list">List</a></h3>
<!-- TODO(@rhendric, #10970): fill this out -->
<p>A list can be constructed with a <a href="language/syntax.html#list-literal">list literal</a>.
The function <a href="language/builtins.html#builtins-isList"><code>builtins.isList</code></a> can be used to determine if a value is a list.</p>
<h2 id="type-function"><a class="header" href="#type-function">Function</a></h2>
<!-- TODO(@rhendric, #10970): fill this out -->
<p>A function can be constructed with a <a href="language/syntax.html#functions">function expression</a>.
The function <a href="language/builtins.html#builtins-isFunction"><code>builtins.isFunction</code></a> can be used to determine if a value is a function.</p>
<h2 id="type-external"><a class="header" href="#type-external">External</a></h2>
<p>An <em>external</em> value is an opaque value created by a Nix <a href="language/../command-ref/conf-file.html#conf-plugin-files">plugin</a>.
Such a value can be substituted in Nix expressions but only created and used by plugin code.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="string-context"><a class="header" href="#string-context">String context</a></h1>
<blockquote>
<p><strong>Note</strong></p>
<p>This is an advanced topic.
The Nix language is designed to be used without the programmer consciously dealing with string contexts or even knowing what they are.</p>
</blockquote>
<p>A string in the Nix language is not just a sequence of characters like strings in other languages.
It is actually a pair of a sequence of characters and a <em>string context</em>.
The string context is an (unordered) set of <em>string context elements</em>.</p>
<p>The purpose of string contexts is to collect non-string values attached to strings via
<a href="language/./operators.html#string-concatenation">string concatenation</a>,
<a href="language/./string-interpolation.html">string interpolation</a>,
and similar operations.
The idea is that a user can combine together values to create a build instructions for derivations without manually keeping track of where they come from.
Then the Nix language implicitly does that bookkeeping to efficiently obtain the closure of derivation inputs.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>String contexts are <em>not</em> explicitly manipulated in idiomatic Nix language code.</p>
</blockquote>
<p>String context elements come in different forms:</p>
<ul>
<li>
<p><a href="language/string-context.html#string-context-element-derived-path" id="string-context-element-derived-path">deriving path</a></p>
<p>A string context element of this type is a <a href="language/../glossary.html#gloss-deriving-path">deriving path</a>.
They can be either of type <a href="language/string-context.html#string-context-constant">constant</a> or <a href="language/string-context.html#string-context-output">output</a>, which correspond to the types of deriving paths.</p>
<ul>
<li>
<p><a href="language/string-context.html#string-context-constant" id="string-context-constant">Constant string context elements</a></p>
<blockquote>
<p><strong>Example</strong></p>
<p><a href="language/./builtins.html#builtins-storePath"><code>builtins.storePath</code></a> creates a string with a single constant string context element:</p>
<pre><code class="language-nix">builtins.getContext (builtins.storePath "/nix/store/wkhdf9jinag5750mqlax6z2zbwhqb76n-hello-2.10")
</code></pre>
<p>evaluates to</p>
<pre><code class="language-nix">{
  "/nix/store/wkhdf9jinag5750mqlax6z2zbwhqb76n-hello-2.10" = {
    path = true;
  };
}
</code></pre>
</blockquote>
</li>
<li>
<p><a href="language/string-context.html#string-context-output" id="string-context-output">Output string context elements</a></p>
<blockquote>
<p><strong>Example</strong></p>
<p>The behavior of string contexts are best demonstrated with a built-in function that is still experimental: <a href="language/./builtins.html#builtins-outputOf"><code>builtins.outputOf</code></a>.
This example will <em>not</em> work with stable Nix!</p>
<pre><code class="language-nix">builtins.getContext
  (builtins.outputOf
    (builtins.storePath "/nix/store/fvchh9cvcr7kdla6n860hshchsba305w-hello-2.12.drv")
    "out")
</code></pre>
<p>evaluates to</p>
<pre><code class="language-nix">{
  "/nix/store/fvchh9cvcr7kdla6n860hshchsba305w-hello-2.12.drv" = {
    outputs = [ "out" ];
  };
}
</code></pre>
</blockquote>
</li>
</ul>
</li>
<li>
<p><a href="language/string-context.html#string-context-element-derivation-deep" id="string-context-element-derivation-deep"><em>derivation deep</em></a></p>
<p><em>derivation deep</em> is an advanced feature intended to be used with the
<a href="language/./advanced-attributes.html#adv-attr-exportReferencesGraph"><code>exportReferencesGraph</code> derivation attribute</a>.
A <em>derivation deep</em> string context element is a derivation path, and refers to both its outputs and the entire build closure of that derivation:
all its outputs, all the other derivations the given derivation depends on, and all the outputs of those.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>The best way to illustrate <em>derivation deep</em> string contexts is with <a href="language/./builtins.html#builtins-addDrvOutputDependencies"><code>builtins.addDrvOutputDependencies</code></a>.
Take a regular constant string context element pointing to a derivation, and transform it into a "Derivation deep" string context element.</p>
<pre><code class="language-nix">builtins.getContext
  (builtins.addDrvOutputDependencies
    (builtins.storePath "/nix/store/fvchh9cvcr7kdla6n860hshchsba305w-hello-2.12.drv"))
</code></pre>
<p>evaluates to</p>
<pre><code class="language-nix">{
  "/nix/store/fvchh9cvcr7kdla6n860hshchsba305w-hello-2.12.drv" = {
    allOutputs = true;
  };
}
</code></pre>
</blockquote>
</li>
</ul>
<h2 id="inspecting-string-contexts"><a class="header" href="#inspecting-string-contexts">Inspecting string contexts</a></h2>
<p>Most basically, <a href="language/./builtins.html#builtins-hasContext"><code>builtins.hasContext</code></a> will tell whether a string has a non-empty context.</p>
<p>When more granular information is needed, <a href="language/./builtins.html#builtins-getContext"><code>builtins.getContext</code></a> can be used.
It creates an <a href="language/./types.html#attribute-set">attribute set</a> representing the string context, which can be inspected as usual.</p>
<h2 id="clearing-string-contexts"><a class="header" href="#clearing-string-contexts">Clearing string contexts</a></h2>
<p><a href="language/./builtins.html#builtins-unsafeDiscardStringContext"><code>builtins.unsafeDiscardStringContext</code></a> will make a copy of a string, but with an empty string context.
The returned string can be used in more ways, e.g. by operators that require the string context to be empty.
The requirement to explicitly discard the string context in such use cases helps ensure that string context elements are not lost by mistake.
The "unsafe" marker is only there to remind that Nix normally guarantees that dependencies are tracked, whereas the returned string has lost them.</p>
<h2 id="constructing-string-contexts"><a class="header" href="#constructing-string-contexts">Constructing string contexts</a></h2>
<p><a href="language/./builtins.html#builtins-appendContext"><code>builtins.appendContext</code></a> will create a copy of a string, but with additional string context elements.
The context is specified explicitly by an <a href="language/./types.html#attribute-set">attribute set</a> in the format that <a href="language/./builtins.html#builtins-hasContext"><code>builtins.hasContext</code></a> produces.
A string with arbitrary contexts can be made like this:</p>
<ol>
<li>Create a string with the desired string context elements.
(The contents of the string do not matter.)</li>
<li>Dump its context with <a href="language/./builtins.html#builtins-getContext"><code>builtins.getContext</code></a>.</li>
<li>Combine it with a base string and repeated <a href="language/./builtins.html#builtins-appendContext"><code>builtins.appendContext</code></a> calls.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="language-constructs"><a class="header" href="#language-constructs">Language Constructs</a></h1>
<p>This section covers syntax and semantics of the Nix language.</p>
<h2 id="basic-literals"><a class="header" href="#basic-literals">Basic Literals</a></h2>
<h3 id="string-literal"><a class="header" href="#string-literal">String</a></h3>
<p>See <a href="language/string-literals.html">String literals</a>.</p>
<h3 id="number-literal"><a class="header" href="#number-literal">Number</a></h3>
<!-- TODO(@rhendric, #10970): split this into int and float -->
<p>Numbers, which can be <em>integers</em> (like <code>123</code>) or <em>floating point</em>
(like <code>123.43</code> or <code>.27e13</code>).</p>
<p>Integers in the Nix language are 64-bit <a href="https://en.wikipedia.org/wiki/Two%27s_complement">two's complement</a> signed integers, with a range of -9223372036854775808 to 9223372036854775807, inclusive.</p>
<p>Note that negative numeric literals are actually parsed as unary negation of positive numeric literals.
This means that the minimum integer <code>-9223372036854775808</code> cannot be written as-is as a literal, since the positive number <code>9223372036854775808</code> is one past the maximum range.</p>
<p>See <a href="language/./operators.html#arithmetic">arithmetic</a> and <a href="language/./operators.html#comparison">comparison</a> operators for semantics.</p>
<h3 id="path-literal"><a class="header" href="#path-literal">Path</a></h3>
<p><em>Paths</em> can be expressed by path literals such as <code>./builder.sh</code>.</p>
<p>A path literal must contain at least one slash to be recognised as such.
For instance, <code>builder.sh</code> is not a path:
it's parsed as an expression that selects the attribute <code>sh</code> from the variable <code>builder</code>.</p>
<p>Path literals are resolved relative to their <a href="language/../glossary.html#gloss-base-directory">base directory</a>.
Path literals may also refer to absolute paths by starting with a slash.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>Absolute paths make expressions less portable.
In the case where a function translates a path literal into an absolute path string for a configuration file, it is recommended to write a string literal instead.
This avoids some confusion about whether files at that location will be used during evaluation.
It also avoids unintentional situations where some function might try to copy everything at the location into the store.</p>
</blockquote>
<p>If the first component of a path is a <code>~</code>, it is interpreted such that the rest of the path were relative to the user's home directory.
For example, <code>~/foo</code> would be equivalent to <code>/home/edolstra/foo</code> for a user whose home directory is <code>/home/edolstra</code>.
Path literals that start with <code>~</code> are not allowed in <a href="language/../command-ref/conf-file.html#conf-pure-eval">pure</a> evaluation.</p>
<p>Path literals can also include [string interpolation], besides being <a href="language/./string-interpolation.html#interpolated-expressions">interpolated into other expressions</a>.</p>
<p>At least one slash (<code>/</code>) must appear <em>before</em> any interpolated expression for the result to be recognized as a path.</p>
<p><code>a.${foo}/b.${bar}</code> is a syntactically valid number division operation.
<code>./a.${foo}/b.${bar}</code> is a path.</p>
<p><a href="language/./constructs/lookup-path.html">Lookup path</a> literals such as <code>&lt;nixpkgs&gt;</code> also resolve to path values.</p>
<h2 id="list-literal"><a class="header" href="#list-literal">List</a></h2>
<p>Lists are formed by enclosing a whitespace-separated list of values
between square brackets. For example,</p>
<pre><code class="language-nix">[ 123 ./foo.nix "abc" (f { x = y; }) ]
</code></pre>
<p>defines a list of four elements, the last being the result of a call to
the function <code>f</code>. Note that function calls have to be enclosed in
parentheses. If they had been omitted, e.g.,</p>
<pre><code class="language-nix">[ 123 ./foo.nix "abc" f { x = y; } ]
</code></pre>
<p>the result would be a list of five elements, the fourth one being a
function and the fifth being a set.</p>
<p>Note that lists are only lazy in values, and they are strict in length.</p>
<p>Elements in a list can be accessed using <a href="language/./builtins.html#builtins-elemAt"><code>builtins.elemAt</code></a>.</p>
<h2 id="attrs-literal"><a class="header" href="#attrs-literal">Attribute Set</a></h2>
<p>An attribute set is a collection of name-value-pairs called <em>attributes</em>.</p>
<p>Attribute sets are written enclosed in curly brackets (<code>{ }</code>).
Attribute names and attribute values are separated by an equal sign (<code>=</code>).
Each value can be an arbitrary expression, terminated by a semicolon (<code>;</code>)</p>
<p>An attribute name is a string without context, and is denoted by a <a href="language/./identifiers.html#names">name</a> (an <a href="language/./identifiers.html#identifiers">identifier</a> or <a href="language/string-literals.html">string literal</a>).</p>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>attrset</em> → <code>{</code> { <em>name</em> <code>=</code> <em>expr</em> <code>;</code> } <code>}</code></p>
</blockquote>
<p>Attributes can appear in any order.
An attribute name may only occur once in each attribute set.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>This defines an attribute set with attributes named:</p>
<ul>
<li><code>x</code> with the value <code>123</code>, an integer</li>
<li><code>text</code> with the value <code>"Hello"</code>, a string</li>
<li><code>y</code> where the value is the result of applying the function <code>f</code> to the attribute set <code>{ bla = 456; }</code></li>
</ul>
<pre><code class="language-nix">{
  x = 123;
  text = "Hello";
  y = f { bla = 456; };
}
</code></pre>
</blockquote>
<p>Attributes in nested attribute sets can be written using <em>attribute paths</em>.</p>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>attrset</em> → <code>{</code> { <em>attrpath</em> <code>=</code> <em>expr</em> <code>;</code> } <code>}</code></p>
</blockquote>
<p>An attribute path is a dot-separated list of <a href="language/./identifiers.html#names">names</a>.</p>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>attrpath</em> = <em>name</em> { <code>.</code> <em>name</em> }</p>
</blockquote>
<!-- -->
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">{ a.b.c = 1; a.b.d = 2; }
</code></pre>
<pre><code>{
  a = {
    b = {
      c = 1;
      d = 2;
    };
  };
}
</code></pre>
</blockquote>
<p>Attribute names can also be set implicitly by using the <a href="language/syntax.html#inheriting-attributes"><code>inherit</code> keyword</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">{ inherit (builtins) true; }
</code></pre>
<pre><code>{ true = true; }
</code></pre>
</blockquote>
<p>Attributes can be accessed with the <a href="language/./operators.html#attribute-selection"><code>.</code> operator</a>.</p>
<p>Example:</p>
<pre><code class="language-nix">{ a = "Foo"; b = "Bar"; }.a
</code></pre>
<p>This evaluates to <code>"Foo"</code>.</p>
<p>It is possible to provide a default value in an attribute selection using the <code>or</code> keyword.</p>
<p>Example:</p>
<pre><code class="language-nix">{ a = "Foo"; b = "Bar"; }.c or "Xyzzy"
</code></pre>
<pre><code class="language-nix">{ a = "Foo"; b = "Bar"; }.c.d.e.f.g or "Xyzzy"
</code></pre>
<p>will both evaluate to <code>"Xyzzy"</code> because there is no <code>c</code> attribute in the set.</p>
<p>You can use arbitrary double-quoted strings as attribute names:</p>
<pre><code class="language-nix">{ "$!@#?" = 123; }."$!@#?"
</code></pre>
<pre><code class="language-nix">let bar = "bar"; in
{ "foo ${bar}" = 123; }."foo ${bar}"
</code></pre>
<p>Both will evaluate to <code>123</code>.</p>
<p>Attribute names support [string interpolation]:</p>
<pre><code class="language-nix">let bar = "foo"; in
{ foo = 123; }.${bar}
</code></pre>
<pre><code class="language-nix">let bar = "foo"; in
{ ${bar} = 123; }.foo
</code></pre>
<p>Both will evaluate to <code>123</code>.</p>
<p>In the special case where an attribute name inside of a set declaration
evaluates to <code>null</code> (which is normally an error, as <code>null</code> cannot be coerced to
a string), that attribute is simply not added to the set:</p>
<pre><code class="language-nix">{ ${if foo then "bar" else null} = true; }
</code></pre>
<p>This will evaluate to <code>{}</code> if <code>foo</code> evaluates to <code>false</code>.</p>
<p>A set that has a <a href="language/syntax.html#attr-__functor" id="attr-__functor"><code>__functor</code></a> attribute whose value is callable (i.e. is
itself a function or a set with a <code>__functor</code> attribute whose value is
callable) can be applied as if it were a function, with the set itself
passed in first , e.g.,</p>
<pre><code class="language-nix">let add = { __functor = self: x: x + self.x; };
    inc = add // { x = 1; };
in inc 1
</code></pre>
<p>evaluates to <code>2</code>. This can be used to attach metadata to a function
without the caller needing to treat it specially, or to implement a form
of object-oriented programming, for example.</p>
<h2 id="recursive-sets"><a class="header" href="#recursive-sets">Recursive sets</a></h2>
<p>Recursive sets are like normal <a href="language/./types.html#attribute-set">attribute sets</a>, but the attributes can refer to each other.</p>
<blockquote>
<p><em>rec-attrset</em> = <code>rec {</code> [ <em>name</em> <code>=</code> <em>expr</em> <code>;</code> <code>]</code>... <code>}</code></p>
</blockquote>
<p>Example:</p>
<pre><code class="language-nix">rec {
  x = y;
  y = 123;
}.x
</code></pre>
<p>This evaluates to <code>123</code>.</p>
<p>Note that without <code>rec</code> the binding <code>x = y;</code> would
refer to the variable <code>y</code> in the surrounding scope, if one exists, and
would be invalid if no such variable exists. That is, in a normal
(non-recursive) set, attributes are not added to the lexical scope; in a
recursive set, they are.</p>
<p>Recursive sets of course introduce the danger of infinite recursion. For
example, the expression</p>
<pre><code class="language-nix">rec {
  x = y;
  y = x;
}.x
</code></pre>
<p>will crash with an <code>infinite recursion encountered</code> error message.</p>
<h2 id="let-expressions"><a class="header" href="#let-expressions">Let-expressions</a></h2>
<p>A let-expression allows you to define local variables for an expression.</p>
<blockquote>
<p><em>let-in</em> = <code>let</code> [ <em>identifier</em> = <em>expr</em> ]... <code>in</code> <em>expr</em></p>
</blockquote>
<p>Example:</p>
<pre><code class="language-nix">let
  x = "foo";
  y = "bar";
in x + y
</code></pre>
<p>This evaluates to <code>"foobar"</code>.</p>
<h2 id="inheriting-attributes"><a class="header" href="#inheriting-attributes">Inheriting attributes</a></h2>
<p>When defining an <a href="language/./types.html#attribute-set">attribute set</a> or in a <a href="language/syntax.html#let-expressions">let-expression</a> it is often convenient to copy variables from the surrounding lexical scope (e.g., when you want to propagate attributes).
This can be shortened using the <code>inherit</code> keyword.</p>
<p>Example:</p>
<pre><code class="language-nix">let x = 123; in
{
  inherit x;
  y = 456;
}
</code></pre>
<p>is equivalent to</p>
<pre><code class="language-nix">let x = 123; in
{
  x = x;
  y = 456;
}
</code></pre>
<p>and both evaluate to <code>{ x = 123; y = 456; }</code>.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>This works because <code>x</code> is added to the lexical scope by the <code>let</code> construct.</p>
</blockquote>
<p>It is also possible to inherit attributes from another attribute set.</p>
<p>Example:</p>
<p>In this fragment from <code>all-packages.nix</code>,</p>
<pre><code class="language-nix">graphviz = (import ../tools/graphics/graphviz) {
  inherit fetchurl stdenv libpng libjpeg expat x11 yacc;
  inherit (xorg) libXaw;
};

xorg = {
  libX11 = ...;
  libXaw = ...;
  ...
}

libpng = ...;
libjpg = ...;
...
</code></pre>
<p>the set used in the function call to the function defined in
<code>../tools/graphics/graphviz</code> inherits a number of variables from the
surrounding scope (<code>fetchurl</code> ... <code>yacc</code>), but also inherits <code>libXaw</code>
(the X Athena Widgets) from the <code>xorg</code> set.</p>
<p>Summarizing the fragment</p>
<pre><code class="language-nix">...
inherit x y z;
inherit (src-set) a b c;
...
</code></pre>
<p>is equivalent to</p>
<pre><code class="language-nix">...
x = x; y = y; z = z;
a = src-set.a; b = src-set.b; c = src-set.c;
...
</code></pre>
<p>when used while defining local variables in a let-expression or while
defining a set.</p>
<p>In a <code>let</code> expression, <code>inherit</code> can be used to selectively bring specific attributes of a set into scope. For example</p>
<pre><code class="language-nix">let
  x = { a = 1; b = 2; };
  inherit (builtins) attrNames;
in
{
  names = attrNames x;
}
</code></pre>
<p>is equivalent to</p>
<pre><code class="language-nix">let
  x = { a = 1; b = 2; };
in
{
  names = builtins.attrNames x;
}
</code></pre>
<p>both evaluate to <code>{ names = [ "a" "b" ]; }</code>.</p>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<p>Functions have the following form:</p>
<pre><code class="language-nix">pattern: body
</code></pre>
<p>The pattern specifies what the argument of the function must look like,
and binds variables in the body to (parts of) the argument. There are
three kinds of patterns:</p>
<ul>
<li>
<p>If a pattern is a single identifier, then the function matches any
argument. Example:</p>
<pre><code class="language-nix">let negate = x: !x;
    concat = x: y: x + y;
in if negate true then concat "foo" "bar" else ""
</code></pre>
<p>Note that <code>concat</code> is a function that takes one argument and returns
a function that takes another argument. This allows partial
parameterisation (i.e., only filling some of the arguments of a
function); e.g.,</p>
<pre><code class="language-nix">map (concat "foo") [ "bar" "bla" "abc" ]
</code></pre>
<p>evaluates to <code>[ "foobar" "foobla" "fooabc" ]</code>.</p>
</li>
<li>
<p>A <em>set pattern</em> of the form <code>{ name1, name2, …, nameN }</code> matches a
set containing the listed attributes, and binds the values of those
attributes to variables in the function body. For example, the
function</p>
<pre><code class="language-nix">{ x, y, z }: z + y + x
</code></pre>
<p>can only be called with a set containing exactly the attributes <code>x</code>,
<code>y</code> and <code>z</code>. No other attributes are allowed. If you want to allow
additional arguments, you can use an ellipsis (<code>...</code>):</p>
<pre><code class="language-nix">{ x, y, z, ... }: z + y + x
</code></pre>
<p>This works on any set that contains at least the three named
attributes.</p>
</li>
<li>
<p>It is possible to provide <em>default values</em> for attributes, in
which case they are allowed to be missing. A default value is
specified by writing <code>name ?  e</code>, where <em>e</em> is an arbitrary
expression. For example,</p>
<pre><code class="language-nix">{ x, y ? "foo", z ? "bar" }: z + y + x
</code></pre>
<p>specifies a function that only requires an attribute named <code>x</code>, but
optionally accepts <code>y</code> and <code>z</code>.</p>
</li>
<li>
<p>An <code>@</code>-pattern provides a means of referring to the whole value
being matched:</p>
<pre><code class="language-nix">args@{ x, y, z, ... }: z + y + x + args.a
</code></pre>
<p>but can also be written as:</p>
<pre><code class="language-nix">{ x, y, z, ... } @ args: z + y + x + args.a
</code></pre>
<p>Here <code>args</code> is bound to the argument <em>as passed</em>, which is further
matched against the pattern <code>{ x, y, z, ... }</code>.
The <code>@</code>-pattern makes mainly sense with an ellipsis(<code>...</code>) as
you can access attribute names as <code>a</code>, using <code>args.a</code>, which was
given as an additional attribute to the function.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p><code>args@</code> binds the name <code>args</code> to the attribute set that is passed to the function.
In particular, <code>args</code> does <em>not</em> include any default values specified with <code>?</code> in the function's set pattern.</p>
<p>For instance</p>
<pre><code class="language-nix">let
  f = args@{ a ? 23, ... }: [ a args ];
in
  f {}
</code></pre>
<p>is equivalent to</p>
<pre><code class="language-nix">let
  f = args @ { ... }: [ (args.a or 23) args ];
in
  f {}
</code></pre>
<p>and both expressions will evaluate to:</p>
<pre><code class="language-nix">[ 23 {} ]
</code></pre>
</blockquote>
</li>
<li>
<p>All bindings introduced by the function are in scope in the entire function expression; not just in the body.
It can therefore be used in default values.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>A parameter (<code>x</code>), is used in the default value for another parameter (<code>y</code>):</p>
<pre><code class="language-nix">let
  f = { x, y ? [x] }: { inherit y; };
in
  f { x = 3; }
</code></pre>
<p>This evaluates to:</p>
<pre><code class="language-nix">{
  y = [ 3 ];
}
</code></pre>
</blockquote>
<blockquote>
<p><strong>Example</strong></p>
<p>The binding of an <code>@</code> pattern, <code>args</code>, is used in the default value for a parameter, <code>x</code>:</p>
<pre><code class="language-nix">let
  f = args@{ x ? args.a, ... }: x;
in
  f { a = 1; }
</code></pre>
<p>This evaluates to:</p>
<pre><code class="language-nix">1
</code></pre>
</blockquote>
</li>
</ul>
<p>Note that functions do not have names. If you want to give them a name,
you can bind them to an attribute, e.g.,</p>
<pre><code class="language-nix">let concat = { x, y }: x + y;
in concat { x = "foo"; y = "bar"; }
</code></pre>
<h2 id="conditionals"><a class="header" href="#conditionals">Conditionals</a></h2>
<p>Conditionals look like this:</p>
<pre><code class="language-nix">if e1 then e2 else e3
</code></pre>
<p>where <em>e1</em> is an expression that should evaluate to a Boolean value
(<code>true</code> or <code>false</code>).</p>
<h2 id="assertions"><a class="header" href="#assertions">Assertions</a></h2>
<p>Assertions are generally used to check that certain requirements on or
between features and dependencies hold. They look like this:</p>
<pre><code class="language-nix">assert e1; e2
</code></pre>
<p>where <em>e1</em> is an expression that should evaluate to a Boolean value. If
it evaluates to <code>true</code>, <em>e2</em> is returned; otherwise expression
evaluation is aborted and a backtrace is printed.</p>
<p>Here is a Nix expression for the Subversion package that shows how
assertions can be used:.</p>
<pre><code class="language-nix">{ localServer ? false
, httpServer ? false
, sslSupport ? false
, pythonBindings ? false
, javaSwigBindings ? false
, javahlBindings ? false
, stdenv, fetchurl
, openssl ? null, httpd ? null, db4 ? null, expat, swig ? null, j2sdk ? null
}:

assert localServer -&gt; db4 != null; ①
assert httpServer -&gt; httpd != null &amp;&amp; httpd.expat == expat; ②
assert sslSupport -&gt; openssl != null &amp;&amp; (httpServer -&gt; httpd.openssl == openssl); ③
assert pythonBindings -&gt; swig != null &amp;&amp; swig.pythonSupport;
assert javaSwigBindings -&gt; swig != null &amp;&amp; swig.javaSupport;
assert javahlBindings -&gt; j2sdk != null;

stdenv.mkDerivation {
  name = "subversion-1.1.1";
  ...
  openssl = if sslSupport then openssl else null; ④
  ...
}
</code></pre>
<p>The points of interest are:</p>
<ol>
<li>
<p>This assertion states that if Subversion is to have support for
local repositories, then Berkeley DB is needed. So if the Subversion
function is called with the <code>localServer</code> argument set to <code>true</code> but
the <code>db4</code> argument set to <code>null</code>, then the evaluation fails.</p>
<p>Note that <code>-&gt;</code> is the <a href="https://en.wikipedia.org/wiki/Truth_table#Logical_implication">logical
implication</a>
Boolean operation.</p>
</li>
<li>
<p>This is a more subtle condition: if Subversion is built with Apache
(<code>httpServer</code>) support, then the Expat library (an XML library) used
by Subversion should be same as the one used by Apache. This is
because in this configuration Subversion code ends up being linked
with Apache code, and if the Expat libraries do not match, a build-
or runtime link error or incompatibility might occur.</p>
</li>
<li>
<p>This assertion says that in order for Subversion to have SSL support
(so that it can access <code>https</code> URLs), an OpenSSL library must be
passed. Additionally, it says that <em>if</em> Apache support is enabled,
then Apache's OpenSSL should match Subversion's. (Note that if
Apache support is not enabled, we don't care about Apache's
OpenSSL.)</p>
</li>
<li>
<p>The conditional here is not really related to assertions, but is
worth pointing out: it ensures that if SSL support is disabled, then
the Subversion derivation is not dependent on OpenSSL, even if a
non-<code>null</code> value was passed. This prevents an unnecessary rebuild of
Subversion if OpenSSL changes.</p>
</li>
</ol>
<h2 id="with-expressions"><a class="header" href="#with-expressions">With-expressions</a></h2>
<p>A <em>with-expression</em>,</p>
<pre><code class="language-nix">with e1; e2
</code></pre>
<p>introduces the set <em>e1</em> into the lexical scope of the expression <em>e2</em>.
For instance,</p>
<pre><code class="language-nix">let as = { x = "foo"; y = "bar"; };
in with as; x + y
</code></pre>
<p>evaluates to <code>"foobar"</code> since the <code>with</code> adds the <code>x</code> and <code>y</code> attributes
of <code>as</code> to the lexical scope in the expression <code>x + y</code>. The most common
use of <code>with</code> is in conjunction with the <code>import</code> function. E.g.,</p>
<pre><code class="language-nix">with (import ./definitions.nix); ...
</code></pre>
<p>makes all attributes defined in the file <code>definitions.nix</code> available as
if they were defined locally in a <code>let</code>-expression.</p>
<p>The bindings introduced by <code>with</code> do not shadow bindings introduced by
other means, e.g.</p>
<pre><code class="language-nix">let a = 3; in with { a = 1; }; let a = 4; in with { a = 2; }; ...
</code></pre>
<p>establishes the same scope as</p>
<pre><code class="language-nix">let a = 1; in let a = 2; in let a = 3; in let a = 4; in ...
</code></pre>
<p>Variables coming from outer <code>with</code> expressions <em>are</em> shadowed:</p>
<pre><code class="language-nix">with { a = "outer"; };
with { a = "inner"; };
a
</code></pre>
<p>Does evaluate to <code>"inner"</code>.</p>
<h2 id="comments"><a class="header" href="#comments">Comments</a></h2>
<ul>
<li>
<p>Inline comments start with <code>#</code> and run until the end of the line.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix"># A number
2 # Equals 1 + 1
</code></pre>
<pre><code class="language-console">2
</code></pre>
</blockquote>
</li>
<li>
<p>Block comments start with <code>/*</code> and run until the next occurrence of <code>*/</code>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">/*
Block comments
can span multiple lines.
*/ "hello"
</code></pre>
<pre><code class="language-console">"hello"
</code></pre>
</blockquote>
<p>This means that block comments cannot be nested.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">/* /* nope */ */ 1
</code></pre>
<pre><code class="language-console">error: syntax error, unexpected '*'

       at «string»:1:15:

            1| /* /* nope */ *
             |               ^
</code></pre>
</blockquote>
<p>Consider escaping nested comments and unescaping them in post-processing.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">/* /* nested *\/ */ 1
</code></pre>
<pre><code class="language-console">1
</code></pre>
</blockquote>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="variables"><a class="header" href="#variables">Variables</a></h1>
<p>A <em>variable</em> is an <a href="language/identifiers.html">identifier</a> used as an expression.</p>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>expression</em> → <em>identifier</em></p>
</blockquote>
<p>A variable must have the same name as a definition in the <a href="language/./scope.html">scope</a> that encloses it.
The value of a variable is the value of the corresponding expression in the enclosing scope.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="string-literals"><a class="header" href="#string-literals">String literals</a></h1>
<p>A <em>string literal</em> represents a <a href="language/types.html#type-string">string</a> value.</p>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>expression</em> → <em>string</em></p>
<p><em>string</em> → <code>"</code> ( <em>string_char</em>* <a href="language/./string-interpolation.html"><em>interpolation_element</em></a> )* <em>string_char</em>* <code>"</code></p>
<p><em>string</em> → <code>''</code> ( <em>indented_string_char</em>* <a href="language/./string-interpolation.html"><em>interpolation_element</em></a> )* <em>indented_string_char</em>* <code>''</code></p>
<p><em>string</em> → <em>uri</em></p>
<p><em>string_char</em> ~ <code>[^"$\\]|\$(?!\{)|\\.</code></p>
<p><em>indented_string_char</em> ~ <code>[^$']|\$\$|\$(?!\{)|''[$']|''\\.|'(?!')</code></p>
<p><em>uri</em> ~ <code>[A-Za-z][+\-.0-9A-Za-z]*:[!$%&amp;'*+,\-./0-9:=?@A-Z_a-z~]+</code></p>
</blockquote>
<p>Strings can be written in three ways.</p>
<p>The most common way is to enclose the string between double quotes, e.g., <code>"foo bar"</code>.
Strings can span multiple lines.
The results of other expressions can be included into a string by enclosing them in <code>${ }</code>, a feature known as <a href="language/./string-interpolation.html">string interpolation</a>.</p>
<p>The following must be escaped to represent them within a string, by prefixing with a backslash (<code>\</code>):</p>
<ul>
<li>Double quote (<code>"</code>)</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">"\""
</code></pre>
<pre><code>"\""
</code></pre>
</blockquote>
<ul>
<li>Backslash (<code>\</code>)</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">"\\"
</code></pre>
<pre><code>"\\"
</code></pre>
</blockquote>
<ul>
<li>Dollar sign followed by an opening curly bracket (<code>${</code>) – "dollar-curly"</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">"\${"
</code></pre>
<pre><code>"\${"
</code></pre>
</blockquote>
<p>The newline, carriage return, and tab characters can be written as <code>\n</code>, <code>\r</code> and <code>\t</code>, respectively.</p>
<p>A "double-dollar-curly" (<code>$${</code>) can be written literally.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">"$${"
</code></pre>
<pre><code>"$\${"
</code></pre>
</blockquote>
<p>String values are output on the terminal with Nix-specific escaping.
Strings written to files will contain the characters encoded by the escaping.</p>
<p>The second way to write string literals is as an <em>indented string</em>, which is enclosed between pairs of <em>double single-quotes</em> (<code>''</code>), like so:</p>
<pre><code class="language-nix">''
This is the first line.
This is the second line.
  This is the third line.
''
</code></pre>
<p>This kind of string literal intelligently strips indentation from
the start of each line. To be precise, it strips from each line a
number of spaces equal to the minimal indentation of the string as a
whole (disregarding the indentation of empty lines). For instance,
the first and second line are indented two spaces, while the third
line is indented four spaces. Thus, two spaces are stripped from
each line, so the resulting string is</p>
<pre><code class="language-nix">"This is the first line.\nThis is the second line.\n  This is the third line.\n"
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>Whitespace and newline following the opening <code>''</code> is ignored if there is no non-whitespace text on the initial line.</p>
</blockquote>
<blockquote>
<p><strong>Warning</strong></p>
<p>Prefixed tab characters are not stripped.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>The following indented string is prefixed with tabs:</p>
<pre><code class="nohighlight">''
	all:
		@echo hello
''
</code></pre>
<pre><code>"\tall:\n\t\t@echo hello\n"
</code></pre>
</blockquote>
</blockquote>
<p>Indented strings support <a href="language/./string-interpolation.html">string interpolation</a>.</p>
<p>The following must be escaped to represent them in an indented string:</p>
<ul>
<li><code>$</code> is escaped by prefixing it with two single quotes (<code>''</code>)</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">''
  ''$
''
</code></pre>
<pre><code>"$\n"
</code></pre>
</blockquote>
<ul>
<li><code>''</code> is escaped by prefixing it with one single quote (<code>'</code>)</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">''
  '''
''
</code></pre>
<pre><code>"''\n"
</code></pre>
</blockquote>
<p>These special characters are escaped as follows:</p>
<ul>
<li>Linefeed (<code>\n</code>): <code>''\n</code></li>
<li>Carriage return (<code>\r</code>): <code>''\r</code></li>
<li>Tab (<code>\t</code>): <code>''\t</code></li>
</ul>
<p><code>''\</code> escapes any other character.</p>
<p>A "dollar-curly" (<code>${</code>) can be written as follows:</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">''
  echo ''${PATH}
''
</code></pre>
<pre><code>"echo ${PATH}\n"
</code></pre>
</blockquote>
<blockquote>
<p><strong>Note</strong></p>
<p>This differs from the syntax for escaping a dollar-curly within double quotes (<code>"\${"</code>). Be aware of which one is needed at a given moment.</p>
</blockquote>
<p>A "double-dollar-curly" (<code>$${</code>) can be written literally.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">''
  $${
''
</code></pre>
<pre><code>"$\${\n"
</code></pre>
</blockquote>
<p>Indented strings are primarily useful in that they allow multi-line
string literals to follow the indentation of the enclosing Nix
expression, and that less escaping is typically necessary for
strings representing languages such as shell scripts and
configuration files because <code>''</code> is much less common than <code>"</code>.
Example:</p>
<pre><code class="language-nix">stdenv.mkDerivation {
...
postInstall =
  ''
    mkdir $out/bin $out/etc
    cp foo $out/bin
    echo "Hello World" &gt; $out/etc/foo.conf
    ${if enableBar then "cp bar $out/bin" else ""}
  '';
...
}
</code></pre>
<p>Finally, as a convenience, <em>URIs</em> as defined in appendix B of
<a href="http://www.ietf.org/rfc/rfc2396.txt">RFC 2396</a> can be written <em>as
is</em>, without quotes. For instance, the string
<code>"http://example.org/foo.tar.bz2"</code> can also be written as
<code>http://example.org/foo.tar.bz2</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="identifiers"><a class="header" href="#identifiers">Identifiers</a></h1>
<p>An <em>identifier</em> is an <a href="https://en.wikipedia.org/wiki/ASCII">ASCII</a> character sequence that:</p>
<ul>
<li>Starts with a letter (<code>a-z</code>, <code>A-Z</code>) or underscore (<code>_</code>)</li>
<li>Can contain any number of:
<ul>
<li>Letters (<code>a-z</code>, <code>A-Z</code>)</li>
<li>Digits (<code>0-9</code>)</li>
<li>Underscores (<code>_</code>)</li>
<li>Apostrophes (<code>'</code>)</li>
<li>Hyphens (<code>-</code>)</li>
</ul>
</li>
<li>Is not one of the <a href="language/identifiers.html#keywords">keywords</a></li>
</ul>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>identifier</em> ~ <code>[A-Za-z_][A-Za-z0-9_'-]*</code></p>
</blockquote>
<h1 id="names"><a class="header" href="#names">Names</a></h1>
<p>A <em>name</em> can be written as an <a href="language/identifiers.html#identifier">identifier</a> or a <a href="language/./string-literals.html">string literal</a>.</p>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>name</em> → <em>identifier</em> | <em>string</em></p>
</blockquote>
<p>Names are used in <a href="language/./syntax.html#attrs-literal">attribute sets</a>, <a href="language/./syntax.html#let-expressions"><code>let</code> bindings</a>, and <a href="language/./syntax.html#inheriting-attributes"><code>inherit</code></a>.
Two names are the same if they represent the same sequence of characters, regardless of whether they are written as identifiers or strings.</p>
<h1 id="keywords"><a class="header" href="#keywords">Keywords</a></h1>
<p>These keywords are reserved and cannot be used as <a href="language/identifiers.html#identifiers">identifiers</a>:</p>
<ul>
<li><a href="language/./syntax.html#assertions"><code>assert</code></a></li>
<li><a href="language/./syntax.html#conditionals"><code>else</code></a></li>
<li><a href="language/./syntax.html#conditionals"><code>if</code></a></li>
<li><a href="language/./syntax.html#let-expressions"><code>in</code></a></li>
<li><a href="language/./syntax.html#inheriting-attributes"><code>inherit</code></a></li>
<li><a href="language/./syntax.html#let-expressions"><code>let</code></a></li>
<li><a href="language/./operators.html#attribute-selection"><code>or</code></a> (see note)</li>
<li><a href="language/./syntax.html#recursive-sets"><code>rec</code></a></li>
<li><a href="language/./syntax.html#conditionals"><code>then</code></a></li>
<li><a href="language/./syntax.html#with-expressions"><code>with</code></a></li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>The Nix language evaluator currently allows <code>or</code> to be used as a name in some contexts, for backwards compatibility reasons.
Users are advised not to rely on this.</p>
<p>There are long-standing issues with how <code>or</code> is parsed as a name, which can't be resolved without making a breaking change to the language.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scoping-rules"><a class="header" href="#scoping-rules">Scoping rules</a></h1>
<p>A <em>scope</em> in the Nix language is a dictionary keyed by <a href="language/./identifiers.html#names">name</a>, mapping each name to an expression and a <em>definition type</em>.
The definition type is either <em>explicit</em> or <em>implicit</em>.
Each entry in this dictionary is a <em>definition</em>.</p>
<p>Explicit definitions are created by the following expressions:</p>
<ul>
<li><a href="language/syntax.html#let-expressions">let-expressions</a></li>
<li><a href="language/syntax.html#recursive-sets">recursive attribute set literals</a> (<code>rec</code>)</li>
<li><a href="language/syntax.html#functions">function literals</a></li>
</ul>
<p>Implicit definitions are only created by <a href="language/./syntax.html#with-expressions">with-expressions</a>.</p>
<p>Every expression is <em>enclosed</em> by a scope.
The outermost expression is enclosed by the <a href="language/./builtins.html">built-in, global scope</a>, which contains only explicit definitions.
The expressions listed above <em>extend</em> their enclosing scope by adding new definitions, or replacing existing ones with the same name.
An explicit definition can replace a definition of any type; an implicit definition can only replace another implicit definition.</p>
<p>Each of the above expressions defines which of its subexpressions are enclosed by the extended scope.
In all other cases, the same scope that encloses an expression is the enclosing scope for its subexpressions.</p>
<p>The Nix language is <a href="https://en.wikipedia.org/wiki/Scope_(computer_science)#Lexical_scope">statically scoped</a>;
the value of a variable is determined only by the variable's enclosing scope, and not by the dynamic context in which the variable is evaluated.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>Expressions entered into the <a href="language/../command-ref/new-cli/nix3-repl.html">Nix REPL</a> are enclosed by a scope that can be extended by command line arguments or previous REPL commands.
These ways of extending scope are not, strictly speaking, part of the Nix language.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="string-interpolation"><a class="header" href="#string-interpolation">String interpolation</a></h1>
<p>String interpolation is a language feature where a <a href="language/./types.html#type-string">string</a>, <a href="language/./types.html#type-path">path</a>, or <a href="language/./types.html#attribute-set">attribute name</a> can contain expressions enclosed in <code>${ }</code> (dollar-sign with curly brackets).</p>
<p>Such a construct is called <em>interpolated string</em>, and the expression inside is an <a href="language/string-interpolation.html#interpolated-expression">interpolated expression</a>.</p>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>interpolation_element</em> → <code>${</code> <em>expression</em> <code>}</code></p>
</blockquote>
<h2 id="examples-1"><a class="header" href="#examples-1">Examples</a></h2>
<h3 id="string"><a class="header" href="#string">String</a></h3>
<p>Rather than writing</p>
<pre><code class="language-nix">"--with-freetype2-library=" + freetype + "/lib"
</code></pre>
<p>(where <code>freetype</code> is a <a href="language/../glossary.html#gloss-derivation-expression">derivation expression</a>), you can instead write</p>
<pre><code class="language-nix">"--with-freetype2-library=${freetype}/lib"
</code></pre>
<p>The latter is automatically translated to the former.</p>
<p>A more complicated example (from the Nix expression for <a href="http://www.trolltech.com/products/qt">Qt</a>):</p>
<pre><code class="language-nix">configureFlags = "
  -system-zlib -system-libpng -system-libjpeg
  ${if openglSupport then "-dlopen-opengl
    -L${mesa}/lib -I${mesa}/include
    -L${libXmu}/lib -I${libXmu}/include" else ""}
  ${if threadSupport then "-thread" else "-no-thread"}
";
</code></pre>
<p>Note that Nix expressions and strings can be arbitrarily nested;
in this case the outer string contains various interpolated expressions that themselves contain strings (e.g., <code>"-thread"</code>), some of which in turn contain interpolated expressions (e.g., <code>${mesa}</code>).</p>
<p>To write a literal <code>${</code> in an regular string, escape it with a backslash (<code>\</code>).</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">"echo \${PATH}"
</code></pre>
<pre><code>"echo ${PATH}"
</code></pre>
</blockquote>
<p>To write a literal <code>${</code> in an indented string, escape it with two single quotes (<code>''</code>).</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">''
  echo ''${PATH}
''
</code></pre>
<pre><code>"echo ${PATH}\n"
</code></pre>
</blockquote>
<p><code>$${</code> can be written literally in any string.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>In Make, <code>$</code> in file names or recipes is represented as <code>$$</code>, see <a href="https://www.gnu.org/software/make/manual/html_node/Reference.html#Basics-of-Variable-References">GNU <code>make</code>: Basics of Variable Reference</a>.
This can be expressed directly in the Nix language strings:</p>
<pre><code class="language-nix">''
  MAKEVAR = Hello
  all:
  	@export BASHVAR=world; echo $(MAKEVAR) $${BASHVAR}
''
</code></pre>
<pre><code>"MAKEVAR = Hello\nall:\n\t@export BASHVAR=world; echo $(MAKEVAR) $\${BASHVAR}\n"
</code></pre>
</blockquote>
<p>See the <a href="language/./types.html#type-string">documentation on strings</a> for details.</p>
<h3 id="path"><a class="header" href="#path">Path</a></h3>
<p>Rather than writing</p>
<pre><code class="language-nix">./. + "/" + foo + "-" + bar + ".nix"
</code></pre>
<p>or</p>
<pre><code class="language-nix">./. + "/${foo}-${bar}.nix"
</code></pre>
<p>you can instead write</p>
<pre><code class="language-nix">./${foo}-${bar}.nix
</code></pre>
<h3 id="attribute-name"><a class="header" href="#attribute-name">Attribute name</a></h3>
<!--
FIXME: these examples are redundant with the main page on attribute sets.
figure out what to do about that
-->
<p>Attribute names can be interpolated strings.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">let name = "foo"; in
{ ${name} = 123; }
</code></pre>
<pre><code>{ foo = 123; }
</code></pre>
</blockquote>
<p>Attributes can be selected with interpolated strings.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">let name = "foo"; in
{ foo = 123; }.${name}
</code></pre>
<pre><code>123
</code></pre>
</blockquote>
<h1 id="interpolated-expression"><a class="header" href="#interpolated-expression">Interpolated expression</a></h1>
<p>An expression that is interpolated must evaluate to one of the following:</p>
<ul>
<li>
<p>a <a href="language/./types.html#type-string">string</a></p>
</li>
<li>
<p>a <a href="language/./types.html#type-path">path</a></p>
</li>
<li>
<p>an <a href="language/./types.html#attribute-set">attribute set</a> that has a <code>__toString</code> attribute or an <code>outPath</code> attribute</p>
<ul>
<li><code>__toString</code> must be a function that takes the attribute set itself and returns a string</li>
<li><code>outPath</code> must be a string</li>
</ul>
<p>This includes <a href="language/./derivations.html">derivation expressions</a> or <a href="language/../command-ref/new-cli/nix3-flake.html#flake-inputs">flake inputs</a> (experimental).</p>
</li>
</ul>
<p>A string interpolates to itself.</p>
<p>A path in an interpolated expression is first copied into the Nix store, and the resulting string is the <a href="language/../store/store-path.html">store path</a> of the newly created <a href="language/../store/store-object.html">store object</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-console">$ mkdir foo
</code></pre>
<p>Reference the empty directory in an interpolated expression:</p>
<pre><code class="language-nix">"${./foo}"
</code></pre>
<pre><code>"/nix/store/2hhl2nz5v0khbn06ys82nrk99aa1xxdw-foo"
</code></pre>
</blockquote>
<p>A derivation interpolates to the <a href="language/../store/store-path.html">store path</a> of its first <a href="language/./derivations.html#attr-outputs">output</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">let
  pkgs = import &lt;nixpkgs&gt; {};
in
"${pkgs.hello}"
</code></pre>
<pre><code>"/nix/store/4xpfqf29z4m8vbhrqcz064wfmb46w5r7-hello-2.12.1"
</code></pre>
</blockquote>
<p>An attribute set interpolates to the return value of the function in the <code>__toString</code> applied to the attribute set itself.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">let
  a = {
    value = 1;
    __toString = self: toString (self.value + 1);
  };
in
"${a}"
</code></pre>
<pre><code>"2"
</code></pre>
</blockquote>
<p>An attribute set also interpolates to the value of its <code>outPath</code> attribute.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">let
  a = { outPath = "foo"; };
in
"${a}"
</code></pre>
<pre><code>"foo"
</code></pre>
</blockquote>
<p>If both <code>__toString</code> and <code>outPath</code> are present in an attribute set, <code>__toString</code> takes precedence.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">let
  a = { __toString = _: "yes"; outPath = throw "no"; };
in
"${a}"
</code></pre>
<pre><code>"yes"
</code></pre>
</blockquote>
<p>If neither is present, an error is thrown.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">let
  a = {};
in
"${a}"
</code></pre>
<pre><code>error: cannot coerce a set to a string: { }

       at «string»:4:2:

            3| in
            4| "${a}"
             |  ^
</code></pre>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lookup-path"><a class="header" href="#lookup-path">Lookup path</a></h1>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>lookup-path</em> = <code>&lt;</code> <em>identifier</em> [ <code>/</code> <em>identifier</em> ]... <code>&gt;</code></p>
</blockquote>
<p>A lookup path is an identifier with an optional path suffix that resolves to a <a href="language/constructs/../../language/types.html#type-path">path value</a> if the identifier matches a search path entry in <a href="language/constructs/../../language/builtins.html#builtins-nixPath"><code>builtins.nixPath</code></a>.
The algorithm for lookup path resolution is described in the documentation on <a href="language/constructs/../../language/builtins.html#builtins-findFile"><code>builtins.findFile</code></a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">&lt;nixpkgs&gt;
</code></pre>
<pre><code>/nix/var/nix/profiles/per-user/root/channels/nixpkgs
</code></pre>
</blockquote>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">&lt;nixpkgs/nixos&gt;
</code></pre>
<pre><code>/nix/var/nix/profiles/per-user/root/channels/nixpkgs/nixos
</code></pre>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="operators"><a class="header" href="#operators">Operators</a></h1>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Syntax</th><th>Associativity</th><th>Precedence</th></tr></thead><tbody>
<tr><td><a href="language/operators.html#attribute-selection">Attribute selection</a></td><td><em>attrset</em> <code>.</code> <em>attrpath</em> [ <code>or</code> <em>expr</em> ]</td><td>none</td><td>1</td></tr>
<tr><td><a href="language/operators.html#function-application">Function application</a></td><td><em>func</em> <em>expr</em></td><td>left</td><td>2</td></tr>
<tr><td><a href="language/operators.html#arithmetic">Arithmetic negation</a></td><td><code>-</code> <em>number</em></td><td>none</td><td>3</td></tr>
<tr><td><a href="language/operators.html#has-attribute">Has attribute</a></td><td><em>attrset</em> <code>?</code> <em>attrpath</em></td><td>none</td><td>4</td></tr>
<tr><td>List concatenation</td><td><em>list</em> <code>++</code> <em>list</em></td><td>right</td><td>5</td></tr>
<tr><td><a href="language/operators.html#arithmetic">Multiplication</a></td><td><em>number</em> <code>*</code> <em>number</em></td><td>left</td><td>6</td></tr>
<tr><td><a href="language/operators.html#arithmetic">Division</a></td><td><em>number</em> <code>/</code> <em>number</em></td><td>left</td><td>6</td></tr>
<tr><td><a href="language/operators.html#arithmetic">Subtraction</a></td><td><em>number</em> <code>-</code> <em>number</em></td><td>left</td><td>7</td></tr>
<tr><td><a href="language/operators.html#arithmetic">Addition</a></td><td><em>number</em> <code>+</code> <em>number</em></td><td>left</td><td>7</td></tr>
<tr><td><a href="language/operators.html#string-concatenation">String concatenation</a></td><td><em>string</em> <code>+</code> <em>string</em></td><td>left</td><td>7</td></tr>
<tr><td><a href="language/operators.html#path-concatenation">Path concatenation</a></td><td><em>path</em> <code>+</code> <em>path</em></td><td>left</td><td>7</td></tr>
<tr><td><a href="language/operators.html#path-and-string-concatenation">Path and string concatenation</a></td><td><em>path</em> <code>+</code> <em>string</em></td><td>left</td><td>7</td></tr>
<tr><td><a href="language/operators.html#string-and-path-concatenation">String and path concatenation</a></td><td><em>string</em> <code>+</code> <em>path</em></td><td>left</td><td>7</td></tr>
<tr><td>Logical negation (<code>NOT</code>)</td><td><code>!</code> <em>bool</em></td><td>none</td><td>8</td></tr>
<tr><td><a href="language/operators.html#update">Update</a></td><td><em>attrset</em> <code>//</code> <em>attrset</em></td><td>right</td><td>9</td></tr>
<tr><td><a href="language/operators.html#comparison">Less than</a></td><td><em>expr</em> <code>&lt;</code> <em>expr</em></td><td>none</td><td>10</td></tr>
<tr><td><a href="language/operators.html#comparison">Less than or equal to</a></td><td><em>expr</em> <code>&lt;=</code> <em>expr</em></td><td>none</td><td>10</td></tr>
<tr><td><a href="language/operators.html#comparison">Greater than</a></td><td><em>expr</em> <code>&gt;</code> <em>expr</em></td><td>none</td><td>10</td></tr>
<tr><td><a href="language/operators.html#comparison">Greater than or equal to</a></td><td><em>expr</em> <code>&gt;=</code> <em>expr</em></td><td>none</td><td>10</td></tr>
<tr><td><a href="language/operators.html#equality">Equality</a></td><td><em>expr</em> <code>==</code> <em>expr</em></td><td>none</td><td>11</td></tr>
<tr><td>Inequality</td><td><em>expr</em> <code>!=</code> <em>expr</em></td><td>none</td><td>11</td></tr>
<tr><td>Logical conjunction (<code>AND</code>)</td><td><em>bool</em> <code>&amp;&amp;</code> <em>bool</em></td><td>left</td><td>12</td></tr>
<tr><td>Logical disjunction (<code>OR</code>)</td><td><em>bool</em> <code>||</code> <em>bool</em></td><td>left</td><td>13</td></tr>
<tr><td><a href="language/operators.html#logical-implication">Logical implication</a></td><td><em>bool</em> <code>-&gt;</code> <em>bool</em></td><td>right</td><td>14</td></tr>
<tr><td><a href="language/operators.html#pipe-operators">Pipe operator</a> (experimental)</td><td><em>expr</em> <code>|&gt;</code> <em>func</em></td><td>left</td><td>15</td></tr>
<tr><td><a href="language/operators.html#pipe-operators">Pipe operator</a> (experimental)</td><td><em>func</em> <code>&lt;|</code> <em>expr</em></td><td>right</td><td>15</td></tr>
</tbody></table>
</div><!-- TODO(@rhendric, #10970): ^ rationalize number -> int/float -->
<h2 id="attribute-selection"><a class="header" href="#attribute-selection">Attribute selection</a></h2>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>attrset</em> <code>.</code> <em>attrpath</em> [ <code>or</code> <em>expr</em> ]</p>
</blockquote>
<p>Select the attribute denoted by attribute path <em>attrpath</em> from <a href="language/./types.html#type-attrs">attribute set</a> <em>attrset</em>.
If the attribute doesn’t exist, return the <em>expr</em> after <code>or</code> if provided, otherwise abort evaluation.</p>
<h2 id="function-application"><a class="header" href="#function-application">Function application</a></h2>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>func</em> <em>expr</em></p>
</blockquote>
<p>Apply the callable value <em>func</em> to the argument <em>expr</em>. Note the absence of any visible operator symbol.
A callable value is either:</p>
<ul>
<li>a <a href="language/./syntax.html#functions">user-defined function</a></li>
<li>a <a href="language/./builtins.html">built-in</a> function</li>
<li>an attribute set with a <a href="language/./syntax.html#attr-__functor"><code>__functor</code> attribute</a></li>
</ul>
<blockquote>
<p><strong>Warning</strong></p>
<p><a href="language/./types.html#type-list">List</a> items are also separated by whitespace, which means that function calls in list items must be enclosed by parentheses.</p>
</blockquote>
<h2 id="has-attribute"><a class="header" href="#has-attribute">Has attribute</a></h2>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>attrset</em> <code>?</code> <em>attrpath</em></p>
</blockquote>
<p>Test whether <a href="language/./types.html#type-attrs">attribute set</a> <em>attrset</em> contains the attribute denoted by <em>attrpath</em>.
The result is a <a href="language/./types.html#type-bool">Boolean</a> value.</p>
<p>See also: <a href="language/../language/builtins.html#builtins-hasAttr"><code>builtins.hasAttr</code></a></p>
<p>After evaluating <em>attrset</em> and <em>attrpath</em>, the computational complexity is O(log(<em>n</em>)) for <em>n</em> attributes in the <em>attrset</em></p>
<h2 id="arithmetic"><a class="header" href="#arithmetic">Arithmetic</a></h2>
<p>Numbers will retain their type unless mixed with other numeric types:
Pure integer operations will always return integers, whereas any operation involving at least one floating point number returns a floating point number.</p>
<p>Evaluation of the following numeric operations throws an evaluation error:</p>
<ul>
<li>Division by zero</li>
<li>Integer overflow, that is, any operation yielding a result outside of the representable range of <a href="language/./syntax.html#number-literal">Nix language integers</a></li>
</ul>
<p>See also <a href="language/operators.html#comparison">Comparison</a> and <a href="language/operators.html#equality">Equality</a>.</p>
<p>The <code>+</code> operator is overloaded to also work on strings and paths.</p>
<h2 id="string-concatenation"><a class="header" href="#string-concatenation">String concatenation</a></h2>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>string</em> <code>+</code> <em>string</em></p>
</blockquote>
<p>Concatenate two <a href="language/./types.html#type-string">strings</a> and merge their <a href="language/./string-context.html">string contexts</a>.</p>
<h2 id="path-concatenation"><a class="header" href="#path-concatenation">Path concatenation</a></h2>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>path</em> <code>+</code> <em>path</em></p>
</blockquote>
<p>Concatenate two <a href="language/./types.html#type-path">paths</a>.
The result is a path.</p>
<h2 id="path-and-string-concatenation"><a class="header" href="#path-and-string-concatenation">Path and string concatenation</a></h2>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>path</em> + <em>string</em></p>
</blockquote>
<p>Concatenate <em><a href="language/./types.html#type-path">path</a></em> with <em><a href="language/./types.html#type-string">string</a></em>.
The result is a path.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>The string must not have a <a href="language/./string-context.html">string context</a> that refers to a <a href="language/../store/store-path.html">store path</a>.</p>
</blockquote>
<h2 id="string-and-path-concatenation"><a class="header" href="#string-and-path-concatenation">String and path concatenation</a></h2>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>string</em> + <em>path</em></p>
</blockquote>
<p>Concatenate <em><a href="language/./types.html#type-string">string</a></em> with <em><a href="language/./types.html#type-path">path</a></em>.
The result is a string.</p>
<blockquote>
<p><strong>Important</strong></p>
<p>The file or directory at <em>path</em> must exist and is copied to the <a href="language/../glossary.html#gloss-store">store</a>.
The path appears in the result as the corresponding <a href="language/../store/store-path.html">store path</a>.</p>
</blockquote>
<h2 id="update"><a class="header" href="#update">Update</a></h2>
<blockquote>
<p><strong>Syntax</strong></p>
<p><em>attrset1</em> // <em>attrset2</em></p>
</blockquote>
<p>Update <a href="language/./types.html#type-attrs">attribute set</a> <em>attrset1</em> with names and values from <em>attrset2</em>.</p>
<p>The returned attribute set will have all of the attributes in <em>attrset1</em> and <em>attrset2</em>.
If an attribute name is present in both, the attribute value from the latter is taken.</p>
<h2 id="comparison"><a class="header" href="#comparison">Comparison</a></h2>
<p>Comparison is</p>
<ul>
<li><a href="language/operators.html#arithmetic">arithmetic</a> for <a href="language/./types.html#type-float">numbers</a></li>
<li>lexicographic for <a href="language/./types.html#type-string">strings</a> and <a href="language/./types.html#type-path">paths</a></li>
<li>item-wise lexicographic for <a href="language/./types.html#type-list">lists</a>:
elements at the same index in both lists are compared according to their type and skipped if they are equal.</li>
</ul>
<p>All comparison operators are implemented in terms of <code>&lt;</code>, and the following equivalencies hold:</p>
<div class="table-wrapper"><table><thead><tr><th>comparison</th><th>implementation</th></tr></thead><tbody>
<tr><td><em>a</em> <code>&lt;=</code> <em>b</em></td><td><code>! (</code> <em>b</em> <code>&lt;</code> <em>a</em> <code>)</code></td></tr>
<tr><td><em>a</em> <code>&gt;</code>  <em>b</em></td><td><em>b</em> <code>&lt;</code> <em>a</em></td></tr>
<tr><td><em>a</em> <code>&gt;=</code> <em>b</em></td><td><code>! (</code> <em>a</em> <code>&lt;</code> <em>b</em> <code>)</code></td></tr>
</tbody></table>
</div>
<h2 id="equality"><a class="header" href="#equality">Equality</a></h2>
<ul>
<li><a href="language/./types.html#type-attrs">Attribute sets</a> and <a href="language/./types.html#type-list">lists</a> are compared recursively, and therefore are fully evaluated.</li>
<li>Comparison of <a href="language/./syntax.html#functions">functions</a> always returns <code>false</code>.</li>
<li>Numbers are type-compatible, see <a href="language/operators.html#arithmetic">arithmetic</a> operators.</li>
<li>Floating point numbers only differ up to a limited precision.</li>
</ul>
<h2 id="logical-implication"><a class="header" href="#logical-implication">Logical implication</a></h2>
<p>Equivalent to <code>!</code><em>b1</em> <code>||</code> <em>b2</em>.</p>
<h2 id="pipe-operators"><a class="header" href="#pipe-operators">Pipe operators</a></h2>
<ul>
<li><em>a</em> <code>|&gt;</code> <em>b</em> is equivalent to <em>b</em> <em>a</em></li>
<li><em>a</em> <code>&lt;|</code> <em>b</em> is equivalent to <em>a</em> <em>b</em></li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<pre><code>nix-repl&gt; 1 |&gt; builtins.add 2 |&gt; builtins.mul 3
9

nix-repl&gt; builtins.add 1 &lt;| builtins.mul 2 &lt;| 3
7
</code></pre>
</blockquote>
<blockquote>
<p><strong>Warning</strong></p>
<p>This syntax is part of an
<a href="language/../development/experimental-features.html">experimental feature</a>
and may change in future releases.</p>
<p>To use this syntax, make sure the
<a href="language/../development/experimental-features.html#xp-feature-pipe-operators"><code>pipe-operators</code> experimental feature</a>
is enabled.
For example, include the following in <a href="language/../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = pipe-operators
</code></pre>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="built-ins"><a class="header" href="#built-ins">Built-ins</a></h1>
<p>This section lists the values and functions built into the Nix language evaluator.
All built-ins are available through the global <a href="language/builtins.html#builtins-builtins"><code>builtins</code></a> constant.</p>
<p>Some built-ins are also exposed directly in the global scope:</p>
<!-- TODO(@rhendric, #10970): this list is incomplete -->
<ul>
<li><a href="language/builtins.html#builtins-derivation"><code>derivation</code></a></li>
<li><a href="language/builtins.html#builtins-import"><code>import</code></a></li>
<li><a href="language/builtins.html#builtins-abort"><code>abort</code></a></li>
<li><a href="language/builtins.html#builtins-throw"><code>throw</code></a></li>
</ul>
<dl>
  <dt id="builtins-derivation"><a href="language/builtins.html#builtins-derivation"><code>derivation <var>attrs</var></code></a></dt>
  <dd><p><var>derivation</var> is described in
         <a href="language/derivations.html">its own section</a>.</p></dd>
<dt id="builtins-abort">
  <a href="language/builtins.html#builtins-abort"><code>abort <var>s</var></code></a>
</dt>
<dd>
<p>Abort Nix expression evaluation and print the error message <em>s</em>.</p>
</dd>
<dt id="builtins-add">
  <a href="language/builtins.html#builtins-add"><code>add <var>e1</var> <var>e2</var></code></a>
</dt>
<dd>
<p>Return the sum of the numbers <em>e1</em> and <em>e2</em>.</p>
</dd>
<dt id="builtins-addDrvOutputDependencies">
  <a href="language/builtins.html#builtins-addDrvOutputDependencies"><code>addDrvOutputDependencies <var>s</var></code></a>
</dt>
<dd>
<p>Create a copy of the given string where a single
<a href="language/../language/string-context.html#string-context-element-constant">constant</a>
string context element is turned into a
<a href="language/../language/string-context.html#string-context-element-derivation-deep">derivation deep</a>
string context element.</p>
<p>The store path that is the constant string context element should point to a valid derivation, and end in <code>.drv</code>.</p>
<p>The original string context element must not be empty or have multiple elements, and it must not have any other type of element other than a constant or derivation deep element.
The latter is supported so this function is idempotent.</p>
<p>This is the opposite of <a href="language/builtins.html#builtins-unsafeDiscardOutputDependency"><code>builtins.unsafeDiscardOutputDependency</code></a>.</p>
</dd>
<dt id="builtins-all">
  <a href="language/builtins.html#builtins-all"><code>all <var>pred</var> <var>list</var></code></a>
</dt>
<dd>
<p>Return <code>true</code> if the function <em>pred</em> returns <code>true</code> for all elements
of <em>list</em>, and <code>false</code> otherwise.</p>
</dd>
<dt id="builtins-any">
  <a href="language/builtins.html#builtins-any"><code>any <var>pred</var> <var>list</var></code></a>
</dt>
<dd>
<p>Return <code>true</code> if the function <em>pred</em> returns <code>true</code> for at least one
element of <em>list</em>, and <code>false</code> otherwise.</p>
</dd>
<dt id="builtins-attrNames">
  <a href="language/builtins.html#builtins-attrNames"><code>attrNames <var>set</var></code></a>
</dt>
<dd>
<p>Return the names of the attributes in the set <em>set</em> in an
alphabetically sorted list. For instance, <code>builtins.attrNames { y = 1; x = "foo"; }</code> evaluates to <code>[ "x" "y" ]</code>.</p>
</dd>
<dt id="builtins-attrValues">
  <a href="language/builtins.html#builtins-attrValues"><code>attrValues <var>set</var></code></a>
</dt>
<dd>
<p>Return the values of the attributes in the set <em>set</em> in the order
corresponding to the sorted attribute names.</p>
</dd>
<dt id="builtins-baseNameOf">
  <a href="language/builtins.html#builtins-baseNameOf"><code>baseNameOf <var>x</var></code></a>
</dt>
<dd>
<p>Return the <em>base name</em> of either a <a href="language/../language/types.html#type-path">path value</a> <em>x</em> or a string <em>x</em>, depending on which type is passed, and according to the following rules.</p>
<p>For a path value, the <em>base name</em> is considered to be the part of the path after the last directory separator, including any file extensions.
This is the simple case, as path values don't have trailing slashes.</p>
<p>When the argument is a string, a more involved logic applies. If the string ends with a <code>/</code>, only this one final slash is removed.</p>
<p>After this, the <em>base name</em> is returned as previously described, assuming <code>/</code> as the directory separator. (Note that evaluation must be platform independent.)</p>
<p>This is somewhat similar to the <a href="https://www.gnu.org/software/coreutils/manual/html_node/basename-invocation.html">GNU <code>basename</code></a> command, but GNU <code>basename</code> will strip any number of trailing slashes.</p>
</dd>
<dt id="builtins-bitAnd">
  <a href="language/builtins.html#builtins-bitAnd"><code>bitAnd <var>e1</var> <var>e2</var></code></a>
</dt>
<dd>
<p>Return the bitwise AND of the integers <em>e1</em> and <em>e2</em>.</p>
</dd>
<dt id="builtins-bitOr">
  <a href="language/builtins.html#builtins-bitOr"><code>bitOr <var>e1</var> <var>e2</var></code></a>
</dt>
<dd>
<p>Return the bitwise OR of the integers <em>e1</em> and <em>e2</em>.</p>
</dd>
<dt id="builtins-bitXor">
  <a href="language/builtins.html#builtins-bitXor"><code>bitXor <var>e1</var> <var>e2</var></code></a>
</dt>
<dd>
<p>Return the bitwise XOR of the integers <em>e1</em> and <em>e2</em>.</p>
</dd>
<dt id="builtins-break">
  <a href="language/builtins.html#builtins-break"><code>break <var>v</var></code></a>
</dt>
<dd>
<p>In debug mode (enabled using <code>--debugger</code>), pause Nix expression evaluation and enter the REPL.
Otherwise, return the argument <code>v</code>.</p>
</dd>
<dt id="builtins-builtins">
  <a href="language/builtins.html#builtins-builtins"><code>builtins</code></a> (set)
</dt>
<dd>
<p>Contains all the built-in functions and values.</p>
<p>Since built-in functions were added over time, <a href="language/./operators.html#has-attribute">testing for attributes</a> in <code>builtins</code> can be used for graceful fallback on older Nix installations:</p>
<pre><code class="language-nix"># if hasContext is not available, we assume `s` has a context
if builtins ? hasContext then builtins.hasContext s else true
</code></pre>
</dd>
<dt id="builtins-catAttrs">
  <a href="language/builtins.html#builtins-catAttrs"><code>catAttrs <var>attr</var> <var>list</var></code></a>
</dt>
<dd>
<p>Collect each attribute named <em>attr</em> from a list of attribute
sets.  Attrsets that don't contain the named attribute are
ignored. For example,</p>
<pre><code class="language-nix">builtins.catAttrs "a" [{a = 1;} {b = 0;} {a = 2;}]
</code></pre>
<p>evaluates to <code>[1 2]</code>.</p>
</dd>
<dt id="builtins-ceil">
  <a href="language/builtins.html#builtins-ceil"><code>ceil <var>double</var></code></a>
</dt>
<dd>
<p>Converts an IEEE-754 double-precision floating-point number (<em>double</em>) to
the next higher integer.</p>
<p>If the datatype is neither an integer nor a "float", an evaluation error will be
thrown.</p>
</dd>
<dt id="builtins-compareVersions">
  <a href="language/builtins.html#builtins-compareVersions"><code>compareVersions <var>s1</var> <var>s2</var></code></a>
</dt>
<dd>
<p>Compare two strings representing versions and return <code>-1</code> if
version <em>s1</em> is older than version <em>s2</em>, <code>0</code> if they are the same,
and <code>1</code> if <em>s1</em> is newer than <em>s2</em>. The version comparison
algorithm is the same as the one used by <a href="language/../command-ref/nix-env.html#operation---upgrade"><code>nix-env -u</code></a>.</p>
</dd>
<dt id="builtins-concatLists">
  <a href="language/builtins.html#builtins-concatLists"><code>concatLists <var>lists</var></code></a>
</dt>
<dd>
<p>Concatenate a list of lists into a single list.</p>
</dd>
<dt id="builtins-concatMap">
  <a href="language/builtins.html#builtins-concatMap"><code>concatMap <var>f</var> <var>list</var></code></a>
</dt>
<dd>
<p>This function is equivalent to <code>builtins.concatLists (map f list)</code>
but is more efficient.</p>
</dd>
<dt id="builtins-concatStringsSep">
  <a href="language/builtins.html#builtins-concatStringsSep"><code>concatStringsSep <var>separator</var> <var>list</var></code></a>
</dt>
<dd>
<p>Concatenate a list of strings with a separator between each
element, e.g. <code>concatStringsSep "/" ["usr" "local" "bin"] == "usr/local/bin"</code>.</p>
</dd>
<dt id="builtins-convertHash">
  <a href="language/builtins.html#builtins-convertHash"><code>convertHash <var>args</var></code></a>
</dt>
<dd>
<p>Return the specified representation of a hash string, based on the attributes presented in <em>args</em>:</p>
<ul>
<li>
<p><code>hash</code></p>
<p>The hash to be converted.
The hash format is detected automatically.</p>
</li>
<li>
<p><code>hashAlgo</code></p>
<p>The algorithm used to create the hash. Must be one of</p>
<ul>
<li><code>"md5"</code></li>
<li><code>"sha1"</code></li>
<li><code>"sha256"</code></li>
<li><code>"sha512"</code></li>
</ul>
<p>The attribute may be omitted when <code>hash</code> is an <a href="https://www.w3.org/TR/SRI/#the-integrity-attribute">SRI hash</a> or when the hash is prefixed with the hash algorithm name followed by a colon.
That <code>&lt;hashAlgo&gt;:&lt;hashBody&gt;</code> syntax is supported for backwards compatibility with existing tooling.</p>
</li>
<li>
<p><code>toHashFormat</code></p>
<p>The format of the resulting hash. Must be one of</p>
<ul>
<li><code>"base16"</code></li>
<li><code>"nix32"</code></li>
<li><code>"base32"</code> (deprecated alias for <code>"nix32"</code>)</li>
<li><code>"base64"</code></li>
<li><code>"sri"</code></li>
</ul>
</li>
</ul>
<p>The result hash is the <em>toHashFormat</em> representation of the hash <em>hash</em>.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>Convert a SHA256 hash in Base16 to SRI:</p>
<pre><code class="language-nix">builtins.convertHash {
  hash = "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";
  toHashFormat = "sri";
  hashAlgo = "sha256";
}
</code></pre>
<pre><code>"sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU="
</code></pre>
</blockquote>
<blockquote>
<p><strong>Example</strong></p>
<p>Convert a SHA256 hash in SRI to Base16:</p>
<pre><code class="language-nix">builtins.convertHash {
  hash = "sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=";
  toHashFormat = "base16";
}
</code></pre>
<pre><code>"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"
</code></pre>
</blockquote>
<blockquote>
<p><strong>Example</strong></p>
<p>Convert a hash in the form <code>&lt;hashAlgo&gt;:&lt;hashBody&gt;</code> in Base16 to SRI:</p>
<pre><code class="language-nix">builtins.convertHash {
  hash = "sha256:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";
  toHashFormat = "sri";
}
</code></pre>
<pre><code>"sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU="
</code></pre>
</blockquote>
</dd>
<dt id="builtins-currentSystem">
  <a href="language/builtins.html#builtins-currentSystem"><code>currentSystem</code></a> (string)
</dt>
<dd>
<p>The value of the
<a href="language/../command-ref/conf-file.html#conf-eval-system"><code>eval-system</code></a>
or else
<a href="language/../command-ref/conf-file.html#conf-system"><code>system</code></a>
configuration option.</p>
<p>It can be used to set the <code>system</code> attribute for <a href="language/../language/derivations.html"><code>builtins.derivation</code></a> such that the resulting derivation can be built on the same system that evaluates the Nix expression:</p>
<pre><code class="language-nix"> builtins.derivation {
   # ...
   system = builtins.currentSystem;
}
</code></pre>
<p>It can be overridden in order to create derivations for different system than the current one:</p>
<pre><code class="language-console">$ nix-instantiate --system "mips64-linux" --eval --expr 'builtins.currentSystem'
"mips64-linux"
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>Not available in <a href="language/../command-ref/conf-file.html#conf-pure-eval">pure evaluation mode</a>.</p>
</blockquote>
</dd>
<dt id="builtins-currentTime">
  <a href="language/builtins.html#builtins-currentTime"><code>currentTime</code></a> (integer)
</dt>
<dd>
<p>Return the <a href="https://en.wikipedia.org/wiki/Unix_time">Unix time</a> at first evaluation.
Repeated references to that name will re-use the initially obtained value.</p>
<p>Example:</p>
<pre><code class="language-console">$ nix repl
Welcome to Nix 2.15.1 Type :? for help.

nix-repl&gt; builtins.currentTime
1683705525

nix-repl&gt; builtins.currentTime
1683705525
</code></pre>
<p>The <a href="language/../store/store-path.html">store path</a> of a derivation depending on <code>currentTime</code> will differ for each evaluation, unless both evaluate <code>builtins.currentTime</code> in the same second.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>Not available in <a href="language/../command-ref/conf-file.html#conf-pure-eval">pure evaluation mode</a>.</p>
</blockquote>
</dd>
<dt id="builtins-deepSeq">
  <a href="language/builtins.html#builtins-deepSeq"><code>deepSeq <var>e1</var> <var>e2</var></code></a>
</dt>
<dd>
<p>This is like <code>seq e1 e2</code>, except that <em>e1</em> is evaluated <em>deeply</em>:
if it’s a list or set, its elements or attributes are also
evaluated recursively.</p>
</dd>
<dt id="builtins-dirOf">
  <a href="language/builtins.html#builtins-dirOf"><code>dirOf <var>s</var></code></a>
</dt>
<dd>
<p>Return the directory part of the string <em>s</em>, that is, everything
before the final slash in the string. This is similar to the GNU
<code>dirname</code> command.</p>
</dd>
<dt id="builtins-div">
  <a href="language/builtins.html#builtins-div"><code>div <var>e1</var> <var>e2</var></code></a>
</dt>
<dd>
<p>Return the quotient of the numbers <em>e1</em> and <em>e2</em>.</p>
</dd>
<dt id="builtins-elem">
  <a href="language/builtins.html#builtins-elem"><code>elem <var>x</var> <var>xs</var></code></a>
</dt>
<dd>
<p>Return <code>true</code> if a value equal to <em>x</em> occurs in the list <em>xs</em>, and
<code>false</code> otherwise.</p>
</dd>
<dt id="builtins-elemAt">
  <a href="language/builtins.html#builtins-elemAt"><code>elemAt <var>xs</var> <var>n</var></code></a>
</dt>
<dd>
<p>Return element <em>n</em> from the list <em>xs</em>. Elements are counted starting
from 0. A fatal error occurs if the index is out of bounds.</p>
</dd>
<dt id="builtins-false">
  <a href="language/builtins.html#builtins-false"><code>false</code></a> (Boolean)
</dt>
<dd>
<p>Primitive value.</p>
<p>It can be returned by
<a href="language/../language/operators.html#Comparison">comparison operators</a>
and used in
<a href="language/../language/syntax.html#Conditionals">conditional expressions</a>.</p>
<p>The name <code>false</code> is not special, and can be shadowed:</p>
<pre><code class="language-nix-repl">nix-repl&gt; let false = 1; in false
1
</code></pre>
</dd>
<dt id="builtins-fetchClosure">
  <a href="language/builtins.html#builtins-fetchClosure"><code>fetchClosure <var>args</var></code></a>
</dt>
<dd>
<blockquote>
<p><strong>Note</strong></p>
<p>This function is only available if the <a href="language/../development/experimental-features.html#xp-feature-fetch-closure"><code>fetch-closure</code> experimental feature</a> is enabled.</p>
<p>For example, include the following in <a href="language/../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = fetch-closure
</code></pre>
</blockquote>
<p>Fetch a store path <a href="language/../glossary.html#gloss-closure">closure</a> from a binary cache, and return the store path as a string with context.</p>
<p>This function can be invoked in three ways, that we will discuss in order of preference.</p>
<p><strong>Fetch a content-addressed store path</strong></p>
<p>Example:</p>
<pre><code class="language-nix">builtins.fetchClosure {
  fromStore = "https://cache.nixos.org";
  fromPath = /nix/store/ldbhlwhh39wha58rm61bkiiwm6j7211j-git-2.33.1;
}
</code></pre>
<p>This is the simplest invocation, and it does not require the user of the expression to configure <a href="language/../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a> to ensure their authenticity.</p>
<p>If your store path is <a href="language/../glossary.html#gloss-input-addressed-store-object">input addressed</a> instead of content addressed, consider the other two invocations.</p>
<p><strong>Fetch any store path and rewrite it to a fully content-addressed store path</strong></p>
<p>Example:</p>
<pre><code class="language-nix">builtins.fetchClosure {
  fromStore = "https://cache.nixos.org";
  fromPath = /nix/store/r2jd6ygnmirm2g803mksqqjm4y39yi6i-git-2.33.1;
  toPath = /nix/store/ldbhlwhh39wha58rm61bkiiwm6j7211j-git-2.33.1;
}
</code></pre>
<p>This example fetches <code>/nix/store/r2jd...</code> from the specified binary cache,
and rewrites it into the content-addressed store path
<code>/nix/store/ldbh...</code>.</p>
<p>Like the previous example, no extra configuration or privileges are required.</p>
<p>To find out the correct value for <code>toPath</code> given a <code>fromPath</code>,
use <a href="language/../command-ref/new-cli/nix3-store-make-content-addressed.html"><code>nix store make-content-addressed</code></a>:</p>
<pre><code class="language-console"># nix store make-content-addressed --from https://cache.nixos.org /nix/store/r2jd6ygnmirm2g803mksqqjm4y39yi6i-git-2.33.1
rewrote '/nix/store/r2jd6ygnmirm2g803mksqqjm4y39yi6i-git-2.33.1' to '/nix/store/ldbhlwhh39wha58rm61bkiiwm6j7211j-git-2.33.1'
</code></pre>
<p>Alternatively, set <code>toPath = ""</code> and find the correct <code>toPath</code> in the error message.</p>
<p><strong>Fetch an input-addressed store path as is</strong></p>
<p>Example:</p>
<pre><code class="language-nix">builtins.fetchClosure {
  fromStore = "https://cache.nixos.org";
  fromPath = /nix/store/r2jd6ygnmirm2g803mksqqjm4y39yi6i-git-2.33.1;
  inputAddressed = true;
}
</code></pre>
<p>It is possible to fetch an <a href="language/../glossary.html#gloss-input-addressed-store-object">input-addressed store path</a> and return it as is.
However, this is the least preferred way of invoking <code>fetchClosure</code>, because it requires that the input-addressed paths are trusted by the Nix configuration.</p>
<p><strong><code>builtins.storePath</code></strong></p>
<p><code>fetchClosure</code> is similar to <a href="language/builtins.html#builtins-storePath"><code>builtins.storePath</code></a> in that it allows you to use a previously built store path in a Nix expression.
However, <code>fetchClosure</code> is more reproducible because it specifies a binary cache from which the path can be fetched.
Also, using content-addressed store paths does not require users to configure <a href="language/../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a> to ensure their authenticity.</p>
</dd>
<dt id="builtins-fetchGit">
  <a href="language/builtins.html#builtins-fetchGit"><code>fetchGit <var>args</var></code></a>
</dt>
<dd>
<p>Fetch a path from git. <em>args</em> can be a URL, in which case the HEAD
of the repo at that URL is fetched. Otherwise, it can be an
attribute with the following attributes (all except <code>url</code> optional):</p>
<ul>
<li>
<p><code>url</code></p>
<p>The URL of the repo.</p>
</li>
<li>
<p><code>name</code> (default: <code>source</code>)</p>
<p>The name of the directory the repo should be exported to in the store.</p>
</li>
<li>
<p><code>rev</code> (default: <em>the tip of <code>ref</code></em>)</p>
<p>The <a href="https://git-scm.com/docs/git-rev-parse#_specifying_revisions">Git revision</a> to fetch.
This is typically a commit hash.</p>
</li>
<li>
<p><code>ref</code> (default: <code>HEAD</code>)</p>
<p>The <a href="https://git-scm.com/book/en/v2/Git-Internals-Git-References">Git reference</a> under which to look for the requested revision.
This is often a branch or tag name.</p>
<p>This option has no effect once <code>shallow</code> cloning is enabled.</p>
<p>By default, the <code>ref</code> value is prefixed with <code>refs/heads/</code>.
As of 2.3.0, Nix will not prefix <code>refs/heads/</code> if <code>ref</code> starts with <code>refs/</code>.</p>
</li>
<li>
<p><code>submodules</code> (default: <code>false</code>)</p>
<p>A Boolean parameter that specifies whether submodules should be checked out.</p>
</li>
<li>
<p><code>exportIgnore</code> (default: <code>true</code>)</p>
<p>A Boolean parameter that specifies whether <code>export-ignore</code> from <code>.gitattributes</code> should be applied.
This approximates part of the <code>git archive</code> behavior.</p>
<p>Enabling this option is not recommended because it is unknown whether the Git developers commit to the reproducibility of <code>export-ignore</code> in newer Git versions.</p>
</li>
<li>
<p><code>shallow</code> (default: <code>false</code>)</p>
<p>Make a shallow clone when fetching the Git tree.
When this is enabled, the options <code>ref</code> and <code>allRefs</code> have no effect anymore.</p>
</li>
<li>
<p><code>lfs</code> (default: <code>false</code>)</p>
<p>A boolean that when <code>true</code> specifies that <a href="https://git-lfs.com/">Git LFS</a> files should be fetched.</p>
</li>
<li>
<p><code>allRefs</code></p>
<p>Whether to fetch all references (eg. branches and tags) of the repository.
With this argument being true, it's possible to load a <code>rev</code> from <em>any</em> <code>ref</code>.
(by default only <code>rev</code>s from the specified <code>ref</code> are supported).</p>
<p>This option has no effect once <code>shallow</code> cloning is enabled.</p>
</li>
<li>
<p><code>verifyCommit</code> (default: <code>true</code> if <code>publicKey</code> or <code>publicKeys</code> are provided, otherwise <code>false</code>)</p>
<p>Whether to check <code>rev</code> for a signature matching <code>publicKey</code> or <code>publicKeys</code>.
If <code>verifyCommit</code> is enabled, then <code>fetchGit</code> cannot use a local repository with uncommitted changes.
Requires the <a href="language/../development/experimental-features.html#xp-feature-verified-fetches"><code>verified-fetches</code> experimental feature</a>.</p>
</li>
<li>
<p><code>publicKey</code></p>
<p>The public key against which <code>rev</code> is verified if <code>verifyCommit</code> is enabled.
Requires the <a href="language/../development/experimental-features.html#xp-feature-verified-fetches"><code>verified-fetches</code> experimental feature</a>.</p>
</li>
<li>
<p><code>keytype</code> (default: <code>"ssh-ed25519"</code>)</p>
<p>The key type of <code>publicKey</code>.
Possible values:</p>
<ul>
<li><code>"ssh-dsa"</code></li>
<li><code>"ssh-ecdsa"</code></li>
<li><code>"ssh-ecdsa-sk"</code></li>
<li><code>"ssh-ed25519"</code></li>
<li><code>"ssh-ed25519-sk"</code></li>
<li><code>"ssh-rsa"</code>
Requires the <a href="language/../development/experimental-features.html#xp-feature-verified-fetches"><code>verified-fetches</code> experimental feature</a>.</li>
</ul>
</li>
<li>
<p><code>publicKeys</code></p>
<p>The public keys against which <code>rev</code> is verified if <code>verifyCommit</code> is enabled.
Must be given as a list of attribute sets with the following form:</p>
<pre><code class="language-nix">{
  key = "&lt;public key&gt;";
  type = "&lt;key type&gt;"; # optional, default: "ssh-ed25519"
}
</code></pre>
<p>Requires the <a href="language/../development/experimental-features.html#xp-feature-verified-fetches"><code>verified-fetches</code> experimental feature</a>.</p>
</li>
</ul>
<p>Here are some examples of how to use <code>fetchGit</code>.</p>
<ul>
<li>
<p>To fetch a private repository over SSH:</p>
<pre><code class="language-nix">builtins.fetchGit {
  url = "git@github.com:my-secret/repository.git";
  ref = "master";
  rev = "adab8b916a45068c044658c4158d81878f9ed1c3";
}
</code></pre>
</li>
<li>
<p>To fetch an arbitrary reference:</p>
<pre><code class="language-nix">builtins.fetchGit {
  url = "https://github.com/NixOS/nix.git";
  ref = "refs/heads/0.5-release";
}
</code></pre>
</li>
<li>
<p>If the revision you're looking for is in the default branch of
the git repository you don't strictly need to specify the branch
name in the <code>ref</code> attribute.</p>
<p>However, if the revision you're looking for is in a future
branch for the non-default branch you will need to specify the
the <code>ref</code> attribute as well.</p>
<pre><code class="language-nix">builtins.fetchGit {
  url = "https://github.com/nixos/nix.git";
  rev = "841fcbd04755c7a2865c51c1e2d3b045976b7452";
  ref = "1.11-maintenance";
}
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>It is nice to always specify the branch which a revision
belongs to. Without the branch being specified, the fetcher
might fail if the default branch changes. Additionally, it can
be confusing to try a commit from a non-default branch and see
the fetch fail. If the branch is specified the fault is much
more obvious.</p>
</blockquote>
</li>
<li>
<p>If the revision you're looking for is in the default branch of
the git repository you may omit the <code>ref</code> attribute.</p>
<pre><code class="language-nix">builtins.fetchGit {
  url = "https://github.com/nixos/nix.git";
  rev = "841fcbd04755c7a2865c51c1e2d3b045976b7452";
}
</code></pre>
</li>
<li>
<p>To fetch a specific tag:</p>
<pre><code class="language-nix">builtins.fetchGit {
  url = "https://github.com/nixos/nix.git";
  ref = "refs/tags/1.9";
}
</code></pre>
</li>
<li>
<p>To fetch the latest version of a remote branch:</p>
<pre><code class="language-nix">builtins.fetchGit {
  url = "ssh://git@github.com/nixos/nix.git";
  ref = "master";
}
</code></pre>
</li>
<li>
<p>To verify the commit signature:</p>
<pre><code class="language-nix">builtins.fetchGit {
  url = "ssh://git@github.com/nixos/nix.git";
  verifyCommit = true;
  publicKeys = [
      {
        type = "ssh-ed25519";
        key = "AAAAC3NzaC1lZDI1NTE5AAAAIArPKULJOid8eS6XETwUjO48/HKBWl7FTCK0Z//fplDi";
      }
  ];
}
</code></pre>
<p>Nix will refetch the branch according to the <a href="language/../command-ref/conf-file.html#conf-tarball-ttl"><code>tarball-ttl</code></a> setting.</p>
<p>This behavior is disabled in <a href="language/../command-ref/conf-file.html#conf-pure-eval">pure evaluation mode</a>.</p>
</li>
<li>
<p>To fetch the content of a checked-out work directory:</p>
<pre><code class="language-nix">builtins.fetchGit ./work-dir
</code></pre>
</li>
</ul>
<p>If the URL points to a local directory, and no <code>ref</code> or <code>rev</code> is
given, <code>fetchGit</code> will use the current content of the checked-out
files, even if they are not committed or added to Git's index. It will
only consider files added to the Git repository, as listed by <code>git ls-files</code>.</p>
</dd>
<dt id="builtins-fetchTarball">
  <a href="language/builtins.html#builtins-fetchTarball"><code>fetchTarball <var>args</var></code></a>
</dt>
<dd>
<p>Download the specified URL, unpack it and return the path of the
unpacked tree. The file must be a tape archive (<code>.tar</code>) compressed
with <code>gzip</code>, <code>bzip2</code> or <code>xz</code>. If the tarball consists of a
single directory, then the top-level path component of the files
in the tarball is removed. The typical use of the function is to
obtain external Nix expression dependencies, such as a
particular version of Nixpkgs, e.g.</p>
<pre><code class="language-nix">with import (fetchTarball https://github.com/NixOS/nixpkgs/archive/nixos-14.12.tar.gz) {};

stdenv.mkDerivation { … }
</code></pre>
<p>The fetched tarball is cached for a certain amount of time (1
hour by default) in <code>~/.cache/nix/tarballs/</code>. You can change the
cache timeout either on the command line with <code>--tarball-ttl</code>
<em>number-of-seconds</em> or in the Nix configuration file by adding
the line <code>tarball-ttl = </code> <em>number-of-seconds</em>.</p>
<p>Note that when obtaining the hash with <code>nix-prefetch-url</code> the
option <code>--unpack</code> is required.</p>
<p>This function can also verify the contents against a hash. In that
case, the function takes a set instead of a URL. The set requires
the attribute <code>url</code> and the attribute <code>sha256</code>, e.g.</p>
<pre><code class="language-nix">with import (fetchTarball {
  url = "https://github.com/NixOS/nixpkgs/archive/nixos-14.12.tar.gz";
  sha256 = "1jppksrfvbk5ypiqdz4cddxdl8z6zyzdb2srq8fcffr327ld5jj2";
}) {};

stdenv.mkDerivation { … }
</code></pre>
<p>Not available in <a href="language/../command-ref/conf-file.html#conf-restrict-eval">restricted evaluation mode</a>.</p>
</dd>
<dt id="builtins-fetchTree">
  <a href="language/builtins.html#builtins-fetchTree"><code>fetchTree <var>input</var></code></a>
</dt>
<dd>
<blockquote>
<p><strong>Note</strong></p>
<p>This function is only available if the <a href="language/../development/experimental-features.html#xp-feature-fetch-tree"><code>fetch-tree</code> experimental feature</a> is enabled.</p>
<p>For example, include the following in <a href="language/../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = fetch-tree
</code></pre>
</blockquote>
<p>Fetch a file system tree or a plain file using one of the supported backends and return an attribute set with:</p>
<ul>
<li>the resulting fixed-output <a href="language/../store/store-path.html">store path</a></li>
<li>the corresponding <a href="language/../store/file-system-object/content-address.html#serial-nix-archive">NAR</a> hash</li>
<li>backend-specific metadata (currently not documented). <!-- TODO: document output attributes --></li>
</ul>
<p><em>input</em> must be an attribute set with the following attributes:</p>
<ul>
<li>
<p><code>type</code> (String, required)</p>
<p>One of the <a href="language/builtins.html#source-types">supported source types</a>.
This determines other required and allowed input attributes.</p>
</li>
<li>
<p><code>narHash</code> (String, optional)</p>
<p>The <code>narHash</code> parameter can be used to substitute the source of the tree.
It also allows for verification of tree contents that may not be provided by the underlying transfer mechanism.
If <code>narHash</code> is set, the source is first looked up is the Nix store and <a href="language/../command-ref/conf-file.html#conf-substituters">substituters</a>, and only fetched if not available.</p>
</li>
</ul>
<p>A subset of the output attributes of <code>fetchTree</code> can be re-used for subsequent calls to <code>fetchTree</code> to produce the same result again.
That is, <code>fetchTree</code> is idempotent.</p>
<p>Downloads are cached in <code>$XDG_CACHE_HOME/nix</code>.
The remote source will be fetched from the network if both are true:</p>
<ul>
<li>
<p>A NAR hash is supplied and the corresponding store path is not <a href="language/../glossary.html#gloss-validity">valid</a>, that is, not available in the store</p>
<blockquote>
<p><strong>Note</strong></p>
<p><a href="language/../command-ref/conf-file.html#conf-substituters">Substituters</a> are not used in fetching.</p>
</blockquote>
</li>
<li>
<p>There is no cache entry or the cache entry is older than <a href="language/../command-ref/conf-file.html#conf-tarball-ttl"><code>tarball-ttl</code></a></p>
</li>
</ul>
<h2 id="source-types"><a class="header" href="#source-types">Source types</a></h2>
<p>The following source types and associated input attributes are supported.</p>
 <!-- TODO: It would be soooo much more predictable to work with (and
 document) if `fetchTree` was a curried call with the first parameter for
 `type` or an attribute like `builtins.fetchTree.git`! -->
<ul>
<li>
<p><code>"file"</code></p>
<p>Place a plain file into the Nix store.
This is similar to <a href="language/../language/builtins.html#builtins-fetchurl"><code>builtins.fetchurl</code></a></p>
<ul>
<li>
<p><code>url</code> (String, required)</p>
<p>Supported protocols:</p>
<ul>
<li>
<p><code>https</code></p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">fetchTree {
  type = "file";
  url = "https://example.com/index.html";
}
</code></pre>
</blockquote>
</li>
<li>
<p><code>http</code></p>
<p>Insecure HTTP transfer for legacy sources.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>HTTP performs no encryption or authentication.
Use a <code>narHash</code> known in advance to ensure the output has expected contents.</p>
</blockquote>
</li>
<li>
<p><code>file</code></p>
<p>A file on the local file system.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">fetchTree {
  type = "file";
  url = "file:///home/eelco/nix/README.md";
}
</code></pre>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>"tarball"</code></p>
<p>Download a tar archive and extract it into the Nix store.
This has the same underyling implementation as <a href="language/../language/builtins.html#builtins-fetchTarball"><code>builtins.fetchTarball</code></a></p>
<ul>
<li>
<p><code>url</code> (String, required)</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">fetchTree {
  type = "tarball";
  url = "https://github.com/NixOS/nixpkgs/tarball/nixpkgs-23.11";
}
</code></pre>
</blockquote>
</li>
</ul>
</li>
<li>
<p><code>"git"</code></p>
<p>Fetch a Git tree and copy it to the Nix store.
This is similar to <a href="language/../language/builtins.html#builtins-fetchGit"><code>builtins.fetchGit</code></a>.</p>
<ul>
<li>
<p><code>url</code> (String, required)</p>
<p>The URL formats supported are the same as for Git itself.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">fetchTree {
  type = "git";
  url = "git@github.com:NixOS/nixpkgs.git";
}
</code></pre>
</blockquote>
<blockquote>
<p><strong>Note</strong></p>
<p>If the URL points to a local directory, and no <code>ref</code> or <code>rev</code> is given, Nix will only consider files added to the Git index, as listed by <code>git ls-files</code> but use the <em>current file contents</em> of the Git working directory.</p>
</blockquote>
</li>
<li>
<p><code>ref</code> (String, optional)</p>
<p>By default, this has no effect. This becomes relevant only once <code>shallow</code> cloning is disabled.</p>
<p>A <a href="https://git-scm.com/book/en/v2/Git-Internals-Git-References">Git reference</a>, such as a branch or tag name.</p>
<p>Default: <code>"HEAD"</code></p>
</li>
<li>
<p><code>rev</code> (String, optional)</p>
<p>A Git revision; a commit hash.</p>
<p>Default: the tip of <code>ref</code></p>
</li>
<li>
<p><code>shallow</code> (Bool, optional)</p>
<p>Make a shallow clone when fetching the Git tree.
When this is enabled, the options <code>ref</code> and <code>allRefs</code> have no effect anymore.</p>
<p>Default: <code>true</code></p>
</li>
<li>
<p><code>submodules</code> (Bool, optional)</p>
<p>Also fetch submodules if available.</p>
<p>Default: <code>false</code></p>
</li>
<li>
<p><code>lfs</code> (Bool, optional)</p>
<p>Fetch any <a href="https://git-lfs.com/">Git LFS</a> files.</p>
<p>Default: <code>false</code></p>
</li>
<li>
<p><code>allRefs</code> (Bool, optional)</p>
<p>By default, this has no effect. This becomes relevant only once <code>shallow</code> cloning is disabled.</p>
<p>Whether to fetch all references (eg. branches and tags) of the repository.
With this argument being true, it's possible to load a <code>rev</code> from <em>any</em> <code>ref</code>.
(Without setting this option, only <code>rev</code>s from the specified <code>ref</code> are supported).</p>
<p>Default: <code>false</code></p>
</li>
<li>
<p><code>lastModified</code> (Integer, optional)</p>
<p>Unix timestamp of the fetched commit.</p>
<p>If set, pass through the value to the output attribute set.
Otherwise, generated from the fetched Git tree.</p>
</li>
<li>
<p><code>revCount</code> (Integer, optional)</p>
<p>Number of revisions in the history of the Git repository before the fetched commit.</p>
<p>If set, pass through the value to the output attribute set.
Otherwise, generated from the fetched Git tree.</p>
</li>
</ul>
</li>
</ul>
<p>The following input types are still subject to change:</p>
<ul>
<li><code>"path"</code></li>
<li><code>"github"</code></li>
<li><code>"gitlab"</code></li>
<li><code>"sourcehut"</code></li>
<li><code>"mercurial"</code></li>
</ul>
<p><em>input</em> can also be a <a href="language/../command-ref/new-cli/nix3-flake.html#flake-references">URL-like reference</a>.
The additional input types and the URL-like syntax requires the <a href="language/../development/experimental-features.html#xp-feature-flakes"><code>flakes</code> experimental feature</a> to be enabled.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>Fetch a GitHub repository using the attribute set representation:</p>
<pre><code class="language-nix">builtins.fetchTree {
  type = "github";
  owner = "NixOS";
  repo = "nixpkgs";
  rev = "ae2e6b3958682513d28f7d633734571fb18285dd";
}
</code></pre>
<p>This evaluates to the following attribute set:</p>
<pre><code class="language-nix">{
  lastModified = 1686503798;
  lastModifiedDate = "20230611171638";
  narHash = "sha256-rA9RqKP9OlBrgGCPvfd5HVAXDOy8k2SmPtB/ijShNXc=";
  outPath = "/nix/store/l5m6qlvfs9sdw14ja3qbzpglcjlb6j1x-source";
  rev = "ae2e6b3958682513d28f7d633734571fb18285dd";
  shortRev = "ae2e6b3";
}
</code></pre>
</blockquote>
<blockquote>
<p><strong>Example</strong></p>
<p>Fetch the same GitHub repository using the URL-like syntax:</p>
<pre><code class="language-nix">builtins.fetchTree "github:NixOS/nixpkgs/ae2e6b3958682513d28f7d633734571fb18285dd"
</code></pre>
</blockquote>
</dd>
<dt id="builtins-fetchurl">
  <a href="language/builtins.html#builtins-fetchurl"><code>fetchurl <var>arg</var></code></a>
</dt>
<dd>
<p>Download the specified URL and return the path of the downloaded file.
<code>arg</code> can be either a string denoting the URL, or an attribute set with the following attributes:</p>
<ul>
<li>
<p><code>url</code></p>
<p>The URL of the file to download.</p>
</li>
<li>
<p><code>name</code> (default: the last path component of the URL)</p>
<p>A name for the file in the store. This can be useful if the URL has any
characters that are invalid for the store.</p>
</li>
</ul>
<p>Not available in <a href="language/../command-ref/conf-file.html#conf-restrict-eval">restricted evaluation mode</a>.</p>
</dd>
<dt id="builtins-filter">
  <a href="language/builtins.html#builtins-filter"><code>filter <var>f</var> <var>list</var></code></a>
</dt>
<dd>
<p>Return a list consisting of the elements of <em>list</em> for which the
function <em>f</em> returns <code>true</code>.</p>
</dd>
<dt id="builtins-filterSource">
  <a href="language/builtins.html#builtins-filterSource"><code>filterSource <var>e1</var> <var>e2</var></code></a>
</dt>
<dd>
<blockquote>
<p><strong>Warning</strong></p>
<p><code>filterSource</code> should not be used to filter store paths. Since
<code>filterSource</code> uses the name of the input directory while naming
the output directory, doing so will produce a directory name in
the form of <code>&lt;hash2&gt;-&lt;hash&gt;-&lt;name&gt;</code>, where <code>&lt;hash&gt;-&lt;name&gt;</code> is
the name of the input directory. Since <code>&lt;hash&gt;</code> depends on the
unfiltered directory, the name of the output directory will
indirectly depend on files that are filtered out by the
function. This will trigger a rebuild even when a filtered out
file is changed. Use <code>builtins.path</code> instead, which allows
specifying the name of the output directory.</p>
</blockquote>
<p>This function allows you to copy sources into the Nix store while
filtering certain files. For instance, suppose that you want to use
the directory <code>source-dir</code> as an input to a Nix expression, e.g.</p>
<pre><code class="language-nix">stdenv.mkDerivation {
  ...
  src = ./source-dir;
}
</code></pre>
<p>However, if <code>source-dir</code> is a Subversion working copy, then all
those annoying <code>.svn</code> subdirectories will also be copied to the
store. Worse, the contents of those directories may change a lot,
causing lots of spurious rebuilds. With <code>filterSource</code> you can
filter out the <code>.svn</code> directories:</p>
<pre><code class="language-nix">src = builtins.filterSource
  (path: type: type != "directory" || baseNameOf path != ".svn")
  ./source-dir;
</code></pre>
<p>Thus, the first argument <em>e1</em> must be a predicate function that is
called for each regular file, directory or symlink in the source
tree <em>e2</em>. If the function returns <code>true</code>, the file is copied to the
Nix store, otherwise it is omitted. The function is called with two
arguments. The first is the full path of the file. The second is a
string that identifies the type of the file, which is either
<code>"regular"</code>, <code>"directory"</code>, <code>"symlink"</code> or <code>"unknown"</code> (for other
kinds of files such as device nodes or fifos — but note that those
cannot be copied to the Nix store, so if the predicate returns
<code>true</code> for them, the copy will fail). If you exclude a directory,
the entire corresponding subtree of <em>e2</em> will be excluded.</p>
</dd>
<dt id="builtins-findFile">
  <a href="language/builtins.html#builtins-findFile"><code>findFile <var>search-path</var> <var>lookup-path</var></code></a>
</dt>
<dd>
<p>Find <em>lookup-path</em> in <em>search-path</em>.</p>
<p><a href="language/../language/constructs/lookup-path.html">Lookup path</a> expressions are <a href="https://en.wikipedia.org/wiki/Syntactic_sugar">desugared</a> using this and <a href="language/builtins.html#builtins-nixPath"><code>builtins.nixPath</code></a>:</p>
<pre><code class="language-nix">&lt;nixpkgs&gt;
</code></pre>
<p>is equivalent to:</p>
<pre><code class="language-nix">builtins.findFile builtins.nixPath "nixpkgs"
</code></pre>
<p>A search path is represented as a list of <a href="language/./types.html#attribute-set">attribute sets</a> with two attributes:</p>
<ul>
<li><code>prefix</code> is a relative path.</li>
<li><code>path</code> denotes a file system location</li>
</ul>
<p>Examples of search path attribute sets:</p>
<ul>
<li>
<pre><code>{
  prefix = "";
  path = "/nix/var/nix/profiles/per-user/root/channels";
}
</code></pre>
</li>
<li>
<pre><code>{
  prefix = "nixos-config";
  path = "/etc/nixos/configuration.nix";
}
</code></pre>
</li>
<li>
<pre><code>{
  prefix = "nixpkgs";
  path = "https://github.com/NixOS/nixpkgs/tarballs/master";
}
</code></pre>
</li>
<li>
<pre><code>{
  prefix = "nixpkgs";
  path = "channel:nixpkgs-unstable";
}
</code></pre>
</li>
<li>
<pre><code>{
  prefix = "flake-compat";
  path = "flake:github:edolstra/flake-compat";
}
</code></pre>
</li>
</ul>
<p>The lookup algorithm checks each entry until a match is found, returning a <a href="language/../language/types.html#type-path">path value</a> of the match:</p>
<ul>
<li>
<p>If a prefix of <code>lookup-path</code> matches <code>prefix</code>, then the remainder of <em>lookup-path</em> (the "suffix") is searched for within the directory denoted by <code>path</code>.
The contents of <code>path</code> may need to be downloaded at this point to look inside.</p>
</li>
<li>
<p>If the suffix is found inside that directory, then the entry is a match.
The combined absolute path of the directory (now downloaded if need be) and the suffix is returned.</p>
</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<p>A <em>search-path</em> value</p>
<pre><code>[
  {
    prefix = "";
    path = "/home/eelco/Dev";
  }
  {
    prefix = "nixos-config";
    path = "/etc/nixos";
  }
]
</code></pre>
<p>and a <em>lookup-path</em> value <code>"nixos-config"</code> will cause Nix to try <code>/home/eelco/Dev/nixos-config</code> and <code>/etc/nixos</code> in that order and return the first path that exists.</p>
</blockquote>
<p>If <code>path</code> starts with <code>http://</code> or <code>https://</code>, it is interpreted as the URL of a tarball that will be downloaded and unpacked to a temporary location.
The tarball must consist of a single top-level directory.</p>
<p>The URLs of the tarballs from the official <code>nixos.org</code> channels can be abbreviated as <code>channel:&lt;channel-name&gt;</code>.
See <a href="language/../command-ref/nix-channel.html">documentation on <code>nix-channel</code></a> for details about channels.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>These two search path entries are equivalent:</p>
<ul>
<li>
<pre><code>{
  prefix = "nixpkgs";
  path = "channel:nixpkgs-unstable";
}
</code></pre>
</li>
<li>
<pre><code>{
  prefix = "nixpkgs";
  path = "https://nixos.org/channels/nixos-unstable/nixexprs.tar.xz";
}
</code></pre>
</li>
</ul>
</blockquote>
<p>Search paths can also point to source trees using <a href="language/../command-ref/new-cli/nix3-flake.html#url-like-syntax">flake URLs</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>The search path entry</p>
<pre><code>{
  prefix = "nixpkgs";
  path = "flake:nixpkgs";
}
</code></pre>
<p>specifies that the prefix <code>nixpkgs</code> shall refer to the source tree downloaded from the <code>nixpkgs</code> entry in the flake registry.</p>
<p>Similarly</p>
<pre><code>{
  prefix = "nixpkgs";
  path = "flake:github:nixos/nixpkgs/nixos-22.05";
}
</code></pre>
<p>makes <code>&lt;nixpkgs&gt;</code> refer to a particular branch of the <code>NixOS/nixpkgs</code> repository on GitHub.</p>
</blockquote>
</dd>
<dt id="builtins-flakeRefToString">
  <a href="language/builtins.html#builtins-flakeRefToString"><code>flakeRefToString <var>attrs</var></code></a>
</dt>
<dd>
<blockquote>
<p><strong>Note</strong></p>
<p>This function is only available if the <a href="language/../development/experimental-features.html#xp-feature-flakes"><code>flakes</code> experimental feature</a> is enabled.</p>
<p>For example, include the following in <a href="language/../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = flakes
</code></pre>
</blockquote>
<p>Convert a flake reference from attribute set format to URL format.</p>
<p>For example:</p>
<pre><code class="language-nix">builtins.flakeRefToString {
  dir = "lib"; owner = "NixOS"; ref = "23.05"; repo = "nixpkgs"; type = "github";
}
</code></pre>
<p>evaluates to</p>
<pre><code class="language-nix">"github:NixOS/nixpkgs/23.05?dir=lib"
</code></pre>
</dd>
<dt id="builtins-floor">
  <a href="language/builtins.html#builtins-floor"><code>floor <var>double</var></code></a>
</dt>
<dd>
<p>Converts an IEEE-754 double-precision floating-point number (<em>double</em>) to
the next lower integer.</p>
<p>If the datatype is neither an integer nor a "float", an evaluation error will be
thrown.</p>
</dd>
<dt id="builtins-foldl'">
  <a href="language/builtins.html#builtins-foldl'"><code>foldl' <var>op</var> <var>nul</var> <var>list</var></code></a>
</dt>
<dd>
<p>Reduce a list by applying a binary operator, from left to right,
e.g. <code>foldl' op nul [x0 x1 x2 ...] = op (op (op nul x0) x1) x2) ...</code>.</p>
<p>For example, <code>foldl' (acc: elem: acc + elem) 0 [1 2 3]</code> evaluates
to <code>6</code> and <code>foldl' (acc: elem: { "${elem}" = elem; } // acc) {} ["a" "b"]</code> evaluates to <code>{ a = "a"; b = "b"; }</code>.</p>
<p>The first argument of <code>op</code> is the accumulator whereas the second
argument is the current element being processed. The return value
of each application of <code>op</code> is evaluated immediately, even for
intermediate values.</p>
</dd>
<dt id="builtins-fromJSON">
  <a href="language/builtins.html#builtins-fromJSON"><code>fromJSON <var>e</var></code></a>
</dt>
<dd>
<p>Convert a JSON string to a Nix value. For example,</p>
<pre><code class="language-nix">builtins.fromJSON ''{"x": [1, 2, 3], "y": null}''
</code></pre>
<p>returns the value <code>{ x = [ 1 2 3 ]; y = null; }</code>.</p>
</dd>
<dt id="builtins-fromTOML">
  <a href="language/builtins.html#builtins-fromTOML"><code>fromTOML <var>e</var></code></a>
</dt>
<dd>
<p>Convert a TOML string to a Nix value. For example,</p>
<pre><code class="language-nix">builtins.fromTOML ''
  x=1
  s="a"
  [table]
  y=2
''
</code></pre>
<p>returns the value <code>{ s = "a"; table = { y = 2; }; x = 1; }</code>.</p>
</dd>
<dt id="builtins-functionArgs">
  <a href="language/builtins.html#builtins-functionArgs"><code>functionArgs <var>f</var></code></a>
</dt>
<dd>
<p>Return a set containing the names of the formal arguments expected
by the function <em>f</em>. The value of each attribute is a Boolean
denoting whether the corresponding argument has a default value. For
instance, <code>functionArgs ({ x, y ? 123}: ...) = { x = false; y = true; }</code>.</p>
<p>"Formal argument" here refers to the attributes pattern-matched by
the function. Plain lambdas are not included, e.g. <code>functionArgs (x: ...) = { }</code>.</p>
</dd>
<dt id="builtins-genList">
  <a href="language/builtins.html#builtins-genList"><code>genList <var>generator</var> <var>length</var></code></a>
</dt>
<dd>
<p>Generate list of size <em>length</em>, with each element <em>i</em> equal to the
value returned by <em>generator</em> <code>i</code>. For example,</p>
<pre><code class="language-nix">builtins.genList (x: x * x) 5
</code></pre>
<p>returns the list <code>[ 0 1 4 9 16 ]</code>.</p>
</dd>
<dt id="builtins-genericClosure">
  <a href="language/builtins.html#builtins-genericClosure"><code>genericClosure <var>attrset</var></code></a>
</dt>
<dd>
<p><code>builtins.genericClosure</code> iteratively computes the transitive closure over an arbitrary relation defined by a function.</p>
<p>It takes <em>attrset</em> with two attributes named <code>startSet</code> and <code>operator</code>, and returns a list of attribute sets:</p>
<ul>
<li>
<p><code>startSet</code>:
The initial list of attribute sets.</p>
</li>
<li>
<p><code>operator</code>:
A function that takes an attribute set and returns a list of attribute sets.
It defines how each item in the current set is processed and expanded into more items.</p>
</li>
</ul>
<p>Each attribute set in the list <code>startSet</code> and the list returned by <code>operator</code> must have an attribute <code>key</code>, which must support equality comparison.
The value of <code>key</code> can be one of the following types:</p>
<ul>
<li><a href="language/../language/types.html#type-int">Int</a></li>
<li><a href="language/../language/types.html#type-float">Float</a></li>
<li><a href="language/../language/types.html#type-boolean">Boolean</a></li>
<li><a href="language/../language/types.html#type-string">String</a></li>
<li><a href="language/../language/types.html#type-path">Path</a></li>
<li><a href="language/../language/types.html#list">List</a></li>
</ul>
<p>The result is produced by calling the <code>operator</code> on each <code>item</code> that has not been called yet, including newly added items, until no new items are added.
Items are compared by their <code>key</code> attribute.</p>
<p>Common usages are:</p>
<ul>
<li>Generating unique collections of items, such as dependency graphs.</li>
<li>Traversing through structures that may contain cycles or loops.</li>
<li>Processing data structures with complex internal relationships.</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">builtins.genericClosure {
  startSet = [ {key = 5;} ];
  operator = item: [{
    key = if (item.key / 2 ) * 2 == item.key
         then item.key / 2
         else 3 * item.key + 1;
  }];
}
</code></pre>
<p>evaluates to</p>
<pre><code class="language-nix">[ { key = 5; } { key = 16; } { key = 8; } { key = 4; } { key = 2; } { key = 1; } ]
</code></pre>
</blockquote>
</dd>
<dt id="builtins-getAttr">
  <a href="language/builtins.html#builtins-getAttr"><code>getAttr <var>s</var> <var>set</var></code></a>
</dt>
<dd>
<p><code>getAttr</code> returns the attribute named <em>s</em> from <em>set</em>. Evaluation
aborts if the attribute doesn’t exist. This is a dynamic version of
the <code>.</code> operator, since <em>s</em> is an expression rather than an
identifier.</p>
</dd>
<dt id="builtins-getContext">
  <a href="language/builtins.html#builtins-getContext"><code>getContext <var>s</var></code></a>
</dt>
<dd>
<p>Return the string context of <em>s</em>.</p>
<p>The string context tracks references to derivations within a string.
It is represented as an attribute set of <a href="language/../glossary.html#gloss-store-derivation">store derivation</a> paths mapping to output names.</p>
<p>Using <a href="language/../language/string-interpolation.html">string interpolation</a> on a derivation will add that derivation to the string context.
For example,</p>
<pre><code class="language-nix">builtins.getContext "${derivation { name = "a"; builder = "b"; system = "c"; }}"
</code></pre>
<p>evaluates to</p>
<pre><code>{ "/nix/store/arhvjaf6zmlyn8vh8fgn55rpwnxq0n7l-a.drv" = { outputs = [ "out" ]; }; }
</code></pre>
</dd>
<dt id="builtins-getEnv">
  <a href="language/builtins.html#builtins-getEnv"><code>getEnv <var>s</var></code></a>
</dt>
<dd>
<p><code>getEnv</code> returns the value of the environment variable <em>s</em>, or an
empty string if the variable doesn’t exist. This function should be
used with care, as it can introduce all sorts of nasty environment
dependencies in your Nix expression.</p>
<p><code>getEnv</code> is used in Nix Packages to locate the file
<code>~/.nixpkgs/config.nix</code>, which contains user-local settings for Nix
Packages. (That is, it does a <code>getEnv "HOME"</code> to locate the user’s
home directory.)</p>
</dd>
<dt id="builtins-getFlake">
  <a href="language/builtins.html#builtins-getFlake"><code>getFlake <var>args</var></code></a>
</dt>
<dd>
<blockquote>
<p><strong>Note</strong></p>
<p>This function is only available if the <a href="language/../development/experimental-features.html#xp-feature-flakes"><code>flakes</code> experimental feature</a> is enabled.</p>
<p>For example, include the following in <a href="language/../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = flakes
</code></pre>
</blockquote>
<p>Fetch a flake from a flake reference, and return its output attributes and some metadata. For example:</p>
<pre><code class="language-nix">(builtins.getFlake "nix/55bc52401966fbffa525c574c14f67b00bc4fb3a").packages.x86_64-linux.nix
</code></pre>
<p>Unless impure evaluation is allowed (<code>--impure</code>), the flake reference
must be "locked", e.g. contain a Git revision or content hash. An
example of an unlocked usage is:</p>
<pre><code class="language-nix">(builtins.getFlake "github:edolstra/dwarffs").rev
</code></pre>
</dd>
<dt id="builtins-groupBy">
  <a href="language/builtins.html#builtins-groupBy"><code>groupBy <var>f</var> <var>list</var></code></a>
</dt>
<dd>
<p>Groups elements of <em>list</em> together by the string returned from the
function <em>f</em> called on each element. It returns an attribute set
where each attribute value contains the elements of <em>list</em> that are
mapped to the same corresponding attribute name returned by <em>f</em>.</p>
<p>For example,</p>
<pre><code class="language-nix">builtins.groupBy (builtins.substring 0 1) ["foo" "bar" "baz"]
</code></pre>
<p>evaluates to</p>
<pre><code class="language-nix">{ b = [ "bar" "baz" ]; f = [ "foo" ]; }
</code></pre>
</dd>
<dt id="builtins-hasAttr">
  <a href="language/builtins.html#builtins-hasAttr"><code>hasAttr <var>s</var> <var>set</var></code></a>
</dt>
<dd>
<p><code>hasAttr</code> returns <code>true</code> if <em>set</em> has an attribute named <em>s</em>, and
<code>false</code> otherwise. This is a dynamic version of the <code>?</code> operator,
since <em>s</em> is an expression rather than an identifier.</p>
</dd>
<dt id="builtins-hasContext">
  <a href="language/builtins.html#builtins-hasContext"><code>hasContext <var>s</var></code></a>
</dt>
<dd>
<p>Return <code>true</code> if string <em>s</em> has a non-empty context.
The context can be obtained with
<a href="language/builtins.html#builtins-getContext"><code>getContext</code></a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>Many operations require a string context to be empty because they are intended only to work with "regular" strings, and also to help users avoid unintentionally loosing track of string context elements.
<code>builtins.hasContext</code> can help create better domain-specific errors in those case.</p>
<pre><code class="language-nix">name: meta:

if builtins.hasContext name
then throw "package name cannot contain string context"
else { ${name} = meta; }
</code></pre>
</blockquote>
</dd>
<dt id="builtins-hashFile">
  <a href="language/builtins.html#builtins-hashFile"><code>hashFile <var>type</var> <var>p</var></code></a>
</dt>
<dd>
<p>Return a base-16 representation of the cryptographic hash of the
file at path <em>p</em>. The hash algorithm specified by <em>type</em> must be one
of <code>"md5"</code>, <code>"sha1"</code>, <code>"sha256"</code> or <code>"sha512"</code>.</p>
</dd>
<dt id="builtins-hashString">
  <a href="language/builtins.html#builtins-hashString"><code>hashString <var>type</var> <var>s</var></code></a>
</dt>
<dd>
<p>Return a base-16 representation of the cryptographic hash of string
<em>s</em>. The hash algorithm specified by <em>type</em> must be one of <code>"md5"</code>,
<code>"sha1"</code>, <code>"sha256"</code> or <code>"sha512"</code>.</p>
</dd>
<dt id="builtins-head">
  <a href="language/builtins.html#builtins-head"><code>head <var>list</var></code></a>
</dt>
<dd>
<p>Return the first element of a list; abort evaluation if the argument
isn’t a list or is an empty list. You can test whether a list is
empty by comparing it with <code>[]</code>.</p>
</dd>
<dt id="builtins-import">
  <a href="language/builtins.html#builtins-import"><code>import <var>path</var></code></a>
</dt>
<dd>
<p>Load, parse, and return the Nix expression in the file <em>path</em>.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>Unlike some languages, <code>import</code> is a regular function in Nix.</p>
</blockquote>
<p>The <em>path</em> argument must meet the same criteria as an <a href="language/../language/string-interpolation.html#interpolated-expression">interpolated expression</a>.</p>
<p>If <em>path</em> is a directory, the file <code>default.nix</code> in that directory is used if it exists.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-console">$ echo 123 &gt; default.nix
</code></pre>
<p>Import <code>default.nix</code> from the current directory.</p>
<pre><code class="language-nix">import ./.
</code></pre>
<pre><code>123
</code></pre>
</blockquote>
<p>Evaluation aborts if the file doesn’t exist or contains an invalid Nix expression.</p>
<p>A Nix expression loaded by <code>import</code> must not contain any <em>free variables</em>, that is, identifiers that are not defined in the Nix expression itself and are not built-in.
Therefore, it cannot refer to variables that are in scope at the call site.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>If you have a calling expression</p>
<pre><code class="language-nix">rec {
  x = 123;
  y = import ./foo.nix;
}
</code></pre>
<p>then the following <code>foo.nix</code> will give an error:</p>
<pre><code class="language-nix"># foo.nix
x + 456
</code></pre>
<p>since <code>x</code> is not in scope in <code>foo.nix</code>.
If you want <code>x</code> to be available in <code>foo.nix</code>, pass it as a function argument:</p>
<pre><code class="language-nix">rec {
  x = 123;
  y = import ./foo.nix x;
}
</code></pre>
<p>and</p>
<pre><code class="language-nix"># foo.nix
x: x + 456
</code></pre>
<p>The function argument doesn’t have to be called <code>x</code> in <code>foo.nix</code>; any name would work.</p>
</blockquote>
</dd>
<dt id="builtins-intersectAttrs">
  <a href="language/builtins.html#builtins-intersectAttrs"><code>intersectAttrs <var>e1</var> <var>e2</var></code></a>
</dt>
<dd>
<p>Return a set consisting of the attributes in the set <em>e2</em> which have the
same name as some attribute in <em>e1</em>.</p>
<p>Performs in O(<em>n</em> log <em>m</em>) where <em>n</em> is the size of the smaller set and <em>m</em> the larger set's size.</p>
</dd>
<dt id="builtins-isAttrs">
  <a href="language/builtins.html#builtins-isAttrs"><code>isAttrs <var>e</var></code></a>
</dt>
<dd>
<p>Return <code>true</code> if <em>e</em> evaluates to a set, and <code>false</code> otherwise.</p>
</dd>
<dt id="builtins-isBool">
  <a href="language/builtins.html#builtins-isBool"><code>isBool <var>e</var></code></a>
</dt>
<dd>
<p>Return <code>true</code> if <em>e</em> evaluates to a bool, and <code>false</code> otherwise.</p>
</dd>
<dt id="builtins-isFloat">
  <a href="language/builtins.html#builtins-isFloat"><code>isFloat <var>e</var></code></a>
</dt>
<dd>
<p>Return <code>true</code> if <em>e</em> evaluates to a float, and <code>false</code> otherwise.</p>
</dd>
<dt id="builtins-isFunction">
  <a href="language/builtins.html#builtins-isFunction"><code>isFunction <var>e</var></code></a>
</dt>
<dd>
<p>Return <code>true</code> if <em>e</em> evaluates to a function, and <code>false</code> otherwise.</p>
</dd>
<dt id="builtins-isInt">
  <a href="language/builtins.html#builtins-isInt"><code>isInt <var>e</var></code></a>
</dt>
<dd>
<p>Return <code>true</code> if <em>e</em> evaluates to an integer, and <code>false</code> otherwise.</p>
</dd>
<dt id="builtins-isList">
  <a href="language/builtins.html#builtins-isList"><code>isList <var>e</var></code></a>
</dt>
<dd>
<p>Return <code>true</code> if <em>e</em> evaluates to a list, and <code>false</code> otherwise.</p>
</dd>
<dt id="builtins-isNull">
  <a href="language/builtins.html#builtins-isNull"><code>isNull <var>e</var></code></a>
</dt>
<dd>
<p>Return <code>true</code> if <em>e</em> evaluates to <code>null</code>, and <code>false</code> otherwise.</p>
<p>This is equivalent to <code>e == null</code>.</p>
</dd>
<dt id="builtins-isPath">
  <a href="language/builtins.html#builtins-isPath"><code>isPath <var>e</var></code></a>
</dt>
<dd>
<p>Return <code>true</code> if <em>e</em> evaluates to a path, and <code>false</code> otherwise.</p>
</dd>
<dt id="builtins-isString">
  <a href="language/builtins.html#builtins-isString"><code>isString <var>e</var></code></a>
</dt>
<dd>
<p>Return <code>true</code> if <em>e</em> evaluates to a string, and <code>false</code> otherwise.</p>
</dd>
<dt id="builtins-langVersion">
  <a href="language/builtins.html#builtins-langVersion"><code>langVersion</code></a> (integer)
</dt>
<dd>
<p>The current version of the Nix language.</p>
</dd>
<dt id="builtins-length">
  <a href="language/builtins.html#builtins-length"><code>length <var>e</var></code></a>
</dt>
<dd>
<p>Return the length of the list <em>e</em>.</p>
</dd>
<dt id="builtins-lessThan">
  <a href="language/builtins.html#builtins-lessThan"><code>lessThan <var>e1</var> <var>e2</var></code></a>
</dt>
<dd>
<p>Return <code>true</code> if the number <em>e1</em> is less than the number <em>e2</em>, and
<code>false</code> otherwise. Evaluation aborts if either <em>e1</em> or <em>e2</em> does not
evaluate to a number.</p>
</dd>
<dt id="builtins-listToAttrs">
  <a href="language/builtins.html#builtins-listToAttrs"><code>listToAttrs <var>e</var></code></a>
</dt>
<dd>
<p>Construct a set from a list specifying the names and values of each
attribute. Each element of the list should be a set consisting of a
string-valued attribute <code>name</code> specifying the name of the attribute,
and an attribute <code>value</code> specifying its value.</p>
<p>In case of duplicate occurrences of the same name, the first
takes precedence.</p>
<p>Example:</p>
<pre><code class="language-nix">builtins.listToAttrs
  [ { name = "foo"; value = 123; }
    { name = "bar"; value = 456; }
    { name = "bar"; value = 420; }
  ]
</code></pre>
<p>evaluates to</p>
<pre><code class="language-nix">{ foo = 123; bar = 456; }
</code></pre>
</dd>
<dt id="builtins-map">
  <a href="language/builtins.html#builtins-map"><code>map <var>f</var> <var>list</var></code></a>
</dt>
<dd>
<p>Apply the function <em>f</em> to each element in the list <em>list</em>. For
example,</p>
<pre><code class="language-nix">map (x: "foo" + x) [ "bar" "bla" "abc" ]
</code></pre>
<p>evaluates to <code>[ "foobar" "foobla" "fooabc" ]</code>.</p>
</dd>
<dt id="builtins-mapAttrs">
  <a href="language/builtins.html#builtins-mapAttrs"><code>mapAttrs <var>f</var> <var>attrset</var></code></a>
</dt>
<dd>
<p>Apply function <em>f</em> to every element of <em>attrset</em>. For example,</p>
<pre><code class="language-nix">builtins.mapAttrs (name: value: value * 10) { a = 1; b = 2; }
</code></pre>
<p>evaluates to <code>{ a = 10; b = 20; }</code>.</p>
</dd>
<dt id="builtins-match">
  <a href="language/builtins.html#builtins-match"><code>match <var>regex</var> <var>str</var></code></a>
</dt>
<dd>
<p>Returns a list if the <a href="http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap09.html#tag_09_04">extended POSIX regular
expression</a>
<em>regex</em> matches <em>str</em> precisely, otherwise returns <code>null</code>. Each item
in the list is a regex group.</p>
<pre><code class="language-nix">builtins.match "ab" "abc"
</code></pre>
<p>Evaluates to <code>null</code>.</p>
<pre><code class="language-nix">builtins.match "abc" "abc"
</code></pre>
<p>Evaluates to <code>[ ]</code>.</p>
<pre><code class="language-nix">builtins.match "a(b)(c)" "abc"
</code></pre>
<p>Evaluates to <code>[ "b" "c" ]</code>.</p>
<pre><code class="language-nix">builtins.match "[[:space:]]+([[:upper:]]+)[[:space:]]+" "  FOO   "
</code></pre>
<p>Evaluates to <code>[ "FOO" ]</code>.</p>
</dd>
<dt id="builtins-mul">
  <a href="language/builtins.html#builtins-mul"><code>mul <var>e1</var> <var>e2</var></code></a>
</dt>
<dd>
<p>Return the product of the numbers <em>e1</em> and <em>e2</em>.</p>
</dd>
<dt id="builtins-nixPath">
  <a href="language/builtins.html#builtins-nixPath"><code>nixPath</code></a> (list)
</dt>
<dd>
<p>A list of search path entries used to resolve <a href="language/../language/constructs/lookup-path.html">lookup paths</a>.
Its value is primarily determined by the <a href="language/../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>, which are</p>
<ul>
<li>Overridden by the <a href="language/../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code></a> environment variable or the <code>--nix-path</code> option</li>
<li>Extended by the <a href="language/../command-ref/opt-common.html#opt-I"><code>-I</code> option</a> or <code>--extra-nix-path</code></li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval --expr "builtins.nixPath" -I foo=bar --no-pure-eval
[ { path = "bar"; prefix = "foo"; } ]
</code></pre>
</blockquote>
<p>Lookup path expressions are <a href="https://en.wikipedia.org/wiki/Syntactic_sugar">desugared</a> using this and
<a href="language/./builtins.html#builtins-findFile"><code>builtins.findFile</code></a>:</p>
<pre><code class="language-nix">&lt;nixpkgs&gt;
</code></pre>
<p>is equivalent to:</p>
<pre><code class="language-nix">builtins.findFile builtins.nixPath "nixpkgs"
</code></pre>
</dd>
<dt id="builtins-nixVersion">
  <a href="language/builtins.html#builtins-nixVersion"><code>nixVersion</code></a> (string)
</dt>
<dd>
<p>The version of Nix.</p>
<p>For example, where the command line returns the current Nix version,</p>
<pre><code class="language-shell-session">$ nix --version
nix (Nix) 2.16.0
</code></pre>
<p>the Nix language evaluator returns the same value:</p>
<pre><code class="language-nix-repl">nix-repl&gt; builtins.nixVersion
"2.16.0"
</code></pre>
</dd>
<dt id="builtins-null">
  <a href="language/builtins.html#builtins-null"><code>null</code></a> (null)
</dt>
<dd>
<p>Primitive value.</p>
<p>The name <code>null</code> is not special, and can be shadowed:</p>
<pre><code class="language-nix-repl">nix-repl&gt; let null = 1; in null
1
</code></pre>
</dd>
<dt id="builtins-outputOf">
  <a href="language/builtins.html#builtins-outputOf"><code>outputOf <var>derivation-reference</var> <var>output-name</var></code></a>
</dt>
<dd>
<blockquote>
<p><strong>Note</strong></p>
<p>This function is only available if the <a href="language/../development/experimental-features.html#xp-feature-dynamic-derivations"><code>dynamic-derivations</code> experimental feature</a> is enabled.</p>
<p>For example, include the following in <a href="language/../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = dynamic-derivations
</code></pre>
</blockquote>
<p>Return the output path of a derivation, literally or using an
<a href="language/../store/derivation/index.html#input-placeholder">input placeholder string</a>
if needed.</p>
<p>If the derivation has a statically-known output path (i.e. the derivation output is input-addressed, or fixed content-addresed), the output path will just be returned.
But if the derivation is content-addressed or if the derivation is itself not-statically produced (i.e. is the output of another derivation), an input placeholder will be returned instead.</p>
<p><em><code>derivation reference</code></em> must be a string that may contain a regular store path to a derivation, or may be an input placeholder reference.
If the derivation is produced by a derivation, you must explicitly select <code>drv.outPath</code>.
This primop can be chained arbitrarily deeply.
For instance,</p>
<pre><code class="language-nix">builtins.outputOf
  (builtins.outputOf myDrv "out")
  "out"
</code></pre>
<p>will return a input placeholder for the output of the output of <code>myDrv</code>.</p>
<p>This primop corresponds to the <code>^</code> sigil for <a href="language/../glossary.html#gloss-deriving-paths">deriving paths</a>, e.g. as part of installable syntax on the command line.</p>
</dd>
<dt id="builtins-parseDrvName">
  <a href="language/builtins.html#builtins-parseDrvName"><code>parseDrvName <var>s</var></code></a>
</dt>
<dd>
<p>Split the string <em>s</em> into a package name and version. The package
name is everything up to but not including the first dash not followed
by a letter, and the version is everything following that dash. The
result is returned in a set <code>{ name, version }</code>. Thus,
<code>builtins.parseDrvName "nix-0.12pre12876"</code> returns <code>{ name = "nix"; version = "0.12pre12876"; }</code>.</p>
</dd>
<dt id="builtins-parseFlakeRef">
  <a href="language/builtins.html#builtins-parseFlakeRef"><code>parseFlakeRef <var>flake-ref</var></code></a>
</dt>
<dd>
<blockquote>
<p><strong>Note</strong></p>
<p>This function is only available if the <a href="language/../development/experimental-features.html#xp-feature-flakes"><code>flakes</code> experimental feature</a> is enabled.</p>
<p>For example, include the following in <a href="language/../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = flakes
</code></pre>
</blockquote>
<p>Parse a flake reference, and return its exploded form.</p>
<p>For example:</p>
<pre><code class="language-nix">builtins.parseFlakeRef "github:NixOS/nixpkgs/23.05?dir=lib"
</code></pre>
<p>evaluates to:</p>
<pre><code class="language-nix">{ dir = "lib"; owner = "NixOS"; ref = "23.05"; repo = "nixpkgs"; type = "github"; }
</code></pre>
</dd>
<dt id="builtins-partition">
  <a href="language/builtins.html#builtins-partition"><code>partition <var>pred</var> <var>list</var></code></a>
</dt>
<dd>
<p>Given a predicate function <em>pred</em>, this function returns an
attrset containing a list named <code>right</code>, containing the elements
in <em>list</em> for which <em>pred</em> returned <code>true</code>, and a list named
<code>wrong</code>, containing the elements for which it returned
<code>false</code>. For example,</p>
<pre><code class="language-nix">builtins.partition (x: x &gt; 10) [1 23 9 3 42]
</code></pre>
<p>evaluates to</p>
<pre><code class="language-nix">{ right = [ 23 42 ]; wrong = [ 1 9 3 ]; }
</code></pre>
</dd>
<dt id="builtins-path">
  <a href="language/builtins.html#builtins-path"><code>path <var>args</var></code></a>
</dt>
<dd>
<p>An enrichment of the built-in path type, based on the attributes
present in <em>args</em>. All are optional except <code>path</code>:</p>
<ul>
<li>
<p>path<br />
The underlying path.</p>
</li>
<li>
<p>name<br />
The name of the path when added to the store. This can used to
reference paths that have nix-illegal characters in their names,
like <code>@</code>.</p>
</li>
<li>
<p>filter<br />
A function of the type expected by <a href="language/builtins.html#builtins-filterSource"><code>builtins.filterSource</code></a>,
with the same semantics.</p>
</li>
<li>
<p>recursive<br />
When <code>false</code>, when <code>path</code> is added to the store it is with a
flat hash, rather than a hash of the NAR serialization of the
file. Thus, <code>path</code> must refer to a regular file, not a
directory. This allows similar behavior to <code>fetchurl</code>. Defaults
to <code>true</code>.</p>
</li>
<li>
<p>sha256<br />
When provided, this is the expected hash of the file at the
path. Evaluation will fail if the hash is incorrect, and
providing a hash allows <code>builtins.path</code> to be used even when the
<code>pure-eval</code> nix config option is on.</p>
</li>
</ul>
</dd>
<dt id="builtins-pathExists">
  <a href="language/builtins.html#builtins-pathExists"><code>pathExists <var>path</var></code></a>
</dt>
<dd>
<p>Return <code>true</code> if the path <em>path</em> exists at evaluation time, and
<code>false</code> otherwise.</p>
</dd>
<dt id="builtins-placeholder">
  <a href="language/builtins.html#builtins-placeholder"><code>placeholder <var>output</var></code></a>
</dt>
<dd>
<p>Return at
<a href="language/../store/derivation/index.html#output-placeholder">output placeholder string</a>
for the specified <em>output</em> that will be substituted by the corresponding
<a href="language/../glossary.html#gloss-output-path">output path</a>
at build time.</p>
<p>Typical outputs would be <code>"out"</code>, <code>"bin"</code> or <code>"dev"</code>.</p>
</dd>
<dt id="builtins-readDir">
  <a href="language/builtins.html#builtins-readDir"><code>readDir <var>path</var></code></a>
</dt>
<dd>
<p>Return the contents of the directory <em>path</em> as a set mapping
directory entries to the corresponding file type. For instance, if
directory <code>A</code> contains a regular file <code>B</code> and another directory
<code>C</code>, then <code>builtins.readDir ./A</code> will return the set</p>
<pre><code class="language-nix">{ B = "regular"; C = "directory"; }
</code></pre>
<p>The possible values for the file type are <code>"regular"</code>,
<code>"directory"</code>, <code>"symlink"</code> and <code>"unknown"</code>.</p>
</dd>
<dt id="builtins-readFile">
  <a href="language/builtins.html#builtins-readFile"><code>readFile <var>path</var></code></a>
</dt>
<dd>
<p>Return the contents of the file <em>path</em> as a string.</p>
</dd>
<dt id="builtins-readFileType">
  <a href="language/builtins.html#builtins-readFileType"><code>readFileType <var>p</var></code></a>
</dt>
<dd>
<p>Determine the directory entry type of a filesystem node, being
one of <code>"directory"</code>, <code>"regular"</code>, <code>"symlink"</code>, or <code>"unknown"</code>.</p>
</dd>
<dt id="builtins-removeAttrs">
  <a href="language/builtins.html#builtins-removeAttrs"><code>removeAttrs <var>set</var> <var>list</var></code></a>
</dt>
<dd>
<p>Remove the attributes listed in <em>list</em> from <em>set</em>. The attributes
don’t have to exist in <em>set</em>. For instance,</p>
<pre><code class="language-nix">removeAttrs { x = 1; y = 2; z = 3; } [ "a" "x" "z" ]
</code></pre>
<p>evaluates to <code>{ y = 2; }</code>.</p>
</dd>
<dt id="builtins-replaceStrings">
  <a href="language/builtins.html#builtins-replaceStrings"><code>replaceStrings <var>from</var> <var>to</var> <var>s</var></code></a>
</dt>
<dd>
<p>Given string <em>s</em>, replace every occurrence of the strings in <em>from</em>
with the corresponding string in <em>to</em>.</p>
<p>The argument <em>to</em> is lazy, that is, it is only evaluated when its corresponding pattern in <em>from</em> is matched in the string <em>s</em></p>
<p>Example:</p>
<pre><code class="language-nix">builtins.replaceStrings ["oo" "a"] ["a" "i"] "foobar"
</code></pre>
<p>evaluates to <code>"fabir"</code>.</p>
</dd>
<dt id="builtins-seq">
  <a href="language/builtins.html#builtins-seq"><code>seq <var>e1</var> <var>e2</var></code></a>
</dt>
<dd>
<p>Evaluate <em>e1</em>, then evaluate and return <em>e2</em>. This ensures that a
computation is strict in the value of <em>e1</em>.</p>
</dd>
<dt id="builtins-sort">
  <a href="language/builtins.html#builtins-sort"><code>sort <var>comparator</var> <var>list</var></code></a>
</dt>
<dd>
<p>Return <em>list</em> in sorted order. It repeatedly calls the function
<em>comparator</em> with two elements. The comparator should return <code>true</code>
if the first element is less than the second, and <code>false</code> otherwise.
For example,</p>
<pre><code class="language-nix">builtins.sort builtins.lessThan [ 483 249 526 147 42 77 ]
</code></pre>
<p>produces the list <code>[ 42 77 147 249 483 526 ]</code>.</p>
<p>This is a stable sort: it preserves the relative order of elements
deemed equal by the comparator.</p>
</dd>
<dt id="builtins-split">
  <a href="language/builtins.html#builtins-split"><code>split <var>regex</var> <var>str</var></code></a>
</dt>
<dd>
<p>Returns a list composed of non matched strings interleaved with the
lists of the <a href="http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap09.html#tag_09_04">extended POSIX regular
expression</a>
<em>regex</em> matches of <em>str</em>. Each item in the lists of matched
sequences is a regex group.</p>
<pre><code class="language-nix">builtins.split "(a)b" "abc"
</code></pre>
<p>Evaluates to <code>[ "" [ "a" ] "c" ]</code>.</p>
<pre><code class="language-nix">builtins.split "([ac])" "abc"
</code></pre>
<p>Evaluates to <code>[ "" [ "a" ] "b" [ "c" ] "" ]</code>.</p>
<pre><code class="language-nix">builtins.split "(a)|(c)" "abc"
</code></pre>
<p>Evaluates to <code>[ "" [ "a" null ] "b" [ null "c" ] "" ]</code>.</p>
<pre><code class="language-nix">builtins.split "([[:upper:]]+)" " FOO "
</code></pre>
<p>Evaluates to <code>[ " " [ "FOO" ] " " ]</code>.</p>
</dd>
<dt id="builtins-splitVersion">
  <a href="language/builtins.html#builtins-splitVersion"><code>splitVersion <var>s</var></code></a>
</dt>
<dd>
<p>Split a string representing a version into its components, by the
same version splitting logic underlying the version comparison in
<a href="language/../command-ref/nix-env.html#operation---upgrade"><code>nix-env -u</code></a>.</p>
</dd>
<dt id="builtins-storeDir">
  <a href="language/builtins.html#builtins-storeDir"><code>storeDir</code></a> (string)
</dt>
<dd>
<p>Logical file system location of the <a href="language/../glossary.html#gloss-store">Nix store</a> currently in use.</p>
<p>This value is determined by the <code>store</code> parameter in <a href="language/../store/types/index.html#store-url-format">Store URLs</a>:</p>
<pre><code class="language-shell-session">$ nix-instantiate --store 'dummy://?store=/blah' --eval --expr builtins.storeDir
"/blah"
</code></pre>
</dd>
<dt id="builtins-storePath">
  <a href="language/builtins.html#builtins-storePath"><code>storePath <var>path</var></code></a>
</dt>
<dd>
<p>This function allows you to define a dependency on an already
existing store path. For example, the derivation attribute <code>src = builtins.storePath /nix/store/f1d18v1y…-source</code> causes the
derivation to depend on the specified path, which must exist or
be substitutable. Note that this differs from a plain path
(e.g. <code>src = /nix/store/f1d18v1y…-source</code>) in that the latter
causes the path to be <em>copied</em> again to the Nix store, resulting
in a new path (e.g. <code>/nix/store/ld01dnzc…-source-source</code>).</p>
<p>Not available in <a href="language/../command-ref/conf-file.html#conf-pure-eval">pure evaluation mode</a>.</p>
<p>See also <a href="language/builtins.html#builtins-fetchClosure"><code>builtins.fetchClosure</code></a>.</p>
</dd>
<dt id="builtins-stringLength">
  <a href="language/builtins.html#builtins-stringLength"><code>stringLength <var>e</var></code></a>
</dt>
<dd>
<p>Return the number of bytes of the string <em>e</em>. If <em>e</em> is not a string,
evaluation is aborted.</p>
</dd>
<dt id="builtins-sub">
  <a href="language/builtins.html#builtins-sub"><code>sub <var>e1</var> <var>e2</var></code></a>
</dt>
<dd>
<p>Return the difference between the numbers <em>e1</em> and <em>e2</em>.</p>
</dd>
<dt id="builtins-substring">
  <a href="language/builtins.html#builtins-substring"><code>substring <var>start</var> <var>len</var> <var>s</var></code></a>
</dt>
<dd>
<p>Return the substring of <em>s</em> from byte position <em>start</em>
(zero-based) up to but not including <em>start + len</em>. If <em>start</em> is
greater than the length of the string, an empty string is returned.
If <em>start + len</em> lies beyond the end of the string or <em>len</em> is <code>-1</code>,
only the substring up to the end of the string is returned.
<em>start</em> must be non-negative.
For example,</p>
<pre><code class="language-nix">builtins.substring 0 3 "nixos"
</code></pre>
<p>evaluates to <code>"nix"</code>.</p>
</dd>
<dt id="builtins-tail">
  <a href="language/builtins.html#builtins-tail"><code>tail <var>list</var></code></a>
</dt>
<dd>
<p>Return the list without its first item; abort evaluation if
the argument isn’t a list or is an empty list.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This function should generally be avoided since it's inefficient:
unlike Haskell's <code>tail</code>, it takes O(n) time, so recursing over a
list by repeatedly calling <code>tail</code> takes O(n^2) time.</p>
</blockquote>
</dd>
<dt id="builtins-throw">
  <a href="language/builtins.html#builtins-throw"><code>throw <var>s</var></code></a>
</dt>
<dd>
<p>Throw an error message <em>s</em>. This usually aborts Nix expression
evaluation, but in <code>nix-env -qa</code> and other commands that try to
evaluate a set of derivations to get information about those
derivations, a derivation that throws an error is silently skipped
(which is not the case for <code>abort</code>).</p>
</dd>
<dt id="builtins-toFile">
  <a href="language/builtins.html#builtins-toFile"><code>toFile <var>name</var> <var>s</var></code></a>
</dt>
<dd>
<p>Store the string <em>s</em> in a file in the Nix store and return its
path.  The file has suffix <em>name</em>. This file can be used as an
input to derivations. One application is to write builders
“inline”. For instance, the following Nix expression combines the
Nix expression for GNU Hello and its build script into one file:</p>
<pre><code class="language-nix">{ stdenv, fetchurl, perl }:

stdenv.mkDerivation {
  name = "hello-2.1.1";

  builder = builtins.toFile "builder.sh" "
    source $stdenv/setup

    PATH=$perl/bin:$PATH

    tar xvfz $src
    cd hello-*
    ./configure --prefix=$out
    make
    make install
  ";

  src = fetchurl {
    url = "http://ftp.nluug.nl/pub/gnu/hello/hello-2.1.1.tar.gz";
    sha256 = "1md7jsfd8pa45z73bz1kszpp01yw6x5ljkjk2hx7wl800any6465";
  };
  inherit perl;
}
</code></pre>
<p>It is even possible for one file to refer to another, e.g.,</p>
<pre><code class="language-nix">builder = let
  configFile = builtins.toFile "foo.conf" "
    # This is some dummy configuration file.
    ...
  ";
in builtins.toFile "builder.sh" "
  source $stdenv/setup
  ...
  cp ${configFile} $out/etc/foo.conf
";
</code></pre>
<p>Note that <code>${configFile}</code> is a
<a href="language/../language/types.html#type-string">string interpolation</a>, so the result of the
expression <code>configFile</code>
(i.e., a path like <code>/nix/store/m7p7jfny445k...-foo.conf</code>) will be
spliced into the resulting string.</p>
<p>It is however <em>not</em> allowed to have files mutually referring to each
other, like so:</p>
<pre><code class="language-nix">let
  foo = builtins.toFile "foo" "...${bar}...";
  bar = builtins.toFile "bar" "...${foo}...";
in foo
</code></pre>
<p>This is not allowed because it would cause a cyclic dependency in
the computation of the cryptographic hashes for <code>foo</code> and <code>bar</code>.</p>
<p>It is also not possible to reference the result of a derivation. If
you are using Nixpkgs, the <code>writeTextFile</code> function is able to do
that.</p>
</dd>
<dt id="builtins-toJSON">
  <a href="language/builtins.html#builtins-toJSON"><code>toJSON <var>e</var></code></a>
</dt>
<dd>
<p>Return a string containing a JSON representation of <em>e</em>. Strings,
integers, floats, booleans, nulls and lists are mapped to their JSON
equivalents. Sets (except derivations) are represented as objects.
Derivations are translated to a JSON string containing the
derivation’s output path. Paths are copied to the store and
represented as a JSON string of the resulting store path.</p>
</dd>
<dt id="builtins-toPath">
  <a href="language/builtins.html#builtins-toPath"><code>toPath <var>s</var></code></a>
</dt>
<dd>
<p><strong>DEPRECATED.</strong> Use <code>/. + "/path"</code> to convert a string into an absolute
path. For relative paths, use <code>./. + "/path"</code>.</p>
</dd>
<dt id="builtins-toString">
  <a href="language/builtins.html#builtins-toString"><code>toString <var>e</var></code></a>
</dt>
<dd>
<p>Convert the expression <em>e</em> to a string. <em>e</em> can be:</p>
<ul>
<li>
<p>A string (in which case the string is returned unmodified).</p>
</li>
<li>
<p>A path (e.g., <code>toString /foo/bar</code> yields <code>"/foo/bar"</code>.</p>
</li>
<li>
<p>A set containing <code>{ __toString = self: ...; }</code> or <code>{ outPath = ...; }</code>.</p>
</li>
<li>
<p>An integer.</p>
</li>
<li>
<p>A list, in which case the string representations of its elements
are joined with spaces.</p>
</li>
<li>
<p>A Boolean (<code>false</code> yields <code>""</code>, <code>true</code> yields <code>"1"</code>).</p>
</li>
<li>
<p><code>null</code>, which yields the empty string.</p>
</li>
</ul>
</dd>
<dt id="builtins-toXML">
  <a href="language/builtins.html#builtins-toXML"><code>toXML <var>e</var></code></a>
</dt>
<dd>
<p>Return a string containing an XML representation of <em>e</em>. The main
application for <code>toXML</code> is to communicate information with the
builder in a more structured format than plain environment
variables.</p>
<p>Here is an example where this is the case:</p>
<pre><code class="language-nix">{ stdenv, fetchurl, libxslt, jira, uberwiki }:

stdenv.mkDerivation (rec {
  name = "web-server";

  buildInputs = [ libxslt ];

  builder = builtins.toFile "builder.sh" "
    source $stdenv/setup
    mkdir $out
    echo "$servlets" | xsltproc ${stylesheet} - &gt; $out/server-conf.xml ①
  ";

  stylesheet = builtins.toFile "stylesheet.xsl" ②
   "&lt;?xml version='1.0' encoding='UTF-8'?&gt;
    &lt;xsl:stylesheet xmlns:xsl='http://www.w3.org/1999/XSL/Transform' version='1.0'&gt;
      &lt;xsl:template match='/'&gt;
        &lt;Configure&gt;
          &lt;xsl:for-each select='/expr/list/attrs'&gt;
            &lt;Call name='addWebApplication'&gt;
              &lt;Arg&gt;&lt;xsl:value-of select=\"attr[@name = 'path']/string/@value\" /&gt;&lt;/Arg&gt;
              &lt;Arg&gt;&lt;xsl:value-of select=\"attr[@name = 'war']/path/@value\" /&gt;&lt;/Arg&gt;
            &lt;/Call&gt;
          &lt;/xsl:for-each&gt;
        &lt;/Configure&gt;
      &lt;/xsl:template&gt;
    &lt;/xsl:stylesheet&gt;
  ";

  servlets = builtins.toXML [ ③
    { path = "/bugtracker"; war = jira + "/lib/atlassian-jira.war"; }
    { path = "/wiki"; war = uberwiki + "/uberwiki.war"; }
  ];
})
</code></pre>
<p>The builder is supposed to generate the configuration file for a
<a href="http://jetty.mortbay.org/">Jetty servlet container</a>. A servlet
container contains a number of servlets (<code>*.war</code> files) each
exported under a specific URI prefix. So the servlet configuration
is a list of sets containing the <code>path</code> and <code>war</code> of the servlet
(①). This kind of information is difficult to communicate with the
normal method of passing information through an environment
variable, which just concatenates everything together into a
string (which might just work in this case, but wouldn’t work if
fields are optional or contain lists themselves). Instead the Nix
expression is converted to an XML representation with <code>toXML</code>,
which is unambiguous and can easily be processed with the
appropriate tools. For instance, in the example an XSLT stylesheet
(at point ②) is applied to it (at point ①) to generate the XML
configuration file for the Jetty server. The XML representation
produced at point ③ by <code>toXML</code> is as follows:</p>
<pre><code class="language-xml">&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;expr&gt;
  &lt;list&gt;
    &lt;attrs&gt;
      &lt;attr name="path"&gt;
        &lt;string value="/bugtracker" /&gt;
      &lt;/attr&gt;
      &lt;attr name="war"&gt;
        &lt;path value="/nix/store/d1jh9pasa7k2...-jira/lib/atlassian-jira.war" /&gt;
      &lt;/attr&gt;
    &lt;/attrs&gt;
    &lt;attrs&gt;
      &lt;attr name="path"&gt;
        &lt;string value="/wiki" /&gt;
      &lt;/attr&gt;
      &lt;attr name="war"&gt;
        &lt;path value="/nix/store/y6423b1yi4sx...-uberwiki/uberwiki.war" /&gt;
      &lt;/attr&gt;
    &lt;/attrs&gt;
  &lt;/list&gt;
&lt;/expr&gt;
</code></pre>
<p>Note that we used the <code>toFile</code> built-in to write the builder and
the stylesheet “inline” in the Nix expression. The path of the
stylesheet is spliced into the builder using the syntax <code>xsltproc ${stylesheet}</code>.</p>
</dd>
<dt id="builtins-trace">
  <a href="language/builtins.html#builtins-trace"><code>trace <var>e1</var> <var>e2</var></code></a>
</dt>
<dd>
<p>Evaluate <em>e1</em> and print its abstract syntax representation on
standard error. Then return <em>e2</em>. This function is useful for
debugging.</p>
<p>If the
<a href="language/../command-ref/conf-file.html#conf-debugger-on-trace"><code>debugger-on-trace</code></a>
option is set to <code>true</code> and the <code>--debugger</code> flag is given, the
interactive debugger will be started when <code>trace</code> is called (like
<a href="language/../language/builtins.html#builtins-break"><code>break</code></a>).</p>
</dd>
<dt id="builtins-traceVerbose">
  <a href="language/builtins.html#builtins-traceVerbose"><code>traceVerbose <var>e1</var> <var>e2</var></code></a>
</dt>
<dd>
<p>Evaluate <em>e1</em> and print its abstract syntax representation on standard
error if <code>--trace-verbose</code> is enabled. Then return <em>e2</em>. This function
is useful for debugging.</p>
</dd>
<dt id="builtins-true">
  <a href="language/builtins.html#builtins-true"><code>true</code></a> (Boolean)
</dt>
<dd>
<p>Primitive value.</p>
<p>It can be returned by
<a href="language/../language/operators.html#Comparison">comparison operators</a>
and used in
<a href="language/../language/syntax.html#Conditionals">conditional expressions</a>.</p>
<p>The name <code>true</code> is not special, and can be shadowed:</p>
<pre><code class="language-nix-repl">nix-repl&gt; let true = 1; in true
1
</code></pre>
</dd>
<dt id="builtins-tryEval">
  <a href="language/builtins.html#builtins-tryEval"><code>tryEval <var>e</var></code></a>
</dt>
<dd>
<p>Try to shallowly evaluate <em>e</em>. Return a set containing the
attributes <code>success</code> (<code>true</code> if <em>e</em> evaluated successfully,
<code>false</code> if an error was thrown) and <code>value</code>, equalling <em>e</em> if
successful and <code>false</code> otherwise. <code>tryEval</code> will only prevent
errors created by <code>throw</code> or <code>assert</code> from being thrown.
Errors <code>tryEval</code> will not catch are for example those created
by <code>abort</code> and type errors generated by builtins. Also note that
this doesn't evaluate <em>e</em> deeply, so <code>let e = { x = throw ""; }; in (builtins.tryEval e).success</code> will be <code>true</code>. Using
<code>builtins.deepSeq</code> one can get the expected result:
<code>let e = { x = throw ""; }; in (builtins.tryEval (builtins.deepSeq e e)).success</code> will be
<code>false</code>.</p>
<p><code>tryEval</code> intentionally does not return the error message, because that risks bringing non-determinism into the evaluation result, and it would become very difficult to improve error reporting without breaking existing expressions.
Instead, use <a href="language/../language/builtins.html#builtins-addErrorContext"><code>builtins.addErrorContext</code></a> to add context to the error message, and use a Nix unit testing tool for testing.</p>
</dd>
<dt id="builtins-typeOf">
  <a href="language/builtins.html#builtins-typeOf"><code>typeOf <var>e</var></code></a>
</dt>
<dd>
<p>Return a string representing the type of the value <em>e</em>, namely
<code>"int"</code>, <code>"bool"</code>, <code>"string"</code>, <code>"path"</code>, <code>"null"</code>, <code>"set"</code>,
<code>"list"</code>, <code>"lambda"</code> or <code>"float"</code>.</p>
</dd>
<dt id="builtins-unsafeDiscardOutputDependency">
  <a href="language/builtins.html#builtins-unsafeDiscardOutputDependency"><code>unsafeDiscardOutputDependency <var>s</var></code></a>
</dt>
<dd>
<p>Create a copy of the given string where every
<a href="language/../language/string-context.html#string-context-element-derivation-deep">derivation deep</a>
string context element is turned into a
<a href="language/../language/string-context.html#string-context-element-constant">constant</a>
string context element.</p>
<p>This is the opposite of <a href="language/builtins.html#builtins-addDrvOutputDependencies"><code>builtins.addDrvOutputDependencies</code></a>.</p>
<p>This is unsafe because it allows us to "forget" store objects we would have otherwise referred to with the string context,
whereas Nix normally tracks all dependencies consistently.
Safe operations "grow" but never "shrink" string contexts.
<a href="language/builtins.html#builtins-addDrvOutputDependencies"><code>builtins.addDrvOutputDependencies</code></a> in contrast is safe because "derivation deep" string context element always refers to the underlying derivation (among many more things).
Replacing a constant string context element with a "derivation deep" element is a safe operation that just enlargens the string context without forgetting anything.</p>
</dd>
<dt id="builtins-unsafeDiscardStringContext">
  <a href="language/builtins.html#builtins-unsafeDiscardStringContext"><code>unsafeDiscardStringContext <var>s</var></code></a>
</dt>
<dd>
<p>Discard the <a href="language/../language/string-context.html">string context</a> from a value that can be coerced to a string.</p>
</dd>
<dt id="builtins-warn">
  <a href="language/builtins.html#builtins-warn"><code>warn <var>e1</var> <var>e2</var></code></a>
</dt>
<dd>
<p>Evaluate <em>e1</em>, which must be a string, and print it on standard error as a warning.
Then return <em>e2</em>.
This function is useful for non-critical situations where attention is advisable.</p>
<p>If the
<a href="language/../command-ref/conf-file.html#conf-debugger-on-trace"><code>debugger-on-trace</code></a>
or <a href="language/../command-ref/conf-file.html#conf-debugger-on-warn"><code>debugger-on-warn</code></a>
option is set to <code>true</code> and the <code>--debugger</code> flag is given, the
interactive debugger will be started when <code>warn</code> is called (like
<a href="language/../language/builtins.html#builtins-break"><code>break</code></a>).</p>
<p>If the
<a href="language/../command-ref/conf-file.html#conf-abort-on-warn"><code>abort-on-warn</code></a>
option is set, the evaluation will be aborted after the warning is printed.
This is useful to reveal the stack trace of the warning, when the context is non-interactive and a debugger can not be launched.</p>
</dd>
<dt id="builtins-zipAttrsWith">
  <a href="language/builtins.html#builtins-zipAttrsWith"><code>zipAttrsWith <var>f</var> <var>list</var></code></a>
</dt>
<dd>
<p>Transpose a list of attribute sets into an attribute set of lists,
then apply <code>mapAttrs</code>.</p>
<p><code>f</code> receives two arguments: the attribute name and a non-empty
list of all values encountered for that attribute name.</p>
<p>The result is an attribute set where the attribute names are the
union of the attribute names in each element of <code>list</code>. The attribute
values are the return values of <code>f</code>.</p>
<pre><code class="language-nix">builtins.zipAttrsWith
  (name: values: { inherit name values; })
  [ { a = "x"; } { a = "y"; b = "z"; } ]
</code></pre>
<p>evaluates to</p>
<pre><code>{
  a = { name = "a"; values = [ "x" "y" ]; };
  b = { name = "b"; values = [ "z" ]; };
}
</code></pre>
</dd>
</dl>
<div style="break-before: page; page-break-before: always;"></div><h1 id="derivations"><a class="header" href="#derivations">Derivations</a></h1>
<p>The most important built-in function is <code>derivation</code>, which is used to describe a single store-layer <a href="language/../glossary.html#gloss-store-derivation">store derivation</a>.
Consult the <a href="language/../store/derivation/index.html">store chapter</a> for what a store derivation is;
this section just concerns how to create one from the Nix language.</p>
<p>This builtin function takes as input an attribute set, the attributes of which specify the inputs to the process.
It outputs an attribute set, and produces a <a href="language/../glossary.html#gloss-store-derivation">store derivation</a> as a side effect of evaluation.</p>
<h2 id="input-attributes"><a class="header" href="#input-attributes">Input attributes</a></h2>
<h3 id="required"><a class="header" href="#required">Required</a></h3>
<ul>
<li>
<p><a href="language/derivations.html#attr-name" id="attr-name"><code>name</code></a> (<a href="language/../language/types.html#type-string">String</a>)</p>
<p>A symbolic name for the derivation.
See <a href="language/../store/derivation/index.html#outputs">derivation outputs</a> for what this is affects.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">derivation {
  name = "hello";
  # ...
}
</code></pre>
<p>The derivation's path will be <code>/nix/store/&lt;hash&gt;-hello.drv</code>.
The <a href="language/derivations.html#attr-outputs">output</a> paths will be of the form <code>/nix/store/&lt;hash&gt;-hello[-&lt;output&gt;]</code></p>
</blockquote>
</li>
<li>
<p><a href="language/derivations.html#attr-system" id="attr-system"><code>system</code></a> (<a href="language/../language/types.html#type-string">String</a>)</p>
<p>See <a href="language/../store/derivation/index.html#system">system</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>Declare a derivation to be built on a specific system type:</p>
<pre><code class="language-nix">derivation {
  # ...
  system = "x86_64-linux";
  # ...
}
</code></pre>
</blockquote>
<blockquote>
<p><strong>Example</strong></p>
<p>Declare a derivation to be built on the system type that evaluates the expression:</p>
<pre><code class="language-nix">derivation {
  # ...
  system = builtins.currentSystem;
  # ...
}
</code></pre>
<p><a href="language/../language/builtins.html#builtins-currentSystem"><code>builtins.currentSystem</code></a> has the value of the [<code>system</code> configuration option], and defaults to the system type of the current Nix installation.</p>
</blockquote>
</li>
<li>
<p><a href="language/derivations.html#attr-builder" id="attr-builder"><code>builder</code></a> (<a href="language/../language/types.html#type-path">Path</a> | <a href="language/../language/types.html#type-string">String</a>)</p>
<p>See <a href="language/../store/derivation/index.html#builder">builder</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>Use the file located at <code>/bin/bash</code> as the builder executable:</p>
<pre><code class="language-nix">derivation {
  # ...
  builder = "/bin/bash";
  # ...
};
</code></pre>
</blockquote>
<!-- -->
<blockquote>
<p><strong>Example</strong></p>
<p>Copy a local file to the Nix store for use as the builder executable:</p>
<pre><code class="language-nix">derivation {
  # ...
  builder = ./builder.sh;
  # ...
};
</code></pre>
</blockquote>
<!-- -->
<blockquote>
<p><strong>Example</strong></p>
<p>Use a file from another derivation as the builder executable:</p>
<pre><code class="language-nix">let pkgs = import &lt;nixpkgs&gt; {}; in
derivation {
  # ...
  builder = "${pkgs.python}/bin/python";
  # ...
};
</code></pre>
</blockquote>
</li>
</ul>
<h3 id="optional"><a class="header" href="#optional">Optional</a></h3>
<ul>
<li>
<p><a href="language/derivations.html#attr-args" id="attr-args"><code>args</code></a> (<a href="language/../language/types.html#type-list">List</a> of <a href="language/../language/types.html#type-string">String</a>)</p>
<p>Default: <code>[ ]</code></p>
<p>See <a href="language/../store/derivation/index.html#args">args</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>Pass arguments to Bash to interpret a shell command:</p>
<pre><code class="language-nix">derivation {
  # ...
  builder = "/bin/bash";
  args = [ "-c" "echo hello world &gt; $out" ];
  # ...
};
</code></pre>
</blockquote>
</li>
<li>
<p><a href="language/derivations.html#attr-outputs" id="attr-outputs"><code>outputs</code></a> (<a href="language/../language/types.html#type-list">List</a> of <a href="language/../language/types.html#type-string">String</a>)</p>
<p>Default: <code>[ "out" ]</code></p>
<p>Symbolic outputs of the derivation.
Each output name is passed to the <a href="language/derivations.html#attr-builder"><code>builder</code></a> executable as an environment variable with its value set to the corresponding <a href="language/../store/store-path.html">store path</a>.</p>
<p>By default, a derivation produces a single output called <code>out</code>.
However, derivations can produce multiple outputs.
This allows the associated <a href="language/../store/store-object.html">store objects</a> and their <a href="language/../glossary.html#gloss-closure">closures</a> to be copied or garbage-collected separately.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>Imagine a library package that provides a dynamic library, header files, and documentation.
A program that links against such a library doesn’t need the header files and documentation at runtime, and it doesn’t need the documentation at build time.
Thus, the library package could specify:</p>
<pre><code class="language-nix">derivation {
  # ...
  outputs = [ "lib" "dev" "doc" ];
  # ...
}
</code></pre>
<p>This will cause Nix to pass environment variables <code>lib</code>, <code>dev</code>, and <code>doc</code> to the builder containing the intended store paths of each output.
The builder would typically do something like</p>
<pre><code class="language-bash">./configure \
  --libdir=$lib/lib \
  --includedir=$dev/include \
  --docdir=$doc/share/doc
</code></pre>
<p>for an Autoconf-style package.</p>
</blockquote>
<p>The name of an output is combined with the name of the derivation to create the name part of the output's store path, unless it is <code>out</code>, in which case just the name of the derivation is used.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix">derivation {
  name = "example";
  outputs = [ "lib" "dev" "doc" "out" ];
  # ...
}
</code></pre>
<p>The store derivation path will be <code>/nix/store/&lt;hash&gt;-example.drv</code>.
The output paths will be</p>
<ul>
<li><code>/nix/store/&lt;hash&gt;-example-lib</code></li>
<li><code>/nix/store/&lt;hash&gt;-example-dev</code></li>
<li><code>/nix/store/&lt;hash&gt;-example-doc</code></li>
<li><code>/nix/store/&lt;hash&gt;-example</code></li>
</ul>
</blockquote>
<p>You can refer to each output of a derivation by selecting it as an attribute.
The first element of <code>outputs</code> determines the <em>default output</em> and ends up at the top-level.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>Select an output by attribute name:</p>
<pre><code class="language-nix">let
  myPackage = derivation {
    name = "example";
    outputs = [ "lib" "dev" "doc" "out" ];
    # ...
  };
in myPackage.dev
</code></pre>
<p>Since <code>lib</code> is the first output, <code>myPackage</code> is equivalent to <code>myPackage.lib</code>.</p>
</blockquote>
<!-- FIXME: refer to the output attributes when we have one -->
</li>
<li>
<p>See <a href="language/./advanced-attributes.html">Advanced Attributes</a> for more, infrequently used, optional attributes.</p>
<!-- FIXME: This should be moved here -->
</li>
<li>
<p>Every other attribute is passed as an environment variable to the builder.
Attribute values are translated to environment variables as follows:</p>
<ul>
<li>
<p>Strings are passed unchanged.</p>
</li>
<li>
<p>Integral numbers are converted to decimal notation.</p>
</li>
<li>
<p>Floating point numbers are converted to simple decimal or scientific notation with a preset precision.</p>
</li>
<li>
<p>A <em>path</em> (e.g., <code>../foo/sources.tar</code>) causes the referenced file
to be copied to the store; its location in the store is put in
the environment variable. The idea is that all sources should
reside in the Nix store, since all inputs to a derivation should
reside in the Nix store.</p>
</li>
<li>
<p>A <em>derivation</em> causes that derivation to be built prior to the
present derivation. The environment variable is set to the <a href="language/../store/store-path.html">store path</a> of the derivation's default <a href="language/derivations.html#attr-outputs">output</a>.</p>
</li>
<li>
<p>Lists of the previous types are also allowed. They are simply
concatenated, separated by spaces.</p>
</li>
<li>
<p><code>true</code> is passed as the string <code>1</code>, <code>false</code> and <code>null</code> are
passed as an empty string.</p>
</li>
</ul>
</li>
</ul>
<!-- FIXME: add a section on output attributes -->
<div style="break-before: page; page-break-before: always;"></div><h1 id="advanced-attributes"><a class="header" href="#advanced-attributes">Advanced Attributes</a></h1>
<p>Derivations can declare some infrequently used optional attributes.</p>
<h2 id="inputs"><a class="header" href="#inputs">Inputs</a></h2>
<ul>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-exportReferencesGraph" id="adv-attr-exportReferencesGraph"><code>exportReferencesGraph</code></a><br />
This attribute allows builders access to the references graph of
their inputs. The attribute is a list of inputs in the Nix store
whose references graph the builder needs to know. The value of
this attribute should be a list of pairs <code>[ name1 path1 name2 path2 ...  ]</code>. The references graph of each <em>pathN</em> will be stored
in a text file <em>nameN</em> in the temporary build directory. The text
files have the format used by <code>nix-store --register-validity</code>
(with the deriver fields left empty). For example, when the
following derivation is built:</p>
<pre><code class="language-nix">derivation {
  ...
  exportReferencesGraph = [ "libfoo-graph" libfoo ];
};
</code></pre>
<p>the references graph of <code>libfoo</code> is placed in the file
<code>libfoo-graph</code> in the temporary build directory.</p>
<p><code>exportReferencesGraph</code> is useful for builders that want to do
something with the closure of a store path. Examples include the
builders in NixOS that generate the initial ramdisk for booting
Linux (a <code>cpio</code> archive containing the closure of the boot script)
and the ISO-9660 image for the installation CD (which is populated
with a Nix store containing the closure of a bootable NixOS
configuration).</p>
</li>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-passAsFile" id="adv-attr-passAsFile"><code>passAsFile</code></a><br />
A list of names of attributes that should be passed via files rather
than environment variables. For example, if you have</p>
<pre><code class="language-nix">passAsFile = ["big"];
big = "a very long string";
</code></pre>
<p>then when the builder runs, the environment variable <code>bigPath</code>
will contain the absolute path to a temporary file containing <code>a very long string</code>. That is, for any attribute <em>x</em> listed in
<code>passAsFile</code>, Nix will pass an environment variable <code>xPath</code>
holding the path of the file containing the value of attribute
<em>x</em>. This is useful when you need to pass large strings to a
builder, since most operating systems impose a limit on the size
of the environment (typically, a few hundred kilobyte).</p>
</li>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-structuredAttrs" id="adv-attr-structuredAttrs"><code>__structuredAttrs</code></a><br />
If the special attribute <code>__structuredAttrs</code> is set to <code>true</code>, the other derivation
attributes are serialised into a file in JSON format. The environment variable
<code>NIX_ATTRS_JSON_FILE</code> points to the exact location of that file both in a build
and a <a href="language/../command-ref/nix-shell.html"><code>nix-shell</code></a>. This obviates the need for
<a href="language/advanced-attributes.html#adv-attr-passAsFile"><code>passAsFile</code></a> since JSON files have no size restrictions,
unlike process environments.</p>
<p>It also makes it possible to tweak derivation settings in a structured way; see
<a href="language/advanced-attributes.html#adv-attr-outputChecks"><code>outputChecks</code></a> for example.</p>
<p>As a convenience to Bash builders,
Nix writes a script that initialises shell variables
corresponding to all attributes that are representable in Bash. The
environment variable <code>NIX_ATTRS_SH_FILE</code> points to the exact
location of the script, both in a build and a
<a href="language/../command-ref/nix-shell.html"><code>nix-shell</code></a>. This includes non-nested
(associative) arrays. For example, the attribute <code>hardening.format = true</code>
ends up as the Bash associative array element <code>${hardening[format]}</code>.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>If set to <code>true</code>, other advanced attributes such as <a href="language/advanced-attributes.html#adv-attr-allowedReferences"><code>allowedReferences</code></a>, <a href="language/advanced-attributes.html#adv-attr-allowedReferences"><code>allowedReferences</code></a>, <a href="language/advanced-attributes.html#adv-attr-allowedRequisites"><code>allowedRequisites</code></a>,
<a href="language/advanced-attributes.html#adv-attr-disallowedReferences"><code>disallowedReferences</code></a> and <a href="language/advanced-attributes.html#adv-attr-disallowedRequisites"><code>disallowedRequisites</code></a>, maxSize, and maxClosureSize.
will have no effect.</p>
</blockquote>
</li>
</ul>
<h2 id="output-checks"><a class="header" href="#output-checks">Output checks</a></h2>
<ul>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-allowedReferences" id="adv-attr-allowedReferences"><code>allowedReferences</code></a><br />
The optional attribute <code>allowedReferences</code> specifies a list of legal
references (dependencies) of the output of the builder. For example,</p>
<pre><code class="language-nix">allowedReferences = [];
</code></pre>
<p>enforces that the output of a derivation cannot have any runtime
dependencies on its inputs. To allow an output to have a runtime
dependency on itself, use <code>"out"</code> as a list item. This is used in
NixOS to check that generated files such as initial ramdisks for
booting Linux don’t have accidental dependencies on other paths in
the Nix store.</p>
</li>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-allowedRequisites" id="adv-attr-allowedRequisites"><code>allowedRequisites</code></a><br />
This attribute is similar to <code>allowedReferences</code>, but it specifies
the legal requisites of the whole closure, so all the dependencies
recursively. For example,</p>
<pre><code class="language-nix">allowedRequisites = [ foobar ];
</code></pre>
<p>enforces that the output of a derivation cannot have any other
runtime dependency than <code>foobar</code>, and in addition it enforces that
<code>foobar</code> itself doesn't introduce any other dependency itself.</p>
</li>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-disallowedReferences" id="adv-attr-disallowedReferences"><code>disallowedReferences</code></a><br />
The optional attribute <code>disallowedReferences</code> specifies a list of
illegal references (dependencies) of the output of the builder. For
example,</p>
<pre><code class="language-nix">disallowedReferences = [ foo ];
</code></pre>
<p>enforces that the output of a derivation cannot have a direct
runtime dependencies on the derivation <code>foo</code>.</p>
</li>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-disallowedRequisites" id="adv-attr-disallowedRequisites"><code>disallowedRequisites</code></a><br />
This attribute is similar to <code>disallowedReferences</code>, but it
specifies illegal requisites for the whole closure, so all the
dependencies recursively. For example,</p>
<pre><code class="language-nix">disallowedRequisites = [ foobar ];
</code></pre>
<p>enforces that the output of a derivation cannot have any runtime
dependency on <code>foobar</code> or any other derivation depending recursively
on <code>foobar</code>.</p>
</li>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-outputChecks" id="adv-attr-outputChecks"><code>outputChecks</code></a><br />
When using <a href="language/advanced-attributes.html#adv-attr-structuredAttrs">structured attributes</a>, the <code>outputChecks</code>
attribute allows defining checks per-output.</p>
<p>In addition to
<a href="language/advanced-attributes.html#adv-attr-allowedReferences"><code>allowedReferences</code></a>, <a href="language/advanced-attributes.html#adv-attr-allowedRequisites"><code>allowedRequisites</code></a>,
<a href="language/advanced-attributes.html#adv-attr-disallowedReferences"><code>disallowedReferences</code></a> and <a href="language/advanced-attributes.html#adv-attr-disallowedRequisites"><code>disallowedRequisites</code></a>,
the following attributes are available:</p>
<ul>
<li><code>maxSize</code> defines the maximum size of the resulting <a href="language/../store/store-object.html">store object</a>.</li>
<li><code>maxClosureSize</code> defines the maximum size of the output's closure.</li>
<li><code>ignoreSelfRefs</code> controls whether self-references should be considered when
checking for allowed references/requisites.</li>
</ul>
<p>Example:</p>
<pre><code class="language-nix">__structuredAttrs = true;

outputChecks.out = {
  # The closure of 'out' must not be larger than 256 MiB.
  maxClosureSize = 256 * 1024 * 1024;

  # It must not refer to the C compiler or to the 'dev' output.
  disallowedRequisites = [ stdenv.cc "dev" ];
};

outputChecks.dev = {
  # The 'dev' output must not be larger than 128 KiB.
  maxSize = 128 * 1024;
};
</code></pre>
</li>
</ul>
<h2 id="other-output-modifications"><a class="header" href="#other-output-modifications">Other output modifications</a></h2>
<ul>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-unsafeDiscardReferences" id="adv-attr-unsafeDiscardReferences"><code>unsafeDiscardReferences</code></a>\</p>
<p>When using <a href="language/advanced-attributes.html#adv-attr-structuredAttrs">structured attributes</a>, the
attribute <code>unsafeDiscardReferences</code> is an attribute set with a boolean value for each output name.
If set to <code>true</code>, it disables scanning the output for runtime dependencies.</p>
<p>Example:</p>
<pre><code class="language-nix">__structuredAttrs = true;
unsafeDiscardReferences.out = true;
</code></pre>
<p>This is useful, for example, when generating self-contained filesystem images with
their own embedded Nix store: hashes found inside such an image refer
to the embedded store and not to the host's Nix store.</p>
</li>
</ul>
<h2 id="build-scheduling"><a class="header" href="#build-scheduling">Build scheduling</a></h2>
<ul>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-preferLocalBuild" id="adv-attr-preferLocalBuild"><code>preferLocalBuild</code></a><br />
If this attribute is set to <code>true</code> and <a href="language/../command-ref/conf-file.html#conf-builders">distributed building is enabled</a>, then, if possible, the derivation will be built locally instead of being forwarded to a remote machine.
This is useful for derivations that are cheapest to build locally.</p>
</li>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-allowSubstitutes" id="adv-attr-allowSubstitutes"><code>allowSubstitutes</code></a><br />
If this attribute is set to <code>false</code>, then Nix will always build this derivation (locally or remotely); it will not try to substitute its outputs.
This is useful for derivations that are cheaper to build than to substitute.</p>
<p>This attribute can be ignored by setting <a href="language/../command-ref/conf-file.html#conf-always-allow-substitutes"><code>always-allow-substitutes</code></a> to <code>true</code>.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>If set to <code>false</code>, the <a href="language/./derivations.html#attr-builder"><code>builder</code></a> should be able to run on the system type specified in the <a href="language/./derivations.html#attr-system"><code>system</code> attribute</a>, since the derivation cannot be substituted.</p>
</blockquote>
</li>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-requiredSystemFeatures" id="adv-attr-requiredSystemFeatures"><code>requiredSystemFeatures</code></a>\</p>
<p>If a derivation has the <code>requiredSystemFeatures</code> attribute, then Nix will only build it on a machine that has the corresponding features set in its <a href="language/../command-ref/conf-file.html#conf-system-features"><code>system-features</code> configuration</a>.</p>
<p>For example, setting</p>
<pre><code class="language-nix">requiredSystemFeatures = [ "kvm" ];
</code></pre>
<p>ensures that the derivation can only be built on a machine with the <code>kvm</code> feature.</p>
</li>
</ul>
<h1 id="impure-builder-configuration"><a class="header" href="#impure-builder-configuration">Impure builder configuration</a></h1>
<ul>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-impureEnvVars" id="adv-attr-impureEnvVars"><code>impureEnvVars</code></a><br />
This attribute allows you to specify a list of environment variables
that should be passed from the environment of the calling user to
the builder. Usually, the environment is cleared completely when the
builder is executed, but with this attribute you can allow specific
environment variables to be passed unmodified. For example,
<code>fetchurl</code> in Nixpkgs has the line</p>
<pre><code class="language-nix">impureEnvVars = [ "http_proxy" "https_proxy" ... ];
</code></pre>
<p>to make it use the proxy server configuration specified by the user
in the environment variables <code>http_proxy</code> and friends.</p>
<p>This attribute is only allowed in <a href="language/../glossary.html#gloss-fixed-output-derivation">fixed-output derivations</a>,
where impurities such as these are okay since (the hash
of) the output is known in advance. It is ignored for all other
derivations.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p><code>impureEnvVars</code> implementation takes environment variables from
the current builder process. When a daemon is building its
environmental variables are used. Without the daemon, the
environmental variables come from the environment of the
<code>nix-build</code>.</p>
</blockquote>
<p>If the <a href="language/../development/experimental-features.html#xp-feature-configurable-impure-env"><code>configurable-impure-env</code> experimental
feature</a>
is enabled, these environment variables can also be controlled
through the
<a href="language/../command-ref/conf-file.html#conf-impure-env"><code>impure-env</code></a>
configuration setting.</p>
</li>
</ul>
<h2 id="setting-the-derivation-type"><a class="header" href="#setting-the-derivation-type">Setting the derivation type</a></h2>
<p>As discussed in <a href="language/../store/derivation/outputs/index.html">Derivation Outputs and Types of Derivations</a>, there are multiples kinds of derivations / kinds of derivation outputs.
The choice of the following attributes determines which kind of derivation we are making.</p>
<ul>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-__contentAddressed"><code>__contentAddressed</code></a></p>
</li>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-outputHash"><code>outputHash</code></a></p>
</li>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-outputHashAlgo"><code>outputHashAlgo</code></a></p>
</li>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-outputHashMode"><code>outputHashMode</code></a></p>
</li>
</ul>
<p>The three types of derivations are chosen based on the following combinations of these attributes.
All other combinations are invalid.</p>
<ul>
<li>
<p><a href="language/../store/derivation/outputs/input-address.html">Input-addressing derivations</a></p>
<p>This is the default for <code>builtins.derivation</code>.
Nix only currently supports one kind of input-addressing, so no other information is needed.</p>
<p><code>__contentAddressed = false;</code> may also be included, but is not needed, and will trigger the experimental feature check.</p>
</li>
<li>
<p><a href="language/../glossary.html#gloss-fixed-output-derivation">Fixed-output derivations</a></p>
<p>All of <a href="language/advanced-attributes.html#adv-attr-outputHash"><code>outputHash</code></a>, <a href="language/advanced-attributes.html#adv-attr-outputHashAlgo"><code>outputHashAlgo</code></a>, and <a href="language/advanced-attributes.html#adv-attr-outputHashMode"><code>outputHashMode</code></a>.</p>
<!--

`__contentAddressed` is ignored, becaused fixed-output derivations always content-address their outputs, by definition.

**TODO CHECK**

-->
</li>
<li>
<p><a href="language/../store/derivation/outputs/content-address.html">(Floating) content-addressing derivations</a></p>
<p>Both <a href="language/advanced-attributes.html#adv-attr-outputHashAlgo"><code>outputHashAlgo</code></a> and <a href="language/advanced-attributes.html#adv-attr-outputHashMode"><code>outputHashMode</code></a>, <code>__contentAddressed = true;</code>, and <em>not</em> <code>outputHash</code>.</p>
<p>If an output hash was given, then the derivation output would be "fixed" not "floating".</p>
</li>
</ul>
<p>Here is more information on the <code>output*</code> attributes, and what values they may be set to:</p>
<ul>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-outputHashMode" id="adv-attr-outputHashMode"><code>outputHashMode</code></a></p>
<p>This specifies how the files of a content-addressing derivation output are digested to produce a content address.</p>
<p>This works in conjunction with <a href="language/advanced-attributes.html#adv-attr-outputHashAlgo"><code>outputHashAlgo</code></a>.
Specifying one without the other is an error (unless [<code>outputHash</code> is also specified and includes its own hash algorithm as described below).</p>
<p>The <code>outputHashMode</code> attribute determines how the hash is computed.
It must be one of the following values:</p>
<ul>
<li>
<p><a href="language/../store/store-object/content-address.html#method-flat"><code>"flat"</code></a></p>
<p>This is the default.</p>
</li>
<li>
<p><a href="language/../store/store-object/content-address.html#method-nix-archive"><code>"recursive"</code> or <code>"nar"</code></a></p>
<blockquote>
<p><strong>Compatibility</strong></p>
<p><code>"recursive"</code> is the traditional way of indicating this,
and is supported since 2005 (virtually the entire history of Nix).
<code>"nar"</code> is more clear, and consistent with other parts of Nix (such as the CLI),
however support for it is only added in Nix version 2.21.</p>
</blockquote>
</li>
<li>
<p><a href="language/../store/store-object/content-address.html#method-text"><code>"text"</code></a></p>
<blockquote>
<p><strong>Warning</strong></p>
<p>The use of this method for derivation outputs is part of the <a href="language/../development/experimental-features.html#xp-feature-dynamic-derivations"><code>dynamic-derivations</code></a> experimental feature.</p>
</blockquote>
</li>
<li>
<p><a href="language/../store/store-object/content-address.html#method-git"><code>"git"</code></a></p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This method is part of the <a href="language/../development/experimental-features.html#xp-feature-git-hashing"><code>git-hashing</code></a> experimental feature.</p>
</blockquote>
</li>
</ul>
<p>See <a href="language/../store/store-object/content-address.html">content-addressing store objects</a> for more information about the process this flag controls.</p>
</li>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-outputHashAlgo" id="adv-attr-outputHashAlgo"><code>outputHashAlgo</code></a></p>
<p>This specifies the hash alorithm used to digest the <a href="language/../store/file-system-object.html">file system object</a> data of a content-addressing derivation output.</p>
<p>This works in conjunction with <a href="language/advanced-attributes.html#adv-attr-outputHashAlgo"><code>outputHashMode</code></a>.
Specifying one without the other is an error (unless <a href="language/advanced-attributes.html#adv-attr-outputHashAlgo" id="adv-attr-outputHashAlgo"><code>outputHash</code> is also specified and includes its own hash algorithm as described below).</p>
<p>The <code>outputHashAlgo</code> attribute specifies the hash algorithm used to compute the hash.
It can currently be <code>"blake3"</code>, "sha1"<code>, </code>"sha256"<code>, </code>"sha512"<code>, or </code>null`.</p>
<p><code>outputHashAlgo</code> can only be <code>null</code> when <code>outputHash</code> follows the SRI format, because in that case the choice of hash algorithm is determined by <code>outputHash</code>.</p>
</li>
<li>
<p>[<code>outputHash</code></a>; <a href="language/advanced-attributes.html#adv-attr-outputHashMode" id="adv-attr-outputHashMode"><code>outputHash</code></a>\</p>
<p>This will specify the output hash of the single output of a <a href="language/../glossary.html#gloss-fixed-output-derivation">fixed-output derivation</a>.</p>
<p>The <code>outputHash</code> attribute must be a string containing the hash in either hexadecimal or "nix32" encoding, or following the format for integrity metadata as defined by <a href="https://www.w3.org/TR/SRI/">SRI</a>.
The "nix32" encoding is an adaptation of base-32 encoding.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>The <a href="language/../language/builtins.html#builtins-convertHash"><code>convertHash</code></a> function shows how to convert between different encodings.
The <a href="language/../command-ref/nix-hash.html"><code>nix-hash</code> command</a> has information about obtaining the hash for some contents, as well as converting to and from encodings.</p>
</blockquote>
</li>
<li>
<p><a href="language/advanced-attributes.html#adv-attr-__contentAddressed" id="adv-attr-__contentAddressed"><code>__contentAddressed</code></a></p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This attribute is part of an <a href="language/../development/experimental-features.html">experimental feature</a>.</p>
<p>To use this attribute, you must enable the
[<code>ca-derivations</code>][xp-feature-ca-derivations] experimental feature.
For example, in <a href="language/../command-ref/conf-file.html">nix.conf</a> you could add:</p>
<pre><code>extra-experimental-features = ca-derivations
</code></pre>
</blockquote>
<p>This is a boolean with a default of <code>false</code>.
It determines whether the derivation is floating content-addressing.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="import-from-derivation"><a class="header" href="#import-from-derivation">Import From Derivation</a></h1>
<p>The value of a Nix expression can depend on the contents of a <a href="language/../store/store-object.html">store object</a>.</p>
<p>Passing an expression <code>expr</code> that evaluates to a <a href="language/../store/store-path.html">store path</a> to any built-in function which reads from the filesystem constitutes Import From Derivation (IFD):</p>
<ul>
<li><a href="language/./builtins.html#builtins-import"><code>import</code></a><code> expr</code></li>
<li><a href="language/./builtins.html#builtins-readFile"><code>builtins.readFile</code></a><code> expr</code></li>
<li><a href="language/./builtins.html#builtins-readFileType"><code>builtins.readFileType</code></a><code> expr</code></li>
<li><a href="language/./builtins.html#builtins-readDir"><code>builtins.readDir</code></a><code> expr</code></li>
<li><a href="language/./builtins.html#builtins-pathExists"><code>builtins.pathExists</code></a><code> expr</code></li>
<li><a href="language/./builtins.html#builtins-filterSource"><code>builtins.filterSource</code></a><code> f expr</code></li>
<li><a href="language/./builtins.html#builtins-path"><code>builtins.path</code></a><code> { path = expr; }</code></li>
<li><a href="language/./builtins.html#builtins-hashFile"><code>builtins.hashFile</code></a><code> t expr</code></li>
<li><code>builtins.scopedImport x drv</code></li>
</ul>
<p>When the store path needs to be accessed, evaluation will be paused, the corresponding store object <a href="language/../glossary.html#gloss-realise">realised</a>, and then evaluation resumed.</p>
<p>This has performance implications:
Evaluation can only finish when all required store objects are realised.
Since the Nix language evaluator is sequential, it only finds store paths to read from one at a time.
While realisation is always parallel, in this case it cannot be done for all required store paths at once, and is therefore much slower than otherwise.</p>
<p>Realising store objects during evaluation can be disabled by setting <a href="language/../command-ref/conf-file.html#conf-allow-import-from-derivation"><code>allow-import-from-derivation</code></a> to <code>false</code>.
Without IFD it is ensured that evaluation is complete and Nix can produce a build plan before starting any realisation.</p>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>In the following Nix expression, the inner derivation <code>drv</code> produces a file with contents <code>hello</code>.</p>
<pre><code class="language-nix"># IFD.nix
let
  drv = derivation {
    name = "hello";
    builder = "/bin/sh";
    args = [ "-c" "echo -n hello &gt; $out" ];
    system = builtins.currentSystem;
  };
in "${builtins.readFile drv} world"
</code></pre>
<pre><code class="language-shellSession">nix-instantiate IFD.nix --eval --read-write-mode
</code></pre>
<pre><code>building '/nix/store/348q1cal6sdgfxs8zqi9v8llrsn4kqkq-hello.drv'...
"hello world"
</code></pre>
<p>The contents of the derivation's output have to be <a href="language/../glossary.html#gloss-realise">realised</a> before they can be read with <a href="language/./builtins.html#builtins-readFile"><code>readFile</code></a>.
Only then evaluation can continue to produce the final result.</p>
<h2 id="illustration"><a class="header" href="#illustration">Illustration</a></h2>
<p>As a first approximation, the following data flow graph shows how evaluation and building are interleaved, if the value of a Nix expression depends on realising a <a href="language/../store/store-object.html">store object</a>.
Boxes are data structures, arrow labels are transformations.</p>
<pre><code>+----------------------+             +------------------------+
| Nix evaluator        |             | Nix store              |
|  .----------------.  |             |                        |
|  | Nix expression |  |             |                        |
|  '----------------'  |             |                        |
|          |           |             |                        |
|       evaluate       |             |                        |
|          |           |             |                        |
|          V           |             |                        |
|    .------------.    |             |                        |
|    | derivation |    |             |  .------------------.  |
|    | expression |----|-instantiate-|-&gt;| store derivation |  |
|    '------------'    |             |  '------------------'  |
|                      |             |           |            |
|                      |             |        realise         |
|                      |             |           |            |
|                      |             |           V            |
|  .----------------.  |             |    .--------------.    |
|  | Nix expression |&lt;-|----read-----|----| store object |    |
|  '----------------'  |             |    '--------------'    |
|          |           |             |                        |
|       evaluate       |             |                        |
|          |           |             |                        |
|          V           |             |                        |
|    .------------.    |             |                        |
|    |   value    |    |             |                        |
|    '------------'    |             |                        |
+----------------------+             +------------------------+
</code></pre>
<p>In more detail, the following sequence diagram shows how the expression is evaluated step by step, and where evaluation is blocked to wait for the build output to appear.</p>
<pre><code>.-------.     .-------------.                        .---------.
|Nix CLI|     |Nix evaluator|                        |Nix store|
'-------'     '-------------'                        '---------'
    |                |                                    |
    |evaluate IFD.nix|                                    |
    |---------------&gt;|                                    |
    |                |                                    |
    |  evaluate `"${readFile drv} world"`                 |
    |                |                                    |
    |    evaluate `readFile drv`                          |
    |                |                                    |
    |   evaluate `drv` as string                          |
    |                |                                    |
    |                |instantiate /nix/store/...-hello.drv|
    |                |-----------------------------------&gt;|
    |                :                                    |
    |                :  realise /nix/store/...-hello.drv  |
    |                :-----------------------------------&gt;|
    |                :                                    |
    |                                                     |--------.
    |                :                                    |        |
    |      (evaluation blocked)                           |  echo hello &gt; $out
    |                :                                    |        |
    |                                                     |&lt;-------'
    |                :        /nix/store/...-hello        |
    |                |&lt;-----------------------------------|
    |                |                                    |
    |  resume `readFile /nix/store/...-hello`             |
    |                |                                    |
    |                |   readFile /nix/store/...-hello    |
    |                |-----------------------------------&gt;|
    |                |                                    |
    |                |               hello                |
    |                |&lt;-----------------------------------|
    |                |                                    |
    |      resume `"${"hello"} world"`                    |
    |                |                                    |
    |        resume `"hello world"`                       |
    |                |                                    |
    | "hello world"  |                                    |
    |&lt;---------------|                                    |
.-------.     .-------------.                        .---------.
|Nix CLI|     |Nix evaluator|                        |Nix store|
'-------'     '-------------'                        '---------'
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><p>This chapter discusses how to do package management with Nix, i.e.,
how to obtain, install, upgrade, and erase packages. This is the
“user’s” perspective of the Nix system — people who want to <em>create</em>
packages should consult the chapter on the <a href="package-management/../language/index.html">Nix language</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="profiles"><a class="header" href="#profiles">Profiles</a></h1>
<p>Profiles and user environments are Nix’s mechanism for implementing the
ability to allow different users to have different configurations, and
to do atomic upgrades and rollbacks. To understand how they work, it’s
useful to know a bit about how Nix works. In Nix, packages are stored in
unique locations in the <em>Nix store</em> (typically, <code>/nix/store</code>). For
instance, a particular version of the Subversion package might be stored
in a directory
<code>/nix/store/dpmvp969yhdqs7lm2r1a3gng7pyq6vy4-subversion-1.1.3/</code>, while
another version might be stored in
<code>/nix/store/5mq2jcn36ldlmh93yj1n8s9c95pj7c5s-subversion-1.1.2</code>. The long
strings prefixed to the directory names are cryptographic hashes (to be
precise, 160-bit truncations of SHA-256 hashes encoded in a base-32
notation) of <em>all</em> inputs involved in building the package — sources,
dependencies, compiler flags, and so on. So if two packages differ in
any way, they end up in different locations in the file system, so they
don’t interfere with each other. Here is what a part of a typical Nix
store looks like:</p>
<p><img src="package-management/../figures/user-environments.png" alt="" /></p>
<p>Of course, you wouldn’t want to type</p>
<pre><code class="language-console">$ /nix/store/dpmvp969yhdq...-subversion-1.1.3/bin/svn
</code></pre>
<p>every time you want to run Subversion. Of course we could set up the
<code>PATH</code> environment variable to include the <code>bin</code> directory of every
package we want to use, but this is not very convenient since changing
<code>PATH</code> doesn’t take effect for already existing processes. The solution
Nix uses is to create directory trees of symlinks to <em>activated</em>
packages. These are called <em>user environments</em> and they are packages
themselves (though automatically generated by <code>nix-env</code>), so they too
reside in the Nix store. For instance, in the figure above, the user
environment <code>/nix/store/0c1p5z4kda11...-user-env</code> contains a symlink to
just Subversion 1.1.2 (arrows in the figure indicate symlinks). This
would be what we would obtain if we had done</p>
<pre><code class="language-console">$ nix-env --install --attr nixpkgs.subversion
</code></pre>
<p>on a set of Nix expressions that contained Subversion 1.1.2.</p>
<p>This doesn’t in itself solve the problem, of course; you wouldn’t want
to type <code>/nix/store/0c1p5z4kda11...-user-env/bin/svn</code> either. That’s why
there are symlinks outside of the store that point to the user
environments in the store; for instance, the symlinks <code>default-42-link</code>
and <code>default-43-link</code> in the example. These are called <em>generations</em>
since every time you perform a <code>nix-env</code> operation, a new user
environment is generated based on the current one. For instance,
generation 43 was created from generation 42 when we did</p>
<pre><code class="language-console">$ nix-env --install --attr nixpkgs.subversion nixpkgs.firefox
</code></pre>
<p>on a set of Nix expressions that contained Firefox and a new version of
Subversion.</p>
<p>Generations are grouped together into <em>profiles</em> so that different users
don’t interfere with each other if they don’t want to. For example:</p>
<pre><code class="language-console">$ ls -l /nix/var/nix/profiles/
...
lrwxrwxrwx  1 eelco ... default-42-link -&gt; /nix/store/0c1p5z4kda11...-user-env
lrwxrwxrwx  1 eelco ... default-43-link -&gt; /nix/store/3aw2pdyx2jfc...-user-env
lrwxrwxrwx  1 eelco ... default -&gt; default-43-link
</code></pre>
<p>This shows a profile called <code>default</code>. The file <code>default</code> itself is
actually a symlink that points to the current generation. When we do a
<code>nix-env</code> operation, a new user environment and generation link are
created based on the current one, and finally the <code>default</code> symlink is
made to point at the new generation. This last step is atomic on Unix,
which explains how we can do atomic upgrades. (Note that the
building/installing of new packages doesn’t interfere in any way with
old packages, since they are stored in different locations in the Nix
store.)</p>
<p>If you find that you want to undo a <code>nix-env</code> operation, you can just do</p>
<pre><code class="language-console">$ nix-env --rollback
</code></pre>
<p>which will just make the current generation link point at the previous
link. E.g., <code>default</code> would be made to point at <code>default-42-link</code>. You
can also switch to a specific generation:</p>
<pre><code class="language-console">$ nix-env --switch-generation 43
</code></pre>
<p>which in this example would roll forward to generation 43 again. You can
also see all available generations:</p>
<pre><code class="language-console">$ nix-env --list-generations
</code></pre>
<p>You generally wouldn’t have <code>/nix/var/nix/profiles/some-profile/bin</code> in
your <code>PATH</code>. Rather, there is a symlink <code>~/.nix-profile</code> that points to
your current profile. This means that you should put
<code>~/.nix-profile/bin</code> in your <code>PATH</code> (and indeed, that’s what the
initialisation script <code>/nix/etc/profile.d/nix.sh</code> does). This makes it
easier to switch to a different profile. You can do that using the
command <code>nix-env --switch-profile</code>:</p>
<pre><code class="language-console">$ nix-env --switch-profile /nix/var/nix/profiles/my-profile

$ nix-env --switch-profile /nix/var/nix/profiles/default
</code></pre>
<p>These commands switch to the <code>my-profile</code> and default profile,
respectively. If the profile doesn’t exist, it will be created
automatically. You should be careful about storing a profile in another
location than the <code>profiles</code> directory, since otherwise it might not be
used as a root of the <a href="package-management/garbage-collection.html">garbage collector</a>.</p>
<p>All <code>nix-env</code> operations work on the profile pointed to by
<code>~/.nix-profile</code>, but you can override this using the <code>--profile</code> option
(abbreviation <code>-p</code>):</p>
<pre><code class="language-console">$ nix-env --profile /nix/var/nix/profiles/other-profile --install --attr nixpkgs.subversion
</code></pre>
<p>This will <em>not</em> change the <code>~/.nix-profile</code> symlink.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="garbage-collection-1"><a class="header" href="#garbage-collection-1">Garbage Collection</a></h1>
<p><code>nix-env</code> operations such as upgrades (<code>-u</code>) and uninstall (<code>-e</code>) never
actually delete packages from the system. All they do (as shown above)
is to create a new user environment that no longer contains symlinks to
the “deleted” packages.</p>
<p>Of course, since disk space is not infinite, unused packages should be
removed at some point. You can do this by running the Nix garbage
collector. It will remove from the Nix store any package not used
(directly or indirectly) by any generation of any profile.</p>
<p>Note however that as long as old generations reference a package, it
will not be deleted. After all, we wouldn’t be able to do a rollback
otherwise. So in order for garbage collection to be effective, you
should also delete (some) old generations. Of course, this should only
be done if you are certain that you will not need to roll back.</p>
<p>To delete all old (non-current) generations of your current profile:</p>
<pre><code class="language-console">$ nix-env --delete-generations old
</code></pre>
<p>Instead of <code>old</code> you can also specify a list of generations, e.g.,</p>
<pre><code class="language-console">$ nix-env --delete-generations 10 11 14
</code></pre>
<p>To delete all generations older than a specified number of days (except
the current generation), use the <code>d</code> suffix. For example,</p>
<pre><code class="language-console">$ nix-env --delete-generations 14d
</code></pre>
<p>deletes all generations older than two weeks.</p>
<p>After removing appropriate old generations you can run the garbage
collector as follows:</p>
<pre><code class="language-console">$ nix-store --gc
</code></pre>
<p>The behaviour of the garbage collector is affected by the
<code>keep-derivations</code> (default: true) and <code>keep-outputs</code> (default: false)
options in the Nix configuration file. The defaults will ensure that all
derivations that are build-time dependencies of garbage collector roots
will be kept and that all output paths that are runtime dependencies
will be kept as well. All other derivations or paths will be collected.
(This is usually what you want, but while you are developing it may make
sense to keep outputs to ensure that rebuild times are quick.) If you
are feeling uncertain, you can also first view what files would be
deleted:</p>
<pre><code class="language-console">$ nix-store --gc --print-dead
</code></pre>
<p>Likewise, the option <code>--print-live</code> will show the paths that <em>won’t</em> be
deleted.</p>
<p>There is also a convenient little utility <code>nix-collect-garbage</code>, which
when invoked with the <code>-d</code> (<code>--delete-old</code>) switch deletes all old
generations of all profiles in <code>/nix/var/nix/profiles</code>. So</p>
<pre><code class="language-console">$ nix-collect-garbage -d
</code></pre>
<p>is a quick and easy way to clean up your system.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="garbage-collector-roots"><a class="header" href="#garbage-collector-roots">Garbage Collector Roots</a></h1>
<p>The roots of the garbage collector are all store paths to which there
are symlinks in the directory <code>prefix/nix/var/nix/gcroots</code>. For
instance, the following command makes the path
<code>/nix/store/d718ef...-foo</code> a root of the collector:</p>
<pre><code class="language-console">$ ln -s /nix/store/d718ef...-foo /nix/var/nix/gcroots/bar
</code></pre>
<p>That is, after this command, the garbage collector will not remove
<code>/nix/store/d718ef...-foo</code> or any of its dependencies.</p>
<p>Subdirectories of <code>prefix/nix/var/nix/gcroots</code> are also searched for
symlinks. Symlinks to non-store paths are followed and searched for
roots, but symlinks to non-store paths <em>inside</em> the paths reached in
that way are not followed to prevent infinite recursion.</p>
<div style="break-before: page; page-break-before: always;"></div><p>This section lists advanced topics related to builds and builds performance</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sharing-packages-between-machines"><a class="header" href="#sharing-packages-between-machines">Sharing Packages Between Machines</a></h1>
<p>Sometimes you want to copy a package from one machine to another. Or,
you want to install some packages and you know that another machine
already has some or all of those packages or their dependencies. In that
case there are mechanisms to quickly copy packages between machines.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="serving-a-nix-store-via-http"><a class="header" href="#serving-a-nix-store-via-http">Serving a Nix store via HTTP</a></h1>
<p>You can easily share the Nix store of a machine via HTTP. This allows
other machines to fetch store paths from that machine to speed up
installations. It uses the same <em>binary cache</em> mechanism that Nix
usually uses to fetch pre-built binaries from <a href="https://cache.nixos.org">https://cache.nixos.org</a>.</p>
<p>The daemon that handles binary cache requests via HTTP, <code>nix-serve</code>, is
not part of the Nix distribution, but you can install it from Nixpkgs:</p>
<pre><code class="language-console">$ nix-env --install --attr nixpkgs.nix-serve
</code></pre>
<p>You can then start the server, listening for HTTP connections on
whatever port you like:</p>
<pre><code class="language-console">$ nix-serve -p 8080
</code></pre>
<p>To check whether it works, try the following on the client:</p>
<pre><code class="language-console">$ curl http://avalon:8080/nix-cache-info
</code></pre>
<p>which should print something like:</p>
<pre><code>StoreDir: /nix/store
WantMassQuery: 1
Priority: 30
</code></pre>
<p>On the client side, you can tell Nix to use your binary cache using
<code>--substituters</code>, e.g.:</p>
<pre><code class="language-console">$ nix-env --install --attr nixpkgs.firefox --substituters http://avalon:8080/
</code></pre>
<p>The option <code>substituters</code> tells Nix to use this binary cache in
addition to your default caches, such as <a href="https://cache.nixos.org">https://cache.nixos.org</a>.
Thus, for any path in the closure of Firefox, Nix will first check if
the path is available on the server <code>avalon</code> or another binary caches.
If not, it will fall back to building from source.</p>
<p>You can also tell Nix to always use your binary cache by adding a line
to the <code>nix.conf</code> configuration file like this:</p>
<pre><code>substituters = http://avalon:8080/ https://cache.nixos.org/
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="serving-a-nix-store-via-ssh"><a class="header" href="#serving-a-nix-store-via-ssh">Serving a Nix store via SSH</a></h1>
<p>You can tell Nix to automatically fetch needed binaries from a remote
Nix store via SSH. For example, the following installs Firefox,
automatically fetching any store paths in Firefox’s closure if they are
available on the server <code>avalon</code>:</p>
<pre><code class="language-console">$ nix-env --install --attr nixpkgs.firefox --substituters ssh://alice@avalon
</code></pre>
<p>This works similar to the binary cache substituter that Nix usually
uses, only using SSH instead of HTTP: if a store path <code>P</code> is needed, Nix
will first check if it’s available in the Nix store on <code>avalon</code>. If not,
it will fall back to using the binary cache substituter, and then to
building from source.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>The SSH substituter currently does not allow you to enter an SSH
passphrase interactively. Therefore, you should use <code>ssh-add</code> to load
the decrypted private key into <code>ssh-agent</code>.</p>
</blockquote>
<p>You can also copy the closure of some store path, without installing it
into your profile, e.g.</p>
<pre><code class="language-console">$ nix-store --realise /nix/store/m85bxg…-firefox-34.0.5 --substituters
ssh://alice@avalon
</code></pre>
<p>This is essentially equivalent to doing</p>
<pre><code class="language-console">$ nix-copy-closure --from alice@avalon
/nix/store/m85bxg…-firefox-34.0.5
</code></pre>
<p>You can use SSH’s <em>forced command</em> feature to set up a restricted user
account for SSH substituter access, allowing read-only access to the
local Nix store, but nothing more. For example, add the following lines
to <code>sshd_config</code> to restrict the user <code>nix-ssh</code>:</p>
<pre><code>Match User nix-ssh
  AllowAgentForwarding no
  AllowTcpForwarding no
  PermitTTY no
  PermitTunnel no
  X11Forwarding no
  ForceCommand nix-store --serve
Match All
</code></pre>
<p>On NixOS, you can accomplish the same by adding the following to your
<code>configuration.nix</code>:</p>
<pre><code class="language-nix">nix.sshServe.enable = true;
nix.sshServe.keys = [ "ssh-dss AAAAB3NzaC1k... bob@example.org" ];
</code></pre>
<p>where the latter line lists the public keys of users that are allowed to
connect.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="remote-builds"><a class="header" href="#remote-builds">Remote Builds</a></h1>
<p>A local Nix installation can forward Nix builds to other machines,
this allows multiple builds to be performed in parallel.</p>
<p>Remote builds also allow Nix to perform multi-platform builds in a
semi-transparent way. For example, if you perform a build for a
<code>x86_64-darwin</code> on an <code>i686-linux</code> machine, Nix can automatically
forward the build to a <code>x86_64-darwin</code> machine, if one is available.</p>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<p>For a local machine to forward a build to a remote machine, the remote machine must:</p>
<ul>
<li>Have Nix installed</li>
<li>Be running an SSH server, e.g. <code>sshd</code></li>
<li>Be accessible via SSH from the local machine over the network</li>
<li>Have the local machine's public SSH key in <code>/etc/ssh/authorized_keys.d/&lt;username&gt;</code></li>
<li>Have the username of the SSH user in the <code>trusted-users</code> setting in <code>nix.conf</code></li>
</ul>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<p>To test connecting to a remote <a href="advanced-topics/../glossary.html#gloss-nix-instance">Nix instance</a> (in this case <code>mac</code>), run:</p>
<pre><code class="language-console">nix store info --store ssh://username@mac
</code></pre>
<p>To specify an SSH identity file as part of the remote store URI add a
query paramater, e.g.</p>
<pre><code class="language-console">nix store info --store ssh://username@mac?ssh-key=/home/alice/my-key
</code></pre>
<p>Since builds should be non-interactive, the key should not have a
passphrase. Alternatively, you can load identities ahead of time into
<code>ssh-agent</code> or <code>gpg-agent</code>.</p>
<p>In a multi-user installation (default), builds are executed by the Nix
Daemon. The Nix Daemon cannot prompt for a passphrase via the terminal
or <code>ssh-agent</code>, so the SSH key must not have a passphrase.</p>
<p>In addition, the Nix Daemon's user (typically root) needs to have SSH
access to the remote builder.</p>
<p>Access can be verified by running <code>sudo su</code>, and then validating SSH
access, e.g. by running <code>ssh mac</code>. SSH identity files for root users
are usually stored in <code>/root/.ssh/</code> (Linux) or <code>/var/root/.ssh</code> (MacOS).</p>
<p>If you get the error</p>
<pre><code class="language-console">bash: nix: command not found
error: cannot connect to 'mac'
</code></pre>
<p>then you need to ensure that the <code>PATH</code> of non-interactive login shells
contains Nix.</p>
<p>The <a href="advanced-topics/../command-ref/conf-file.html#conf-builders">list of remote build machines</a> can be specified on the command line or in the Nix configuration file.
For example, the following command allows you to build a derivation for <code>x86_64-darwin</code> on a Linux machine:</p>
<pre><code class="language-console">uname
</code></pre>
<pre><code class="language-console">Linux
</code></pre>
<pre><code class="language-console">nix build --impure \
 --expr '(with import &lt;nixpkgs&gt; { system = "x86_64-darwin"; }; runCommand "foo" {} "uname &gt; $out")' \
 --builders 'ssh://mac x86_64-darwin'
</code></pre>
<pre><code class="language-console">[1/0/1 built, 0.0 MiB DL] building foo on ssh://mac
</code></pre>
<pre><code class="language-console">cat ./result
</code></pre>
<pre><code class="language-console">Darwin
</code></pre>
<p>It is possible to specify multiple build machines separated by a semicolon or a newline, e.g.</p>
<pre><code class="language-console">  --builders 'ssh://mac x86_64-darwin ; ssh://beastie x86_64-freebsd'
</code></pre>
<p>Remote build machines can also be configured in <a href="advanced-topics/../command-ref/conf-file.html"><code>nix.conf</code></a>, e.g.</p>
<pre><code>builders = ssh://mac x86_64-darwin ; ssh://beastie x86_64-freebsd
</code></pre>
<p>After making changes to <code>nix.conf</code>, restart the Nix daemon for changes to take effect.</p>
<p>Finally, remote build machines can be configured in a separate configuration
file included in <code>builders</code> via the syntax <code>@/path/to/file</code>. For example,</p>
<pre><code>builders = @/etc/nix/machines
</code></pre>
<p>causes the list of machines in <code>/etc/nix/machines</code> to be included.
(This is the default.)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tuning-cores-and-jobs"><a class="header" href="#tuning-cores-and-jobs">Tuning Cores and Jobs</a></h1>
<p>Nix has two relevant settings with regards to how your CPU cores will
be utilized: <code>cores</code> and <code>max-jobs</code>. This chapter will talk about what
they are, how they interact, and their configuration trade-offs.</p>
<ul>
<li>
<p><code>max-jobs</code><br />
Dictates how many separate derivations will be built at the same
time. If you set this to zero, the local machine will do no
builds.  Nix will still substitute from binary caches, and build
remotely if remote builders are configured.</p>
</li>
<li>
<p><code>cores</code><br />
Suggests how many cores each derivation should use. Similar to
<code>make -j</code>.</p>
</li>
</ul>
<p>The <code>cores</code> setting determines the value of
<code>NIX_BUILD_CORES</code>. <code>NIX_BUILD_CORES</code> is equal to <code>cores</code>, unless
<code>cores</code> equals <code>0</code>, in which case <code>NIX_BUILD_CORES</code> will be the total
number of cores in the system.</p>
<p>The maximum number of consumed cores is a simple multiplication,
<code>max-jobs</code> * <code>NIX_BUILD_CORES</code>.</p>
<p>The balance on how to set these two independent variables depends upon
each builder's workload and hardware. Here are a few example scenarios
on a machine with 24 cores:</p>
<div class="table-wrapper"><table><thead><tr><th><code>max-jobs</code></th><th><code>cores</code></th><th><code>NIX_BUILD_CORES</code></th><th>Maximum Processes</th><th>Result</th></tr></thead><tbody>
<tr><td>1</td><td>24</td><td>24</td><td>24</td><td>One derivation will be built at a time, each one can use 24 cores. Undersold if a job can’t use 24 cores.</td></tr>
<tr><td>4</td><td>6</td><td>6</td><td>24</td><td>Four derivations will be built at once, each given access to six cores.</td></tr>
<tr><td>12</td><td>6</td><td>6</td><td>72</td><td>12 derivations will be built at once, each given access to six cores. This configuration is over-sold. If all 12 derivations being built simultaneously try to use all six cores, the machine's performance will be degraded due to extensive context switching between the 12 builds.</td></tr>
<tr><td>24</td><td>1</td><td>1</td><td>24</td><td>24 derivations can build at the same time, each using a single core. Never oversold, but derivations which require many cores will be very slow to compile.</td></tr>
<tr><td>24</td><td>0</td><td>24</td><td>576</td><td>24 derivations can build at the same time, each using all the available cores of the machine. Very likely to be oversold, and very likely to suffer context switches.</td></tr>
</tbody></table>
</div>
<p>It is up to the derivations' build script to respect host's requested
cores-per-build by following the value of the <code>NIX_BUILD_CORES</code>
environment variable.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="verifying-build-reproducibility"><a class="header" href="#verifying-build-reproducibility">Verifying Build Reproducibility</a></h1>
<p>You can use Nix's <code>diff-hook</code> setting to compare build results. Note
that this hook is only executed if the results differ; it is not used
for determining if the results are the same.</p>
<p>For purposes of demonstration, we'll use the following Nix file,
<code>deterministic.nix</code> for testing:</p>
<pre><code class="language-nix">let
  inherit (import &lt;nixpkgs&gt; {}) runCommand;
in {
  stable = runCommand "stable" {} ''
    touch $out
  '';

  unstable = runCommand "unstable" {} ''
    echo $RANDOM &gt; $out
  '';
}
</code></pre>
<p>Additionally, <code>nix.conf</code> contains:</p>
<pre><code>diff-hook = /etc/nix/my-diff-hook
run-diff-hook = true
</code></pre>
<p>where <code>/etc/nix/my-diff-hook</code> is an executable file containing:</p>
<pre><code class="language-bash">#!/bin/sh
exec &gt;&amp;2
echo "For derivation $3:"
/run/current-system/sw/bin/diff -r "$1" "$2"
</code></pre>
<p>The diff hook is executed by the same user and group who ran the build.
However, the diff hook does not have write access to the store path just
built.</p>
<h1 id="spot-checking-build-determinism"><a class="header" href="#spot-checking-build-determinism">Spot-Checking Build Determinism</a></h1>
<p>Verify a path which already exists in the Nix store by passing <code>--check</code>
to the build command.</p>
<p>If the build passes and is deterministic, Nix will exit with a status
code of 0:</p>
<pre><code class="language-console">$ nix-build ./deterministic.nix --attr stable
this derivation will be built:
  /nix/store/z98fasz2jqy9gs0xbvdj939p27jwda38-stable.drv
building '/nix/store/z98fasz2jqy9gs0xbvdj939p27jwda38-stable.drv'...
/nix/store/yyxlzw3vqaas7wfp04g0b1xg51f2czgq-stable

$ nix-build ./deterministic.nix --attr stable --check
checking outputs of '/nix/store/z98fasz2jqy9gs0xbvdj939p27jwda38-stable.drv'...
/nix/store/yyxlzw3vqaas7wfp04g0b1xg51f2czgq-stable
</code></pre>
<p>If the build is not deterministic, Nix will exit with a status code of
1:</p>
<pre><code class="language-console">$ nix-build ./deterministic.nix --attr unstable
this derivation will be built:
  /nix/store/cgl13lbj1w368r5z8gywipl1ifli7dhk-unstable.drv
building '/nix/store/cgl13lbj1w368r5z8gywipl1ifli7dhk-unstable.drv'...
/nix/store/krpqk0l9ib0ibi1d2w52z293zw455cap-unstable

$ nix-build ./deterministic.nix --attr unstable --check
checking outputs of '/nix/store/cgl13lbj1w368r5z8gywipl1ifli7dhk-unstable.drv'...
error: derivation '/nix/store/cgl13lbj1w368r5z8gywipl1ifli7dhk-unstable.drv' may
not be deterministic: output '/nix/store/krpqk0l9ib0ibi1d2w52z293zw455cap-unstable' differs
</code></pre>
<p>In the Nix daemon's log, we will now see:</p>
<pre><code>For derivation /nix/store/cgl13lbj1w368r5z8gywipl1ifli7dhk-unstable.drv:
1c1
&lt; 8108
---
&gt; 30204
</code></pre>
<p>Using <code>--check</code> with <code>--keep-failed</code> will cause Nix to keep the second
build's output in a special, <code>.check</code> path:</p>
<pre><code class="language-console">$ nix-build ./deterministic.nix --attr unstable --check --keep-failed
checking outputs of '/nix/store/cgl13lbj1w368r5z8gywipl1ifli7dhk-unstable.drv'...
note: keeping build directory '/tmp/nix-build-unstable.drv-0'
error: derivation '/nix/store/cgl13lbj1w368r5z8gywipl1ifli7dhk-unstable.drv' may
not be deterministic: output '/nix/store/krpqk0l9ib0ibi1d2w52z293zw455cap-unstable' differs
from '/nix/store/krpqk0l9ib0ibi1d2w52z293zw455cap-unstable.check'
</code></pre>
<p>In particular, notice the
<code>/nix/store/krpqk0l9ib0ibi1d2w52z293zw455cap-unstable.check</code> output. Nix
has copied the build results to that directory where you can examine it.</p>
<blockquote>
<p><a name="check-dirs-are-unregistered"></a> <strong>Note</strong></p>
<p>Check paths are not protected against garbage collection, and this
path will be deleted on the next garbage collection.</p>
<p>The path is guaranteed to be alive for the duration of
the <code>diff-hook</code>'s execution, but may be deleted any time after.</p>
<p>If the comparison is performed as part of automated tooling, please
use the diff-hook or author your tooling to handle the case where the
build was not deterministic and also a check path does not exist.</p>
</blockquote>
<p><code>--check</code> is only usable if the derivation has been built on the system
already. If the derivation has not been built Nix will fail with the
error:</p>
<pre><code>error: some outputs of '/nix/store/hzi1h60z2qf0nb85iwnpvrai3j2w7rr6-unstable.drv' 
are not valid, so checking is not possible
</code></pre>
<p>Run the build without <code>--check</code>, and then try with <code>--check</code> again.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-the-post-build-hook"><a class="header" href="#using-the-post-build-hook">Using the <code>post-build-hook</code></a></h1>
<h1 id="implementation-caveats"><a class="header" href="#implementation-caveats">Implementation Caveats</a></h1>
<p>Here we use the post-build hook to upload to a binary cache. This is a
simple and working example, but it is not suitable for all use cases.</p>
<p>The post build hook program runs after each executed build, and blocks
the build loop. The build loop exits if the hook program fails.</p>
<p>Concretely, this implementation will make Nix slow or unusable when the
internet is slow or unreliable.</p>
<p>A more advanced implementation might pass the store paths to a
user-supplied daemon or queue for processing the store paths outside of
the build loop.</p>
<h1 id="prerequisites-1"><a class="header" href="#prerequisites-1">Prerequisites</a></h1>
<p>This tutorial assumes you have configured an <a href="advanced-topics/../command-ref/new-cli/nix3-help-stores.html#s3-binary-cache-store">S3-compatible binary cache</a> as a <a href="advanced-topics/../command-ref/conf-file.html#conf-substituters">substituter</a>,
and that the <code>root</code> user's default AWS profile can upload to the bucket.</p>
<h1 id="set-up-a-signing-key"><a class="header" href="#set-up-a-signing-key">Set up a Signing Key</a></h1>
<p>Use <code>nix-store --generate-binary-cache-key</code> to create our public and
private signing keys. We will sign paths with the private key, and
distribute the public key for verifying the authenticity of the paths.</p>
<pre><code class="language-console"># nix-store --generate-binary-cache-key example-nix-cache-1 /etc/nix/key.private /etc/nix/key.public
# cat /etc/nix/key.public
example-nix-cache-1:1/cKDz3QCCOmwcztD2eV6Coggp6rqc9DGjWv7C0G+rM=
</code></pre>
<p>Then update <a href="advanced-topics/../command-ref/conf-file.html"><code>nix.conf</code></a> on any machine that will access the cache.
Add the cache URL to <a href="advanced-topics/../command-ref/conf-file.html#conf-substituters"><code>substituters</code></a> and the public key to <a href="advanced-topics/../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>:</p>
<pre><code>substituters = https://cache.nixos.org/ s3://example-nix-cache
trusted-public-keys = cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY= example-nix-cache-1:1/cKDz3QCCOmwcztD2eV6Coggp6rqc9DGjWv7C0G+rM=
</code></pre>
<p>Machines that build for the cache must sign derivations using the private key.
On those machines, add the path to the key file to the <a href="advanced-topics/../command-ref/conf-file.html#conf-secret-key-files"><code>secret-key-files</code></a> field in their <a href="advanced-topics/../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>secret-key-files = /etc/nix/key.private
</code></pre>
<p>We will restart the Nix daemon in a later step.</p>
<h1 id="implementing-the-build-hook"><a class="header" href="#implementing-the-build-hook">Implementing the build hook</a></h1>
<p>Write the following script to <code>/etc/nix/upload-to-cache.sh</code>:</p>
<pre><code class="language-bash">#!/bin/sh

set -eu
set -f # disable globbing
export IFS=' '

echo "Uploading paths" $OUT_PATHS
exec nix copy --to "s3://example-nix-cache" $OUT_PATHS
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>The <code>$OUT_PATHS</code> variable is a space-separated list of Nix store
paths. In this case, we expect and want the shell to perform word
splitting to make each output path its own argument to <code>nix store sign</code>. Nix guarantees the paths will not contain any spaces,
however a store path might contain glob characters. The <code>set -f</code>
disables globbing in the shell.
If you want to upload the <code>.drv</code> file too, the <code>$DRV_PATH</code> variable
is also defined for the script and works just like <code>$OUT_PATHS</code>.</p>
</blockquote>
<p>Then make sure the hook program is executable by the <code>root</code> user:</p>
<pre><code class="language-console"># chmod +x /etc/nix/upload-to-cache.sh
</code></pre>
<h1 id="updating-nix-configuration"><a class="header" href="#updating-nix-configuration">Updating Nix Configuration</a></h1>
<p>Edit <code>/etc/nix/nix.conf</code> to run our hook, by adding the following
configuration snippet at the end:</p>
<pre><code>post-build-hook = /etc/nix/upload-to-cache.sh
</code></pre>
<p>Then, restart the <code>nix-daemon</code>.</p>
<h1 id="testing-1"><a class="header" href="#testing-1">Testing</a></h1>
<p>Build any derivation, for example:</p>
<pre><code class="language-console">$ nix-build --expr '(import &lt;nixpkgs&gt; {}).writeText "example" (builtins.toString builtins.currentTime)'
this derivation will be built:
  /nix/store/s4pnfbkalzy5qz57qs6yybna8wylkig6-example.drv
building '/nix/store/s4pnfbkalzy5qz57qs6yybna8wylkig6-example.drv'...
running post-build-hook '/home/grahamc/projects/github.com/NixOS/nix/post-hook.sh'...
post-build-hook: Signing paths /nix/store/ibcyipq5gf91838ldx40mjsp0b8w9n18-example
post-build-hook: Uploading paths /nix/store/ibcyipq5gf91838ldx40mjsp0b8w9n18-example
/nix/store/ibcyipq5gf91838ldx40mjsp0b8w9n18-example
</code></pre>
<p>Then delete the path from the store, and try substituting it from the
binary cache:</p>
<pre><code class="language-console">$ rm ./result
$ nix-store --delete /nix/store/ibcyipq5gf91838ldx40mjsp0b8w9n18-example
</code></pre>
<p>Now, copy the path back from the cache:</p>
<pre><code class="language-console">$ nix-store --realise /nix/store/ibcyipq5gf91838ldx40mjsp0b8w9n18-example
copying path '/nix/store/m8bmqwrch6l3h8s0k3d673xpmipcdpsa-example from 's3://example-nix-cache'...
warning: you did not specify '--add-root'; the result might be removed by the garbage collector
/nix/store/m8bmqwrch6l3h8s0k3d673xpmipcdpsa-example
</code></pre>
<h1 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h1>
<p>We now have a Nix installation configured to automatically sign and
upload every local build to a remote binary cache.</p>
<p>Before deploying this to production, be sure to consider the
<a href="advanced-topics/post-build-hook.html#implementation-caveats">implementation caveats</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><p>This section lists commands and options that you can use when you work
with Nix.</p>
<div style="break-before: page; page-break-before: always;"></div><!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options"><a class="header" href="#common-options">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/opt-common.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/opt-common.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/opt-common.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/opt-common.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/opt-common.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/opt-common.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/opt-common.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/opt-common.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/opt-common.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/opt-common.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/opt-common.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/opt-common.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/opt-common.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/opt-common.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/opt-common.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/opt-common.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/opt-common.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/opt-common.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/opt-common.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/opt-common.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/opt-common.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/opt-common.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/opt-common.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/opt-common.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/opt-common.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="common-environment-variables"><a class="header" href="#common-environment-variables">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/env-common.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/env-common.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/env-common.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/env-common.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/env-common.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/env-common.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/env-common.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/env-common.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/env-common.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/env-common.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/env-common.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/env-common.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/env-common.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/env-common.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/env-common.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories"><a class="header" href="#xdg-base-directories">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/env-common.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/env-common.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/env-common.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/env-common.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/env-common.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/env-common.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="main-commands"><a class="header" href="#main-commands">Main Commands</a></h1>
<p>This section lists commands and options that you can use when you work
with Nix.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name"><a class="header" href="#name">Name</a></h1>
<p><code>nix-build</code> - build a Nix expression</p>
<h1 id="synopsis"><a class="header" href="#synopsis">Synopsis</a></h1>
<p><code>nix-build</code> [<em>paths…</em>]
[<code>--arg</code> <em>name</em> <em>value</em>]
[<code>--argstr</code> <em>name</em> <em>value</em>]
[{<code>--attr</code> | <code>-A</code>} <em>attrPath</em>]
[<code>--no-out-link</code>]
[<code>--dry-run</code>]
[{<code>--out-link</code> | <code>-o</code>} <em>outlink</em>]</p>
<h1 id="disambiguation"><a class="header" href="#disambiguation">Disambiguation</a></h1>
<p>This man page describes the command <code>nix-build</code>, which is distinct from <code>nix build</code>. For documentation on the latter, run <code>nix build --help</code> or see <code>man nix3-build</code>.</p>
<h1 id="description"><a class="header" href="#description">Description</a></h1>
<p>The <code>nix-build</code> command builds the derivations described by the Nix
expressions in <em>paths</em>. If the build succeeds, it places a symlink to
the result in the current directory. The symlink is called <code>result</code>. If
there are multiple Nix expressions, or the Nix expressions evaluate to
multiple derivations, multiple sequentially numbered symlinks are
created (<code>result</code>, <code>result-2</code>, and so on).</p>
<p>If no <em>paths</em> are specified, then <code>nix-build</code> will use <code>default.nix</code> in
the current directory, if it exists.</p>
<p>If an element of <em>paths</em> starts with <code>http://</code> or <code>https://</code>, it is
interpreted as the URL of a tarball that will be downloaded and unpacked
to a temporary location. The tarball must include a single top-level
directory containing at least a file named <code>default.nix</code>.</p>
<p><code>nix-build</code> is essentially a wrapper around
<a href="command-ref/nix-instantiate.html"><code>nix-instantiate</code></a> (to translate a high-level Nix
expression to a low-level <a href="command-ref/../glossary.html#gloss-store-derivation">store derivation</a>) and <a href="command-ref/../command-ref/nix-store/realise.html"><code>nix-store --realise</code></a> (to build the store
derivation).</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>The result of the build is automatically registered as a root of the
Nix garbage collector. This root disappears automatically when the
<code>result</code> symlink is deleted or renamed. So don’t rename the symlink.</p>
</blockquote>
<h1 id="options"><a class="header" href="#options">Options</a></h1>
<p>All options not listed here are passed to
<a href="command-ref/nix-store/realise.html"><code>nix-store --realise</code></a>,
except for <code>--arg</code> and <code>--attr</code> / <code>-A</code> which are passed to <a href="command-ref/nix-instantiate.html"><code>nix-instantiate</code></a>.</p>
<ul>
<li>
<p><span id="opt-no-out-link"><a href="command-ref/nix-build.html#opt-no-out-link"><code>--no-out-link</code></a><span></p>
<p>Do not create a symlink to the output path. Note that as a result
the output does not become a root of the garbage collector, and so
might be deleted by <code>nix-store --gc</code>.</p>
</li>
<li>
<p><span id="opt-dry-run"><a href="command-ref/nix-build.html#opt-dry-run"><code>--dry-run</code></a></span></p>
<p>Show what store paths would be built or downloaded.</p>
</li>
<li>
<p><span id="opt-out-link"><a href="command-ref/nix-build.html#opt-out-link"><code>--out-link</code></a></span> / <code>-o</code> <em>outlink</em></p>
<p>Change the name of the symlink to the output path created from
<code>result</code> to <em>outlink</em>.</p>
</li>
</ul>
<h1 id="special-exit-codes-for-build-failure"><a class="header" href="#special-exit-codes-for-build-failure">Special exit codes for build failure</a></h1>
<p>1xx status codes are used when requested builds failed.
The following codes are in use:</p>
<ul>
<li>
<p><code>100</code> Generic build failure</p>
<p>The builder process returned with a non-zero exit code.</p>
</li>
<li>
<p><code>101</code> Build timeout</p>
<p>The build was aborted because it did not complete within the specified <code>timeout</code>.</p>
</li>
<li>
<p><code>102</code> Hash mismatch</p>
<p>The build output was rejected because it does not match the
<a href="command-ref/../language/advanced-attributes.html"><code>outputHash</code> attribute of the derivation</a>.</p>
</li>
<li>
<p><code>104</code> Not deterministic</p>
<p>The build succeeded in check mode but the resulting output is not binary reproducible.</p>
</li>
</ul>
<p>With the <code>--keep-going</code> flag it's possible for multiple failures to occur.
In this case the 1xx status codes are or combined using
<a href="https://en.wikipedia.org/wiki/Bitwise_operation#OR">bitwise OR</a>.</p>
<pre><code>0b1100100
     ^^^^
     |||`- timeout
     ||`-- output hash mismatch
     |`--- build failure
     `---- not deterministic
</code></pre>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-1"><a class="header" href="#common-options-1">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-build.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-build.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-build.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-build.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-build.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-build.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-build.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-build.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-build.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-build.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-build.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-build.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-build.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-build.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-build.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-build.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-build.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-build.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-build.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-build.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-build.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-build.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-build.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-build.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-build.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-1"><a class="header" href="#common-environment-variables-1">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-build.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-build.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-build.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-build.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-build.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-build.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-build.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-build.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-build.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-build.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-build.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-build.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-build.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-build.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-build.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-build.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-1"><a class="header" href="#xdg-base-directories-1">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-build.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-build.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-build.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-build.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-build.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-build.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-2"><a class="header" href="#examples-2">Examples</a></h1>
<pre><code class="language-console">$ nix-build '&lt;nixpkgs&gt;' --attr firefox
store derivation is /nix/store/qybprl8sz2lc...-firefox-1.5.0.7.drv
/nix/store/d18hyl92g30l...-firefox-1.5.0.7

$ ls -l result
lrwxrwxrwx  ...  result -&gt; /nix/store/d18hyl92g30l...-firefox-1.5.0.7

$ ls ./result/bin/
firefox  firefox-config
</code></pre>
<p>If a derivation has multiple outputs, <code>nix-build</code> will build the default
(first) output. You can also build all outputs:</p>
<pre><code class="language-console">$ nix-build '&lt;nixpkgs&gt;' --attr openssl.all
</code></pre>
<p>This will create a symlink for each output named <code>result-outputname</code>.
The suffix is omitted if the output name is <code>out</code>. So if <code>openssl</code> has
outputs <code>out</code>, <code>bin</code> and <code>man</code>, <code>nix-build</code> will create symlinks
<code>result</code>, <code>result-bin</code> and <code>result-man</code>. It’s also possible to build a
specific output:</p>
<pre><code class="language-console">$ nix-build '&lt;nixpkgs&gt;' --attr openssl.man
</code></pre>
<p>This will create a symlink <code>result-man</code>.</p>
<p>Build a Nix expression given on the command line:</p>
<pre><code class="language-console">$ nix-build --expr 'with import &lt;nixpkgs&gt; { }; runCommand "foo" { } "echo bar &gt; $out"'
$ cat ./result
bar
</code></pre>
<p>Build the GNU Hello package from the latest revision of the master
branch of Nixpkgs:</p>
<pre><code class="language-console">$ nix-build https://github.com/NixOS/nixpkgs/archive/master.tar.gz --attr hello
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-1"><a class="header" href="#name-1">Name</a></h1>
<p><code>nix-shell</code> - start an interactive shell based on a Nix expression</p>
<h1 id="synopsis-1"><a class="header" href="#synopsis-1">Synopsis</a></h1>
<p><code>nix-shell</code>
[<code>--arg</code> <em>name</em> <em>value</em>]
[<code>--argstr</code> <em>name</em> <em>value</em>]
[{<code>--attr</code> | <code>-A</code>} <em>attrPath</em>]
[<code>--command</code> <em>cmd</em>]
[<code>--run</code> <em>cmd</em>]
[<code>--exclude</code> <em>regexp</em>]
[<code>--pure</code>]
[<code>--keep</code> <em>name</em>]
{{<code>--packages</code> | <code>-p</code>} {<em>packages</em> | <em>expressions</em>} … | [<em>path</em>]}</p>
<h1 id="disambiguation-1"><a class="header" href="#disambiguation-1">Disambiguation</a></h1>
<p>This man page describes the command <code>nix-shell</code>, which is distinct from <code>nix shell</code>. For documentation on the latter, run <code>nix shell --help</code> or see <code>man nix3-shell</code>.</p>
<h1 id="description-1"><a class="header" href="#description-1">Description</a></h1>
<p>The command <code>nix-shell</code> will build the dependencies of the specified
derivation, but not the derivation itself. It will then start an
interactive shell in which all environment variables defined by the
derivation <em>path</em> have been set to their corresponding values, and the
script <code>$stdenv/setup</code> has been sourced. This is useful for reproducing
the environment of a derivation for development.</p>
<p>If <em>path</em> is not given, <code>nix-shell</code> defaults to <code>shell.nix</code> if it
exists, and <code>default.nix</code> otherwise.</p>
<p>If <em>path</em> starts with <code>http://</code> or <code>https://</code>, it is interpreted as the
URL of a tarball that will be downloaded and unpacked to a temporary
location. The tarball must include a single top-level directory
containing at least a file named <code>default.nix</code>.</p>
<p>If the derivation defines the variable <code>shellHook</code>, it will be run
after <code>$stdenv/setup</code> has been sourced. Since this hook is not executed
by regular Nix builds, it allows you to perform initialisation specific
to <code>nix-shell</code>. For example, the derivation attribute</p>
<pre><code class="language-nix">shellHook =
  ''
    echo "Hello shell"
    export SOME_API_TOKEN="$(cat ~/.config/some-app/api-token)"
  '';
</code></pre>
<p>will cause <code>nix-shell</code> to print <code>Hello shell</code> and set the <code>SOME_API_TOKEN</code>
environment variable to a user-configured value.</p>
<h1 id="options-1"><a class="header" href="#options-1">Options</a></h1>
<p>All options not listed here are passed to <code>nix-store --realise</code>, except for <code>--arg</code> and <code>--attr</code> / <code>-A</code> which are passed to
<code>nix-instantiate</code>.</p>
<ul>
<li>
<p><code>--command</code> <em>cmd</em></p>
<p>In the environment of the derivation, run the shell command <em>cmd</em>.
This command is executed in an interactive shell. (Use <code>--run</code> to
use a non-interactive shell instead.) However, a call to <code>exit</code> is
implicitly added to the command, so the shell will exit after
running the command. To prevent this, add <code>return</code> at the end;
e.g.  <code>--command "echo Hello; return"</code> will print <code>Hello</code> and then
drop you into the interactive shell. This can be useful for doing
any additional initialisation.</p>
</li>
<li>
<p><code>--run</code> <em>cmd</em></p>
<p>Like <code>--command</code>, but executes the command in a non-interactive
shell. This means (among other things) that if you hit Ctrl-C while
the command is running, the shell exits.</p>
</li>
<li>
<p><code>--exclude</code> <em>regexp</em></p>
<p>Do not build any dependencies whose store path matches the regular
expression <em>regexp</em>. This option may be specified multiple times.</p>
</li>
<li>
<p><code>--pure</code></p>
<p>If this flag is specified, the environment is almost entirely
cleared before the interactive shell is started, so you get an
environment that more closely corresponds to the “real” Nix build. A
few variables, in particular <code>HOME</code>, <code>USER</code> and <code>DISPLAY</code>, are
retained.  Note that the shell used to run commands is obtained from
<a href="command-ref/nix-shell.html#env-NIX_BUILD_SHELL"><code>NIX_BUILD_SHELL</code></a> / <code>&lt;nixpkgs&gt;</code> from
<code>NIX_PATH</code>, and therefore not affected by <code>--pure</code>.</p>
</li>
<li>
<p><code>--packages</code> / <code>-p</code> <em>packages</em>…</p>
<p>Set up an environment in which the specified packages are present.
The command line arguments are interpreted as attribute names inside
the Nix Packages collection. Thus, <code>nix-shell --packages libjpeg openjdk</code>
will start a shell in which the packages denoted by the attribute
names <code>libjpeg</code> and <code>openjdk</code> are present.</p>
</li>
<li>
<p><code>-i</code> <em>interpreter</em></p>
<p>The chained script interpreter to be invoked by <code>nix-shell</code>. Only
applicable in <code>#!</code>-scripts (described below).</p>
</li>
<li>
<p><code>--keep</code> <em>name</em></p>
<p>When a <code>--pure</code> shell is started, keep the listed environment
variables.</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-2"><a class="header" href="#common-options-2">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-shell.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-shell.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-shell.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-shell.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-shell.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-shell.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-shell.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-shell.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-shell.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-shell.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-shell.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-shell.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-shell.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-shell.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-shell.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-shell.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-shell.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-shell.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-shell.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-shell.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-shell.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-shell.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-shell.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-shell.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-shell.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="environment-variables-1"><a class="header" href="#environment-variables-1">Environment variables</a></h1>
<ul>
<li>
<p><span id="env-NIX_BUILD_SHELL"><a href="command-ref/nix-shell.html#env-NIX_BUILD_SHELL"><code>NIX_BUILD_SHELL</code></a></span></p>
<p>Shell used to start the interactive environment.
Defaults to the <code>bash</code> from <code>bashInteractive</code> found in <code>&lt;nixpkgs&gt;</code>, falling back to the <code>bash</code> found in <code>PATH</code> if not found.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>The shell obtained using this method may not necessarily be the same as any shells requested in <em>path</em>.</p>
</blockquote>
<!-- -->
<blockquote>
<p>**Example</p>
<p>Despite <code>--pure</code>, this invocation will not result in a fully reproducible shell environment:</p>
<pre><code class="language-nix">#!/usr/bin/env -S nix-shell --pure
let
  pkgs = import (fetchTarball "https://github.com/NixOS/nixpkgs/archive/854fdc68881791812eddd33b2fed94b954979a8e.tar.gz") {};
in
pkgs.mkShell {
  buildInputs = pkgs.bashInteractive;
}
</code></pre>
</blockquote>
</li>
</ul>
<h1 id="common-environment-variables-2"><a class="header" href="#common-environment-variables-2">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-shell.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-shell.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-shell.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-shell.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-shell.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-shell.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-shell.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-shell.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-shell.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-shell.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-shell.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-shell.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-shell.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-shell.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-shell.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-shell.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-2"><a class="header" href="#xdg-base-directories-2">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-shell.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-shell.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-shell.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-shell.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-shell.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-shell.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-3"><a class="header" href="#examples-3">Examples</a></h1>
<p>To build the dependencies of the package Pan, and start an interactive
shell in which to build it:</p>
<pre><code class="language-console">$ nix-shell '&lt;nixpkgs&gt;' --attr pan
[nix-shell]$ eval ${unpackPhase:-unpackPhase}
[nix-shell]$ cd $sourceRoot
[nix-shell]$ eval ${patchPhase:-patchPhase}
[nix-shell]$ eval ${configurePhase:-configurePhase}
[nix-shell]$ eval ${buildPhase:-buildPhase}
[nix-shell]$ ./pan/gui/pan
</code></pre>
<p>The reason we use form <code>eval ${configurePhase:-configurePhase}</code> here is because
those packages that override these phases do so by exporting the overridden
values in the environment variable of the same name.
Here bash is being told to either evaluate the contents of 'configurePhase',
if it exists as a variable, otherwise evaluate the configurePhase function.</p>
<p>To clear the environment first, and do some additional automatic
initialisation of the interactive shell:</p>
<pre><code class="language-console">$ nix-shell '&lt;nixpkgs&gt;' --attr pan --pure \
    --command 'export NIX_DEBUG=1; export NIX_CORES=8; return'
</code></pre>
<p>Nix expressions can also be given on the command line using the <code>-E</code> and
<code>-p</code> flags. For instance, the following starts a shell containing the
packages <code>sqlite</code> and <code>libX11</code>:</p>
<pre><code class="language-console">$ nix-shell --expr 'with import &lt;nixpkgs&gt; { }; runCommand "dummy" { buildInputs = [ sqlite xorg.libX11 ]; } ""'
</code></pre>
<p>A shorter way to do the same is:</p>
<pre><code class="language-console">$ nix-shell --packages sqlite xorg.libX11
[nix-shell]$ echo $NIX_LDFLAGS
… -L/nix/store/j1zg5v…-sqlite-3.8.0.2/lib -L/nix/store/0gmcz9…-libX11-1.6.1/lib …
</code></pre>
<p>Note that <code>-p</code> accepts multiple full nix expressions that are valid in
the <code>buildInputs = [ ... ]</code> shown above, not only package names. So the
following is also legal:</p>
<pre><code class="language-console">$ nix-shell --packages sqlite 'git.override { withManual = false; }'
</code></pre>
<p>The <code>-p</code> flag looks up Nixpkgs in the Nix search path. You can override
it by passing <code>-I</code> or setting <code>NIX_PATH</code>. For example, the following
gives you a shell containing the Pan package from a specific revision of
Nixpkgs:</p>
<pre><code class="language-console">$ nix-shell --packages pan -I nixpkgs=https://github.com/NixOS/nixpkgs/archive/8a3eea054838b55aca962c3fbde9c83c102b8bf2.tar.gz

[nix-shell:~]$ pan --version
Pan 0.139
</code></pre>
<h1 id="use-as-a--interpreter"><a class="header" href="#use-as-a--interpreter">Use as a <code>#!</code>-interpreter</a></h1>
<p>You can use <code>nix-shell</code> as a script interpreter to allow scripts written
in arbitrary languages to obtain their own dependencies via Nix. This is
done by starting the script with the following lines:</p>
<pre><code class="language-bash">#! /usr/bin/env nix-shell
#! nix-shell -i real-interpreter --packages packages
</code></pre>
<p>where <em>real-interpreter</em> is the “real” script interpreter that will be
invoked by <code>nix-shell</code> after it has obtained the dependencies and
initialised the environment, and <em>packages</em> are the attribute names of
the dependencies in Nixpkgs.</p>
<p>The lines starting with <code>#! nix-shell</code> specify <code>nix-shell</code> options (see
above). Note that you cannot write <code>#! /usr/bin/env nix-shell -i ...</code>
because many operating systems only allow one argument in <code>#!</code> lines.</p>
<p>For example, here is a Python script that depends on Python and the
<code>prettytable</code> package:</p>
<pre><code class="language-python">#! /usr/bin/env nix-shell
#! nix-shell -i python3 --packages python3 python3Packages.prettytable

import prettytable

# Print a simple table.
t = prettytable.PrettyTable(["N", "N^2"])
for n in range(1, 10): t.add_row([n, n * n])
print(t)
</code></pre>
<p>Similarly, the following is a Perl script that specifies that it
requires Perl and the <code>HTML::TokeParser::Simple</code> and <code>LWP</code> packages:</p>
<pre><code class="language-perl">#! /usr/bin/env nix-shell
#! nix-shell -i perl --packages perl perlPackages.HTMLTokeParserSimple perlPackages.LWP

use HTML::TokeParser::Simple;

# Fetch nixos.org and print all hrefs.
my $p = HTML::TokeParser::Simple-&gt;new(url =&gt; 'http://nixos.org/');

while (my $token = $p-&gt;get_tag("a")) {
    my $href = $token-&gt;get_attr("href");
    print "$href\n" if $href;
}
</code></pre>
<p>Sometimes you need to pass a simple Nix expression to customize a
package like Terraform:</p>
<pre><code class="language-bash">#! /usr/bin/env nix-shell
#! nix-shell -i bash --packages 'terraform.withPlugins (plugins: [ plugins.openstack ])'

terraform apply
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>You must use single or double quotes (<code>'</code>, <code>"</code>) when passing a simple Nix expression
in a nix-shell shebang.</p>
</blockquote>
<p>Finally, using the merging of multiple nix-shell shebangs the following
Haskell script uses a specific branch of Nixpkgs/NixOS (the 20.03 stable
branch):</p>
<pre><code class="language-haskell">#! /usr/bin/env nix-shell
#! nix-shell -i runghc --packages 'haskellPackages.ghcWithPackages (ps: [ps.download-curl ps.tagsoup])'
#! nix-shell -I nixpkgs=https://github.com/NixOS/nixpkgs/archive/nixos-20.03.tar.gz

import Network.Curl.Download
import Text.HTML.TagSoup
import Data.Either
import Data.ByteString.Char8 (unpack)

-- Fetch nixos.org and print all hrefs.
main = do
  resp &lt;- openURI "https://nixos.org/"
  let tags = filter (isTagOpenName "a") $ parseTags $ unpack $ fromRight undefined resp
  let tags' = map (fromAttrib "href") tags
  mapM_ putStrLn $ filter (/= "") tags'
</code></pre>
<p>If you want to be even more precise, you can specify a specific revision
of Nixpkgs:</p>
<pre><code>#! nix-shell -I nixpkgs=https://github.com/NixOS/nixpkgs/archive/0672315759b3e15e2121365f067c1c8c56bb4722.tar.gz
</code></pre>
<p>The examples above all used <code>-p</code> to get dependencies from Nixpkgs. You
can also use a Nix expression to build your own dependencies. For
example, the Python example could have been written as:</p>
<pre><code class="language-python">#! /usr/bin/env nix-shell
#! nix-shell deps.nix -i python
</code></pre>
<p>where the file <code>deps.nix</code> in the same directory as the <code>#!</code>-script
contains:</p>
<pre><code class="language-nix">with import &lt;nixpkgs&gt; {};

runCommand "dummy" { buildInputs = [ python pythonPackages.prettytable ]; } ""
</code></pre>
<p>The script's file name is passed as the first argument to the interpreter specified by the <code>-i</code> flag.</p>
<p>Aside from the very first line, which is a directive to the operating system, the additional <code>#! nix-shell</code> lines do not need to be at the beginning of the file.
This allows wrapping them in block comments for languages where <code>#</code> does not start a comment, such as ECMAScript, Erlang, PHP, or Ruby.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-2"><a class="header" href="#name-2">Name</a></h1>
<p><code>nix-store</code> - manipulate or query the Nix store</p>
<h1 id="synopsis-2"><a class="header" href="#synopsis-2">Synopsis</a></h1>
<p><code>nix-store</code> <em>operation</em> [<em>options…</em>] [<em>arguments…</em>]
[<code>--option</code> <em>name</em> <em>value</em>]
[<code>--add-root</code> <em>path</em>]</p>
<h1 id="description-2"><a class="header" href="#description-2">Description</a></h1>
<p>The command <code>nix-store</code> performs primitive operations on the Nix store.
You generally do not need to run this command manually.</p>
<p><code>nix-store</code> takes exactly one <em>operation</em> flag which indicates the subcommand to be performed. The following operations are available:</p>
<ul>
<li><a href="command-ref/./nix-store/realise.html"><code>--realise</code></a></li>
<li><a href="command-ref/./nix-store/serve.html"><code>--serve</code></a></li>
<li><a href="command-ref/./nix-store/gc.html"><code>--gc</code></a></li>
<li><a href="command-ref/./nix-store/delete.html"><code>--delete</code></a></li>
<li><a href="command-ref/./nix-store/query.html"><code>--query</code></a></li>
<li><a href="command-ref/./nix-store/add.html"><code>--add</code></a></li>
<li><a href="command-ref/./nix-store/add-fixed.html"><code>--add-fixed</code></a></li>
<li><a href="command-ref/./nix-store/verify.html"><code>--verify</code></a></li>
<li><a href="command-ref/./nix-store/verify-path.html"><code>--verify-path</code></a></li>
<li><a href="command-ref/./nix-store/repair-path.html"><code>--repair-path</code></a></li>
<li><a href="command-ref/./nix-store/dump.html"><code>--dump</code></a></li>
<li><a href="command-ref/./nix-store/restore.html"><code>--restore</code></a></li>
<li><a href="command-ref/./nix-store/export.html"><code>--export</code></a></li>
<li><a href="command-ref/./nix-store/import.html"><code>--import</code></a></li>
<li><a href="command-ref/./nix-store/optimise.html"><code>--optimise</code></a></li>
<li><a href="command-ref/./nix-store/read-log.html"><code>--read-log</code></a></li>
<li><a href="command-ref/./nix-store/dump-db.html"><code>--dump-db</code></a></li>
<li><a href="command-ref/./nix-store/load-db.html"><code>--load-db</code></a></li>
<li><a href="command-ref/./nix-store/print-env.html"><code>--print-env</code></a></li>
<li><a href="command-ref/./nix-store/generate-binary-cache-key.html"><code>--generate-binary-cache-key</code></a></li>
</ul>
<p>These pages can be viewed offline:</p>
<ul>
<li>
<p><code>man nix-store-&lt;operation&gt;</code>.</p>
<p>Example: <code>man nix-store-realise</code></p>
</li>
<li>
<p><code>nix-store --help --&lt;operation&gt;</code></p>
<p>Example: <code>nix-store --help --realise</code></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-3"><a class="header" href="#name-3">Name</a></h1>
<p><code>nix-store --add-fixed</code> - add paths to store using given hashing algorithm</p>
<h2 id="synopsis-3"><a class="header" href="#synopsis-3">Synopsis</a></h2>
<p><code>nix-store</code> <code>--add-fixed</code> [<code>--recursive</code>] <em>algorithm</em> <em>paths…</em></p>
<h2 id="description-3"><a class="header" href="#description-3">Description</a></h2>
<p>The operation <code>--add-fixed</code> adds the specified paths to the Nix store.
Unlike <code>--add</code> paths are registered using the specified hashing
algorithm, resulting in the same output path as a fixed-output
derivation. This can be used for sources that are not available from a
public url or broke since the download expression was written.</p>
<p>This operation has the following options:</p>
<ul>
<li>
<p><code>--recursive</code></p>
<p>Use recursive instead of flat hashing mode, used when adding
directories to the store.</p>
<p><em>paths</em> that refer to symlinks are not dereferenced, but added to the store
as symlinks with the same target.</p>
</li>
</ul>
<h1 id="options-2"><a class="header" href="#options-2">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/add-fixed.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-3"><a class="header" href="#common-options-3">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/add-fixed.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/add-fixed.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/add-fixed.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/add-fixed.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/add-fixed.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/add-fixed.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/add-fixed.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/add-fixed.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/add-fixed.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/add-fixed.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/add-fixed.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/add-fixed.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/add-fixed.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/add-fixed.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/add-fixed.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/add-fixed.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/add-fixed.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/add-fixed.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/add-fixed.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/add-fixed.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/add-fixed.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/add-fixed.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/add-fixed.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/add-fixed.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/add-fixed.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-3"><a class="header" href="#common-environment-variables-3">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/add-fixed.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/add-fixed.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/add-fixed.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/add-fixed.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/add-fixed.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/add-fixed.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/add-fixed.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/add-fixed.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/add-fixed.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/add-fixed.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/add-fixed.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/add-fixed.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/add-fixed.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/add-fixed.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/add-fixed.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/add-fixed.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-3"><a class="header" href="#xdg-base-directories-3">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/add-fixed.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/add-fixed.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/add-fixed.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/add-fixed.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/add-fixed.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/add-fixed.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h2 id="example-1"><a class="header" href="#example-1">Example</a></h2>
<pre><code class="language-console">$ nix-store --add-fixed sha256 ./hello-2.10.tar.gz
/nix/store/3x7dwzq014bblazs7kq20p9hyzz0qh8g-hello-2.10.tar.gz
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-4"><a class="header" href="#name-4">Name</a></h1>
<p><code>nix-store --add</code> - add paths to Nix store</p>
<h1 id="synopsis-4"><a class="header" href="#synopsis-4">Synopsis</a></h1>
<p><code>nix-store</code> <code>--add</code> <em>paths…</em></p>
<h1 id="description-4"><a class="header" href="#description-4">Description</a></h1>
<p>The operation <code>--add</code> adds the specified paths to the Nix store. It
prints the resulting paths in the Nix store on standard output.</p>
<p><em>paths</em> that refer to symlinks are not dereferenced, but added to the store
as symlinks with the same target.</p>
<h1 id="options-3"><a class="header" href="#options-3">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/add.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-4"><a class="header" href="#common-options-4">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/add.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/add.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/add.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/add.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/add.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/add.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/add.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/add.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/add.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/add.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/add.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/add.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/add.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/add.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/add.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/add.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/add.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/add.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/add.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/add.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/add.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/add.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/add.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/add.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/add.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-4"><a class="header" href="#common-environment-variables-4">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/add.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/add.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/add.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/add.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/add.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/add.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/add.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/add.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/add.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/add.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/add.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/add.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/add.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/add.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/add.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/add.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-4"><a class="header" href="#xdg-base-directories-4">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/add.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/add.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/add.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/add.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/add.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/add.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="example-2"><a class="header" href="#example-2">Example</a></h1>
<pre><code class="language-console">$ nix-store --add ./foo.c
/nix/store/m7lrha58ph6rcnv109yzx1nk1cj7k7zf-foo.c
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-5"><a class="header" href="#name-5">Name</a></h1>
<p><code>nix-store --delete</code> - delete store paths</p>
<h1 id="synopsis-5"><a class="header" href="#synopsis-5">Synopsis</a></h1>
<p><code>nix-store</code> <code>--delete</code> [<code>--ignore-liveness</code>] <em>paths…</em></p>
<h1 id="description-5"><a class="header" href="#description-5">Description</a></h1>
<p>The operation <code>--delete</code> deletes the store paths <em>paths</em> from the Nix
store, but only if it is safe to do so; that is, when the path is not
reachable from a root of the garbage collector. This means that you can
only delete paths that would also be deleted by <code>nix-store --gc</code>. Thus,
<code>--delete</code> is a more targeted version of <code>--gc</code>.</p>
<p>With the option <code>--ignore-liveness</code>, reachability from the roots is
ignored. However, the path still won’t be deleted if there are other
paths in the store that refer to it (i.e., depend on it).</p>
<h1 id="options-4"><a class="header" href="#options-4">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/delete.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-5"><a class="header" href="#common-options-5">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/delete.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/delete.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/delete.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/delete.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/delete.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/delete.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/delete.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/delete.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/delete.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/delete.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/delete.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/delete.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/delete.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/delete.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/delete.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/delete.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/delete.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/delete.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/delete.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/delete.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/delete.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/delete.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/delete.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/delete.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/delete.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-5"><a class="header" href="#common-environment-variables-5">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/delete.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/delete.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/delete.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/delete.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/delete.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/delete.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/delete.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/delete.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/delete.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/delete.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/delete.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/delete.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/delete.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/delete.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/delete.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/delete.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-5"><a class="header" href="#xdg-base-directories-5">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/delete.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/delete.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/delete.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/delete.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/delete.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/delete.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="example-3"><a class="header" href="#example-3">Example</a></h1>
<pre><code class="language-console">$ nix-store --delete /nix/store/zq0h41l75vlb4z45kzgjjmsjxvcv1qk7-mesa-6.4
0 bytes freed (0.00 MiB)
error: cannot delete path `/nix/store/zq0h41l75vlb4z45kzgjjmsjxvcv1qk7-mesa-6.4' since it is still alive
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-6"><a class="header" href="#name-6">Name</a></h1>
<p><code>nix-store --dump-db</code> - export Nix database</p>
<h1 id="synopsis-6"><a class="header" href="#synopsis-6">Synopsis</a></h1>
<p><code>nix-store</code> <code>--dump-db</code> [<em>paths…</em>]</p>
<h1 id="description-6"><a class="header" href="#description-6">Description</a></h1>
<p>The operation <code>--dump-db</code> writes a dump of the Nix database to standard
output. It can be loaded into an empty Nix store using <code>--load-db</code>. This
is useful for making backups and when migrating to different database
schemas.</p>
<p>By default, <code>--dump-db</code> will dump the entire Nix database. When one or
more store paths is passed, only the subset of the Nix database for
those store paths is dumped. As with <code>--export</code>, the user is responsible
for passing all the store paths for a closure. See <code>--export</code> for an
example.</p>
<h1 id="options-5"><a class="header" href="#options-5">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/dump-db.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-6"><a class="header" href="#common-options-6">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/dump-db.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/dump-db.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/dump-db.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/dump-db.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/dump-db.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/dump-db.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/dump-db.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/dump-db.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/dump-db.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/dump-db.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/dump-db.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/dump-db.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/dump-db.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/dump-db.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/dump-db.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/dump-db.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/dump-db.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/dump-db.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/dump-db.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/dump-db.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/dump-db.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/dump-db.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/dump-db.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/dump-db.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/dump-db.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-6"><a class="header" href="#common-environment-variables-6">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/dump-db.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/dump-db.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/dump-db.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/dump-db.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/dump-db.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/dump-db.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/dump-db.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/dump-db.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/dump-db.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/dump-db.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/dump-db.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/dump-db.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/dump-db.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/dump-db.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/dump-db.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/dump-db.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-6"><a class="header" href="#xdg-base-directories-6">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/dump-db.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/dump-db.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/dump-db.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/dump-db.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/dump-db.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/dump-db.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-7"><a class="header" href="#name-7">Name</a></h1>
<p><code>nix-store --dump</code> - write a single path to a <a href="command-ref/nix-store/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive</a></p>
<h2 id="synopsis-7"><a class="header" href="#synopsis-7">Synopsis</a></h2>
<p><code>nix-store</code> <code>--dump</code> <em>path</em></p>
<h2 id="description-7"><a class="header" href="#description-7">Description</a></h2>
<p>The operation <code>--dump</code> produces a <a href="command-ref/nix-store/../../glossary.html#gloss-nar">Nix archive</a> (NAR) file containing the
contents of the file system tree rooted at <em>path</em>. The archive is
written to standard output.</p>
<p>A NAR archive is like a TAR or Zip archive, but it contains only the
information that Nix considers important. For instance, timestamps are
elided because all files in the Nix store have their timestamp set to 0
anyway. Likewise, all permissions are left out except for the execute
bit, because all files in the Nix store have 444 or 555 permission.</p>
<p>Also, a NAR archive is <em>canonical</em>, meaning that “equal” paths always
produce the same NAR archive. For instance, directory entries are
always sorted so that the actual on-disk order doesn’t influence the
result.  This means that the cryptographic hash of a NAR dump of a
path is usable as a fingerprint of the contents of the path. Indeed,
the hashes of store paths stored in Nix’s database (see <code>nix-store --query --hash</code>) are SHA-256 hashes of the NAR dump of each store path.</p>
<p>NAR archives support filenames of unlimited length and 64-bit file
sizes. They can contain regular files, directories, and symbolic links,
but not other types of files (such as device nodes).</p>
<p>A Nix archive can be unpacked using <a href="command-ref/nix-store/../../command-ref/nix-store/restore.html"><code>nix-store --restore</code></a>.</p>
<h1 id="options-6"><a class="header" href="#options-6">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/dump.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-7"><a class="header" href="#common-options-7">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/dump.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/dump.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/dump.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/dump.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/dump.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/dump.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/dump.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/dump.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/dump.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/dump.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/dump.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/dump.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/dump.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/dump.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/dump.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/dump.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/dump.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/dump.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/dump.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/dump.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/dump.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/dump.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/dump.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/dump.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/dump.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-7"><a class="header" href="#common-environment-variables-7">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/dump.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/dump.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/dump.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/dump.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/dump.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/dump.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/dump.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/dump.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/dump.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/dump.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/dump.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/dump.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/dump.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/dump.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/dump.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/dump.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-7"><a class="header" href="#xdg-base-directories-7">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/dump.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/dump.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/dump.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/dump.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/dump.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/dump.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-8"><a class="header" href="#name-8">Name</a></h1>
<p><code>nix-store --export</code> - export store paths to a <a href="command-ref/nix-store/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive</a></p>
<h2 id="synopsis-8"><a class="header" href="#synopsis-8">Synopsis</a></h2>
<p><code>nix-store</code> <code>--export</code> <em>paths…</em></p>
<h2 id="description-8"><a class="header" href="#description-8">Description</a></h2>
<p>The operation <code>--export</code> writes a serialisation of the given <a href="command-ref/nix-store/../../glossary.html#gloss-store-object">store objects</a> to standard output in a format that can be imported into another <a href="command-ref/nix-store/../../store/index.html">Nix store</a> with <a href="command-ref/nix-store/./import.html"><code>nix-store --import</code></a>.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This command <em>does not</em> produce a <a href="command-ref/nix-store/../../glossary.html#gloss-closure">closure</a> of the specified store paths.
Trying to import a store object that refers to store paths not available in the target Nix store will fail.</p>
<p>Use <a href="command-ref/nix-store/../../command-ref/nix-store/query.html"><code>nix-store --query</code></a> to obtain the closure of a store path.</p>
</blockquote>
<p>This command is different from <a href="command-ref/nix-store/./dump.html"><code>nix-store --dump</code></a>, which produces a <a href="command-ref/nix-store/../../glossary.html#gloss-nar">Nix archive</a> that <em>does not</em> contain the set of <a href="command-ref/nix-store/../../glossary.html#gloss-reference">references</a> of a given store path.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>For efficient transfer of closures to remote machines over SSH, use <a href="command-ref/nix-store/../../command-ref/nix-copy-closure.html"><code>nix-copy-closure</code></a>.</p>
</blockquote>
<h1 id="options-7"><a class="header" href="#options-7">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/export.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-8"><a class="header" href="#common-options-8">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/export.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/export.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/export.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/export.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/export.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/export.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/export.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/export.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/export.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/export.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/export.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/export.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/export.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/export.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/export.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/export.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/export.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/export.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/export.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/export.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/export.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/export.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/export.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/export.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/export.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-8"><a class="header" href="#common-environment-variables-8">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/export.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/export.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/export.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/export.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/export.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/export.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/export.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/export.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/export.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/export.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/export.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/export.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/export.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/export.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/export.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/export.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-8"><a class="header" href="#xdg-base-directories-8">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/export.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/export.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/export.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/export.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/export.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/export.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-4"><a class="header" href="#examples-4">Examples</a></h1>
<blockquote>
<p><strong>Example</strong></p>
<p>Deploy GNU Hello to an airgapped machine via USB stick.</p>
<p>Write the closure to the block device on a machine with internet connection:</p>
<pre><code class="language-shell-session">[alice@itchy]$ storePath=$(nix-build '&lt;nixpkgs&gt;' -I nixpkgs=channel:nixpkgs-unstable -A hello --no-out-link)
[alice@itchy]$ nix-store --export $(nix-store --query --requisites $storePath) | sudo dd of=/dev/usb
</code></pre>
<p>Read the closure from the block device on the machine without internet connection:</p>
<pre><code class="language-shell-session">[bob@scratchy]$ hello=$(sudo dd if=/dev/usb | nix-store --import | tail -1)
[bob@scratchy]$ $hello/bin/hello
Hello, world!
</code></pre>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-9"><a class="header" href="#name-9">Name</a></h1>
<p><code>nix-store --gc</code> - run garbage collection</p>
<h1 id="synopsis-9"><a class="header" href="#synopsis-9">Synopsis</a></h1>
<p><code>nix-store</code> <code>--gc</code> [<code>--print-roots</code> | <code>--print-live</code> | <code>--print-dead</code>] [<code>--max-freed</code> <em>bytes</em>]</p>
<h1 id="description-9"><a class="header" href="#description-9">Description</a></h1>
<p>Without additional flags, the operation <code>--gc</code> performs a garbage
collection on the Nix store. That is, all paths in the Nix store not
reachable via file system references from a set of “roots”, are deleted.</p>
<p>The following suboperations may be specified:</p>
<ul>
<li>
<p><code>--print-roots</code></p>
<p>This operation prints on standard output the set of roots used by
the garbage collector.</p>
</li>
<li>
<p><code>--print-live</code></p>
<p>This operation prints on standard output the set of “live” store
paths, which are all the store paths reachable from the roots. Live
paths should never be deleted, since that would break consistency —
it would become possible that applications are installed that
reference things that are no longer present in the store.</p>
</li>
<li>
<p><code>--print-dead</code></p>
<p>This operation prints out on standard output the set of “dead” store
paths, which is just the opposite of the set of live paths: any path
in the store that is not live (with respect to the roots) is dead.</p>
</li>
</ul>
<p>By default, all unreachable paths are deleted. The following options
control what gets deleted and in what order:</p>
<ul>
<li>
<p><code>--max-freed</code> <em>bytes</em></p>
<p>Keep deleting paths until at least <em>bytes</em> bytes have been deleted,
then stop. The argument <em>bytes</em> can be followed by the
multiplicative suffix <code>K</code>, <code>M</code>, <code>G</code> or <code>T</code>, denoting KiB, MiB, GiB
or TiB units.</p>
</li>
</ul>
<p>The behaviour of the collector is also influenced by the
<code>keep-outputs</code> and <code>keep-derivations</code> settings in the Nix
configuration file.</p>
<p>By default, the collector prints the total number of freed bytes when it
finishes (or when it is interrupted). With <code>--print-dead</code>, it prints the
number of bytes that would be freed.</p>
<h1 id="options-8"><a class="header" href="#options-8">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/gc.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-9"><a class="header" href="#common-options-9">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/gc.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/gc.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/gc.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/gc.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/gc.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/gc.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/gc.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/gc.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/gc.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/gc.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/gc.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/gc.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/gc.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/gc.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/gc.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/gc.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/gc.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/gc.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/gc.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/gc.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/gc.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/gc.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/gc.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/gc.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/gc.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-9"><a class="header" href="#common-environment-variables-9">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/gc.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/gc.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/gc.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/gc.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/gc.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/gc.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/gc.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/gc.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/gc.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/gc.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/gc.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/gc.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/gc.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/gc.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/gc.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/gc.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-9"><a class="header" href="#xdg-base-directories-9">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/gc.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/gc.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/gc.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/gc.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/gc.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/gc.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-5"><a class="header" href="#examples-5">Examples</a></h1>
<p>To delete all unreachable paths, just do:</p>
<pre><code class="language-console">$ nix-store --gc
deleting `/nix/store/kq82idx6g0nyzsp2s14gfsc38npai7lf-cairo-1.0.4.tar.gz.drv'
...
8825586 bytes freed (8.42 MiB)
</code></pre>
<p>To delete at least 100 MiBs of unreachable paths:</p>
<pre><code class="language-console">$ nix-store --gc --max-freed $((100 * 1024 * 1024))
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-10"><a class="header" href="#name-10">Name</a></h1>
<p><code>nix-store --generate-binary-cache-key</code> - generate key pair to use for a binary cache</p>
<h2 id="synopsis-10"><a class="header" href="#synopsis-10">Synopsis</a></h2>
<p><code>nix-store</code> <code>--generate-binary-cache-key</code> <em>key-name</em> <em>secret-key-file</em> <em>public-key-file</em></p>
<h2 id="description-10"><a class="header" href="#description-10">Description</a></h2>
<p>This command generates an <a href="http://ed25519.cr.yp.to/">Ed25519 key pair</a>
that can be used to create a signed binary cache. It takes three
mandatory parameters:</p>
<ol>
<li>
<p>A key name, such as <code>cache.example.org-1</code>, that is used to look up
keys on the client when it verifies signatures. It can be anything,
but it’s suggested to use the host name of your cache (e.g.
<code>cache.example.org</code>) with a suffix denoting the number of the key
(to be incremented every time you need to revoke a key).</p>
</li>
<li>
<p>The file name where the secret key is to be stored.</p>
</li>
<li>
<p>The file name where the public key is to be stored.</p>
</li>
</ol>
<h1 id="options-9"><a class="header" href="#options-9">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-10"><a class="header" href="#common-options-10">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/generate-binary-cache-key.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-10"><a class="header" href="#common-environment-variables-10">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/generate-binary-cache-key.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/generate-binary-cache-key.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/generate-binary-cache-key.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/generate-binary-cache-key.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/generate-binary-cache-key.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/generate-binary-cache-key.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/generate-binary-cache-key.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/generate-binary-cache-key.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/generate-binary-cache-key.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/generate-binary-cache-key.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/generate-binary-cache-key.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/generate-binary-cache-key.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/generate-binary-cache-key.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/generate-binary-cache-key.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/generate-binary-cache-key.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/generate-binary-cache-key.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-10"><a class="header" href="#xdg-base-directories-10">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/generate-binary-cache-key.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/generate-binary-cache-key.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/generate-binary-cache-key.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/generate-binary-cache-key.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/generate-binary-cache-key.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/generate-binary-cache-key.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-11"><a class="header" href="#name-11">Name</a></h1>
<p><code>nix-store --import</code> - import <a href="command-ref/nix-store/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive</a> into the store</p>
<h1 id="synopsis-11"><a class="header" href="#synopsis-11">Synopsis</a></h1>
<p><code>nix-store</code> <code>--import</code></p>
<h1 id="description-11"><a class="header" href="#description-11">Description</a></h1>
<p>The operation <code>--import</code> reads a serialisation of a set of <a href="command-ref/nix-store/../../glossary.html#gloss-store-object">store objects</a> produced by <a href="command-ref/nix-store/./export.html"><code>nix-store --export</code></a> from standard input, and adds those store objects to the specified <a href="command-ref/nix-store/../../store/index.html">Nix store</a>.
Paths that already exist in the target Nix store are ignored.
If a path <a href="command-ref/nix-store/../../glossary.html#gloss-reference">refers</a> to another path that doesn’t exist in the target Nix store, the import fails.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>For efficient transfer of closures to remote machines over SSH, use <a href="command-ref/nix-store/../../command-ref/nix-copy-closure.html"><code>nix-copy-closure</code></a>.</p>
</blockquote>
<h1 id="options-10"><a class="header" href="#options-10">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/import.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-11"><a class="header" href="#common-options-11">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/import.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/import.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/import.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/import.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/import.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/import.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/import.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/import.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/import.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/import.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/import.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/import.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/import.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/import.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/import.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/import.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/import.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/import.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/import.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/import.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/import.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/import.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/import.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/import.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/import.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-11"><a class="header" href="#common-environment-variables-11">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/import.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/import.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/import.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/import.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/import.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/import.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/import.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/import.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/import.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/import.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/import.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/import.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/import.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/import.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/import.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/import.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-11"><a class="header" href="#xdg-base-directories-11">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/import.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/import.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/import.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/import.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/import.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/import.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-6"><a class="header" href="#examples-6">Examples</a></h1>
<blockquote>
<p><strong>Example</strong></p>
<p>Given a closure of GNU Hello as a file:</p>
<pre><code class="language-shell-session">$ storePath="$(nix-build '&lt;nixpkgs&gt;' -I nixpkgs=channel:nixpkgs-unstable -A hello --no-out-link)"
$ nix-store --export $(nix-store --query --requisites $storePath) &gt; hello.closure
</code></pre>
<p>Import the closure into a <a href="command-ref/nix-store/../../store/types/ssh-store.html">remote SSH store</a> using the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-store"><code>--store</code></a> option:</p>
<pre><code class="language-console">$ nix-store --import --store ssh://alice@itchy.example.org &lt; hello.closure
</code></pre>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-12"><a class="header" href="#name-12">Name</a></h1>
<p><code>nix-store --load-db</code> - import Nix database</p>
<h1 id="synopsis-12"><a class="header" href="#synopsis-12">Synopsis</a></h1>
<p><code>nix-store</code> <code>--load-db</code></p>
<h1 id="description-12"><a class="header" href="#description-12">Description</a></h1>
<p>The operation <code>--load-db</code> reads a dump of the Nix database created by
<code>--dump-db</code> from standard input and loads it into the Nix database.</p>
<h1 id="options-11"><a class="header" href="#options-11">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/load-db.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-12"><a class="header" href="#common-options-12">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/load-db.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/load-db.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/load-db.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/load-db.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/load-db.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/load-db.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/load-db.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/load-db.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/load-db.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/load-db.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/load-db.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/load-db.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/load-db.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/load-db.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/load-db.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/load-db.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/load-db.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/load-db.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/load-db.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/load-db.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/load-db.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/load-db.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/load-db.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/load-db.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/load-db.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-12"><a class="header" href="#common-environment-variables-12">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/load-db.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/load-db.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/load-db.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/load-db.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/load-db.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/load-db.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/load-db.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/load-db.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/load-db.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/load-db.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/load-db.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/load-db.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/load-db.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/load-db.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/load-db.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/load-db.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-12"><a class="header" href="#xdg-base-directories-12">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/load-db.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/load-db.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/load-db.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/load-db.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/load-db.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/load-db.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-13"><a class="header" href="#name-13">Name</a></h1>
<p><code>nix-store --optimise</code> - reduce disk space usage</p>
<h2 id="synopsis-13"><a class="header" href="#synopsis-13">Synopsis</a></h2>
<p><code>nix-store</code> <code>--optimise</code></p>
<h2 id="description-13"><a class="header" href="#description-13">Description</a></h2>
<p>The operation <code>--optimise</code> reduces Nix store disk space usage by finding
identical files in the store and hard-linking them to each other. It
typically reduces the size of the store by something like 25-35%. Only
regular files and symlinks are hard-linked in this manner. Files are
considered identical when they have the same <a href="command-ref/nix-store/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive (NAR)</a> serialisation:
that is, regular files must have the same contents and permission
(executable or non-executable), and symlinks must have the same
contents.</p>
<p>After completion, or when the command is interrupted, a report on the
achieved savings is printed on standard error.</p>
<p>Use <code>-vv</code> or <code>-vvv</code> to get some progress indication.</p>
<h1 id="options-12"><a class="header" href="#options-12">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/optimise.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-13"><a class="header" href="#common-options-13">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/optimise.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/optimise.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/optimise.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/optimise.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/optimise.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/optimise.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/optimise.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/optimise.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/optimise.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/optimise.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/optimise.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/optimise.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/optimise.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/optimise.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/optimise.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/optimise.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/optimise.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/optimise.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/optimise.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/optimise.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/optimise.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/optimise.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/optimise.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/optimise.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/optimise.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-13"><a class="header" href="#common-environment-variables-13">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/optimise.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/optimise.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/optimise.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/optimise.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/optimise.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/optimise.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/optimise.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/optimise.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/optimise.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/optimise.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/optimise.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/optimise.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/optimise.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/optimise.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/optimise.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/optimise.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-13"><a class="header" href="#xdg-base-directories-13">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/optimise.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/optimise.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/optimise.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/optimise.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/optimise.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/optimise.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h2 id="example-4"><a class="header" href="#example-4">Example</a></h2>
<pre><code class="language-console">$ nix-store --optimise
hashing files in `/nix/store/qhqx7l2f1kmwihc9bnxs7rc159hsxnf3-gcc-4.1.1'
...
541838819 bytes (516.74 MiB) freed by hard-linking 54143 files;
there are 114486 files with equal contents out of 215894 files in total
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-14"><a class="header" href="#name-14">Name</a></h1>
<p><code>nix-store --print-env</code> - print the build environment of a derivation</p>
<h2 id="synopsis-14"><a class="header" href="#synopsis-14">Synopsis</a></h2>
<p><code>nix-store</code> <code>--print-env</code> <em>drvpath</em></p>
<h2 id="description-14"><a class="header" href="#description-14">Description</a></h2>
<p>The operation <code>--print-env</code> prints out the environment of a derivation
in a format that can be evaluated by a shell. The command line arguments
of the builder are placed in the variable <code>_args</code>.</p>
<h1 id="options-13"><a class="header" href="#options-13">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/print-env.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-14"><a class="header" href="#common-options-14">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/print-env.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/print-env.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/print-env.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/print-env.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/print-env.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/print-env.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/print-env.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/print-env.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/print-env.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/print-env.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/print-env.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/print-env.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/print-env.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/print-env.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/print-env.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/print-env.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/print-env.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/print-env.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/print-env.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/print-env.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/print-env.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/print-env.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/print-env.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/print-env.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/print-env.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-14"><a class="header" href="#common-environment-variables-14">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/print-env.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/print-env.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/print-env.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/print-env.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/print-env.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/print-env.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/print-env.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/print-env.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/print-env.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/print-env.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/print-env.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/print-env.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/print-env.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/print-env.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/print-env.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/print-env.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-14"><a class="header" href="#xdg-base-directories-14">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/print-env.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/print-env.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/print-env.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/print-env.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/print-env.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/print-env.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h2 id="example-5"><a class="header" href="#example-5">Example</a></h2>
<pre><code class="language-console">$ nix-store --print-env $(nix-instantiate '&lt;nixpkgs&gt;' -A firefox)
…
export src; src='/nix/store/plpj7qrwcz94z2psh6fchsi7s8yihc7k-firefox-12.0.source.tar.bz2'
export stdenv; stdenv='/nix/store/7c8asx3yfrg5dg1gzhzyq2236zfgibnn-stdenv'
export system; system='x86_64-linux'
export _args; _args='-e /nix/store/9krlzvny65gdc8s7kpb6lkx8cd02c25c-default-builder.sh'
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-15"><a class="header" href="#name-15">Name</a></h1>
<p><code>nix-store --query</code> - display information about store paths</p>
<h1 id="synopsis-15"><a class="header" href="#synopsis-15">Synopsis</a></h1>
<p><code>nix-store</code> {<code>--query</code> | <code>-q</code>}
{<code>--outputs</code> | <code>--requisites</code> | <code>-R</code> | <code>--references</code> | <code>--referrers</code> |
<code>--referrers-closure</code> | <code>--deriver</code> | <code>-d</code> | <code>--valid-derivers</code> |
<code>--graph</code> | <code>--tree</code> | <code>--binding</code> <em>name</em> | <code>-b</code> <em>name</em> | <code>--hash</code> |
<code>--size</code> | <code>--roots</code>}
[<code>--use-output</code>] [<code>-u</code>] [<code>--force-realise</code>] [<code>-f</code>]
<em>paths…</em></p>
<h1 id="description-15"><a class="header" href="#description-15">Description</a></h1>
<p>The operation <code>--query</code> displays various bits of information about the
store paths . The queries are described below. At most one query can be
specified. The default query is <code>--outputs</code>.</p>
<p>The paths <em>paths</em> may also be symlinks from outside of the Nix store, to
the Nix store. In that case, the query is applied to the target of the
symlink.</p>
<h1 id="common-query-options"><a class="header" href="#common-query-options">Common query options</a></h1>
<ul>
<li>
<p><code>--use-output</code> / <code>-u</code></p>
<p>For each argument to the query that is a <a href="command-ref/nix-store/../../glossary.html#gloss-store-derivation">store derivation</a>, apply the
query to the output path of the derivation instead.</p>
</li>
<li>
<p><code>--force-realise</code> / <code>-f</code></p>
<p>Realise each argument to the query first (see <a href="command-ref/nix-store/./realise.html"><code>nix-store --realise</code></a>).</p>
</li>
</ul>
<h1 id="queries"><a class="header" href="#queries">Queries</a></h1>
<ul>
<li>
<p><code>--outputs</code></p>
<p>Prints out the <a href="command-ref/nix-store/../../glossary.html#gloss-output-path">output paths</a> of the store
derivations <em>paths</em>. These are the paths that will be produced when
the derivation is built.</p>
</li>
<li>
<p><code>--requisites</code> / <code>-R</code></p>
<p>Prints out the <a href="command-ref/nix-store/../../glossary.html#gloss-closure">closure</a> of the store path <em>paths</em>.</p>
<p>This query has one option:</p>
<ul>
<li><code>--include-outputs</code>
Also include the existing output paths of <a href="command-ref/nix-store/../../glossary.html#gloss-store-derivation">store derivation</a>s,
and their closures.</li>
</ul>
<p>This query can be used to implement various kinds of deployment. A
<em>source deployment</em> is obtained by distributing the closure of a
store derivation. A <em>binary deployment</em> is obtained by distributing
the closure of an output path. A <em>cache deployment</em> (combined
source/binary deployment, including binaries of build-time-only
dependencies) is obtained by distributing the closure of a store
derivation and specifying the option <code>--include-outputs</code>.</p>
</li>
<li>
<p><code>--references</code></p>
<p>Prints the set of <a href="command-ref/nix-store/../../glossary.html#gloss-reference">references</a> of the store paths
<em>paths</em>, that is, their immediate dependencies. (For <em>all</em>
dependencies, use <code>--requisites</code>.)</p>
</li>
<li>
<p><code>--referrers</code></p>
<p>Prints the set of <em>referrers</em> of the store paths <em>paths</em>, that is,
the store paths currently existing in the Nix store that refer to
one of <em>paths</em>. Note that contrary to the references, the set of
referrers is not constant; it can change as store paths are added or
removed.</p>
</li>
<li>
<p><code>--referrers-closure</code></p>
<p>Prints the closure of the set of store paths <em>paths</em> under the
referrers relation; that is, all store paths that directly or
indirectly refer to one of <em>paths</em>. These are all the path currently
in the Nix store that are dependent on <em>paths</em>.</p>
</li>
<li>
<p><code>--deriver</code> / <code>-d</code></p>
<p>Prints the <a href="command-ref/nix-store/../../glossary.html#gloss-deriver">deriver</a> that was used to build the store paths <em>paths</em>. If
the path has no deriver (e.g., if it is a source file), or if the
deriver is not known (e.g., in the case of a binary-only
deployment), the string <code>unknown-deriver</code> is printed.
The returned deriver is not guaranteed to exist in the local store, for
example when <em>paths</em> were substituted from a binary cache.
Use <code>--valid-derivers</code> instead to obtain valid paths only.</p>
</li>
<li>
<p><code>--valid-derivers</code></p>
<p>Prints a set of derivation files (<code>.drv</code>) which are supposed produce
said paths when realized. Might print nothing, for example for source paths
or paths substituted from a binary cache.</p>
</li>
<li>
<p><code>--graph</code></p>
<p>Prints the references graph of the store paths <em>paths</em> in the format
of the <code>dot</code> tool of AT&amp;T's <a href="http://www.graphviz.org/">Graphviz
package</a>. This can be used to visualise
dependency graphs. To obtain a build-time dependency graph, apply
this to a store derivation. To obtain a runtime dependency graph,
apply it to an output path.</p>
</li>
<li>
<p><code>--tree</code></p>
<p>Prints the references graph of the store paths <em>paths</em> as a nested
ASCII tree. References are ordered by descending closure size; this
tends to flatten the tree, making it more readable. The query only
recurses into a store path when it is first encountered; this
prevents a blowup of the tree representation of the graph.</p>
</li>
<li>
<p><code>--graphml</code></p>
<p>Prints the references graph of the store paths <em>paths</em> in the
<a href="http://graphml.graphdrawing.org/">GraphML</a> file format. This can be
used to visualise dependency graphs. To obtain a build-time
dependency graph, apply this to a <a href="command-ref/nix-store/../../glossary.html#gloss-store-derivation">store derivation</a>. To obtain a
runtime dependency graph, apply it to an output path.</p>
</li>
<li>
<p><code>--binding</code> <em>name</em> / <code>-b</code> <em>name</em></p>
<p>Prints the value of the attribute <em>name</em> (i.e., environment
variable) of the <a href="command-ref/nix-store/../../glossary.html#gloss-store-derivation">store derivation</a>s <em>paths</em>. It is an error for a
derivation to not have the specified attribute.</p>
</li>
<li>
<p><code>--hash</code></p>
<p>Prints the SHA-256 hash of the contents of the store paths <em>paths</em>
(that is, the hash of the output of <code>nix-store --dump</code> on the given
paths). Since the hash is stored in the Nix database, this is a fast
operation.</p>
</li>
<li>
<p><code>--size</code></p>
<p>Prints the size in bytes of the contents of the store paths <em>paths</em>
— to be precise, the size of the output of <code>nix-store --dump</code> on
the given paths. Note that the actual disk space required by the
store paths may be higher, especially on filesystems with large
cluster sizes.</p>
</li>
<li>
<p><code>--roots</code></p>
<p>Prints the garbage collector roots that point, directly or
indirectly, at the store paths <em>paths</em>.</p>
</li>
</ul>
<h1 id="options-14"><a class="header" href="#options-14">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/query.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-15"><a class="header" href="#common-options-15">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/query.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/query.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/query.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/query.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/query.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/query.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/query.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/query.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/query.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/query.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/query.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/query.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/query.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/query.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/query.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/query.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/query.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/query.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/query.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/query.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/query.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/query.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/query.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/query.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/query.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-15"><a class="header" href="#common-environment-variables-15">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/query.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/query.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/query.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/query.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/query.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/query.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/query.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/query.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/query.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/query.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/query.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/query.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/query.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/query.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/query.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/query.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-15"><a class="header" href="#xdg-base-directories-15">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/query.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/query.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/query.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/query.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/query.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/query.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-7"><a class="header" href="#examples-7">Examples</a></h1>
<p>Print the closure (runtime dependencies) of the <code>svn</code> program in the
current user environment:</p>
<pre><code class="language-console">$ nix-store --query --requisites $(which svn)
/nix/store/5mbglq5ldqld8sj57273aljwkfvj22mc-subversion-1.1.4
/nix/store/9lz9yc6zgmc0vlqmn2ipcpkjlmbi51vv-glibc-2.3.4
...
</code></pre>
<p>Print the build-time dependencies of <code>svn</code>:</p>
<pre><code class="language-console">$ nix-store --query --requisites $(nix-store --query --deriver $(which svn))
/nix/store/02iizgn86m42q905rddvg4ja975bk2i4-grep-2.5.1.tar.bz2.drv
/nix/store/07a2bzxmzwz5hp58nf03pahrv2ygwgs3-gcc-wrapper.sh
/nix/store/0ma7c9wsbaxahwwl04gbw3fcd806ski4-glibc-2.3.4.drv
... lots of other paths ...
</code></pre>
<p>The difference with the previous example is that we ask the closure of
the derivation (<code>-qd</code>), not the closure of the output path that contains
<code>svn</code>.</p>
<p>Show the build-time dependencies as a tree:</p>
<pre><code class="language-console">$ nix-store --query --tree $(nix-store --query --deriver $(which svn))
/nix/store/7i5082kfb6yjbqdbiwdhhza0am2xvh6c-subversion-1.1.4.drv
+---/nix/store/d8afh10z72n8l1cr5w42366abiblgn54-builder.sh
+---/nix/store/fmzxmpjx2lh849ph0l36snfj9zdibw67-bash-3.0.drv
|   +---/nix/store/570hmhmx3v57605cqg9yfvvyh0nnb8k8-bash
|   +---/nix/store/p3srsbd8dx44v2pg6nbnszab5mcwx03v-builder.sh
...
</code></pre>
<p>Show all paths that depend on the same OpenSSL library as <code>svn</code>:</p>
<pre><code class="language-console">$ nix-store --query --referrers $(nix-store --query --binding openssl $(nix-store --query --deriver $(which svn)))
/nix/store/23ny9l9wixx21632y2wi4p585qhva1q8-sylpheed-1.0.0
/nix/store/5mbglq5ldqld8sj57273aljwkfvj22mc-subversion-1.1.4
/nix/store/dpmvp969yhdqs7lm2r1a3gng7pyq6vy4-subversion-1.1.3
/nix/store/l51240xqsgg8a7yrbqdx1rfzyv6l26fx-lynx-2.8.5
</code></pre>
<p>Show all paths that directly or indirectly depend on the Glibc (C
library) used by <code>svn</code>:</p>
<pre><code class="language-console">$ nix-store --query --referrers-closure $(ldd $(which svn) | grep /libc.so | awk '{print $3}')
/nix/store/034a6h4vpz9kds5r6kzb9lhh81mscw43-libgnomeprintui-2.8.2
/nix/store/15l3yi0d45prm7a82pcrknxdh6nzmxza-gawk-3.1.4
...
</code></pre>
<p>Note that <code>ldd</code> is a command that prints out the dynamic libraries used
by an ELF executable.</p>
<p>Make a picture of the runtime dependency graph of the current user
environment:</p>
<pre><code class="language-console">$ nix-store --query --graph ~/.nix-profile | dot -Tps &gt; graph.ps
$ gv graph.ps
</code></pre>
<p>Show every garbage collector root that points to a store path that
depends on <code>svn</code>:</p>
<pre><code class="language-console">$ nix-store --query --roots $(which svn)
/nix/var/nix/profiles/default-81-link
/nix/var/nix/profiles/default-82-link
/home/eelco/.local/state/nix/profiles/profile-97-link
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-16"><a class="header" href="#name-16">Name</a></h1>
<p><code>nix-store --read-log</code> - print build log</p>
<h1 id="synopsis-16"><a class="header" href="#synopsis-16">Synopsis</a></h1>
<p><code>nix-store</code> {<code>--read-log</code> | <code>-l</code>} <em>paths…</em></p>
<h1 id="description-16"><a class="header" href="#description-16">Description</a></h1>
<p>The operation <code>--read-log</code> prints the build log of the specified store
paths on standard output. The build log is whatever the builder of a
derivation wrote to standard output and standard error. If a store path
is not a derivation, the deriver of the store path is used.</p>
<p>Build logs are kept in <code>/nix/var/log/nix/drvs</code>. However, there is no
guarantee that a build log is available for any particular store path.
For instance, if the path was downloaded as a pre-built binary through a
substitute, then the log is unavailable.</p>
<h1 id="options-15"><a class="header" href="#options-15">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/read-log.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-16"><a class="header" href="#common-options-16">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/read-log.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/read-log.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/read-log.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/read-log.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/read-log.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/read-log.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/read-log.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/read-log.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/read-log.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/read-log.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/read-log.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/read-log.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/read-log.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/read-log.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/read-log.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/read-log.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/read-log.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/read-log.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/read-log.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/read-log.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/read-log.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/read-log.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/read-log.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/read-log.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/read-log.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-16"><a class="header" href="#common-environment-variables-16">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/read-log.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/read-log.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/read-log.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/read-log.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/read-log.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/read-log.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/read-log.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/read-log.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/read-log.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/read-log.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/read-log.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/read-log.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/read-log.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/read-log.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/read-log.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/read-log.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-16"><a class="header" href="#xdg-base-directories-16">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/read-log.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/read-log.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/read-log.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/read-log.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/read-log.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/read-log.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="example-6"><a class="header" href="#example-6">Example</a></h1>
<pre><code class="language-console">$ nix-store --read-log $(which ktorrent)
building /nix/store/dhc73pvzpnzxhdgpimsd9sw39di66ph1-ktorrent-2.2.1
unpacking sources
unpacking source archive /nix/store/p8n1jpqs27mgkjw07pb5269717nzf5f8-ktorrent-2.2.1.tar.gz
ktorrent-2.2.1/
ktorrent-2.2.1/NEWS
...
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-17"><a class="header" href="#name-17">Name</a></h1>
<p><code>nix-store --realise</code> - build or fetch store objects</p>
<h1 id="synopsis-17"><a class="header" href="#synopsis-17">Synopsis</a></h1>
<p><code>nix-store</code> {<code>--realise</code> | <code>-r</code>} <em>paths…</em> [<code>--dry-run</code>]</p>
<h1 id="description-17"><a class="header" href="#description-17">Description</a></h1>
<p>Each of <em>paths</em> is processed as follows:</p>
<ul>
<li>If the path leads to a <a href="command-ref/nix-store/../../glossary.html#gloss-store-derivation">store derivation</a>:
<ol>
<li>If it is not <a href="command-ref/nix-store/../../glossary.html#gloss-validity">valid</a>, substitute the store derivation file itself.</li>
<li>Realise its <a href="command-ref/nix-store/../../glossary.html#gloss-output-path">output paths</a>:</li>
</ol>
<ul>
<li>Try to fetch from <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-substituters">substituters</a> the <a href="command-ref/nix-store/../../store/store-object.html">store objects</a> associated with the output paths in the store derivation's <a href="command-ref/nix-store/../../glossary.html#gloss-closure">closure</a>.
<ul>
<li>With <a href="command-ref/nix-store/../../development/experimental-features.html#xp-feature-ca-derivations">content-addressing derivations</a> (experimental):
Determine the output paths to realise by querying content-addressed realisation entries in the <a href="command-ref/nix-store/../../glossary.html#gloss-nix-database">Nix database</a>.</li>
</ul>
</li>
<li>For any store paths that cannot be substituted, produce the required store objects:
<ol>
<li>Realise all outputs of the derivation's dependencies</li>
<li>Run the derivation's <a href="command-ref/nix-store/../../language/derivations.html#attr-builder"><code>builder</code></a> executable<!-- TODO: Link to build process page #8888 -->
</li>
</ol>
</li>
</ul>
</li>
<li>Otherwise, and if the path is not already valid: Try to fetch the associated <a href="command-ref/nix-store/../../store/store-object.html">store objects</a> in the path's <a href="command-ref/nix-store/../../glossary.html#gloss-closure">closure</a> from <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-substituters">substituters</a>.</li>
</ul>
<p>If no substitutes are available and no store derivation is given, realisation fails.</p>
<p>The resulting paths are printed on standard output.
For non-derivation arguments, the argument itself is printed.</p>
<h1 id="special-exit-codes-for-build-failure-1"><a class="header" href="#special-exit-codes-for-build-failure-1">Special exit codes for build failure</a></h1>
<p>1xx status codes are used when requested builds failed.
The following codes are in use:</p>
<ul>
<li>
<p><code>100</code> Generic build failure</p>
<p>The builder process returned with a non-zero exit code.</p>
</li>
<li>
<p><code>101</code> Build timeout</p>
<p>The build was aborted because it did not complete within the specified <code>timeout</code>.</p>
</li>
<li>
<p><code>102</code> Hash mismatch</p>
<p>The build output was rejected because it does not match the
<a href="command-ref/nix-store/../../language/advanced-attributes.html"><code>outputHash</code> attribute of the derivation</a>.</p>
</li>
<li>
<p><code>104</code> Not deterministic</p>
<p>The build succeeded in check mode but the resulting output is not binary reproducible.</p>
</li>
</ul>
<p>With the <code>--keep-going</code> flag it's possible for multiple failures to occur.
In this case the 1xx status codes are or combined using
<a href="https://en.wikipedia.org/wiki/Bitwise_operation#OR">bitwise OR</a>.</p>
<pre><code>0b1100100
     ^^^^
     |||`- timeout
     ||`-- output hash mismatch
     |`--- build failure
     `---- not deterministic
</code></pre>
<h1 id="options-16"><a class="header" href="#options-16">Options</a></h1>
<ul>
<li>
<p><code>--dry-run</code></p>
<p>Print on standard error a description of what packages would be
built or downloaded, without actually performing the operation.</p>
</li>
<li>
<p><code>--ignore-unknown</code></p>
<p>If a non-derivation path does not have a substitute, then silently
ignore it.</p>
</li>
<li>
<p><code>--check</code></p>
<p>This option allows you to check whether a derivation is
deterministic. It rebuilds the specified derivation and checks
whether the result is bitwise-identical with the existing outputs,
printing an error if that’s not the case. The outputs of the
specified derivation must already exist. When used with <code>-K</code>, if an
output path is not identical to the corresponding output from the
previous build, the new output path is left in
<code>/nix/store/name.check.</code></p>
</li>
</ul>
<h1 id="options-17"><a class="header" href="#options-17">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/realise.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-17"><a class="header" href="#common-options-17">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/realise.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/realise.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/realise.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/realise.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/realise.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/realise.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/realise.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/realise.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/realise.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/realise.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/realise.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/realise.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/realise.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/realise.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/realise.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/realise.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/realise.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/realise.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/realise.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/realise.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/realise.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/realise.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/realise.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/realise.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/realise.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-17"><a class="header" href="#common-environment-variables-17">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/realise.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/realise.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/realise.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/realise.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/realise.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/realise.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/realise.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/realise.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/realise.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/realise.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/realise.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/realise.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/realise.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/realise.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/realise.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/realise.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-17"><a class="header" href="#xdg-base-directories-17">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/realise.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/realise.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/realise.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/realise.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/realise.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/realise.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-8"><a class="header" href="#examples-8">Examples</a></h1>
<p>This operation is typically used to build <a href="command-ref/nix-store/../../glossary.html#gloss-store-derivation">store derivation</a>s produced by
<a href="command-ref/nix-store/../../command-ref/nix-instantiate.html"><code>nix-instantiate</code></a>:</p>
<pre><code class="language-console">$ nix-store --realise $(nix-instantiate ./test.nix)
/nix/store/31axcgrlbfsxzmfff1gyj1bf62hvkby2-aterm-2.3.1
</code></pre>
<p>This is essentially what <a href="command-ref/nix-store/../../command-ref/nix-build.html"><code>nix-build</code></a> does.</p>
<p>To test whether a previously-built derivation is deterministic:</p>
<pre><code class="language-console">$ nix-build '&lt;nixpkgs&gt;' --attr hello --check -K
</code></pre>
<p>Use <a href="command-ref/nix-store/./read-log.html"><code>nix-store --read-log</code></a> to show the stderr and stdout of a build:</p>
<pre><code class="language-console">$ nix-store --read-log $(nix-instantiate ./test.nix)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-18"><a class="header" href="#name-18">Name</a></h1>
<p><code>nix --repair-path</code> - re-download path from substituter</p>
<h1 id="synopsis-18"><a class="header" href="#synopsis-18">Synopsis</a></h1>
<p><code>nix-store</code> <code>--repair-path</code> <em>paths…</em></p>
<h1 id="description-18"><a class="header" href="#description-18">Description</a></h1>
<p>The operation <code>--repair-path</code> attempts to “repair” the specified paths
by redownloading them using the available substituters. If no
substitutes are available, then repair is not possible.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>During repair, there is a very small time window during which the old
path (if it exists) is moved out of the way and replaced with the new
path. If repair is interrupted in between, then the system may be left
in a broken state (e.g., if the path contains a critical system
component like the GNU C Library).</p>
</blockquote>
<h1 id="example-7"><a class="header" href="#example-7">Example</a></h1>
<pre><code class="language-console">$ nix-store --verify-path /nix/store/dj7a81wsm1ijwwpkks3725661h3263p5-glibc-2.13
path `/nix/store/dj7a81wsm1ijwwpkks3725661h3263p5-glibc-2.13' was modified!
  expected hash `2db57715ae90b7e31ff1f2ecb8c12ec1cc43da920efcbe3b22763f36a1861588',
  got `481c5aa5483ebc97c20457bb8bca24deea56550d3985cda0027f67fe54b808e4'

$ nix-store --repair-path /nix/store/dj7a81wsm1ijwwpkks3725661h3263p5-glibc-2.13
fetching path `/nix/store/d7a81wsm1ijwwpkks3725661h3263p5-glibc-2.13'...
…
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-19"><a class="header" href="#name-19">Name</a></h1>
<p><code>nix-store --restore</code> - extract a Nix archive</p>
<h2 id="synopsis-19"><a class="header" href="#synopsis-19">Synopsis</a></h2>
<p><code>nix-store</code> <code>--restore</code> <em>path</em></p>
<h2 id="description-19"><a class="header" href="#description-19">Description</a></h2>
<p>The operation <code>--restore</code> unpacks a <a href="command-ref/nix-store/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive (NAR)</a> to <em>path</em>, which must
not already exist. The archive is read from standard input.</p>
<h1 id="options-18"><a class="header" href="#options-18">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/restore.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-18"><a class="header" href="#common-options-18">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/restore.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/restore.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/restore.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/restore.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/restore.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/restore.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/restore.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/restore.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/restore.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/restore.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/restore.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/restore.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/restore.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/restore.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/restore.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/restore.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/restore.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/restore.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/restore.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/restore.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/restore.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/restore.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/restore.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/restore.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/restore.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-18"><a class="header" href="#common-environment-variables-18">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/restore.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/restore.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/restore.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/restore.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/restore.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/restore.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/restore.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/restore.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/restore.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/restore.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/restore.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/restore.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/restore.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/restore.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/restore.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/restore.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-18"><a class="header" href="#xdg-base-directories-18">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/restore.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/restore.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/restore.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/restore.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/restore.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/restore.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-20"><a class="header" href="#name-20">Name</a></h1>
<p><code>nix-store --serve</code> - serve local Nix store over SSH</p>
<h1 id="synopsis-20"><a class="header" href="#synopsis-20">Synopsis</a></h1>
<p><code>nix-store</code> <code>--serve</code> [<code>--write</code>]</p>
<h1 id="description-20"><a class="header" href="#description-20">Description</a></h1>
<p>The operation <code>--serve</code> provides access to the Nix store over stdin and
stdout, and is intended to be used as a means of providing Nix store
access to a restricted ssh user.</p>
<p>The following flags are available:</p>
<ul>
<li>
<p><code>--write</code></p>
<p>Allow the connected client to request the realization of
derivations. In effect, this can be used to make the host act as a
remote builder.</p>
</li>
</ul>
<h1 id="options-19"><a class="header" href="#options-19">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/serve.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-19"><a class="header" href="#common-options-19">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/serve.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/serve.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/serve.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/serve.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/serve.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/serve.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/serve.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/serve.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/serve.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/serve.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/serve.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/serve.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/serve.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/serve.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/serve.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/serve.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/serve.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/serve.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/serve.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/serve.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/serve.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/serve.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/serve.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/serve.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/serve.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-19"><a class="header" href="#common-environment-variables-19">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/serve.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/serve.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/serve.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/serve.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/serve.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/serve.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/serve.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/serve.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/serve.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/serve.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/serve.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/serve.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/serve.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/serve.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/serve.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/serve.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-19"><a class="header" href="#xdg-base-directories-19">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/serve.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/serve.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/serve.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/serve.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/serve.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/serve.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-9"><a class="header" href="#examples-9">Examples</a></h1>
<p>To turn a host into a build server, the <code>authorized_keys</code> file can be
used to provide build access to a given SSH public key:</p>
<pre><code class="language-console">$ cat &lt;&lt;EOF &gt;&gt;/root/.ssh/authorized_keys
command="nice -n20 nix-store --serve --write" ssh-rsa AAAAB3NzaC1yc2EAAAA...
EOF
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-21"><a class="header" href="#name-21">Name</a></h1>
<p><code>nix-store --verify-path</code> - check path contents against Nix database</p>
<h2 id="synopsis-21"><a class="header" href="#synopsis-21">Synopsis</a></h2>
<p><code>nix-store</code> <code>--verify-path</code> <em>paths…</em></p>
<h2 id="description-21"><a class="header" href="#description-21">Description</a></h2>
<p>The operation <code>--verify-path</code> compares the contents of the given store
paths to their cryptographic hashes stored in Nix’s database. For every
changed path, it prints a warning message. The exit status is 0 if no
path has changed, and 1 otherwise.</p>
<h1 id="options-20"><a class="header" href="#options-20">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/verify-path.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-20"><a class="header" href="#common-options-20">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/verify-path.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/verify-path.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/verify-path.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/verify-path.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/verify-path.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/verify-path.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/verify-path.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/verify-path.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/verify-path.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/verify-path.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/verify-path.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/verify-path.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/verify-path.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/verify-path.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/verify-path.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/verify-path.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/verify-path.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/verify-path.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/verify-path.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/verify-path.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/verify-path.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/verify-path.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/verify-path.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/verify-path.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/verify-path.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-20"><a class="header" href="#common-environment-variables-20">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/verify-path.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/verify-path.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/verify-path.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/verify-path.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/verify-path.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/verify-path.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/verify-path.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/verify-path.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/verify-path.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/verify-path.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/verify-path.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/verify-path.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/verify-path.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/verify-path.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/verify-path.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/verify-path.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-20"><a class="header" href="#xdg-base-directories-20">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/verify-path.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/verify-path.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/verify-path.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/verify-path.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/verify-path.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/verify-path.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h2 id="example-8"><a class="header" href="#example-8">Example</a></h2>
<p>To verify the integrity of the <code>svn</code> command and all its dependencies:</p>
<pre><code class="language-console">$ nix-store --verify-path $(nix-store --query --requisites $(which svn))
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-22"><a class="header" href="#name-22">Name</a></h1>
<p><code>nix-store --verify</code> - check Nix database for consistency</p>
<h1 id="synopsis-22"><a class="header" href="#synopsis-22">Synopsis</a></h1>
<p><code>nix-store</code> <code>--verify</code> [<code>--check-contents</code>] [<code>--repair</code>]</p>
<h1 id="description-22"><a class="header" href="#description-22">Description</a></h1>
<p>The operation <code>--verify</code> verifies the internal consistency of the Nix
database, and the consistency between the Nix database and the Nix
store. Any inconsistencies encountered are automatically repaired.
Inconsistencies are generally the result of the Nix store or database
being modified by non-Nix tools, or of bugs in Nix itself.</p>
<p>This operation has the following options:</p>
<ul>
<li>
<p><code>--check-contents</code></p>
<p>Checks that the contents of every valid store path has not been
altered by computing a SHA-256 hash of the contents and comparing it
with the hash stored in the Nix database at build time. Paths that
have been modified are printed out. For large stores,
<code>--check-contents</code> is obviously quite slow.</p>
</li>
<li>
<p><code>--repair</code></p>
<p>If any valid path is missing from the store, or (if
<code>--check-contents</code> is given) the contents of a valid path has been
modified, then try to repair the path by redownloading it. See
<code>nix-store --repair-path</code> for details.</p>
</li>
</ul>
<h1 id="options-21"><a class="header" href="#options-21">Options</a></h1>
<p>The following options are allowed for all <code>nix-store</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><span id="opt-add-root"><a href="command-ref/nix-store/verify.html#opt-add-root"><code>--add-root</code></a></span> <em>path</em></p>
<p>Causes the result of a realisation (<code>--realise</code> and
<code>--force-realise</code>) to be registered as a root of the garbage
collector. <em>path</em> will be created as a symlink to the resulting
store path. In addition, a uniquely named symlink to <em>path</em> will
be created in <code>/nix/var/nix/gcroots/auto/</code>. For instance,</p>
<pre><code class="language-console">$ nix-store --add-root /home/eelco/bla/result --realise ...

$ ls -l /nix/var/nix/gcroots/auto
lrwxrwxrwx    1 ... 2005-03-13 21:10 dn54lcypm8f8... -&gt; /home/eelco/bla/result

$ ls -l /home/eelco/bla/result
lrwxrwxrwx    1 ... 2005-03-13 21:10 /home/eelco/bla/result -&gt; /nix/store/1r11343n6qd4...-f-spot-0.0.10
</code></pre>
<p>Thus, when <code>/home/eelco/bla/result</code> is removed, the GC root in the
<code>auto</code> directory becomes a dangling symlink and will be ignored by
the collector.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that it is not possible to move or rename GC roots, since
the symlink in the <code>auto</code> directory will still point to the old
location.</p>
</blockquote>
<p>If there are multiple results, then multiple symlinks will be
created by sequentially numbering symlinks beyond the first one
(e.g., <code>foo</code>, <code>foo-2</code>, <code>foo-3</code>, and so on).</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-21"><a class="header" href="#common-options-21">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-store/verify.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-store/verify.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-store/verify.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-store/verify.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-store/verify.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-store/verify.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-store/verify.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-store/verify.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-store/verify.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-store/verify.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-store/verify.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-store/verify.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-store/verify.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-store/verify.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-store/verify.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-store/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-store/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-store/verify.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-store/verify.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-store/verify.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-store/verify.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-store/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-store/verify.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-store/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-store/verify.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-store/verify.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-store/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-store/verify.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-store/verify.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-store/verify.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-store/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-21"><a class="header" href="#common-environment-variables-21">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-store/verify.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-store/verify.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-store/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-store/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-store/verify.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-store/verify.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-store/verify.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-store/verify.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-store/verify.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-store/verify.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-store/verify.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-store/verify.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-store/verify.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-store/verify.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-store/verify.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-store/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-store/verify.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-store/verify.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-store/verify.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-21"><a class="header" href="#xdg-base-directories-21">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-store/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-store/verify.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-store/verify.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-store/verify.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-store/verify.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/verify.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-store/verify.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-store/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-23"><a class="header" href="#name-23">Name</a></h1>
<p><code>nix-env</code> - manipulate or query Nix user environments</p>
<h1 id="synopsis-23"><a class="header" href="#synopsis-23">Synopsis</a></h1>
<p><code>nix-env</code> <em>operation</em> [<em>options</em>] [<em>arguments…</em>]
[<code>--option</code> <em>name</em> <em>value</em>]
[<code>--arg</code> <em>name</em> <em>value</em>]
[<code>--argstr</code> <em>name</em> <em>value</em>]
[{<code>--file</code> | <code>-f</code>} <em>path</em>]
[{<code>--profile</code> | <code>-p</code>} <em>path</em>]
[<code>--system-filter</code> <em>system</em>]
[<code>--dry-run</code>]</p>
<h1 id="description-23"><a class="header" href="#description-23">Description</a></h1>
<p>The command <code>nix-env</code> is used to manipulate Nix user environments. User
environments are sets of software packages available to a user at some
point in time. In other words, they are a synthesised view of the
programs available in the Nix store. There may be many user
environments: different users can have different environments, and
individual users can switch between different environments.</p>
<p><code>nix-env</code> takes exactly one <em>operation</em> flag which indicates the
subcommand to be performed. The following operations are available:</p>
<ul>
<li><a href="command-ref/./nix-env/install.html"><code>--install</code></a></li>
<li><a href="command-ref/./nix-env/upgrade.html"><code>--upgrade</code></a></li>
<li><a href="command-ref/./nix-env/uninstall.html"><code>--uninstall</code></a></li>
<li><a href="command-ref/./nix-env/set.html"><code>--set</code></a></li>
<li><a href="command-ref/./nix-env/set-flag.html"><code>--set-flag</code></a></li>
<li><a href="command-ref/./nix-env/query.html"><code>--query</code></a></li>
<li><a href="command-ref/./nix-env/switch-profile.html"><code>--switch-profile</code></a></li>
<li><a href="command-ref/./nix-env/list-generations.html"><code>--list-generations</code></a></li>
<li><a href="command-ref/./nix-env/delete-generations.html"><code>--delete-generations</code></a></li>
<li><a href="command-ref/./nix-env/switch-generation.html"><code>--switch-generation</code></a></li>
<li><a href="command-ref/./nix-env/rollback.html"><code>--rollback</code></a></li>
</ul>
<p>These pages can be viewed offline:</p>
<ul>
<li>
<p><code>man nix-env-&lt;operation&gt;</code>.</p>
<p>Example: <code>man nix-env-install</code></p>
</li>
<li>
<p><code>nix-env --help --&lt;operation&gt;</code></p>
<p>Example: <code>nix-env --help --install</code></p>
</li>
</ul>
<h1 id="package-sources"><a class="header" href="#package-sources">Package sources</a></h1>
<p><code>nix-env</code> can obtain packages from multiple sources:</p>
<ul>
<li>An attribute set of derivations from:
<ul>
<li>The <a href="command-ref/../command-ref/files/default-nix-expression.html">default Nix expression</a> (by default)</li>
<li>A Nix file, specified via <code>--file</code></li>
<li>A <a href="command-ref/../command-ref/files/profiles.html">profile</a>, specified via <code>--from-profile</code></li>
<li>A Nix expression that is a function which takes default expression as argument, specified via <code>--from-expression</code></li>
</ul>
</li>
<li>A <a href="command-ref/../store/store-path.html">store path</a></li>
</ul>
<h1 id="selectors"><a class="header" href="#selectors">Selectors</a></h1>
<p>Several operations, such as <a href="command-ref/./nix-env/query.html"><code>nix-env --query</code></a> and <a href="command-ref/./nix-env/install.html"><code>nix-env --install</code></a>, take a list of <em>arguments</em> that specify the packages on which to operate.</p>
<p>Packages are identified based on a <code>name</code> part and a <code>version</code> part of a <a href="command-ref/../language/derivations.html#attr-name">symbolic derivation name</a>:</p>
<ul>
<li><code>name</code>: Everything up to but not including the first dash (<code>-</code>) that is <em>not</em> followed by a letter.</li>
<li><code>version</code>: The rest, excluding the separating dash.</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<p><code>nix-env</code> parses the symbolic derivation name <code>apache-httpd-2.0.48</code> as:</p>
<pre><code class="language-json">{
  "name": "apache-httpd",
  "version": "2.0.48"
}
</code></pre>
</blockquote>
<blockquote>
<p><strong>Example</strong></p>
<p><code>nix-env</code> parses the symbolic derivation name <code>firefox.*</code> as:</p>
<pre><code class="language-json">{
  "name": "firefox.*",
  "version": ""
}
</code></pre>
</blockquote>
<p>The <code>name</code> parts of the <em>arguments</em> to <code>nix-env</code> are treated as extended regular expressions and matched against the <code>name</code> parts of derivation names in the package source.
The match is case-sensitive.
The regular expression can optionally be followed by a dash (<code>-</code>) and a version number; if omitted, any version of the package will match.
For details on regular expressions, see <a href="https://linux.die.net/man/7/regex"><strong>regex</strong>(7)</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>Common patterns for finding package names with <code>nix-env</code>:</p>
<ul>
<li>
<p><code>firefox</code></p>
<p>Matches the package name <code>firefox</code> and any version.</p>
</li>
<li>
<p><code>firefox-32.0</code></p>
<p>Matches the package name <code>firefox</code> and version <code>32.0</code>.</p>
</li>
<li>
<p><code>gtk\\+</code></p>
<p>Matches the package name <code>gtk+</code>.
The <code>+</code> character must be escaped using a backslash (<code>\</code>) to prevent it from being interpreted as a quantifier, and the backslash must be escaped in turn with another backslash to ensure that the shell passes it on.</p>
</li>
<li>
<p><code>.\*</code></p>
<p>Matches any package name.
This is the default for most commands.</p>
</li>
<li>
<p><code>'.*zip.*'</code></p>
<p>Matches any package name containing the string <code>zip</code>.
Note the dots: <code>'*zip*'</code> does not work, because in a regular expression, the character <code>*</code> is interpreted as a quantifier.</p>
</li>
<li>
<p><code>'.*(firefox|chromium).*'</code></p>
<p>Matches any package name containing the strings <code>firefox</code> or <code>chromium</code>.</p>
</li>
</ul>
</blockquote>
<h1 id="files"><a class="header" href="#files">Files</a></h1>
<p><code>nix-env</code> operates on the following files.</p>
<h2 id="default-nix-expression"><a class="header" href="#default-nix-expression">Default Nix expression</a></h2>
<p>The source for the <a href="command-ref/../glossary.html#gloss-nix-expression">Nix expressions</a> used by <a href="command-ref/../command-ref/nix-env.html"><code>nix-env</code></a> by default:</p>
<ul>
<li><code>~/.nix-defexpr</code></li>
<li><code>$XDG_STATE_HOME/nix/defexpr</code> if <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is set to <code>true</code>.</li>
</ul>
<p>It is loaded as follows:</p>
<ul>
<li>If the default expression is a file, it is loaded as a Nix expression.</li>
<li>If the default expression is a directory containing a <code>default.nix</code> file, that <code>default.nix</code> file is loaded as a Nix expression.</li>
<li>If the default expression is a directory without a <code>default.nix</code> file, then its contents (both files and subdirectories) are loaded as Nix expressions.
The expressions are combined into a single attribute set, each expression under an attribute with the same name as the original file or subdirectory.
Subdirectories without a <code>default.nix</code> file are traversed recursively in search of more Nix expressions, but the names of these intermediate directories are not added to the attribute paths of the default Nix expression.</li>
</ul>
<p>Then, the resulting expression is interpreted like this:</p>
<ul>
<li>If the expression is an attribute set, it is used as the default Nix expression.</li>
<li>If the expression is a function, an empty set is passed as argument and the return value is used as the default Nix expression.</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<p>If the default expression contains two files, <code>foo.nix</code> and <code>bar.nix</code>, then the default Nix expression will be equivalent to</p>
<pre><code class="language-nix">{
  foo = import ~/.nix-defexpr/foo.nix;
  bar = import ~/.nix-defexpr/bar.nix;
}
</code></pre>
</blockquote>
<p>The file <a href="command-ref/../command-ref/files/manifest.nix.html"><code>manifest.nix</code></a> is always ignored.</p>
<p>The command <a href="command-ref/../command-ref/nix-channel.html"><code>nix-channel</code></a> places a symlink to the current user's <a href="command-ref/../command-ref/files/channels.html">channels</a> in this directory, the <a href="command-ref/nix-env.html#user-channel-link">user channel link</a>.
This makes all subscribed channels available as attributes in the default expression.</p>
<h2 id="user-channel-link"><a class="header" href="#user-channel-link">User channel link</a></h2>
<p>A symlink that ensures that <a href="command-ref/../command-ref/nix-env.html"><code>nix-env</code></a> can find the current user's <a href="command-ref/../command-ref/files/channels.html">channels</a>:</p>
<ul>
<li><code>~/.nix-defexpr/channels</code></li>
<li><code>$XDG_STATE_HOME/defexpr/channels</code> if <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is set to <code>true</code>.</li>
</ul>
<p>This symlink points to:</p>
<ul>
<li><code>$XDG_STATE_HOME/profiles/channels</code> for regular users</li>
<li><code>$NIX_STATE_DIR/profiles/per-user/root/channels</code> for <code>root</code></li>
</ul>
<p>In a multi-user installation, you may also have <code>~/.nix-defexpr/channels_root</code>, which links to the channels of the root user.</p>
<h2 id="profiles-1"><a class="header" href="#profiles-1">Profiles</a></h2>
<p>A directory that contains links to profiles managed by <a href="command-ref/../command-ref/nix-env.html"><code>nix-env</code></a> and <a href="command-ref/../command-ref/new-cli/nix3-profile.html"><code>nix profile</code></a>:</p>
<ul>
<li><code>$XDG_STATE_HOME/nix/profiles</code> for regular users</li>
<li><code>$NIX_STATE_DIR/profiles/per-user/root</code> if the user is <code>root</code></li>
</ul>
<p>A profile is a directory of symlinks to files in the Nix store.</p>
<h3 id="filesystem-layout"><a class="header" href="#filesystem-layout">Filesystem layout</a></h3>
<p>Profiles are versioned as follows. When using a profile named <em>path</em>, <em>path</em> is a symlink to <em>path</em><code>-</code><em>N</em><code>-link</code>, where <em>N</em> is the version of the profile.
In turn, <em>path</em><code>-</code><em>N</em><code>-link</code> is a symlink to a path in the Nix store.
For example:</p>
<pre><code class="language-console">$ ls -l ~alice/.local/state/nix/profiles/profile*
lrwxrwxrwx 1 alice users 14 Nov 25 14:35 /home/alice/.local/state/nix/profiles/profile -&gt; profile-7-link
lrwxrwxrwx 1 alice users 51 Oct 28 16:18 /home/alice/.local/state/nix/profiles/profile-5-link -&gt; /nix/store/q69xad13ghpf7ir87h0b2gd28lafjj1j-profile
lrwxrwxrwx 1 alice users 51 Oct 29 13:20 /home/alice/.local/state/nix/profiles/profile-6-link -&gt; /nix/store/6bvhpysd7vwz7k3b0pndn7ifi5xr32dg-profile
lrwxrwxrwx 1 alice users 51 Nov 25 14:35 /home/alice/.local/state/nix/profiles/profile-7-link -&gt; /nix/store/mp0x6xnsg0b8qhswy6riqvimai4gm677-profile
</code></pre>
<p>Each of these symlinks is a root for the Nix garbage collector.</p>
<p>The contents of the store path corresponding to each version of the
profile is a tree of symlinks to the files of the installed packages,
e.g.</p>
<pre><code class="language-console">$ ll -R ~eelco/.local/state/nix/profiles/profile-7-link/
/home/eelco/.local/state/nix/profiles/profile-7-link/:
total 20
dr-xr-xr-x 2 root root 4096 Jan  1  1970 bin
-r--r--r-- 2 root root 1402 Jan  1  1970 manifest.nix
dr-xr-xr-x 4 root root 4096 Jan  1  1970 share

/home/eelco/.local/state/nix/profiles/profile-7-link/bin:
total 20
lrwxrwxrwx 5 root root 79 Jan  1  1970 chromium -&gt; /nix/store/ijm5k0zqisvkdwjkc77mb9qzb35xfi4m-chromium-86.0.4240.111/bin/chromium
lrwxrwxrwx 7 root root 87 Jan  1  1970 spotify -&gt; /nix/store/w9182874m1bl56smps3m5zjj36jhp3rn-spotify-1.1.26.501.gbe11e53b-15/bin/spotify
lrwxrwxrwx 3 root root 79 Jan  1  1970 zoom-us -&gt; /nix/store/wbhg2ga8f3h87s9h5k0slxk0m81m4cxl-zoom-us-5.3.469451.0927/bin/zoom-us

/home/eelco/.local/state/nix/profiles/profile-7-link/share/applications:
total 12
lrwxrwxrwx 4 root root 120 Jan  1  1970 chromium-browser.desktop -&gt; /nix/store/4cf803y4vzfm3gyk3vzhzb2327v0kl8a-chromium-unwrapped-86.0.4240.111/share/applications/chromium-browser.desktop
lrwxrwxrwx 7 root root 110 Jan  1  1970 spotify.desktop -&gt; /nix/store/w9182874m1bl56smps3m5zjj36jhp3rn-spotify-1.1.26.501.gbe11e53b-15/share/applications/spotify.desktop
lrwxrwxrwx 3 root root 107 Jan  1  1970 us.zoom.Zoom.desktop -&gt; /nix/store/wbhg2ga8f3h87s9h5k0slxk0m81m4cxl-zoom-us-5.3.469451.0927/share/applications/us.zoom.Zoom.desktop

…
</code></pre>
<p>Each profile version contains a manifest file:</p>
<ul>
<li><a href="command-ref/../command-ref/files/manifest.nix.html"><code>manifest.nix</code></a> used by <a href="command-ref/../command-ref/nix-env.html"><code>nix-env</code></a>.</li>
<li><a href="command-ref/../command-ref/files/manifest.json.html"><code>manifest.json</code></a> used by <a href="command-ref/../command-ref/new-cli/nix3-profile.html"><code>nix profile</code></a> (experimental).</li>
</ul>
<h2 id="user-profile-link"><a class="header" href="#user-profile-link">User profile link</a></h2>
<p>A symbolic link to the user's current profile:</p>
<ul>
<li><code>~/.nix-profile</code></li>
<li><code>$XDG_STATE_HOME/nix/profile</code> if <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is set to <code>true</code>.</li>
</ul>
<p>By default, this symlink points to:</p>
<ul>
<li><code>$XDG_STATE_HOME/nix/profiles/profile</code> for regular users</li>
<li><code>$NIX_STATE_DIR/profiles/per-user/root/profile</code> for <code>root</code></li>
</ul>
<p>The <code>PATH</code> environment variable should include <code>/bin</code> subdirectory of the profile link (e.g. <code>~/.nix-profile/bin</code>) for the user environment to be visible to the user.
The <a href="command-ref/../installation/installing-binary.html">installer</a> sets this up by default, unless you enable <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-24"><a class="header" href="#name-24">Name</a></h1>
<p><code>nix-env --delete-generations</code> - delete profile generations</p>
<h1 id="synopsis-24"><a class="header" href="#synopsis-24">Synopsis</a></h1>
<p><code>nix-env</code> <code>--delete-generations</code> <em>generations</em></p>
<h1 id="description-24"><a class="header" href="#description-24">Description</a></h1>
<p>This operation deletes the specified generations of the current profile.</p>
<p><em>generations</em> can be a one of the following:</p>
<ul>
<li>
<p><span id="generations-list"><a href="command-ref/nix-env/delete-generations.html#generations-list"><code>&lt;number&gt;...</code></a></span></p>
<p>A list of generation numbers, each one a separate command-line argument.</p>
<p>Delete exactly the profile generations given by their generation number.
Deleting the current generation is not allowed.</p>
</li>
<li>
<p><span id="generations-old"><a href="command-ref/nix-env/delete-generations.html#generations-old">The special value <code>old</code></a></span></p>
<p>Delete all generations except the current one.</p>
<blockquote>
<p><strong>WARNING</strong></p>
<p>Older <em>and newer</em> generations will be deleted by this operation.</p>
<p>One might expect this to just delete older generations than the curent one, but that is only true if the current generation is also the latest.
Because one can roll back to a previous generation, it is possible to have generations newer than the current one.
They will also be deleted.</p>
</blockquote>
</li>
<li>
<p><span id="generations-time"><a href="command-ref/nix-env/delete-generations.html#generations-time"><code>&lt;number&gt;d</code></a></span></p>
<p>The last <em>number</em> days</p>
<p><em>Example</em>: <code>30d</code></p>
<p>Delete all generations created more than <em>number</em> days ago, except the most recent one of them.
This allows rolling back to generations that were available within the specified period.</p>
</li>
<li>
<p><span id="generations-count"><a href="command-ref/nix-env/delete-generations.html#generations-count"><code>+&lt;number&gt;</code></a></span></p>
<p>The last <em>number</em> generations up to the present</p>
<p><em>Example</em>: <code>+5</code></p>
<p>Keep the last <em>number</em> generations, along with any newer than current.</p>
</li>
</ul>
<p>Periodically deleting old generations is important to make garbage collection
effective.
The is because profiles are also garbage collection roots — any <a href="command-ref/nix-env/../../store/store-object.html">store object</a> reachable from a profile is "alive" and ineligible for deletion.</p>
<h1 id="options-22"><a class="header" href="#options-22">Options</a></h1>
<p>The following options are allowed for all <code>nix-env</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><code>--file</code> / <code>-f</code> <em>path</em></p>
<p>Specifies the Nix expression (designated below as the <em>active Nix
expression</em>) used by the <code>--install</code>, <code>--upgrade</code>, and <code>--query --available</code> operations to obtain derivations. The default is
<code>~/.nix-defexpr</code>.</p>
<p>If the argument starts with <code>http://</code> or <code>https://</code>, it is
interpreted as the URL of a tarball that will be downloaded and
unpacked to a temporary location. The tarball must include a single
top-level directory containing at least a file named <code>default.nix</code>.</p>
</li>
<li>
<p><code>--profile</code> / <code>-p</code> <em>path</em></p>
<p>Specifies the profile to be used by those operations that operate on
a profile (designated below as the <em>active profile</em>). A profile is a
sequence of user environments called <em>generations</em>, one of which is
the <em>current generation</em>.</p>
</li>
<li>
<p><code>--dry-run</code></p>
<p>For the <code>--install</code>, <code>--upgrade</code>, <code>--uninstall</code>,
<code>--switch-generation</code>, <code>--delete-generations</code> and <code>--rollback</code>
operations, this flag will cause <code>nix-env</code> to print what <em>would</em> be
done if this flag had not been specified, without actually doing it.</p>
<p><code>--dry-run</code> also prints out which paths will be
<a href="command-ref/nix-env/../../glossary.html">substituted</a> (i.e., downloaded) and which paths
will be built from source (because no substitute is available).</p>
</li>
<li>
<p><code>--system-filter</code> <em>system</em></p>
<p>By default, operations such as <code>--query --available</code> show derivations matching any platform. This option
allows you to use derivations for the specified platform <em>system</em>.</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-22"><a class="header" href="#common-options-22">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-env/delete-generations.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-env/delete-generations.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-env/delete-generations.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-env/delete-generations.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-env/delete-generations.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-env/delete-generations.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-env/delete-generations.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-env/delete-generations.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-env/delete-generations.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-env/delete-generations.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-env/delete-generations.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-env/delete-generations.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-env/delete-generations.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-env/delete-generations.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-env/delete-generations.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-env/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-env/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-env/delete-generations.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-env/delete-generations.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-env/delete-generations.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-env/delete-generations.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-env/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-env/delete-generations.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-env/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-env/delete-generations.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-env/delete-generations.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-env/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-env/delete-generations.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-env/delete-generations.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-env/delete-generations.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-env/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="environment-variables-2"><a class="header" href="#environment-variables-2">Environment variables</a></h1>
<ul>
<li>
<p><code>NIX_PROFILE</code></p>
<p>Location of the Nix profile. Defaults to the target of the symlink
<code>~/.nix-profile</code>, if it exists, or <code>/nix/var/nix/profiles/default</code>
otherwise.</p>
</li>
</ul>
<h1 id="common-environment-variables-22"><a class="header" href="#common-environment-variables-22">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-env/delete-generations.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-env/delete-generations.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-env/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-env/delete-generations.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-env/delete-generations.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-env/delete-generations.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-env/delete-generations.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-env/delete-generations.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-env/delete-generations.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-env/delete-generations.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-env/delete-generations.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-env/delete-generations.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-env/delete-generations.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-env/delete-generations.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-env/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-env/delete-generations.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-env/delete-generations.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-env/delete-generations.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-22"><a class="header" href="#xdg-base-directories-22">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-env/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-env/delete-generations.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-env/delete-generations.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-env/delete-generations.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-env/delete-generations.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/delete-generations.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/delete-generations.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-10"><a class="header" href="#examples-10">Examples</a></h1>
<h2 id="delete-explicit-generation-numbers"><a class="header" href="#delete-explicit-generation-numbers">Delete explicit generation numbers</a></h2>
<pre><code class="language-console">$ nix-env --delete-generations 3 4 8
</code></pre>
<p>Delete the generations numbered 3, 4, and 8, so long as the current active generation is not any of those.</p>
<h2 id="keep-most-recent-by-count-number-of-generations"><a class="header" href="#keep-most-recent-by-count-number-of-generations">Keep most-recent by count (number of generations)</a></h2>
<pre><code class="language-console">$ nix-env --delete-generations +5
</code></pre>
<p>Suppose <code>30</code> is the current generation, and we currently have generations numbered <code>20</code> through <code>32</code>.</p>
<p>Then this command will delete generations <code>20</code> through <code>25</code> (<code>&lt;= 30 - 5</code>),
and keep generations <code>26</code> through <code>31</code> (<code>&gt; 30 - 5</code>).</p>
<h2 id="keep-most-recent-by-time-number-of-days"><a class="header" href="#keep-most-recent-by-time-number-of-days">Keep most-recent by time (number of days)</a></h2>
<pre><code class="language-console">$ nix-env --delete-generations 30d
</code></pre>
<p>This command will delete all generations older than 30 days, except for the generation that was active 30 days ago (if it currently exists).</p>
<h2 id="delete-all-older"><a class="header" href="#delete-all-older">Delete all older</a></h2>
<pre><code class="language-console">$ nix-env --profile other_profile --delete-generations old
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-25"><a class="header" href="#name-25">Name</a></h1>
<p><code>nix-env --install</code> - add packages to user environment</p>
<h1 id="synopsis-25"><a class="header" href="#synopsis-25">Synopsis</a></h1>
<p><code>nix-env</code> {<code>--install</code> | <code>-i</code>} <em>args…</em>
[{<code>--prebuilt-only</code> | <code>-b</code>}]
[{<code>--attr</code> | <code>-A</code>}]
[<code>--from-expression</code>] [<code>-E</code>]
[<code>--from-profile</code> <em>path</em>]
[<code>--preserve-installed</code> | <code>-P</code>]
[<code>--remove-all</code> | <code>-r</code>]
[<code>--priority</code> <em>priority</em>]</p>
<h1 id="description-25"><a class="header" href="#description-25">Description</a></h1>
<p>The <code>--install</code> operation creates a new user environment.
It is based on the current generation of the active <a href="command-ref/nix-env/../../command-ref/files/profiles.html">profile</a>, to which a set of <a href="command-ref/nix-env/../../store/store-path.html">store paths</a> described by <em>args</em> is added.</p>
<p>The arguments <em>args</em> map to store paths in a number of possible ways:</p>
<ul>
<li>
<p>By default, <em>args</em> is a set of names denoting derivations in the <a href="command-ref/nix-env/../../command-ref/files/default-nix-expression.html">default Nix expression</a>.
These are <a href="command-ref/nix-env/../../glossary.html#gloss-realise">realised</a>, and the resulting output paths are installed.
Currently installed derivations with a name equal to the name of a derivation being added are removed unless the option <code>--preserve-installed</code> is specified.</p>
<p>If there are multiple derivations matching a name in <em>args</em> that
have the same name (e.g., <code>gcc-3.3.6</code> and <code>gcc-4.1.1</code>), then the
derivation with the highest <em>priority</em> is used. A derivation can
define a priority by declaring the <code>meta.priority</code> attribute. This
attribute should be a number, with a higher value denoting a lower
priority. The default priority is <code>5</code>.</p>
<p>If there are multiple matching derivations with the same priority,
then the derivation with the highest version will be installed.</p>
<p>You can force the installation of multiple derivations with the same
name by being specific about the versions. For instance, <code>nix-env --install gcc-3.3.6 gcc-4.1.1</code> will install both version of GCC (and will
probably cause a user environment conflict!).</p>
</li>
<li>
<p>If <a href="command-ref/nix-env/install.html#opt-attr"><code>--attr</code></a> / <code>-A</code> is specified, the arguments are <em>attribute paths</em> that select attributes from the <a href="command-ref/nix-env/../../command-ref/files/default-nix-expression.html">default Nix expression</a>.
This is faster than using derivation names and unambiguous.
Show the attribute paths of available packages with <a href="command-ref/nix-env/./query.html"><code>nix-env --query</code></a>:</p>
<pre><code class="language-console">nix-env --query --available --attr-path
</code></pre>
</li>
<li>
<p>If <code>--from-profile</code> <em>path</em> is given, <em>args</em> is a set of names
denoting installed <a href="command-ref/nix-env/../../store/store-path.html">store paths</a> in the profile <em>path</em>. This is an
easy way to copy user environment elements from one profile to
another.</p>
</li>
<li>
<p>If <code>--from-expression</code> is given, <em>args</em> are <a href="command-ref/nix-env/../../language/syntax.html#functions">Nix language functions</a> that are called with the <a href="command-ref/nix-env/../../command-ref/files/default-nix-expression.html">default Nix expression</a> as their single argument.
The derivations returned by those function calls are installed.
This allows derivations to be specified in an unambiguous way, which is necessary if there are multiple derivations with the same name.</p>
</li>
<li>
<p>If <code>--priority</code> <em>priority</em> is given, the priority of the derivations being installed is set to <em>priority</em>.
This can be used to override the priority of the derivations being installed.
This is useful if <em>args</em> are <a href="command-ref/nix-env/../../store/store-path.html">store paths</a>, which don't have any priority information.</p>
</li>
<li>
<p>If <em>args</em> are <a href="command-ref/nix-env/../../store/store-path.html">store paths</a> that point to <a href="command-ref/nix-env/../../glossary.html#gloss-store-derivation">store derivations</a>, then those store derivations are <a href="command-ref/nix-env/../../glossary.html#gloss-realise">realised</a>, and the resulting output paths are installed.</p>
</li>
<li>
<p>If <em>args</em> are <a href="command-ref/nix-env/../../store/store-path.html">store paths</a> that do not point to store derivations, then these are <a href="command-ref/nix-env/../../glossary.html#gloss-realise">realised</a> and installed.</p>
</li>
<li>
<p>By default all <a href="command-ref/nix-env/../../language/derivations.html#attr-outputs">outputs</a> are installed for each <a href="command-ref/nix-env/../../glossary.html#gloss-store-derivation">store derivation</a>.
This can be overridden by adding a <code>meta.outputsToInstall</code> attribute on the derivation listing a subset of the output names.</p>
<p>Example:</p>
<p>The file <code>example.nix</code> defines a derivation with two outputs <code>foo</code> and <code>bar</code>, each containing a file.</p>
<pre><code class="language-nix"># example.nix
let
  pkgs = import &lt;nixpkgs&gt; {};
  command = ''
    ${pkgs.coreutils}/bin/mkdir -p $foo $bar
    echo foo &gt; $foo/foo-file
    echo bar &gt; $bar/bar-file
  '';
in
derivation {
  name = "example";
  builder = "${pkgs.bash}/bin/bash";
  args = [ "-c" command ];
  outputs = [ "foo" "bar" ];
  system = builtins.currentSystem;
}
</code></pre>
<p>Installing from this Nix expression will make files from both outputs appear in the current profile.</p>
<pre><code class="language-console">$ nix-env --install --file example.nix
installing 'example'
$ ls ~/.nix-profile
foo-file
bar-file
manifest.nix
</code></pre>
<p>Adding <code>meta.outputsToInstall</code> to that derivation will make <code>nix-env</code> only install files from the specified outputs.</p>
<pre><code class="language-nix"># example-outputs.nix
import ./example.nix // { meta.outputsToInstall = [ "bar" ]; }
</code></pre>
<pre><code class="language-console">$ nix-env --install --file example-outputs.nix
installing 'example'
$ ls ~/.nix-profile
bar-file
manifest.nix
</code></pre>
</li>
</ul>
<h1 id="options-23"><a class="header" href="#options-23">Options</a></h1>
<ul>
<li>
<p><code>--prebuilt-only</code> / <code>-b</code></p>
<p>Use only derivations for which a substitute is registered, i.e.,
there is a pre-built binary available that can be downloaded in lieu
of building the derivation. Thus, no packages will be built from
source.</p>
</li>
<li>
<p><code>--preserve-installed</code> / <code>-P</code></p>
<p>Do not remove derivations with a name matching one of the
derivations being installed. Usually, trying to have two versions of
the same package installed in the same generation of a profile will
lead to an error in building the generation, due to file name
clashes between the two versions. However, this is not the case for
all packages.</p>
</li>
<li>
<p><code>--remove-all</code> / <code>-r</code></p>
<p>Remove all previously installed packages first. This is equivalent
to running <code>nix-env --uninstall '.*'</code> first, except that everything happens
in a single transaction.</p>
</li>
</ul>
<h1 id="options-24"><a class="header" href="#options-24">Options</a></h1>
<p>The following options are allowed for all <code>nix-env</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><code>--file</code> / <code>-f</code> <em>path</em></p>
<p>Specifies the Nix expression (designated below as the <em>active Nix
expression</em>) used by the <code>--install</code>, <code>--upgrade</code>, and <code>--query --available</code> operations to obtain derivations. The default is
<code>~/.nix-defexpr</code>.</p>
<p>If the argument starts with <code>http://</code> or <code>https://</code>, it is
interpreted as the URL of a tarball that will be downloaded and
unpacked to a temporary location. The tarball must include a single
top-level directory containing at least a file named <code>default.nix</code>.</p>
</li>
<li>
<p><code>--profile</code> / <code>-p</code> <em>path</em></p>
<p>Specifies the profile to be used by those operations that operate on
a profile (designated below as the <em>active profile</em>). A profile is a
sequence of user environments called <em>generations</em>, one of which is
the <em>current generation</em>.</p>
</li>
<li>
<p><code>--dry-run</code></p>
<p>For the <code>--install</code>, <code>--upgrade</code>, <code>--uninstall</code>,
<code>--switch-generation</code>, <code>--delete-generations</code> and <code>--rollback</code>
operations, this flag will cause <code>nix-env</code> to print what <em>would</em> be
done if this flag had not been specified, without actually doing it.</p>
<p><code>--dry-run</code> also prints out which paths will be
<a href="command-ref/nix-env/../../glossary.html">substituted</a> (i.e., downloaded) and which paths
will be built from source (because no substitute is available).</p>
</li>
<li>
<p><code>--system-filter</code> <em>system</em></p>
<p>By default, operations such as <code>--query --available</code> show derivations matching any platform. This option
allows you to use derivations for the specified platform <em>system</em>.</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-23"><a class="header" href="#common-options-23">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-env/install.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-env/install.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-env/install.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-env/install.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-env/install.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-env/install.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-env/install.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-env/install.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-env/install.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-env/install.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-env/install.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-env/install.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-env/install.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-env/install.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-env/install.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-env/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-env/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-env/install.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-env/install.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-env/install.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-env/install.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-env/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-env/install.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-env/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-env/install.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-env/install.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-env/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-env/install.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-env/install.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-env/install.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-env/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="environment-variables-3"><a class="header" href="#environment-variables-3">Environment variables</a></h1>
<ul>
<li>
<p><code>NIX_PROFILE</code></p>
<p>Location of the Nix profile. Defaults to the target of the symlink
<code>~/.nix-profile</code>, if it exists, or <code>/nix/var/nix/profiles/default</code>
otherwise.</p>
</li>
</ul>
<h1 id="common-environment-variables-23"><a class="header" href="#common-environment-variables-23">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-env/install.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-env/install.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-env/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-env/install.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-env/install.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-env/install.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-env/install.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-env/install.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-env/install.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-env/install.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-env/install.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-env/install.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-env/install.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-env/install.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-env/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-env/install.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-env/install.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-env/install.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-23"><a class="header" href="#xdg-base-directories-23">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-env/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-env/install.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-env/install.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-env/install.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-env/install.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/install.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/install.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-11"><a class="header" href="#examples-11">Examples</a></h1>
<p>To install a package using a specific attribute path from the active Nix expression:</p>
<pre><code class="language-console">$ nix-env --install --attr gcc40mips
installing `gcc-4.0.2'
$ nix-env --install --attr xorg.xorgserver
installing `xorg-server-1.2.0'
</code></pre>
<p>To install a specific version of <code>gcc</code> using the derivation name:</p>
<pre><code class="language-console">$ nix-env --install gcc-3.3.2
installing `gcc-3.3.2'
uninstalling `gcc-3.1'
</code></pre>
<p>Using attribute path for selecting a package is preferred,
as it is much faster and there will not be multiple matches.</p>
<p>Note the previously installed version is removed, since
<code>--preserve-installed</code> was not specified.</p>
<p>To install an arbitrary version:</p>
<pre><code class="language-console">$ nix-env --install gcc
installing `gcc-3.3.2'
</code></pre>
<p>To install all derivations in the Nix expression <code>foo.nix</code>:</p>
<pre><code class="language-console">$ nix-env --file ~/foo.nix --install '.*'
</code></pre>
<p>To copy the store path with symbolic name <code>gcc</code> from another profile:</p>
<pre><code class="language-console">$ nix-env --install --from-profile /nix/var/nix/profiles/foo gcc
</code></pre>
<p>To install a specific <a href="command-ref/nix-env/../../glossary.html#gloss-store-derivation">store derivation</a> (typically created by
<code>nix-instantiate</code>):</p>
<pre><code class="language-console">$ nix-env --install /nix/store/fibjb1bfbpm5mrsxc4mh2d8n37sxh91i-gcc-3.4.3.drv
</code></pre>
<p>To install a specific output path:</p>
<pre><code class="language-console">$ nix-env --install /nix/store/y3cgx0xj1p4iv9x0pnnmdhr8iyg741vk-gcc-3.4.3
</code></pre>
<p>To install from a Nix expression specified on the command-line:</p>
<pre><code class="language-console">$ nix-env --file ./foo.nix --install --expr \
    'f: (f {system = "i686-linux";}).subversionWithJava'
</code></pre>
<p>I.e., this evaluates to <code>(f: (f {system = "i686-linux";}).subversionWithJava) (import ./foo.nix)</code>, thus selecting
the <code>subversionWithJava</code> attribute from the set returned by calling the
function defined in <code>./foo.nix</code>.</p>
<p>A dry-run tells you which paths will be downloaded or built from source:</p>
<pre><code class="language-console">$ nix-env --file '&lt;nixpkgs&gt;' --install --attr hello --dry-run
(dry run; not doing anything)
installing ‘hello-2.10’
this path will be fetched (0.04 MiB download, 0.19 MiB unpacked):
  /nix/store/wkhdf9jinag5750mqlax6z2zbwhqb76n-hello-2.10
  ...
</code></pre>
<p>To install Firefox from the latest revision in the Nixpkgs/NixOS 14.12
channel:</p>
<pre><code class="language-console">$ nix-env --file https://github.com/NixOS/nixpkgs/archive/nixos-14.12.tar.gz --install --attr firefox
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-26"><a class="header" href="#name-26">Name</a></h1>
<p><code>nix-env --list-generations</code> - list profile generations</p>
<h1 id="synopsis-26"><a class="header" href="#synopsis-26">Synopsis</a></h1>
<p><code>nix-env</code> <code>--list-generations</code></p>
<h1 id="description-26"><a class="header" href="#description-26">Description</a></h1>
<p>This operation print a list of all the currently existing generations
for the active profile. These may be switched to using the
<code>--switch-generation</code> operation. It also prints the creation date of the
generation, and indicates the current generation.</p>
<h1 id="options-25"><a class="header" href="#options-25">Options</a></h1>
<p>The following options are allowed for all <code>nix-env</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><code>--file</code> / <code>-f</code> <em>path</em></p>
<p>Specifies the Nix expression (designated below as the <em>active Nix
expression</em>) used by the <code>--install</code>, <code>--upgrade</code>, and <code>--query --available</code> operations to obtain derivations. The default is
<code>~/.nix-defexpr</code>.</p>
<p>If the argument starts with <code>http://</code> or <code>https://</code>, it is
interpreted as the URL of a tarball that will be downloaded and
unpacked to a temporary location. The tarball must include a single
top-level directory containing at least a file named <code>default.nix</code>.</p>
</li>
<li>
<p><code>--profile</code> / <code>-p</code> <em>path</em></p>
<p>Specifies the profile to be used by those operations that operate on
a profile (designated below as the <em>active profile</em>). A profile is a
sequence of user environments called <em>generations</em>, one of which is
the <em>current generation</em>.</p>
</li>
<li>
<p><code>--dry-run</code></p>
<p>For the <code>--install</code>, <code>--upgrade</code>, <code>--uninstall</code>,
<code>--switch-generation</code>, <code>--delete-generations</code> and <code>--rollback</code>
operations, this flag will cause <code>nix-env</code> to print what <em>would</em> be
done if this flag had not been specified, without actually doing it.</p>
<p><code>--dry-run</code> also prints out which paths will be
<a href="command-ref/nix-env/../../glossary.html">substituted</a> (i.e., downloaded) and which paths
will be built from source (because no substitute is available).</p>
</li>
<li>
<p><code>--system-filter</code> <em>system</em></p>
<p>By default, operations such as <code>--query --available</code> show derivations matching any platform. This option
allows you to use derivations for the specified platform <em>system</em>.</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-24"><a class="header" href="#common-options-24">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-env/list-generations.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-env/list-generations.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-env/list-generations.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-env/list-generations.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-env/list-generations.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-env/list-generations.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-env/list-generations.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-env/list-generations.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-env/list-generations.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-env/list-generations.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-env/list-generations.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-env/list-generations.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-env/list-generations.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-env/list-generations.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-env/list-generations.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-env/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-env/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-env/list-generations.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-env/list-generations.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-env/list-generations.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-env/list-generations.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-env/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-env/list-generations.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-env/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-env/list-generations.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-env/list-generations.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-env/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-env/list-generations.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-env/list-generations.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-env/list-generations.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-env/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="environment-variables-4"><a class="header" href="#environment-variables-4">Environment variables</a></h1>
<ul>
<li>
<p><code>NIX_PROFILE</code></p>
<p>Location of the Nix profile. Defaults to the target of the symlink
<code>~/.nix-profile</code>, if it exists, or <code>/nix/var/nix/profiles/default</code>
otherwise.</p>
</li>
</ul>
<h1 id="common-environment-variables-24"><a class="header" href="#common-environment-variables-24">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-env/list-generations.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-env/list-generations.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-env/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-env/list-generations.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-env/list-generations.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-env/list-generations.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-env/list-generations.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-env/list-generations.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-env/list-generations.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-env/list-generations.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-env/list-generations.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-env/list-generations.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-env/list-generations.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-env/list-generations.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-env/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-env/list-generations.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-env/list-generations.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-env/list-generations.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-24"><a class="header" href="#xdg-base-directories-24">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-env/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-env/list-generations.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-env/list-generations.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-env/list-generations.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-env/list-generations.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/list-generations.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/list-generations.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-12"><a class="header" href="#examples-12">Examples</a></h1>
<pre><code class="language-console">$ nix-env --list-generations
  95   2004-02-06 11:48:24
  96   2004-02-06 11:49:01
  97   2004-02-06 16:22:45
  98   2004-02-06 16:24:33   (current)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-27"><a class="header" href="#name-27">Name</a></h1>
<p><code>nix-env --query</code> - display information about packages</p>
<h1 id="synopsis-27"><a class="header" href="#synopsis-27">Synopsis</a></h1>
<p><code>nix-env</code> {<code>--query</code> | <code>-q</code>} <em>names…</em>
[<code>--installed</code> | <code>--available</code> | <code>-a</code>]
[{<code>--status</code> | <code>-s</code>}]
[{<code>--attr-path</code> | <code>-P</code>}]
[<code>--no-name</code>]
[{<code>--compare-versions</code> | <code>-c</code>}]
[<code>--system</code>]
[<code>--drv-path</code>]
[<code>--out-path</code>]
[<code>--description</code>]
[<code>--meta</code>]
[<code>--xml</code>]
[<code>--json</code>]
[{<code>--prebuilt-only</code> | <code>-b</code>}]
[{<code>--attr</code> | <code>-A</code>} <em>attribute-path</em>]</p>
<h1 id="description-27"><a class="header" href="#description-27">Description</a></h1>
<p>The query operation displays information about either the store paths
that are installed in the current generation of the active profile
(<code>--installed</code>), or the derivations that are available for installation
in the active Nix expression (<code>--available</code>). It only prints information
about derivations whose symbolic name matches one of <em>names</em>.</p>
<p>The derivations are sorted by their <code>name</code> attributes.</p>
<h1 id="source-selection"><a class="header" href="#source-selection">Source selection</a></h1>
<p>The following flags specify the set of things on which the query
operates.</p>
<ul>
<li>
<p><code>--installed</code></p>
<p>The query operates on the store paths that are installed in the
current generation of the active profile. This is the default.</p>
</li>
<li>
<p><code>--available</code> / <code>-a</code></p>
<p>The query operates on the derivations that are available in the
active Nix expression.</p>
</li>
</ul>
<h1 id="queries-1"><a class="header" href="#queries-1">Queries</a></h1>
<p>The following flags specify what information to display about the
selected derivations. Multiple flags may be specified, in which case the
information is shown in the order given here. Note that the name of the
derivation is shown unless <code>--no-name</code> is specified.</p>
<ul>
<li>
<p><code>--xml</code></p>
<p>Print the result in an XML representation suitable for automatic
processing by other tools. The root element is called <code>items</code>, which
contains a <code>item</code> element for each available or installed
derivation. The fields discussed below are all stored in attributes
of the <code>item</code> elements.</p>
</li>
<li>
<p><code>--json</code></p>
<p>Print the result in a JSON representation suitable for automatic
processing by other tools.</p>
</li>
<li>
<p><code>--prebuilt-only</code> / <code>-b</code></p>
<p>Show only derivations for which a substitute is registered, i.e.,
there is a pre-built binary available that can be downloaded in lieu
of building the derivation. Thus, this shows all packages that
probably can be installed quickly.</p>
</li>
<li>
<p><code>--status</code> / <code>-s</code></p>
<p>Print the <em>status</em> of the derivation. The status consists of three
characters. The first is <code>I</code> or <code>-</code>, indicating whether the
derivation is currently installed in the current generation of the
active profile. This is by definition the case for <code>--installed</code>,
but not for <code>--available</code>. The second is <code>P</code> or <code>-</code>, indicating
whether the derivation is present on the system. This indicates
whether installation of an available derivation will require the
derivation to be built. The third is <code>S</code> or <code>-</code>, indicating whether
a substitute is available for the derivation.</p>
</li>
<li>
<p><code>--attr-path</code> / <code>-P</code></p>
<p>Print the <em>attribute path</em> of the derivation, which can be used to
unambiguously select it using the <code>--attr</code> option available in
commands that install derivations like <code>nix-env --install</code>. This
option only works together with <code>--available</code></p>
</li>
<li>
<p><code>--no-name</code></p>
<p>Suppress printing of the <code>name</code> attribute of each derivation.</p>
</li>
<li>
<p><code>--compare-versions</code> / <code>-c</code></p>
<p>Compare installed versions to available versions, or vice versa (if
<code>--available</code> is given). This is useful for quickly seeing whether
upgrades for installed packages are available in a Nix expression. A
column is added with the following meaning:</p>
<ul>
<li>
<p><code>&lt;</code> <em>version</em></p>
<p>A newer version of the package is available or installed.</p>
</li>
<li>
<p><code>=</code> <em>version</em></p>
<p>At most the same version of the package is available or
installed.</p>
</li>
<li>
<p><code>&gt;</code> <em>version</em></p>
<p>Only older versions of the package are available or installed.</p>
</li>
<li>
<p><code>- ?</code></p>
<p>No version of the package is available or installed.</p>
</li>
</ul>
</li>
<li>
<p><code>--system</code></p>
<p>Print the <code>system</code> attribute of the derivation.</p>
</li>
<li>
<p><code>--drv-path</code></p>
<p>Print the <a href="command-ref/nix-env/../../glossary.html#gloss-store-path">store path</a> to the <a href="command-ref/nix-env/../../glossary.html#gloss-derivation">store derivation</a>.</p>
</li>
<li>
<p><code>--out-path</code></p>
<p>Print the output path of the derivation.</p>
</li>
<li>
<p><code>--description</code></p>
<p>Print a short (one-line) description of the derivation, if
available. The description is taken from the <code>meta.description</code>
attribute of the derivation.</p>
</li>
<li>
<p><code>--meta</code></p>
<p>Print all of the meta-attributes of the derivation. This option is
only available with <code>--xml</code> or <code>--json</code>.</p>
</li>
</ul>
<h1 id="options-26"><a class="header" href="#options-26">Options</a></h1>
<p>The following options are allowed for all <code>nix-env</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><code>--file</code> / <code>-f</code> <em>path</em></p>
<p>Specifies the Nix expression (designated below as the <em>active Nix
expression</em>) used by the <code>--install</code>, <code>--upgrade</code>, and <code>--query --available</code> operations to obtain derivations. The default is
<code>~/.nix-defexpr</code>.</p>
<p>If the argument starts with <code>http://</code> or <code>https://</code>, it is
interpreted as the URL of a tarball that will be downloaded and
unpacked to a temporary location. The tarball must include a single
top-level directory containing at least a file named <code>default.nix</code>.</p>
</li>
<li>
<p><code>--profile</code> / <code>-p</code> <em>path</em></p>
<p>Specifies the profile to be used by those operations that operate on
a profile (designated below as the <em>active profile</em>). A profile is a
sequence of user environments called <em>generations</em>, one of which is
the <em>current generation</em>.</p>
</li>
<li>
<p><code>--dry-run</code></p>
<p>For the <code>--install</code>, <code>--upgrade</code>, <code>--uninstall</code>,
<code>--switch-generation</code>, <code>--delete-generations</code> and <code>--rollback</code>
operations, this flag will cause <code>nix-env</code> to print what <em>would</em> be
done if this flag had not been specified, without actually doing it.</p>
<p><code>--dry-run</code> also prints out which paths will be
<a href="command-ref/nix-env/../../glossary.html">substituted</a> (i.e., downloaded) and which paths
will be built from source (because no substitute is available).</p>
</li>
<li>
<p><code>--system-filter</code> <em>system</em></p>
<p>By default, operations such as <code>--query --available</code> show derivations matching any platform. This option
allows you to use derivations for the specified platform <em>system</em>.</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-25"><a class="header" href="#common-options-25">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-env/query.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-env/query.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-env/query.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-env/query.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-env/query.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-env/query.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-env/query.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-env/query.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-env/query.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-env/query.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-env/query.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-env/query.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-env/query.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-env/query.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-env/query.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-env/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-env/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-env/query.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-env/query.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-env/query.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-env/query.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-env/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-env/query.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-env/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-env/query.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-env/query.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-env/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-env/query.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-env/query.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-env/query.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-env/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="environment-variables-5"><a class="header" href="#environment-variables-5">Environment variables</a></h1>
<ul>
<li>
<p><code>NIX_PROFILE</code></p>
<p>Location of the Nix profile. Defaults to the target of the symlink
<code>~/.nix-profile</code>, if it exists, or <code>/nix/var/nix/profiles/default</code>
otherwise.</p>
</li>
</ul>
<h1 id="common-environment-variables-25"><a class="header" href="#common-environment-variables-25">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-env/query.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-env/query.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-env/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-env/query.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-env/query.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-env/query.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-env/query.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-env/query.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-env/query.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-env/query.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-env/query.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-env/query.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-env/query.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-env/query.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-env/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-env/query.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-env/query.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-env/query.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-25"><a class="header" href="#xdg-base-directories-25">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-env/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-env/query.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-env/query.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-env/query.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-env/query.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/query.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/query.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-13"><a class="header" href="#examples-13">Examples</a></h1>
<p>To show installed packages:</p>
<pre><code class="language-console">$ nix-env --query
bison-1.875c
docbook-xml-4.2
firefox-1.0.4
MPlayer-1.0pre7
ORBit2-2.8.3
…
</code></pre>
<p>To show available packages:</p>
<pre><code class="language-console">$ nix-env --query --available
firefox-1.0.7
GConf-2.4.0.1
MPlayer-1.0pre7
ORBit2-2.8.3
…
</code></pre>
<p>To show the status of available packages:</p>
<pre><code class="language-console">$ nix-env --query --available --status
-P- firefox-1.0.7   (not installed but present)
--S GConf-2.4.0.1   (not present, but there is a substitute for fast installation)
--S MPlayer-1.0pre3 (i.e., this is not the installed MPlayer, even though the version is the same!)
IP- ORBit2-2.8.3    (installed and by definition present)
…
</code></pre>
<p>To show available packages in the Nix expression <code>foo.nix</code>:</p>
<pre><code class="language-console">$ nix-env --file ./foo.nix --query --available
foo-1.2.3
</code></pre>
<p>To compare installed versions to what’s available:</p>
<pre><code class="language-console">$ nix-env --query --compare-versions
...
acrobat-reader-7.0 - ?      (package is not available at all)
autoconf-2.59      = 2.59   (same version)
firefox-1.0.4      &lt; 1.0.7  (a more recent version is available)
...
</code></pre>
<p>To show all packages with “<code>zip</code>” in the name:</p>
<pre><code class="language-console">$ nix-env --query --available '.*zip.*'
bzip2-1.0.6
gzip-1.6
zip-3.0
…
</code></pre>
<p>To show all packages with “<code>firefox</code>” or “<code>chromium</code>” in the name:</p>
<pre><code class="language-console">$ nix-env --query --available '.*(firefox|chromium).*'
chromium-37.0.2062.94
chromium-beta-38.0.2125.24
firefox-32.0.3
firefox-with-plugins-13.0.1
…
</code></pre>
<p>To show all packages in the latest revision of the Nixpkgs repository:</p>
<pre><code class="language-console">$ nix-env --file https://github.com/NixOS/nixpkgs/archive/master.tar.gz --query --available
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-28"><a class="header" href="#name-28">Name</a></h1>
<p><code>nix-env --rollback</code> - set user environment to previous generation</p>
<h1 id="synopsis-28"><a class="header" href="#synopsis-28">Synopsis</a></h1>
<p><code>nix-env</code> <code>--rollback</code></p>
<h1 id="description-28"><a class="header" href="#description-28">Description</a></h1>
<p>This operation switches to the “previous” generation of the active
profile, that is, the highest numbered generation lower than the current
generation, if it exists. It is just a convenience wrapper around
<code>--list-generations</code> and <code>--switch-generation</code>.</p>
<h1 id="options-27"><a class="header" href="#options-27">Options</a></h1>
<p>The following options are allowed for all <code>nix-env</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><code>--file</code> / <code>-f</code> <em>path</em></p>
<p>Specifies the Nix expression (designated below as the <em>active Nix
expression</em>) used by the <code>--install</code>, <code>--upgrade</code>, and <code>--query --available</code> operations to obtain derivations. The default is
<code>~/.nix-defexpr</code>.</p>
<p>If the argument starts with <code>http://</code> or <code>https://</code>, it is
interpreted as the URL of a tarball that will be downloaded and
unpacked to a temporary location. The tarball must include a single
top-level directory containing at least a file named <code>default.nix</code>.</p>
</li>
<li>
<p><code>--profile</code> / <code>-p</code> <em>path</em></p>
<p>Specifies the profile to be used by those operations that operate on
a profile (designated below as the <em>active profile</em>). A profile is a
sequence of user environments called <em>generations</em>, one of which is
the <em>current generation</em>.</p>
</li>
<li>
<p><code>--dry-run</code></p>
<p>For the <code>--install</code>, <code>--upgrade</code>, <code>--uninstall</code>,
<code>--switch-generation</code>, <code>--delete-generations</code> and <code>--rollback</code>
operations, this flag will cause <code>nix-env</code> to print what <em>would</em> be
done if this flag had not been specified, without actually doing it.</p>
<p><code>--dry-run</code> also prints out which paths will be
<a href="command-ref/nix-env/../../glossary.html">substituted</a> (i.e., downloaded) and which paths
will be built from source (because no substitute is available).</p>
</li>
<li>
<p><code>--system-filter</code> <em>system</em></p>
<p>By default, operations such as <code>--query --available</code> show derivations matching any platform. This option
allows you to use derivations for the specified platform <em>system</em>.</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-26"><a class="header" href="#common-options-26">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-env/rollback.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-env/rollback.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-env/rollback.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-env/rollback.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-env/rollback.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-env/rollback.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-env/rollback.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-env/rollback.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-env/rollback.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-env/rollback.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-env/rollback.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-env/rollback.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-env/rollback.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-env/rollback.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-env/rollback.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-env/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-env/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-env/rollback.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-env/rollback.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-env/rollback.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-env/rollback.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-env/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-env/rollback.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-env/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-env/rollback.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-env/rollback.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-env/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-env/rollback.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-env/rollback.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-env/rollback.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-env/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="environment-variables-6"><a class="header" href="#environment-variables-6">Environment variables</a></h1>
<ul>
<li>
<p><code>NIX_PROFILE</code></p>
<p>Location of the Nix profile. Defaults to the target of the symlink
<code>~/.nix-profile</code>, if it exists, or <code>/nix/var/nix/profiles/default</code>
otherwise.</p>
</li>
</ul>
<h1 id="common-environment-variables-26"><a class="header" href="#common-environment-variables-26">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-env/rollback.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-env/rollback.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-env/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-env/rollback.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-env/rollback.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-env/rollback.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-env/rollback.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-env/rollback.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-env/rollback.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-env/rollback.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-env/rollback.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-env/rollback.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-env/rollback.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-env/rollback.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-env/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-env/rollback.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-env/rollback.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-env/rollback.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-26"><a class="header" href="#xdg-base-directories-26">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-env/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-env/rollback.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-env/rollback.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-env/rollback.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-env/rollback.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/rollback.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/rollback.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-14"><a class="header" href="#examples-14">Examples</a></h1>
<pre><code class="language-console">$ nix-env --rollback
switching from generation 92 to 91
</code></pre>
<pre><code class="language-console">$ nix-env --rollback
error: no generation older than the current (91) exists
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-29"><a class="header" href="#name-29">Name</a></h1>
<p><code>nix-env --set-flag</code> - modify meta attributes of installed packages</p>
<h1 id="synopsis-29"><a class="header" href="#synopsis-29">Synopsis</a></h1>
<p><code>nix-env</code> <code>--set-flag</code> <em>name</em> <em>value</em> <em>drvnames</em></p>
<h1 id="description-29"><a class="header" href="#description-29">Description</a></h1>
<p>The <code>--set-flag</code> operation allows meta attributes of installed packages
to be modified. There are several attributes that can be usefully
modified, because they affect the behaviour of <code>nix-env</code> or the user
environment build script:</p>
<ul>
<li>
<p><code>priority</code> can be changed to resolve filename clashes. The user
environment build script uses the <code>meta.priority</code> attribute of
derivations to resolve filename collisions between packages. Lower
priority values denote a higher priority. For instance, the GCC
wrapper package and the Binutils package in Nixpkgs both have a file
<code>bin/ld</code>, so previously if you tried to install both you would get a
collision. Now, on the other hand, the GCC wrapper declares a higher
priority than Binutils, so the former’s <code>bin/ld</code> is symlinked in the
user environment.</p>
</li>
<li>
<p><code>keep</code> can be set to <code>true</code> to prevent the package from being
upgraded or replaced. This is useful if you want to hang on to an
older version of a package.</p>
</li>
<li>
<p><code>active</code> can be set to <code>false</code> to “disable” the package. That is, no
symlinks will be generated to the files of the package, but it
remains part of the profile (so it won’t be garbage-collected). It
can be set back to <code>true</code> to re-enable the package.</p>
</li>
</ul>
<h1 id="options-28"><a class="header" href="#options-28">Options</a></h1>
<p>The following options are allowed for all <code>nix-env</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><code>--file</code> / <code>-f</code> <em>path</em></p>
<p>Specifies the Nix expression (designated below as the <em>active Nix
expression</em>) used by the <code>--install</code>, <code>--upgrade</code>, and <code>--query --available</code> operations to obtain derivations. The default is
<code>~/.nix-defexpr</code>.</p>
<p>If the argument starts with <code>http://</code> or <code>https://</code>, it is
interpreted as the URL of a tarball that will be downloaded and
unpacked to a temporary location. The tarball must include a single
top-level directory containing at least a file named <code>default.nix</code>.</p>
</li>
<li>
<p><code>--profile</code> / <code>-p</code> <em>path</em></p>
<p>Specifies the profile to be used by those operations that operate on
a profile (designated below as the <em>active profile</em>). A profile is a
sequence of user environments called <em>generations</em>, one of which is
the <em>current generation</em>.</p>
</li>
<li>
<p><code>--dry-run</code></p>
<p>For the <code>--install</code>, <code>--upgrade</code>, <code>--uninstall</code>,
<code>--switch-generation</code>, <code>--delete-generations</code> and <code>--rollback</code>
operations, this flag will cause <code>nix-env</code> to print what <em>would</em> be
done if this flag had not been specified, without actually doing it.</p>
<p><code>--dry-run</code> also prints out which paths will be
<a href="command-ref/nix-env/../../glossary.html">substituted</a> (i.e., downloaded) and which paths
will be built from source (because no substitute is available).</p>
</li>
<li>
<p><code>--system-filter</code> <em>system</em></p>
<p>By default, operations such as <code>--query --available</code> show derivations matching any platform. This option
allows you to use derivations for the specified platform <em>system</em>.</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-27"><a class="header" href="#common-options-27">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-env/set-flag.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-env/set-flag.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-env/set-flag.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-env/set-flag.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-env/set-flag.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-env/set-flag.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-env/set-flag.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-env/set-flag.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-env/set-flag.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-env/set-flag.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-env/set-flag.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-env/set-flag.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-env/set-flag.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-env/set-flag.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-env/set-flag.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-env/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-env/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-env/set-flag.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-env/set-flag.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-env/set-flag.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-env/set-flag.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-env/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-env/set-flag.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-env/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-env/set-flag.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-env/set-flag.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-env/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-env/set-flag.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-env/set-flag.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-env/set-flag.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-env/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-27"><a class="header" href="#common-environment-variables-27">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-env/set-flag.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-env/set-flag.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-env/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-env/set-flag.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-env/set-flag.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-env/set-flag.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-env/set-flag.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-env/set-flag.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-env/set-flag.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-env/set-flag.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-env/set-flag.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-env/set-flag.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-env/set-flag.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-env/set-flag.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-env/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-env/set-flag.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-env/set-flag.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-env/set-flag.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-27"><a class="header" href="#xdg-base-directories-27">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-env/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-env/set-flag.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-env/set-flag.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-env/set-flag.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-env/set-flag.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/set-flag.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/set-flag.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-15"><a class="header" href="#examples-15">Examples</a></h1>
<p>To prevent the currently installed Firefox from being upgraded:</p>
<pre><code class="language-console">$ nix-env --set-flag keep true firefox
</code></pre>
<p>After this, <code>nix-env --upgrade </code> will ignore Firefox.</p>
<p>To disable the currently installed Firefox, then install a new Firefox
while the old remains part of the profile:</p>
<pre><code class="language-console">$ nix-env --query
firefox-2.0.0.9 (the current one)

$ nix-env --preserve-installed --install firefox-2.0.0.11
installing `firefox-2.0.0.11'
building path(s) `/nix/store/myy0y59q3ig70dgq37jqwg1j0rsapzsl-user-environment'
collision between `/nix/store/...-firefox-2.0.0.11/bin/firefox'
  and `/nix/store/...-firefox-2.0.0.9/bin/firefox'.
(i.e., can’t have two active at the same time)

$ nix-env --set-flag active false firefox
setting flag on `firefox-2.0.0.9'

$ nix-env --preserve-installed --install firefox-2.0.0.11
installing `firefox-2.0.0.11'

$ nix-env --query
firefox-2.0.0.11 (the enabled one)
firefox-2.0.0.9 (the disabled one)
</code></pre>
<p>To make files from <code>binutils</code> take precedence over files from <code>gcc</code>:</p>
<pre><code class="language-console">$ nix-env --set-flag priority 5 binutils
$ nix-env --set-flag priority 10 gcc
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-30"><a class="header" href="#name-30">Name</a></h1>
<p><code>nix-env --set</code> - set profile to contain a specified derivation</p>
<h2 id="synopsis-30"><a class="header" href="#synopsis-30">Synopsis</a></h2>
<p><code>nix-env</code> <code>--set</code> <em>drvname</em></p>
<h2 id="description-30"><a class="header" href="#description-30">Description</a></h2>
<p>The <code>--set</code> operation modifies the current generation of a profile so
that it contains exactly the specified derivation, and nothing else.</p>
<h1 id="options-29"><a class="header" href="#options-29">Options</a></h1>
<p>The following options are allowed for all <code>nix-env</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><code>--file</code> / <code>-f</code> <em>path</em></p>
<p>Specifies the Nix expression (designated below as the <em>active Nix
expression</em>) used by the <code>--install</code>, <code>--upgrade</code>, and <code>--query --available</code> operations to obtain derivations. The default is
<code>~/.nix-defexpr</code>.</p>
<p>If the argument starts with <code>http://</code> or <code>https://</code>, it is
interpreted as the URL of a tarball that will be downloaded and
unpacked to a temporary location. The tarball must include a single
top-level directory containing at least a file named <code>default.nix</code>.</p>
</li>
<li>
<p><code>--profile</code> / <code>-p</code> <em>path</em></p>
<p>Specifies the profile to be used by those operations that operate on
a profile (designated below as the <em>active profile</em>). A profile is a
sequence of user environments called <em>generations</em>, one of which is
the <em>current generation</em>.</p>
</li>
<li>
<p><code>--dry-run</code></p>
<p>For the <code>--install</code>, <code>--upgrade</code>, <code>--uninstall</code>,
<code>--switch-generation</code>, <code>--delete-generations</code> and <code>--rollback</code>
operations, this flag will cause <code>nix-env</code> to print what <em>would</em> be
done if this flag had not been specified, without actually doing it.</p>
<p><code>--dry-run</code> also prints out which paths will be
<a href="command-ref/nix-env/../../glossary.html">substituted</a> (i.e., downloaded) and which paths
will be built from source (because no substitute is available).</p>
</li>
<li>
<p><code>--system-filter</code> <em>system</em></p>
<p>By default, operations such as <code>--query --available</code> show derivations matching any platform. This option
allows you to use derivations for the specified platform <em>system</em>.</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-28"><a class="header" href="#common-options-28">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-env/set.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-env/set.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-env/set.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-env/set.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-env/set.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-env/set.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-env/set.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-env/set.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-env/set.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-env/set.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-env/set.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-env/set.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-env/set.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-env/set.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-env/set.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-env/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-env/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-env/set.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-env/set.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-env/set.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-env/set.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-env/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-env/set.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-env/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-env/set.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-env/set.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-env/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-env/set.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-env/set.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-env/set.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-env/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="environment-variables-7"><a class="header" href="#environment-variables-7">Environment variables</a></h1>
<ul>
<li>
<p><code>NIX_PROFILE</code></p>
<p>Location of the Nix profile. Defaults to the target of the symlink
<code>~/.nix-profile</code>, if it exists, or <code>/nix/var/nix/profiles/default</code>
otherwise.</p>
</li>
</ul>
<h1 id="common-environment-variables-28"><a class="header" href="#common-environment-variables-28">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-env/set.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-env/set.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-env/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-env/set.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-env/set.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-env/set.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-env/set.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-env/set.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-env/set.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-env/set.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-env/set.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-env/set.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-env/set.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-env/set.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-env/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-env/set.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-env/set.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-env/set.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-28"><a class="header" href="#xdg-base-directories-28">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-env/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-env/set.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-env/set.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-env/set.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-env/set.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/set.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/set.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h2 id="examples-16"><a class="header" href="#examples-16">Examples</a></h2>
<p>The following updates a profile such that its current generation will
contain just Firefox:</p>
<pre><code class="language-console">$ nix-env --profile /nix/var/nix/profiles/browser --set firefox
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-31"><a class="header" href="#name-31">Name</a></h1>
<p><code>nix-env --switch-generation</code> - set user environment to given profile generation</p>
<h1 id="synopsis-31"><a class="header" href="#synopsis-31">Synopsis</a></h1>
<p><code>nix-env</code> {<code>--switch-generation</code> | <code>-G</code>} <em>generation</em></p>
<h1 id="description-31"><a class="header" href="#description-31">Description</a></h1>
<p>This operation makes generation number <em>generation</em> the current
generation of the active profile. That is, if the <code>profile</code> is the path
to the active profile, then the symlink <code>profile</code> is made to point to
<code>profile-generation-link</code>, which is in turn a symlink to the actual user
environment in the Nix store.</p>
<p>Switching will fail if the specified generation does not exist.</p>
<h1 id="options-30"><a class="header" href="#options-30">Options</a></h1>
<p>The following options are allowed for all <code>nix-env</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><code>--file</code> / <code>-f</code> <em>path</em></p>
<p>Specifies the Nix expression (designated below as the <em>active Nix
expression</em>) used by the <code>--install</code>, <code>--upgrade</code>, and <code>--query --available</code> operations to obtain derivations. The default is
<code>~/.nix-defexpr</code>.</p>
<p>If the argument starts with <code>http://</code> or <code>https://</code>, it is
interpreted as the URL of a tarball that will be downloaded and
unpacked to a temporary location. The tarball must include a single
top-level directory containing at least a file named <code>default.nix</code>.</p>
</li>
<li>
<p><code>--profile</code> / <code>-p</code> <em>path</em></p>
<p>Specifies the profile to be used by those operations that operate on
a profile (designated below as the <em>active profile</em>). A profile is a
sequence of user environments called <em>generations</em>, one of which is
the <em>current generation</em>.</p>
</li>
<li>
<p><code>--dry-run</code></p>
<p>For the <code>--install</code>, <code>--upgrade</code>, <code>--uninstall</code>,
<code>--switch-generation</code>, <code>--delete-generations</code> and <code>--rollback</code>
operations, this flag will cause <code>nix-env</code> to print what <em>would</em> be
done if this flag had not been specified, without actually doing it.</p>
<p><code>--dry-run</code> also prints out which paths will be
<a href="command-ref/nix-env/../../glossary.html">substituted</a> (i.e., downloaded) and which paths
will be built from source (because no substitute is available).</p>
</li>
<li>
<p><code>--system-filter</code> <em>system</em></p>
<p>By default, operations such as <code>--query --available</code> show derivations matching any platform. This option
allows you to use derivations for the specified platform <em>system</em>.</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-29"><a class="header" href="#common-options-29">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-env/switch-generation.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-env/switch-generation.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-env/switch-generation.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-env/switch-generation.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-env/switch-generation.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-env/switch-generation.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-env/switch-generation.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-env/switch-generation.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-env/switch-generation.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-env/switch-generation.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-env/switch-generation.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-env/switch-generation.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-env/switch-generation.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-env/switch-generation.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-env/switch-generation.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-env/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-env/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-env/switch-generation.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-env/switch-generation.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-env/switch-generation.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-env/switch-generation.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-env/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-env/switch-generation.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-env/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-env/switch-generation.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-env/switch-generation.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-env/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-env/switch-generation.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-env/switch-generation.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-env/switch-generation.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-env/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="environment-variables-8"><a class="header" href="#environment-variables-8">Environment variables</a></h1>
<ul>
<li>
<p><code>NIX_PROFILE</code></p>
<p>Location of the Nix profile. Defaults to the target of the symlink
<code>~/.nix-profile</code>, if it exists, or <code>/nix/var/nix/profiles/default</code>
otherwise.</p>
</li>
</ul>
<h1 id="common-environment-variables-29"><a class="header" href="#common-environment-variables-29">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-env/switch-generation.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-env/switch-generation.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-env/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-env/switch-generation.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-env/switch-generation.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-env/switch-generation.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-env/switch-generation.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-env/switch-generation.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-env/switch-generation.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-env/switch-generation.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-env/switch-generation.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-env/switch-generation.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-env/switch-generation.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-env/switch-generation.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-env/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-env/switch-generation.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-env/switch-generation.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-env/switch-generation.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-29"><a class="header" href="#xdg-base-directories-29">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-env/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-env/switch-generation.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-env/switch-generation.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-env/switch-generation.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-env/switch-generation.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/switch-generation.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/switch-generation.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-17"><a class="header" href="#examples-17">Examples</a></h1>
<pre><code class="language-console">$ nix-env --switch-generation 42
switching from generation 50 to 42
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-32"><a class="header" href="#name-32">Name</a></h1>
<p><code>nix-env --switch-profile</code> - set user environment to given profile</p>
<h1 id="synopsis-32"><a class="header" href="#synopsis-32">Synopsis</a></h1>
<p><code>nix-env</code> {<code>--switch-profile</code> | <code>-S</code>} <em>path</em></p>
<h1 id="description-32"><a class="header" href="#description-32">Description</a></h1>
<p>This operation makes <em>path</em> the current profile for the user. That is,
the symlink <code>~/.nix-profile</code> is made to point to <em>path</em>.</p>
<h1 id="options-31"><a class="header" href="#options-31">Options</a></h1>
<p>The following options are allowed for all <code>nix-env</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><code>--file</code> / <code>-f</code> <em>path</em></p>
<p>Specifies the Nix expression (designated below as the <em>active Nix
expression</em>) used by the <code>--install</code>, <code>--upgrade</code>, and <code>--query --available</code> operations to obtain derivations. The default is
<code>~/.nix-defexpr</code>.</p>
<p>If the argument starts with <code>http://</code> or <code>https://</code>, it is
interpreted as the URL of a tarball that will be downloaded and
unpacked to a temporary location. The tarball must include a single
top-level directory containing at least a file named <code>default.nix</code>.</p>
</li>
<li>
<p><code>--profile</code> / <code>-p</code> <em>path</em></p>
<p>Specifies the profile to be used by those operations that operate on
a profile (designated below as the <em>active profile</em>). A profile is a
sequence of user environments called <em>generations</em>, one of which is
the <em>current generation</em>.</p>
</li>
<li>
<p><code>--dry-run</code></p>
<p>For the <code>--install</code>, <code>--upgrade</code>, <code>--uninstall</code>,
<code>--switch-generation</code>, <code>--delete-generations</code> and <code>--rollback</code>
operations, this flag will cause <code>nix-env</code> to print what <em>would</em> be
done if this flag had not been specified, without actually doing it.</p>
<p><code>--dry-run</code> also prints out which paths will be
<a href="command-ref/nix-env/../../glossary.html">substituted</a> (i.e., downloaded) and which paths
will be built from source (because no substitute is available).</p>
</li>
<li>
<p><code>--system-filter</code> <em>system</em></p>
<p>By default, operations such as <code>--query --available</code> show derivations matching any platform. This option
allows you to use derivations for the specified platform <em>system</em>.</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-30"><a class="header" href="#common-options-30">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-env/switch-profile.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-env/switch-profile.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-env/switch-profile.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-env/switch-profile.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-env/switch-profile.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-env/switch-profile.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-env/switch-profile.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-env/switch-profile.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-env/switch-profile.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-env/switch-profile.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-env/switch-profile.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-env/switch-profile.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-env/switch-profile.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-env/switch-profile.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-env/switch-profile.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-env/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-env/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-env/switch-profile.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-env/switch-profile.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-env/switch-profile.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-env/switch-profile.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-env/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-env/switch-profile.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-env/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-env/switch-profile.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-env/switch-profile.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-env/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-env/switch-profile.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-env/switch-profile.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-env/switch-profile.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-env/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="environment-variables-9"><a class="header" href="#environment-variables-9">Environment variables</a></h1>
<ul>
<li>
<p><code>NIX_PROFILE</code></p>
<p>Location of the Nix profile. Defaults to the target of the symlink
<code>~/.nix-profile</code>, if it exists, or <code>/nix/var/nix/profiles/default</code>
otherwise.</p>
</li>
</ul>
<h1 id="common-environment-variables-30"><a class="header" href="#common-environment-variables-30">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-env/switch-profile.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-env/switch-profile.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-env/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-env/switch-profile.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-env/switch-profile.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-env/switch-profile.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-env/switch-profile.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-env/switch-profile.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-env/switch-profile.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-env/switch-profile.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-env/switch-profile.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-env/switch-profile.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-env/switch-profile.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-env/switch-profile.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-env/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-env/switch-profile.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-env/switch-profile.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-env/switch-profile.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-30"><a class="header" href="#xdg-base-directories-30">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-env/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-env/switch-profile.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-env/switch-profile.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-env/switch-profile.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-env/switch-profile.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/switch-profile.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/switch-profile.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-18"><a class="header" href="#examples-18">Examples</a></h1>
<pre><code class="language-console">$ nix-env --switch-profile ~/my-profile
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-33"><a class="header" href="#name-33">Name</a></h1>
<p><code>nix-env --uninstall</code> - remove packages from user environment</p>
<h1 id="synopsis-33"><a class="header" href="#synopsis-33">Synopsis</a></h1>
<p><code>nix-env</code> {<code>--uninstall</code> | <code>-e</code>} <em>drvnames…</em></p>
<h1 id="description-33"><a class="header" href="#description-33">Description</a></h1>
<p>The uninstall operation creates a new user environment, based on the
current generation of the active profile, from which the store paths
designated by the symbolic names <em>drvnames</em> are removed.</p>
<h1 id="options-32"><a class="header" href="#options-32">Options</a></h1>
<p>The following options are allowed for all <code>nix-env</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><code>--file</code> / <code>-f</code> <em>path</em></p>
<p>Specifies the Nix expression (designated below as the <em>active Nix
expression</em>) used by the <code>--install</code>, <code>--upgrade</code>, and <code>--query --available</code> operations to obtain derivations. The default is
<code>~/.nix-defexpr</code>.</p>
<p>If the argument starts with <code>http://</code> or <code>https://</code>, it is
interpreted as the URL of a tarball that will be downloaded and
unpacked to a temporary location. The tarball must include a single
top-level directory containing at least a file named <code>default.nix</code>.</p>
</li>
<li>
<p><code>--profile</code> / <code>-p</code> <em>path</em></p>
<p>Specifies the profile to be used by those operations that operate on
a profile (designated below as the <em>active profile</em>). A profile is a
sequence of user environments called <em>generations</em>, one of which is
the <em>current generation</em>.</p>
</li>
<li>
<p><code>--dry-run</code></p>
<p>For the <code>--install</code>, <code>--upgrade</code>, <code>--uninstall</code>,
<code>--switch-generation</code>, <code>--delete-generations</code> and <code>--rollback</code>
operations, this flag will cause <code>nix-env</code> to print what <em>would</em> be
done if this flag had not been specified, without actually doing it.</p>
<p><code>--dry-run</code> also prints out which paths will be
<a href="command-ref/nix-env/../../glossary.html">substituted</a> (i.e., downloaded) and which paths
will be built from source (because no substitute is available).</p>
</li>
<li>
<p><code>--system-filter</code> <em>system</em></p>
<p>By default, operations such as <code>--query --available</code> show derivations matching any platform. This option
allows you to use derivations for the specified platform <em>system</em>.</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-31"><a class="header" href="#common-options-31">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-env/uninstall.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-env/uninstall.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-env/uninstall.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-env/uninstall.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-env/uninstall.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-env/uninstall.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-env/uninstall.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-env/uninstall.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-env/uninstall.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-env/uninstall.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-env/uninstall.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-env/uninstall.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-env/uninstall.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-env/uninstall.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-env/uninstall.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-env/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-env/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-env/uninstall.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-env/uninstall.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-env/uninstall.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-env/uninstall.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-env/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-env/uninstall.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-env/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-env/uninstall.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-env/uninstall.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-env/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-env/uninstall.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-env/uninstall.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-env/uninstall.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-env/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="environment-variables-10"><a class="header" href="#environment-variables-10">Environment variables</a></h1>
<ul>
<li>
<p><code>NIX_PROFILE</code></p>
<p>Location of the Nix profile. Defaults to the target of the symlink
<code>~/.nix-profile</code>, if it exists, or <code>/nix/var/nix/profiles/default</code>
otherwise.</p>
</li>
</ul>
<h1 id="common-environment-variables-31"><a class="header" href="#common-environment-variables-31">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-env/uninstall.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-env/uninstall.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-env/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-env/uninstall.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-env/uninstall.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-env/uninstall.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-env/uninstall.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-env/uninstall.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-env/uninstall.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-env/uninstall.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-env/uninstall.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-env/uninstall.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-env/uninstall.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-env/uninstall.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-env/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-env/uninstall.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-env/uninstall.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-env/uninstall.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-31"><a class="header" href="#xdg-base-directories-31">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-env/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-env/uninstall.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-env/uninstall.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-env/uninstall.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-env/uninstall.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/uninstall.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/uninstall.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-19"><a class="header" href="#examples-19">Examples</a></h1>
<pre><code class="language-console">$ nix-env --uninstall gcc
$ nix-env --uninstall '.*' (remove everything)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-34"><a class="header" href="#name-34">Name</a></h1>
<p><code>nix-env --upgrade</code> - upgrade packages in user environment</p>
<h1 id="synopsis-34"><a class="header" href="#synopsis-34">Synopsis</a></h1>
<p><code>nix-env</code> {<code>--upgrade</code> | <code>-u</code>} <em>args</em>
[<code>--lt</code> | <code>--leq</code> | <code>--eq</code> | <code>--always</code>]
[{<code>--prebuilt-only</code> | <code>-b</code>}]
[{<code>--attr</code> | <code>-A</code>}]
[<code>--from-expression</code>] [<code>-E</code>]
[<code>--from-profile</code> <em>path</em>]
[<code>--preserve-installed</code> | <code>-P</code>]</p>
<h1 id="description-34"><a class="header" href="#description-34">Description</a></h1>
<p>The upgrade operation creates a new user environment, based on the
current generation of the active profile, in which all store paths are
replaced for which there are newer versions in the set of paths
described by <em>args</em>. Paths for which there are no newer versions are
left untouched; this is not an error. It is also not an error if an
element of <em>args</em> matches no installed derivations.</p>
<p>For a description of how <em>args</em> is mapped to a set of store paths, see
<a href="command-ref/nix-env/upgrade.html#operation---install"><code>--install</code></a>. If <em>args</em> describes multiple
store paths with the same symbolic name, only the one with the highest
version is installed.</p>
<h1 id="flags"><a class="header" href="#flags">Flags</a></h1>
<ul>
<li>
<p><code>--lt</code></p>
<p>Only upgrade a derivation to newer versions. This is the default.</p>
</li>
<li>
<p><code>--leq</code></p>
<p>In addition to upgrading to newer versions, also “upgrade” to
derivations that have the same version. Version are not a unique
identification of a derivation, so there may be many derivations
that have the same version. This flag may be useful to force
“synchronisation” between the installed and available derivations.</p>
</li>
<li>
<p><code>--eq</code></p>
<p><em>Only</em> “upgrade” to derivations that have the same version. This may
not seem very useful, but it actually is, e.g., when there is a new
release of Nixpkgs and you want to replace installed applications
with the same versions built against newer dependencies (to reduce
the number of dependencies floating around on your system).</p>
</li>
<li>
<p><code>--always</code></p>
<p>In addition to upgrading to newer versions, also “upgrade” to
derivations that have the same or a lower version. I.e., derivations
may actually be downgraded depending on what is available in the
active Nix expression.</p>
</li>
<li>
<p><code>--prebuilt-only</code> / <code>-b</code></p>
<p>Use only derivations for which a substitute is registered, i.e.,
there is a pre-built binary available that can be downloaded in lieu
of building the derivation. Thus, no packages will be built from
source.</p>
</li>
<li>
<p><code>--preserve-installed</code> / <code>-P</code></p>
<p>Do not remove derivations with a name matching one of the
derivations being installed. Usually, trying to have two versions of
the same package installed in the same generation of a profile will
lead to an error in building the generation, due to file name
clashes between the two versions. However, this is not the case for
all packages.</p>
</li>
</ul>
<h1 id="options-33"><a class="header" href="#options-33">Options</a></h1>
<p>The following options are allowed for all <code>nix-env</code> operations, but may not always have an effect.</p>
<ul>
<li>
<p><code>--file</code> / <code>-f</code> <em>path</em></p>
<p>Specifies the Nix expression (designated below as the <em>active Nix
expression</em>) used by the <code>--install</code>, <code>--upgrade</code>, and <code>--query --available</code> operations to obtain derivations. The default is
<code>~/.nix-defexpr</code>.</p>
<p>If the argument starts with <code>http://</code> or <code>https://</code>, it is
interpreted as the URL of a tarball that will be downloaded and
unpacked to a temporary location. The tarball must include a single
top-level directory containing at least a file named <code>default.nix</code>.</p>
</li>
<li>
<p><code>--profile</code> / <code>-p</code> <em>path</em></p>
<p>Specifies the profile to be used by those operations that operate on
a profile (designated below as the <em>active profile</em>). A profile is a
sequence of user environments called <em>generations</em>, one of which is
the <em>current generation</em>.</p>
</li>
<li>
<p><code>--dry-run</code></p>
<p>For the <code>--install</code>, <code>--upgrade</code>, <code>--uninstall</code>,
<code>--switch-generation</code>, <code>--delete-generations</code> and <code>--rollback</code>
operations, this flag will cause <code>nix-env</code> to print what <em>would</em> be
done if this flag had not been specified, without actually doing it.</p>
<p><code>--dry-run</code> also prints out which paths will be
<a href="command-ref/nix-env/../../glossary.html">substituted</a> (i.e., downloaded) and which paths
will be built from source (because no substitute is available).</p>
</li>
<li>
<p><code>--system-filter</code> <em>system</em></p>
<p>By default, operations such as <code>--query --available</code> show derivations matching any platform. This option
allows you to use derivations for the specified platform <em>system</em>.</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-32"><a class="header" href="#common-options-32">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-env/upgrade.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-env/upgrade.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-env/upgrade.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-env/upgrade.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-env/upgrade.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-env/upgrade.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-env/upgrade.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-env/upgrade.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-env/upgrade.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-env/upgrade.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-env/upgrade.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-env/upgrade.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-env/upgrade.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-env/upgrade.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-env/upgrade.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/nix-env/../../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/nix-env/../../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-env/upgrade.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-env/upgrade.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-env/upgrade.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-env/upgrade.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/nix-env/../../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-env/upgrade.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/nix-env/../../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-env/upgrade.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-env/upgrade.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/nix-env/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-env/upgrade.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-env/upgrade.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-env/upgrade.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/nix-env/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="environment-variables-11"><a class="header" href="#environment-variables-11">Environment variables</a></h1>
<ul>
<li>
<p><code>NIX_PROFILE</code></p>
<p>Location of the Nix profile. Defaults to the target of the symlink
<code>~/.nix-profile</code>, if it exists, or <code>/nix/var/nix/profiles/default</code>
otherwise.</p>
</li>
</ul>
<h1 id="common-environment-variables-32"><a class="header" href="#common-environment-variables-32">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-env/upgrade.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-env/upgrade.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/nix-env/../../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/nix-env/../../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-env/upgrade.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-env/upgrade.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-env/upgrade.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-env/upgrade.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-env/upgrade.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-env/upgrade.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-env/upgrade.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-env/upgrade.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-env/upgrade.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-env/upgrade.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-env/upgrade.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/nix-env/../../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-env/upgrade.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-env/upgrade.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-env/upgrade.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-32"><a class="header" href="#xdg-base-directories-32">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/nix-env/../../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-env/upgrade.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-env/upgrade.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-env/upgrade.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-env/upgrade.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/upgrade.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-env/upgrade.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/nix-env/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-20"><a class="header" href="#examples-20">Examples</a></h1>
<pre><code class="language-console">$ nix-env --upgrade --attr nixpkgs.gcc
upgrading `gcc-3.3.1' to `gcc-3.4'
</code></pre>
<p>When there are no updates available, nothing will happen:</p>
<pre><code class="language-console">$ nix-env --upgrade --attr nixpkgs.pan
</code></pre>
<p>Using <code>-A</code> is preferred when possible, as it is faster and unambiguous but
it is also possible to upgrade to a specific version by matching the derivation name:</p>
<pre><code class="language-console">$ nix-env --upgrade gcc-3.3.2 --always
upgrading `gcc-3.4' to `gcc-3.3.2'
</code></pre>
<p>To try to upgrade everything
(matching packages based on the part of the derivation name without version):</p>
<pre><code class="language-console">$ nix-env --upgrade
upgrading `hello-2.1.2' to `hello-2.1.3'
upgrading `mozilla-1.2' to `mozilla-1.4'
</code></pre>
<h1 id="versions"><a class="header" href="#versions">Versions</a></h1>
<p>The upgrade operation determines whether a derivation <code>y</code> is an upgrade
of a derivation <code>x</code> by looking at their respective <code>name</code> attributes.
The names (e.g., <code>gcc-3.3.1</code> are split into two parts: the package name
(<code>gcc</code>), and the version (<code>3.3.1</code>). The version part starts after the
first dash not followed by a letter. <code>y</code> is considered an upgrade of <code>x</code>
if their package names match, and the version of <code>y</code> is higher than that
of <code>x</code>.</p>
<p>The versions are compared by splitting them into contiguous components
of numbers and letters. E.g., <code>3.3.1pre5</code> is split into <code>[3, 3, 1, "pre", 5]</code>. These lists are then compared lexicographically (from left
to right). Corresponding components <code>a</code> and <code>b</code> are compared as follows.
If they are both numbers, integer comparison is used. If <code>a</code> is an empty
string and <code>b</code> is a number, <code>a</code> is considered less than <code>b</code>. The special
string component <code>pre</code> (for <em>pre-release</em>) is considered to be less than
other components. String components are considered less than number
components. Otherwise, they are compared lexicographically (i.e., using
case-sensitive string comparison).</p>
<p>This is illustrated by the following examples:</p>
<pre><code>1.0 &lt; 2.3
2.1 &lt; 2.3
2.3 = 2.3
2.5 &gt; 2.3
3.1 &gt; 2.3
2.3.1 &gt; 2.3
2.3.1 &gt; 2.3a
2.3pre1 &lt; 2.3
2.3pre3 &lt; 2.3pre12
2.3a &lt; 2.3c
2.3pre1 &lt; 2.3c
2.3pre1 &lt; 2.3q
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="utilities"><a class="header" href="#utilities">Utilities</a></h1>
<p>This section lists utilities that you can use when you work with Nix.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-35"><a class="header" href="#name-35">Name</a></h1>
<p><code>nix-channel</code> - manage Nix channels</p>
<h1 id="synopsis-35"><a class="header" href="#synopsis-35">Synopsis</a></h1>
<p><code>nix-channel</code> {<code>--add</code> url [<em>name</em>] | <code>--remove</code> <em>name</em> | <code>--list</code> | <code>--update</code> [<em>names…</em>] | <code>--list-generations</code> | <code>--rollback</code> [<em>generation</em>] }</p>
<h1 id="description-35"><a class="header" href="#description-35">Description</a></h1>
<p>Channels are a mechanism for referencing remote Nix expressions and conveniently retrieving their latest version.</p>
<p>The moving parts of channels are:</p>
<ul>
<li>The official channels listed at <a href="https://nixos.org/channels">https://nixos.org/channels</a></li>
<li>The user-specific list of <a href="command-ref/nix-channel.html#subscribed-channels">subscribed channels</a></li>
<li>The <a href="command-ref/nix-channel.html#channels">downloaded channel contents</a></li>
<li>The <a href="command-ref/../command-ref/conf-file.html#conf-nix-path">Nix expression search path</a>, set with the <a href="command-ref/nix-channel.html#opt-i"><code>-I</code> option</a> or the <a href="command-ref/nix-channel.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a></li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>The state of a subscribed channel is external to the Nix expressions relying on it.
This may limit reproducibility.</p>
<p>Dependencies on other Nix expressions can be declared explicitly with:</p>
<ul>
<li><a href="command-ref/../language/builtins.html#builtins-fetchurl"><code>fetchurl</code></a>, <a href="command-ref/../language/builtins.html#builtins-fetchTarball"><code>fetchTarball</code></a>, or <a href="command-ref/../language/builtins.html#builtins-fetchGit"><code>fetchGit</code></a> in Nix expressions</li>
<li>the <a href="command-ref/../command-ref/opt-common.html#opt-I"><code>-I</code> option</a> in command line invocations</li>
</ul>
</blockquote>
<p>This command has the following operations:</p>
<ul>
<li>
<p><code>--add</code> <em>url</em> [<em>name</em>]</p>
<p>Add a channel <em>name</em> located at <em>url</em> to the list of subscribed channels.
If <em>name</em> is omitted, default to the last component of <em>url</em>, with the suffixes <code>-stable</code> or <code>-unstable</code> removed.</p>
<blockquote>
<p><strong>Note</strong></p>
<p><code>--add</code> does not automatically perform an update.
Use <code>--update</code> explicitly.</p>
</blockquote>
<p>A channel URL must point to a directory containing a file <code>nixexprs.tar.gz</code>.
At the top level, that tarball must contain a single directory with a <code>default.nix</code> file that serves as the channel’s entry point.</p>
</li>
<li>
<p><code>--remove</code> <em>name</em></p>
<p>Remove the channel <em>name</em> from the list of subscribed channels.</p>
</li>
<li>
<p><code>--list</code></p>
<p>Print the names and URLs of all subscribed channels on standard output.</p>
</li>
<li>
<p><code>--update</code> [<em>names</em>…]</p>
<p>Download the Nix expressions of subscribed channels and create a new generation.
Update all channels if none is specified, and only those included in <em>names</em> otherwise.</p>
</li>
<li>
<p><code>--list-generations</code></p>
<p>Prints a list of all the current existing generations for the
channel profile.</p>
<p>Works the same way as</p>
<pre><code>nix-env --profile /nix/var/nix/profiles/per-user/$USER/channels --list-generations
</code></pre>
</li>
<li>
<p><code>--rollback</code> [<em>generation</em>]</p>
<p>Revert channels to the state before the last call to <code>nix-channel --update</code>.
Optionally, you can specify a specific channel <em>generation</em> number to restore.</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-33"><a class="header" href="#common-options-33">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-channel.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-channel.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-channel.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-channel.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-channel.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-channel.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-channel.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-channel.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-channel.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-channel.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-channel.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-channel.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-channel.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-channel.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-channel.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-channel.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-channel.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-channel.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-channel.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-channel.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-channel.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-channel.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-channel.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-channel.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-channel.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-33"><a class="header" href="#common-environment-variables-33">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-channel.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-channel.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-channel.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-channel.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-channel.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-channel.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-channel.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-channel.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-channel.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-channel.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-channel.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-channel.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-channel.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-channel.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-channel.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-channel.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-33"><a class="header" href="#xdg-base-directories-33">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-channel.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-channel.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-channel.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-channel.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-channel.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-channel.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="files-1"><a class="header" href="#files-1">Files</a></h1>
<p><code>nix-channel</code> operates on the following files.</p>
<h2 id="channels"><a class="header" href="#channels">Channels</a></h2>
<p>A directory containing symlinks to Nix channels, managed by <a href="command-ref/../command-ref/nix-channel.html"><code>nix-channel</code></a>:</p>
<ul>
<li><code>$XDG_STATE_HOME/nix/profiles/channels</code> for regular users</li>
<li><code>$NIX_STATE_DIR/profiles/per-user/root/channels</code> for <code>root</code></li>
</ul>
<p><a href="command-ref/../command-ref/nix-channel.html"><code>nix-channel</code></a> uses a <a href="command-ref/../command-ref/files/profiles.html">profile</a> to store channels.
This profile contains symlinks to the contents of those channels.</p>
<h2 id="subscribed-channels"><a class="header" href="#subscribed-channels">Subscribed channels</a></h2>
<p>The list of subscribed channels is stored in</p>
<ul>
<li><code>~/.nix-channels</code></li>
<li><code>$XDG_STATE_HOME/nix/channels</code> if <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is set to <code>true</code></li>
</ul>
<p>in the following format:</p>
<pre><code>&lt;url&gt; &lt;name&gt;
...
</code></pre>
<h1 id="examples-21"><a class="header" href="#examples-21">Examples</a></h1>
<p>Subscribe to the Nixpkgs channel and run <code>hello</code> from the GNU Hello package:</p>
<pre><code class="language-console">$ nix-channel --add https://nixos.org/channels/nixpkgs-unstable
$ nix-channel --list
nixpkgs https://nixos.org/channels/nixpkgs
$ nix-channel --update
$ nix-shell -p hello --run hello
hello
</code></pre>
<p>Revert channel updates using <code>--rollback</code>:</p>
<pre><code class="language-console">$ nix-instantiate --eval '&lt;nixpkgs&gt;' --attr lib.version
"22.11pre296212.530a53dcbc9"

$ nix-channel --rollback
switching from generation 483 to 482

$ nix-instantiate --eval '&lt;nixpkgs&gt;' --attr lib.version
"22.11pre281526.d0419badfad"
</code></pre>
<p>Remove a channel:</p>
<pre><code class="language-console">$ nix-channel --remove nixpkgs
$ nix-channel --list
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-36"><a class="header" href="#name-36">Name</a></h1>
<p><code>nix-collect-garbage</code> - delete unreachable <a href="command-ref/../store/store-object.html">store objects</a></p>
<h1 id="synopsis-36"><a class="header" href="#synopsis-36">Synopsis</a></h1>
<p><code>nix-collect-garbage</code> [<code>--delete-old</code>] [<code>-d</code>] [<code>--delete-older-than</code> <em>period</em>] [<code>--max-freed</code> <em>bytes</em>] [<code>--dry-run</code>]</p>
<h1 id="description-36"><a class="header" href="#description-36">Description</a></h1>
<p>The command <code>nix-collect-garbage</code> is mostly an alias of <a href="command-ref/../command-ref/nix-store/gc.html"><code>nix-store --gc</code></a>.
That is, it deletes all unreachable <a href="command-ref/../store/store-object.html">store objects</a> in the Nix store to clean up your system.</p>
<p>However, it provides two additional options,
<a href="command-ref/nix-collect-garbage.html#opt-delete-old"><code>--delete-old</code></a> and <a href="command-ref/nix-collect-garbage.html#opt-delete-older-than"><code>--delete-older-than</code></a>,
which also delete old <a href="command-ref/../command-ref/files/profiles.html">profiles</a>, allowing potentially more <a href="command-ref/../store/store-object.html">store objects</a> to be deleted because profiles are also garbage collection roots.
These options are the equivalent of running
<a href="command-ref/../command-ref/nix-env/delete-generations.html"><code>nix-env --delete-generations</code></a>
with various augments on multiple profiles,
prior to running <code>nix-collect-garbage</code> (or just <code>nix-store --gc</code>) without any flags.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>Deleting previous configurations makes rollbacks to them impossible.</p>
</blockquote>
<p>These flags should be used with care, because they potentially delete generations of profiles used by other users on the system.</p>
<h2 id="locations-searched-for-profiles"><a class="header" href="#locations-searched-for-profiles">Locations searched for profiles</a></h2>
<p><code>nix-collect-garbage</code> cannot know about all profiles; that information doesn't exist.
Instead, it looks in a few locations, and acts on all profiles it finds there:</p>
<ol>
<li>
<p>The default profile locations as specified in the <a href="command-ref/../command-ref/files/profiles.html">profiles</a> section of the manual.</p>
</li>
<li>
<blockquote>
<p><strong>NOTE</strong></p>
<p>Not stable; subject to change</p>
<p>Do not rely on this functionality; it just exists for migration purposes and may change in the future.
These deprecated paths remain a private implementation detail of Nix.</p>
</blockquote>
<p><code>$NIX_STATE_DIR/profiles</code> and <code>$NIX_STATE_DIR/profiles/per-user</code>.</p>
<p>With the exception of <code>$NIX_STATE_DIR/profiles/per-user/root</code> and <code>$NIX_STATE_DIR/profiles/default</code>, these directories are no longer used by other commands.
<code>nix-collect-garbage</code> looks there anyways in order to clean up profiles from older versions of Nix.</p>
</li>
</ol>
<h1 id="options-34"><a class="header" href="#options-34">Options</a></h1>
<p>These options are for deleting old <a href="command-ref/../command-ref/files/profiles.html">profiles</a> prior to deleting unreachable <a href="command-ref/../store/store-object.html">store objects</a>.</p>
<ul>
<li>
<p><span id="opt-delete-old"><a href="command-ref/nix-collect-garbage.html#opt-delete-old"><code>--delete-old</code></a></span> / <code>-d</code></p>
<p>Delete all old generations of profiles.</p>
<p>This is the equivalent of invoking <a href="command-ref/../command-ref/nix-env/delete-generations.html#generations-old"><code>nix-env --delete-generations old</code></a> on each found profile.</p>
</li>
<li>
<p><span id="opt-delete-older-than"><a href="command-ref/nix-collect-garbage.html#opt-delete-older-than"><code>--delete-older-than</code></a></span> <em>period</em></p>
<p>Delete all generations of profiles older than the specified amount (except for the generations that were active at that point in time).
<em>period</em> is a value such as <code>30d</code>, which would mean 30 days.</p>
<p>This is the equivalent of invoking <a href="command-ref/../command-ref/nix-env/delete-generations.html#generations-time"><code>nix-env --delete-generations &lt;period&gt;</code></a> on each found profile.
See the documentation of that command for additional information about the <em>period</em> argument.</p>
<ul>
<li><span id="opt-max-freed"><a href="command-ref/nix-collect-garbage.html#opt-max-freed"><code>--max-freed</code></a></span> <em>bytes</em></li>
</ul>
</li>
</ul>
<!-- duplication from https://github.com/NixOS/nix/blob/442a2623e48357ff72c77bb11cf2cf06d94d2f90/doc/manual/source/command-ref/nix-store/gc.md?plain=1#L39-L44 -->
<p>Keep deleting paths until at least <em>bytes</em> bytes have been deleted,
then stop. The argument <em>bytes</em> can be followed by the
multiplicative suffix <code>K</code>, <code>M</code>, <code>G</code> or <code>T</code>, denoting KiB, MiB, GiB
or TiB units.</p>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-34"><a class="header" href="#common-options-34">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-collect-garbage.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-collect-garbage.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-collect-garbage.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-collect-garbage.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-collect-garbage.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-collect-garbage.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-collect-garbage.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-collect-garbage.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-collect-garbage.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-collect-garbage.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-collect-garbage.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-collect-garbage.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-collect-garbage.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-collect-garbage.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-collect-garbage.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-collect-garbage.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-collect-garbage.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-collect-garbage.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-collect-garbage.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-collect-garbage.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-collect-garbage.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-collect-garbage.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-collect-garbage.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-collect-garbage.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-collect-garbage.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-34"><a class="header" href="#common-environment-variables-34">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-collect-garbage.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-collect-garbage.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-collect-garbage.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-collect-garbage.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-collect-garbage.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-collect-garbage.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-collect-garbage.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-collect-garbage.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-collect-garbage.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-collect-garbage.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-collect-garbage.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-collect-garbage.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-collect-garbage.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-collect-garbage.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-collect-garbage.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-collect-garbage.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-34"><a class="header" href="#xdg-base-directories-34">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-collect-garbage.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-collect-garbage.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-collect-garbage.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-collect-garbage.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-collect-garbage.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-collect-garbage.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="example-9"><a class="header" href="#example-9">Example</a></h1>
<p>To delete from the Nix store everything that is not used by the current
generations of each profile, do</p>
<pre><code class="language-console">$ nix-collect-garbage -d
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-37"><a class="header" href="#name-37">Name</a></h1>
<p><code>nix-copy-closure</code> - copy store objects to or from a remote machine via SSH</p>
<h1 id="synopsis-37"><a class="header" href="#synopsis-37">Synopsis</a></h1>
<p><code>nix-copy-closure</code>
[<code>--to</code> | <code>--from</code> ]
[<code>--gzip</code>]
[<code>--include-outputs</code>]
[<code>--use-substitutes</code> | <code>-s</code>]
[<code>-v</code>]
[<em>user</em>@]<em>machine</em>[:<em>port</em>] <em>paths</em></p>
<h1 id="description-37"><a class="header" href="#description-37">Description</a></h1>
<p>Given <em>paths</em> from one machine, <code>nix-copy-closure</code> computes the <a href="command-ref/../glossary.html#gloss-closure">closure</a> of those paths (i.e. all their dependencies in the Nix store), and copies <a href="command-ref/../glossary.html#gloss-store-object">store objects</a> in that closure to another machine via SSH.
It doesn’t copy store objects that are already present on the other machine.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>While the Nix store to use on the local machine can be specified on the command line with the <a href="command-ref/../command-ref/conf-file.html#conf-store"><code>--store</code></a> option, the Nix store to be accessed on the remote machine can only be <a href="command-ref/../command-ref/conf-file.html#configuration-file">configured statically</a> on that remote machine.</p>
</blockquote>
<p>Since <code>nix-copy-closure</code> calls <code>ssh</code>, you may need to authenticate with the remote machine.
In fact, you may be asked for authentication <em>twice</em> because <code>nix-copy-closure</code> currently connects twice to the remote machine: first to get the set of paths missing on the target machine, and second to send the dump of those paths.
When using public key authentication, you can avoid typing the passphrase with <code>ssh-agent</code>.</p>
<h1 id="options-35"><a class="header" href="#options-35">Options</a></h1>
<ul>
<li>
<p><code>--to</code></p>
<p>Copy the closure of <em>paths</em> from a Nix store accessible from the local machine to the Nix store on the remote <em>machine</em>.
This is the default behavior.</p>
</li>
<li>
<p><code>--from</code></p>
<p>Copy the closure of <em>paths</em> from the Nix store on the remote <em>machine</em> to the local machine's specified Nix store.</p>
</li>
<li>
<p><code>--gzip</code></p>
<p>Enable compression of the SSH connection.</p>
</li>
<li>
<p><code>--include-outputs</code></p>
<p>Also copy the outputs of <a href="command-ref/../glossary.html#gloss-store-derivation">store derivation</a>s included in the closure.</p>
</li>
<li>
<p><code>--use-substitutes</code> / <code>-s</code></p>
<p>Attempt to download missing store objects on the target from <a href="command-ref/../command-ref/conf-file.html#conf-substituters">substituters</a>.
Any store objects that cannot be substituted on the target are still copied normally from the source.
This is useful, for instance, if the connection between the source and target machine is slow, but the connection between the target machine and <code>cache.nixos.org</code> (the default binary cache server) is fast.</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-35"><a class="header" href="#common-options-35">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-copy-closure.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-copy-closure.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-copy-closure.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-copy-closure.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-copy-closure.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-copy-closure.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-copy-closure.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-copy-closure.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-copy-closure.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-copy-closure.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-copy-closure.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-copy-closure.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-copy-closure.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-copy-closure.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-copy-closure.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-copy-closure.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-copy-closure.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-copy-closure.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-copy-closure.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-copy-closure.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-copy-closure.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-copy-closure.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-copy-closure.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-copy-closure.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-copy-closure.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="environment-variables-12"><a class="header" href="#environment-variables-12">Environment variables</a></h1>
<ul>
<li>
<p><code>NIX_SSHOPTS</code></p>
<p>Additional options to be passed to <code>ssh</code> on the command line.</p>
</li>
</ul>
<h1 id="common-environment-variables-35"><a class="header" href="#common-environment-variables-35">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-copy-closure.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-copy-closure.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-copy-closure.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-copy-closure.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-copy-closure.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-copy-closure.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-copy-closure.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-copy-closure.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-copy-closure.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-copy-closure.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-copy-closure.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-copy-closure.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-copy-closure.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-copy-closure.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-copy-closure.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-copy-closure.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-35"><a class="header" href="#xdg-base-directories-35">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-copy-closure.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-copy-closure.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-copy-closure.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-copy-closure.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-copy-closure.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-copy-closure.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-22"><a class="header" href="#examples-22">Examples</a></h1>
<blockquote>
<p><strong>Example</strong></p>
<p>Copy GNU Hello with all its dependencies to a remote machine:</p>
<pre><code class="language-shell-session">$ storePath="$(nix-build '&lt;nixpkgs&gt;' -I nixpkgs=channel:nixpkgs-unstable -A hello --no-out-link)"
$ nix-copy-closure --to alice@itchy.example.org "$storePath"
copying 5 paths...
copying path '/nix/store/nrwkk6ak3rgkrxbqhsscb01jpzmslf2r-xgcc-13.2.0-libgcc' to 'ssh://alice@itchy.example.org'...
copying path '/nix/store/gm61h1y42pqyl6178g90x8zm22n6pyy5-libunistring-1.1' to 'ssh://alice@itchy.example.org'...
copying path '/nix/store/ddfzjdykw67s20c35i7a6624by3iz5jv-libidn2-2.3.7' to 'ssh://alice@itchy.example.org'...
copying path '/nix/store/apab5i73dqa09wx0q27b6fbhd1r18ihl-glibc-2.39-31' to 'ssh://alice@itchy.example.org'...
copying path '/nix/store/g1n2vryg06amvcc1avb2mcq36faly0mh-hello-2.12.1' to 'ssh://alice@itchy.example.org'...
</code></pre>
</blockquote>
<blockquote>
<p><strong>Example</strong></p>
<p>Copy GNU Hello from a remote machine using a known store path, and run it:</p>
<pre><code class="language-shell-session">$ storePath="$(nix-instantiate --eval --raw '&lt;nixpkgs&gt;' -I nixpkgs=channel:nixpkgs-unstable -A hello.outPath)"
$ nix-copy-closure --from alice@itchy.example.org "$storePath"
$ "$storePath"/bin/hello
Hello, world!
</code></pre>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-38"><a class="header" href="#name-38">Name</a></h1>
<p><code>nix-daemon</code> - Nix multi-user support daemon</p>
<h1 id="synopsis-38"><a class="header" href="#synopsis-38">Synopsis</a></h1>
<p><code>nix-daemon</code></p>
<h1 id="description-38"><a class="header" href="#description-38">Description</a></h1>
<p>The Nix daemon is necessary in multi-user Nix installations. It runs
build tasks and other operations on the Nix store on behalf of
unprivileged users.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-39"><a class="header" href="#name-39">Name</a></h1>
<p><code>nix-hash</code> - compute the cryptographic hash of a path</p>
<h1 id="synopsis-39"><a class="header" href="#synopsis-39">Synopsis</a></h1>
<p><code>nix-hash</code> [<code>--flat</code>] [<code>--base32</code>] [<code>--truncate</code>] [<code>--type</code> <em>hashAlgo</em>] <em>path…</em></p>
<p><code>nix-hash</code> [<code>--to-base16</code>|<code>--to-base32</code>|<code>--to-base64</code>|<code>--to-sri</code>] [<code>--type</code> <em>hashAlgo</em>] <em>hash…</em></p>
<h1 id="description-39"><a class="header" href="#description-39">Description</a></h1>
<p>The command <code>nix-hash</code> computes the cryptographic hash of the contents
of each <em>path</em> and prints it on standard output. By default, it computes
an MD5 hash, but other hash algorithms are available as well. The hash
is printed in hexadecimal. To generate the same hash as
<code>nix-prefetch-url</code> you have to specify multiple arguments, see below for
an example.</p>
<p>The hash is computed over a <em>serialisation</em> of each path: a dump of
the file system tree rooted at the path. This allows directories and
symlinks to be hashed as well as regular files. The dump is in the
<em><a href="command-ref/../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive (NAR)</a> format</em> produced by <a href="command-ref/../command-ref/nix-store/dump.html"><code>nix-store --dump</code></a>.  Thus, <code>nix-hash path</code>
yields the same cryptographic hash as <code>nix-store --dump path | md5sum</code>.</p>
<h1 id="options-36"><a class="header" href="#options-36">Options</a></h1>
<ul>
<li>
<p><code>--flat</code></p>
<p>Print the cryptographic hash of the contents of each regular file <em>path</em>.
That is, instead of computing
the hash of the <a href="command-ref/../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive (NAR)</a> of <em>path</em>,
just [directly hash]((../store/file-system-object/content-address.md#serial-flat) <em>path</em> as is.
This requires <em>path</em> to resolve to a regular file rather than directory.
The result is identical to that produced by the GNU commands
<code>md5sum</code> and <code>sha1sum</code>.</p>
</li>
<li>
<p><code>--base16</code></p>
<p>Print the hash in a hexadecimal representation (default).</p>
</li>
<li>
<p><code>--base32</code></p>
<p>Print the hash in a base-32 representation rather than hexadecimal.
This base-32 representation is more compact and can be used in Nix
expressions (such as in calls to <code>fetchurl</code>).</p>
</li>
<li>
<p><code>--base64</code></p>
<p>Similar to --base32, but print the hash in a base-64 representation,
which is more compact than the base-32 one.</p>
</li>
<li>
<p><code>--sri</code></p>
<p>Print the hash in SRI format with base-64 encoding.
The type of hash algorithm will be prepended to the hash string,
followed by a hyphen (-) and the base-64 hash body.</p>
</li>
<li>
<p><code>--truncate</code></p>
<p>Truncate hashes longer than 160 bits (such as SHA-256) to 160 bits.</p>
</li>
<li>
<p><code>--type</code> <em>hashAlgo</em></p>
<p>Use the specified cryptographic hash algorithm, which can be one of
<code>blake3</code>, <code>md5</code>, <code>sha1</code>, <code>sha256</code>, and <code>sha512</code>.</p>
</li>
<li>
<p><code>--to-base16</code></p>
<p>Don’t hash anything, but convert the base-32 hash representation
<em>hash</em> to hexadecimal.</p>
</li>
<li>
<p><code>--to-base32</code></p>
<p>Don’t hash anything, but convert the hexadecimal hash representation
<em>hash</em> to base-32.</p>
</li>
<li>
<p><code>--to-base64</code></p>
<p>Don’t hash anything, but convert the hexadecimal hash representation
<em>hash</em> to base-64.</p>
</li>
<li>
<p><code>--to-sri</code></p>
<p>Don’t hash anything, but convert the hexadecimal hash representation
<em>hash</em> to SRI.</p>
</li>
</ul>
<h1 id="examples-23"><a class="header" href="#examples-23">Examples</a></h1>
<p>Computing the same hash as <code>nix-prefetch-url</code>:</p>
<pre><code class="language-console">$ nix-prefetch-url file://&lt;(echo test)
1lkgqb6fclns49861dwk9rzb6xnfkxbpws74mxnx01z9qyv1pjpj
$ nix-hash --type sha256 --flat --base32 &lt;(echo test)
1lkgqb6fclns49861dwk9rzb6xnfkxbpws74mxnx01z9qyv1pjpj
</code></pre>
<p>Computing hashes:</p>
<pre><code class="language-console">$ mkdir test
$ echo "hello" &gt; test/world

$ nix-hash test/ (MD5 hash; default)
8179d3caeff1869b5ba1744e5a245c04

$ nix-store --dump test/ | md5sum (for comparison)
8179d3caeff1869b5ba1744e5a245c04  -

$ nix-hash --type sha1 test/
e4fd8ba5f7bbeaea5ace89fe10255536cd60dab6

$ nix-hash --type sha1 --base16 test/
e4fd8ba5f7bbeaea5ace89fe10255536cd60dab6

$ nix-hash --type sha1 --base32 test/
nvd61k9nalji1zl9rrdfmsmvyyjqpzg4

$ nix-hash --type sha1 --base64 test/
5P2Lpfe76upazon+ECVVNs1g2rY=

$ nix-hash --type sha1 --sri test/
sha1-5P2Lpfe76upazon+ECVVNs1g2rY=

$ nix-hash --type sha256 --flat test/
error: reading file `test/': Is a directory

$ nix-hash --type sha256 --flat test/world
5891b5b522d5df086d0ff0b110fbd9d21bb4fc7163af34d08286a2e846f6be03
</code></pre>
<p>Converting between hexadecimal, base-32, base-64, and SRI:</p>
<pre><code class="language-console">$ nix-hash --type sha1 --to-base32 e4fd8ba5f7bbeaea5ace89fe10255536cd60dab6
nvd61k9nalji1zl9rrdfmsmvyyjqpzg4

$ nix-hash --type sha1 --to-base16 nvd61k9nalji1zl9rrdfmsmvyyjqpzg4
e4fd8ba5f7bbeaea5ace89fe10255536cd60dab6

$ nix-hash --type sha1 --to-base64 e4fd8ba5f7bbeaea5ace89fe10255536cd60dab6
5P2Lpfe76upazon+ECVVNs1g2rY=

$ nix-hash --type sha1 --to-sri nvd61k9nalji1zl9rrdfmsmvyyjqpzg4
sha1-5P2Lpfe76upazon+ECVVNs1g2rY=

$ nix-hash --to-base16 sha1-5P2Lpfe76upazon+ECVVNs1g2rY=
e4fd8ba5f7bbeaea5ace89fe10255536cd60dab6
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-40"><a class="header" href="#name-40">Name</a></h1>
<p><code>nix-instantiate</code> - instantiate store derivations from Nix expressions</p>
<h1 id="synopsis-40"><a class="header" href="#synopsis-40">Synopsis</a></h1>
<p><code>nix-instantiate</code>
[<code>--parse</code> | <code>--eval</code> [<code>--strict</code>] [<code>--raw</code> | <code>--json</code> | <code>--xml</code>] ]
[<code>--read-write-mode</code>]
[<code>--arg</code> <em>name</em> <em>value</em>]
[{<code>--attr</code>| <code>-A</code>} <em>attrPath</em>]
[<code>--add-root</code> <em>path</em>]
[<code>--expr</code> | <code>-E</code>]
<em>files…</em></p>
<p><code>nix-instantiate</code> <code>--find-file</code> <em>files…</em></p>
<h1 id="description-40"><a class="header" href="#description-40">Description</a></h1>
<p>The command <code>nix-instantiate</code> produces <a href="command-ref/../glossary.html#gloss-store-derivation">store derivation</a>s from (high-level) Nix expressions.
It evaluates the Nix expressions in each of <em>files</em> (which defaults to
<em>./default.nix</em>). Each top-level expression should evaluate to a
derivation, a list of derivations, or a set of derivations. The paths
of the resulting store derivations are printed on standard output.</p>
<p>If <em>files</em> is the character <code>-</code>, then a Nix expression will be read from
standard input.</p>
<h1 id="options-37"><a class="header" href="#options-37">Options</a></h1>
<ul>
<li>
<p><code>--add-root</code> <em>path</em></p>
<p>See the <a href="command-ref/nix-store.html">corresponding option</a> in <code>nix-store</code>.</p>
</li>
<li>
<p><code>--parse</code></p>
<p>Just parse the input files, and print their abstract syntax trees on
standard output as a Nix expression.</p>
</li>
<li>
<p><code>--eval</code></p>
<p>Just parse and evaluate the input files, and print the resulting
values on standard output.
Store derivations are not serialized and written to the store, but instead just hashed and discarded.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This option produces output which can be parsed as a Nix expression which
will produce a different result than the input expression when evaluated.
For example, these two Nix expressions print the same result despite
having different meaning:</p>
<pre><code class="language-console">$ nix-instantiate --eval --expr '{ a = {}; }'
{ a = &lt;CODE&gt;; }
$ nix-instantiate --eval --expr '{ a = &lt;CODE&gt;; }'
{ a = &lt;CODE&gt;; }
</code></pre>
<p>For human-readable output, <code>nix eval</code> (experimental) is more informative:</p>
<pre><code class="language-console">$ nix-instantiate --eval --expr 'a: a'
&lt;LAMBDA&gt;
$ nix eval --expr 'a: a'
«lambda @ «string»:1:1»
</code></pre>
<p>For machine-readable output, the <code>--xml</code> option produces unambiguous
output:</p>
<pre><code class="language-console">$ nix-instantiate --eval --xml --expr '{ foo = &lt;CODE&gt;; }'
&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;expr&gt;
  &lt;attrs&gt;
    &lt;attr column="3" line="1" name="foo"&gt;
      &lt;unevaluated /&gt;
    &lt;/attr&gt;
  &lt;/attrs&gt;
&lt;/expr&gt;
</code></pre>
</blockquote>
</li>
<li>
<p><code>--find-file</code></p>
<p>Look up the given files in Nix’s search path (as specified by the
<code>NIX_PATH</code> environment variable). If found, print the corresponding
absolute paths on standard output. For instance, if <code>NIX_PATH</code> is
<code>nixpkgs=/home/alice/nixpkgs</code>, then <code>nix-instantiate --find-file nixpkgs/default.nix</code> will print <code>/home/alice/nixpkgs/default.nix</code>.</p>
</li>
<li>
<p><code>--strict</code></p>
<p>When used with <code>--eval</code>, recursively evaluate list elements and
attributes. Normally, such sub-expressions are left unevaluated
(since the Nix language is lazy).</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This option can cause non-termination, because lazy data
structures can be infinitely large.</p>
</blockquote>
</li>
<li>
<p><code>--raw</code></p>
<p>When used with <code>--eval</code>, the evaluation result must be a string,
which is printed verbatim, without quoting, escaping or trailing newline.</p>
</li>
<li>
<p><code>--json</code></p>
<p>When used with <code>--eval</code>, print the resulting value as an JSON
representation of the abstract syntax tree rather than as a Nix expression.</p>
</li>
<li>
<p><code>--xml</code></p>
<p>When used with <code>--eval</code>, print the resulting value as an XML
representation of the abstract syntax tree rather than as a Nix expression.
The schema is the same as that used by the <a href="command-ref/../language/builtins.html"><code>toXML</code>
built-in</a>.</p>
</li>
<li>
<p><code>--read-write-mode</code></p>
<p>When used with <code>--eval</code>, perform evaluation in read/write mode so
nix language features that require it will still work (at the cost
of needing to do instantiation of every evaluated derivation). If
this option is not enabled, there may be uninstantiated store paths
in the final output.</p>
</li>
</ul>
<!-- Some of the options documented here are hardcopied from
     src/libcmd/common-eval-args.cc
-->
<h1 id="common-options-36"><a class="header" href="#common-options-36">Common Options</a></h1>
<p>Most Nix commands accept the following command-line options:</p>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/nix-instantiate.html#opt-help"><code>--help</code></a></span></p>
<p>Prints out a summary of the command syntax and exits.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/nix-instantiate.html#opt-version"><code>--version</code></a></span></p>
<p>Prints out the Nix version number on standard output and exits.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/nix-instantiate.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increases the level of verbosity of diagnostic messages printed on standard error.
For each Nix operation, the information printed on standard output is well-defined;
any diagnostic information is printed on standard error, never on standard output.</p>
<p>This option may be specified repeatedly.
Currently, the following verbosity levels exist:</p>
<ul>
<li>
<p><code>0</code> “Errors only”</p>
<p>Only print messages explaining why the Nix invocation failed.</p>
</li>
<li>
<p><code>1</code> “Informational”</p>
<p>Print <em>useful</em> messages about what Nix is doing.
This is the default.</p>
</li>
<li>
<p><code>2</code> “Talkative”</p>
<p>Print more informational messages.</p>
</li>
<li>
<p><code>3</code> “Chatty”</p>
<p>Print even more informational messages.</p>
</li>
<li>
<p><code>4</code> “Debug”</p>
<p>Print debug information.</p>
</li>
<li>
<p><code>5</code> “Vomit”</p>
<p>Print vast amounts of debug information.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/nix-instantiate.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decreases the level of verbosity of diagnostic messages printed on standard error.
This is the inverse option to <code>-v</code> / <code>--verbose</code>.</p>
<p>This option may be specified repeatedly.
See the previous verbosity levels list.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/nix-instantiate.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>This option can be used to change the output of the log format, with <em>format</em> being one of:</p>
<ul>
<li>
<p><code>raw</code></p>
<p>This is the raw format, as outputted by nix-build.</p>
</li>
<li>
<p><code>internal-json</code></p>
<p>Outputs the logs in a structured manner.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>While the schema itself is relatively stable, the format of
the error-messages (namely of the <code>msg</code>-field) can change
between releases.</p>
</blockquote>
</li>
<li>
<p><code>bar</code></p>
<p>Only display a progress bar during the builds.</p>
</li>
<li>
<p><code>bar-with-logs</code></p>
<p>Display the raw logs, with the progress bar at the bottom.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-no-build-output"><a href="command-ref/nix-instantiate.html#opt-no-build-output"><code>--no-build-output</code></a></span> / <code>-Q</code></p>
<p>By default, output written by builders to standard output and standard error is echoed to the Nix command's standard error.
This option suppresses this behaviour.
Note that the builder's standard output and error are always written to a log file in <code>prefix/nix/var/log/nix</code>.</p>
</li>
<li>
<p><span id="opt-max-jobs"><a href="command-ref/nix-instantiate.html#opt-max-jobs"><code>--max-jobs</code></a></span> / <code>-j</code> <em>number</em></p>
<p>Sets the maximum number of build jobs that Nix will perform in parallel to the specified number.
Specify <code>auto</code> to use the number of CPUs in the system.
The default is specified by the <code>max-jobs</code> configuration setting, which itself defaults to <code>1</code>.
A higher value is useful on SMP systems or to exploit I/O latency.</p>
<p>Setting it to <code>0</code> disallows building on the local machine, which is useful when you want builds to happen only on remote builders.</p>
</li>
<li>
<p><span id="opt-cores"><a href="command-ref/nix-instantiate.html#opt-cores"><code>--cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the invocation of builders.
Builders can use this variable at their discretion to control the maximum amount of parallelism.
For instance, in Nixpkgs, if the derivation attribute <code>enableParallelBuilding</code> is set to <code>true</code>, the builder passes the <code>-jN</code> flag to GNU Make.
It defaults to the value of the <code>cores</code> configuration setting, if set, or <code>1</code> otherwise.
The value <code>0</code> means that the builder should use all available CPU cores in the system.</p>
</li>
<li>
<p><span id="opt-max-silent-time"><a href="command-ref/nix-instantiate.html#opt-max-silent-time"><code>--max-silent-time</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can go without producing any data on standard output or standard error.
The default is specified by the <code>max-silent-time</code> configuration setting.
<code>0</code> means no time-out.</p>
</li>
<li>
<p><span id="opt-timeout"><a href="command-ref/nix-instantiate.html#opt-timeout"><code>--timeout</code></a></span></p>
<p>Sets the maximum number of seconds that a builder can run.
The default is specified by the <code>timeout</code> configuration setting.
<code>0</code> means no timeout.</p>
</li>
<li>
<p><span id="opt-keep-going"><a href="command-ref/nix-instantiate.html#opt-keep-going"><code>--keep-going</code></a></span> / <code>-k</code></p>
<p>Keep going in case of failed builds, to the greatest extent possible.
That is, if building an input of some derivation fails, Nix will still build the other inputs, but not the derivation itself.
Without this option, Nix stops if any build fails (except for builds of substitutes), possibly killing builds in progress (in case of parallel or distributed builds).</p>
</li>
<li>
<p><span id="opt-keep-failed"><a href="command-ref/nix-instantiate.html#opt-keep-failed"><code>--keep-failed</code></a></span> / <code>-K</code></p>
<p>Specifies that in case of a build failure, the temporary directory (usually in <code>/tmp</code>) in which the build takes place should not be deleted.
The path of the build directory is printed as an informational message.</p>
</li>
<li>
<p><span id="opt-fallback"><a href="command-ref/nix-instantiate.html#opt-fallback"><code>--fallback</code></a></span></p>
<p>Whenever Nix attempts to build a derivation for which substitutes are known for each output path, but realising the output paths through the substitutes fails, fall back on building the derivation.</p>
<p>The most common scenario in which this is useful is when we have registered substitutes in order to perform binary distribution from, say, a network repository.
If the repository is down, the realisation of the derivation will fail.
When this option is specified, Nix will build the derivation instead.
Thus, installation from binaries falls back on installation from source.
This option is not the default since it is generally not desirable for a transient failure in obtaining the substitutes to lead to a full build from source (with the related consumption of resources).</p>
</li>
<li>
<p><span id="opt-readonly-mode"><a href="command-ref/nix-instantiate.html#opt-readonly-mode"><code>--readonly-mode</code></a></span></p>
<p>When this option is used, no attempt is made to open the Nix database.
Most Nix operations do need database access, so those operations will fail.</p>
</li>
<li>
<p><span id="opt-arg"><a href="command-ref/nix-instantiate.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is accepted by <code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-shell</code> and <code>nix-build</code>.
When evaluating Nix expressions, the expression evaluator will automatically try to call functions that it encounters.
It can automatically call functions for which every argument has a <a href="command-ref/../language/syntax.html#functions">default value</a> (e.g., <code>{ argName ?  defaultValue }: ...</code>).</p>
<p>With <code>--arg</code>, you can also call functions that have arguments without a default value (or override a default value).
That is, if the evaluator encounters a function with an argument named <em>name</em>, it will call it with value <em>value</em>.</p>
<p>For instance, the top-level <code>default.nix</code> in Nixpkgs is actually a function:</p>
<pre><code class="language-nix">{ # The system (e.g., `i686-linux') for which to build the packages.
  system ? builtins.currentSystem
  ...
}: ...
</code></pre>
<p>So if you call this Nix expression (e.g., when you do <code>nix-env --install --attr pkgname</code>), the function will be called automatically using the value <a href="command-ref/../language/builtins.html"><code>builtins.currentSystem</code></a> for the <code>system</code> argument.
You can override this using <code>--arg</code>, e.g., <code>nix-env --install --attr pkgname --arg system \"i686-freebsd\"</code>.
(Note that since the argument is a Nix string literal, you have to escape the quotes.)</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/nix-instantiate.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/nix-instantiate.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/nix-instantiate.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>value</em></p>
<p>This option is like <code>--arg</code>, only the value is not a Nix expression but a string.
So instead of <code>--arg system \"i686-linux\"</code> (the outer quotes are to keep the shell happy) you can say <code>--argstr system i686-linux</code>.</p>
</li>
<li>
<p><span id="opt-attr"><a href="command-ref/nix-instantiate.html#opt-attr"><code>--attr</code></a></span> / <code>-A</code> <em>attrPath</em></p>
<p>Select an attribute from the top-level Nix expression being evaluated.
(<code>nix-env</code>, <code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)
The <em>attribute path</em> <em>attrPath</em> is a sequence of attribute names separated by dots.
For instance, given a top-level Nix expression <em>e</em>, the attribute path <code>xorg.xorgserver</code> would cause the expression <code>e.xorg.xorgserver</code> to be used.
See <a href="command-ref/../command-ref/nix-env/install.html"><code>nix-env --install</code></a> for some concrete examples.</p>
<p>In addition to attribute names, you can also specify array indices.
For instance, the attribute path <code>foo.3.bar</code> selects the <code>bar</code>
attribute of the fourth element of the array in the <code>foo</code> attribute
of the top-level expression.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/nix-instantiate.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/../store/types/index.html#store-url-format">URL to the Nix store</a> to use for evaluation, i.e. where to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/nix-instantiate.html#opt-expr"><code>--expr</code></a></span> / <code>-E</code></p>
<p>Interpret the command line arguments as a list of Nix expressions to be parsed and evaluated, rather than as a list of file names of Nix expressions.
(<code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> only.)</p>
<p>For <code>nix-shell</code>, this option is commonly used to give you a shell in which you can build the packages returned by the expression.
If you want to get a shell which contain the <em>built</em> packages ready for use, give your expression to the <code>nix-shell --packages </code> convenience flag instead.</p>
</li>
<li>
<p><span id="opt-I"><a href="command-ref/nix-instantiate.html#opt-I"><code>-I</code> / <code>--include</code></a></span> <em>path</em></p>
<p>Add an entry to the list of search paths used to resolve <a href="command-ref/../language/constructs/lookup-path.html">lookup paths</a>.
This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/nix-instantiate.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/nix-instantiate.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration option <em>name</em> to <em>value</em>.
This overrides settings in the Nix configuration file (see nix.conf5).</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/nix-instantiate.html#opt-repair"><code>--repair</code></a></span></p>
<p>Fix corrupted or missing store paths by redownloading or rebuilding them.
Note that this is slow because it requires computing a cryptographic hash of the contents of every path in the closure of the build.
Also note the warning under <code>nix-store --repair-path</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<h1 id="common-environment-variables-36"><a class="header" href="#common-environment-variables-36">Common Environment Variables</a></h1>
<p>Most Nix commands interpret the following environment variables:</p>
<ul>
<li>
<p><span id="env-IN_NIX_SHELL"><a href="command-ref/nix-instantiate.html#env-IN_NIX_SHELL"><code>IN_NIX_SHELL</code></a></span></p>
<p>Indicator that tells if the current environment was set up by
<code>nix-shell</code>. It can have the values <code>pure</code> or <code>impure</code>.</p>
</li>
<li>
<p><span id="env-NIX_PATH"><a href="command-ref/nix-instantiate.html#env-NIX_PATH"><code>NIX_PATH</code></a></span></p>
<p>A colon-separated list of search path entries used to resolve <a href="command-ref/../language/constructs/lookup-path.html">lookup paths</a>.</p>
<p>This environment variable overrides the value of the <a href="command-ref/../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a>.</p>
<p>It can be extended using the <a href="command-ref/../command-ref/opt-common.html#opt-I"><code>-I</code> option</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ export NIX_PATH=`/home/eelco/Dev:nixos-config=/etc/nixos
</code></pre>
</blockquote>
<p>If <code>NIX_PATH</code> is set to an empty string, resolving search paths will always fail.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-bash">$ NIX_PATH= nix-instantiate --eval '&lt;nixpkgs&gt;'
error: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)
</code></pre>
</blockquote>
</li>
<li>
<p><span id="env-NIX_IGNORE_SYMLINK_STORE"><a href="command-ref/nix-instantiate.html#env-NIX_IGNORE_SYMLINK_STORE"><code>NIX_IGNORE_SYMLINK_STORE</code></a></span></p>
<p>Normally, the Nix store directory (typically <code>/nix/store</code>) is not
allowed to contain any symlink components. This is to prevent
“impure” builds. Builders sometimes “canonicalise” paths by
resolving all symlink components. Thus, builds on different machines
(with <code>/nix/store</code> resolving to different locations) could yield
different results. This is generally not a problem, except when
builds are deployed to machines where <code>/nix/store</code> resolves
differently. If you are sure that you’re not going to do that, you
can set <code>NIX_IGNORE_SYMLINK_STORE</code> to <code>1</code>.</p>
<p>Note that if you’re symlinking the Nix store so that you can put it
on another file system than the root file system, on Linux you’re
better off using <code>bind</code> mount points, e.g.,</p>
<pre><code class="language-console">$ mkdir /nix
$ mount -o bind /mnt/otherdisk/nix /nix
</code></pre>
<p>Consult the mount 8 manual page for details.</p>
</li>
<li>
<p><span id="env-NIX_STORE_DIR"><a href="command-ref/nix-instantiate.html#env-NIX_STORE_DIR"><code>NIX_STORE_DIR</code></a></span></p>
<p>Overrides the location of the Nix store (default <code>prefix/store</code>).</p>
</li>
<li>
<p><span id="env-NIX_DATA_DIR"><a href="command-ref/nix-instantiate.html#env-NIX_DATA_DIR"><code>NIX_DATA_DIR</code></a></span></p>
<p>Overrides the location of the Nix static data directory (default
<code>prefix/share</code>).</p>
</li>
<li>
<p><span id="env-NIX_LOG_DIR"><a href="command-ref/nix-instantiate.html#env-NIX_LOG_DIR"><code>NIX_LOG_DIR</code></a></span></p>
<p>Overrides the location of the Nix log directory (default
<code>prefix/var/log/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_STATE_DIR"><a href="command-ref/nix-instantiate.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a></span></p>
<p>Overrides the location of the Nix state directory (default
<code>prefix/var/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONF_DIR"><a href="command-ref/nix-instantiate.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a></span></p>
<p>Overrides the location of the system Nix configuration directory
(default <code>prefix/etc/nix</code>).</p>
</li>
<li>
<p><span id="env-NIX_CONFIG"><a href="command-ref/nix-instantiate.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a></span></p>
<p>Applies settings from Nix configuration from the environment.
The content is treated as if it was read from a Nix configuration file.
Settings are separated by the newline character.</p>
</li>
<li>
<p><span id="env-NIX_USER_CONF_FILES"><a href="command-ref/nix-instantiate.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a></span></p>
<p>Overrides the location of the Nix user configuration files to load from.</p>
<p>The default are the locations according to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.
See the <a href="command-ref/nix-instantiate.html#xdg-base-directories">XDG Base Directories</a> sub-section for details.</p>
<p>The variable is treated as a list separated by the <code>:</code> token.</p>
</li>
<li>
<p><span id="env-TMPDIR"><a href="command-ref/nix-instantiate.html#env-TMPDIR"><code>TMPDIR</code></a></span></p>
<p>Use the specified directory to store temporary files. In particular,
this includes temporary build directories; these can take up
substantial amounts of disk space. The default is <code>/tmp</code>.</p>
</li>
<li>
<p><span id="env-NIX_REMOTE"><a href="command-ref/nix-instantiate.html#env-NIX_REMOTE"><code>NIX_REMOTE</code></a></span></p>
<p>This variable should be set to <code>daemon</code> if you want to use the Nix
daemon to execute Nix operations. This is necessary in <a href="command-ref/../installation/multi-user.html">multi-user
Nix installations</a>. If the Nix
daemon's Unix socket is at some non-standard path, this variable
should be set to <code>unix://path/to/socket</code>. Otherwise, it should be
left unset.</p>
</li>
<li>
<p><span id="env-NIX_SHOW_STATS"><a href="command-ref/nix-instantiate.html#env-NIX_SHOW_STATS"><code>NIX_SHOW_STATS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print some evaluation statistics, such as
the number of values allocated.</p>
</li>
<li>
<p><span id="env-NIX_COUNT_CALLS"><a href="command-ref/nix-instantiate.html#env-NIX_COUNT_CALLS"><code>NIX_COUNT_CALLS</code></a></span></p>
<p>If set to <code>1</code>, Nix will print how often functions were called during
Nix expression evaluation. This is useful for profiling your Nix
expressions.</p>
</li>
<li>
<p><span id="env-GC_INITIAL_HEAP_SIZE"><a href="command-ref/nix-instantiate.html#env-GC_INITIAL_HEAP_SIZE"><code>GC_INITIAL_HEAP_SIZE</code></a></span></p>
<p>If Nix has been configured to use the Boehm garbage collector, this
variable sets the initial size of the heap in bytes. It defaults to
384 MiB. Setting it to a low value reduces memory consumption, but
will increase runtime due to the overhead of garbage collection.</p>
</li>
</ul>
<h2 id="xdg-base-directories-36"><a class="header" href="#xdg-base-directories-36">XDG Base Directories</a></h2>
<p>Nix follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
<p>For backwards compatibility, Nix commands will follow the standard only when <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled.
<a href="command-ref/../command-ref/new-cli/nix.html">New Nix commands</a> (experimental) conform to the standard by default.</p>
<p>The following environment variables are used to determine locations of various state and configuration files:</p>
<ul>
<li><a href="command-ref/nix-instantiate.html#env-XDG_CONFIG_HOME" id="env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a> (default <code>~/.config</code>)</li>
<li><a href="command-ref/nix-instantiate.html#env-XDG_STATE_HOME" id="env-XDG_STATE_HOME"><code>XDG_STATE_HOME</code></a> (default <code>~/.local/state</code>)</li>
<li><a href="command-ref/nix-instantiate.html#env-XDG_CACHE_HOME" id="env-XDG_CACHE_HOME"><code>XDG_CACHE_HOME</code></a> (default <code>~/.cache</code>)</li>
</ul>
<p>In addition, setting the following environment variables overrides the XDG base directories:</p>
<ul>
<li><a href="command-ref/nix-instantiate.html#env-NIX_CONFIG_HOME" id="env-NIX_CONFIG_HOME"><code>NIX_CONFIG_HOME</code></a> (default <code>$XDG_CONFIG_HOME/nix</code>)</li>
<li><a href="command-ref/nix-instantiate.html#env-NIX_STATE_HOME" id="env-NIX_STATE_HOME"><code>NIX_STATE_HOME</code></a> (default <code>$XDG_STATE_HOME/nix</code>)</li>
<li><a href="command-ref/nix-instantiate.html#env-NIX_CACHE_HOME" id="env-NIX_CACHE_HOME"><code>NIX_CACHE_HOME</code></a> (default <code>$XDG_CACHE_HOME/nix</code>)</li>
</ul>
<p>When <a href="command-ref/../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is enabled, the configuration directory is:</p>
<ol>
<li><code>$NIX_CONFIG_HOME</code>, if it is defined</li>
<li>Otherwise, <code>$XDG_CONFIG_HOME/nix</code>, if <code>XDG_CONFIG_HOME</code> is defined</li>
<li>Otherwise, <code>~/.config/nix</code>.</li>
</ol>
<p>Likewise for the state and cache directories.</p>
<h1 id="examples-24"><a class="header" href="#examples-24">Examples</a></h1>
<p>Instantiate <a href="command-ref/../glossary.html#gloss-store-derivation">store derivation</a>s from a Nix expression, and build them using <code>nix-store</code>:</p>
<pre><code class="language-console">$ nix-instantiate test.nix (instantiate)
/nix/store/cigxbmvy6dzix98dxxh9b6shg7ar5bvs-perl-BerkeleyDB-0.26.drv

$ nix-store --realise $(nix-instantiate test.nix) (build)
...
/nix/store/qhqk4n8ci095g3sdp93x7rgwyh9rdvgk-perl-BerkeleyDB-0.26 (output path)

$ ls -l /nix/store/qhqk4n8ci095g3sdp93x7rgwyh9rdvgk-perl-BerkeleyDB-0.26
dr-xr-xr-x    2 eelco    users        4096 1970-01-01 01:00 lib
...
</code></pre>
<p>You can also give a Nix expression on the command line:</p>
<pre><code class="language-console">$ nix-instantiate --expr 'with import &lt;nixpkgs&gt; { }; hello'
/nix/store/j8s4zyv75a724q38cb0r87rlczaiag4y-hello-2.8.drv
</code></pre>
<p>This is equivalent to:</p>
<pre><code class="language-console">$ nix-instantiate '&lt;nixpkgs&gt;' --attr hello
</code></pre>
<p>Parsing and evaluating Nix expressions:</p>
<pre><code class="language-console">$ nix-instantiate --parse --expr '1 + 2'
1 + 2
</code></pre>
<pre><code class="language-console">$ nix-instantiate --eval --expr '1 + 2'
3
</code></pre>
<pre><code class="language-console">$ nix-instantiate --eval --xml --expr '1 + 2'
&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;expr&gt;
  &lt;int value="3" /&gt;
&lt;/expr&gt;
</code></pre>
<p>The difference between non-strict and strict evaluation:</p>
<pre><code class="language-console">$ nix-instantiate --eval --xml --expr '{ x = {}; }'
&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;expr&gt;
  &lt;attrs&gt;
    &lt;attr column="3" line="1" name="x"&gt;
      &lt;unevaluated /&gt;
    &lt;/attr&gt;
  &lt;/attrs&gt;
&lt;/expr&gt;

$ nix-instantiate --eval --xml --strict --expr '{ x = {}; }'
&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;expr&gt;
  &lt;attrs&gt;
    &lt;attr column="3" line="1" name="x"&gt;
      &lt;attrs&gt;
      &lt;/attrs&gt;
    &lt;/attr&gt;
  &lt;/attrs&gt;
&lt;/expr&gt;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-41"><a class="header" href="#name-41">Name</a></h1>
<p><code>nix-prefetch-url</code> - copy a file from a URL into the store and print its hash</p>
<h1 id="synopsis-41"><a class="header" href="#synopsis-41">Synopsis</a></h1>
<p><code>nix-prefetch-url</code> <em>url</em> [<em>hash</em>]
[<code>--type</code> <em>hashAlgo</em>]
[<code>--print-path</code>]
[<code>--unpack</code>]
[<code>--name</code> <em>name</em>]</p>
<h1 id="description-41"><a class="header" href="#description-41">Description</a></h1>
<p>The command <code>nix-prefetch-url</code> downloads the file referenced by the URL
<em>url</em>, prints its cryptographic hash, and copies it into the Nix store.
The file name in the store is <code>hash-baseName</code>, where <em>baseName</em> is
everything following the final slash in <em>url</em>.</p>
<p>This command is just a convenience for Nix expression writers. Often a
Nix expression fetches some source distribution from the network using
the <code>fetchurl</code> expression contained in Nixpkgs. However, <code>fetchurl</code>
requires a cryptographic hash. If you don't know the hash, you would
have to download the file first, and then <code>fetchurl</code> would download it
again when you build your Nix expression. Since <code>fetchurl</code> uses the same
name for the downloaded file as <code>nix-prefetch-url</code>, the redundant
download can be avoided.</p>
<p>If <em>hash</em> is specified, then a download is not performed if the Nix
store already contains a file with the same hash and base name.
Otherwise, the file is downloaded, and an error is signaled if the
actual hash of the file does not match the specified hash.</p>
<p>This command prints the hash on standard output.
The hash is printed using base-32 unless <code>--type md5</code> is specified,
in which case it's printed using base-16.
Additionally, if the option <code>--print-path</code> is used,
the path of the downloaded file in the Nix store is also printed.</p>
<h1 id="options-38"><a class="header" href="#options-38">Options</a></h1>
<ul>
<li>
<p><code>--type</code> <em>hashAlgo</em></p>
<p>Use the specified cryptographic hash algorithm,
which can be one of <code>blake3</code>, <code>md5</code>, <code>sha1</code>, <code>sha256</code>, and <code>sha512</code>.
The default is <code>sha256</code>.</p>
</li>
<li>
<p><code>--print-path</code></p>
<p>Print the store path of the downloaded file on standard output.</p>
</li>
<li>
<p><code>--unpack</code></p>
<p>Unpack the archive (which must be a tarball or zip file) and add the
result to the Nix store. The resulting hash can be used with
functions such as Nixpkgs’s <code>fetchzip</code> or <code>fetchFromGitHub</code>.</p>
</li>
<li>
<p><code>--executable</code></p>
<p>Set the executable bit on the downloaded file.</p>
</li>
<li>
<p><code>--name</code> <em>name</em></p>
<p>Override the name of the file in the Nix store. By default, this is
<code>hash-basename</code>, where <em>basename</em> is the last component of <em>url</em>.
Overriding the name is necessary when <em>basename</em> contains characters
that are not allowed in Nix store paths.</p>
</li>
</ul>
<h1 id="examples-25"><a class="header" href="#examples-25">Examples</a></h1>
<pre><code class="language-console">$ nix-prefetch-url ftp://ftp.gnu.org/pub/gnu/hello/hello-2.10.tar.gz
0ssi1wpaf7plaswqqjwigppsg5fyh99vdlb9kzl7c9lng89ndq1i
</code></pre>
<pre><code class="language-console">$ nix-prefetch-url --print-path mirror://gnu/hello/hello-2.10.tar.gz
0ssi1wpaf7plaswqqjwigppsg5fyh99vdlb9kzl7c9lng89ndq1i
/nix/store/3x7dwzq014bblazs7kq20p9hyzz0qh8g-hello-2.10.tar.gz
</code></pre>
<pre><code class="language-console">$ nix-prefetch-url --unpack --print-path https://github.com/NixOS/patchelf/archive/0.8.tar.gz
079agjlv0hrv7fxnx9ngipx14gyncbkllxrp9cccnh3a50fxcmy7
/nix/store/19zrmhm3m40xxaw81c8cqm6aljgrnwj2-0.8.tar.gz
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="experimental-commands"><a class="header" href="#experimental-commands">Experimental Commands</a></h1>
<p>This section lists <a href="command-ref/../development/experimental-features.html#xp-feature-nix-command">experimental commands</a>.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>These commands may be removed in the future, or their syntax may
change in incompatible ways.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-42"><a class="header" href="#name-42">Name</a></h1>
<p><code>nix</code> - a tool for reproducible and declarative configuration management</p>
<h1 id="synopsis-42"><a class="header" href="#synopsis-42">Synopsis</a></h1>
<p><code>nix</code> [<em>option</em>...] <em>subcommand</em></p>
<p>where <em>subcommand</em> is one of the following:</p>
<p><strong>Help commands:</strong></p>
<ul>
<li><a href="command-ref/new-cli/./nix3-help.html"><code>nix help</code></a> - show help about <code>nix</code> or a particular subcommand</li>
<li><a href="command-ref/new-cli/./nix3-help-stores.html"><code>nix help-stores</code></a> - show help about store types and their settings</li>
</ul>
<p><strong>Main commands:</strong></p>
<ul>
<li><a href="command-ref/new-cli/./nix3-build.html"><code>nix build</code></a> - build a derivation or fetch a store path</li>
<li><a href="command-ref/new-cli/./nix3-develop.html"><code>nix develop</code></a> - run a bash shell that provides the build environment of a derivation</li>
<li><a href="command-ref/new-cli/./nix3-flake.html"><code>nix flake</code></a> - manage Nix flakes</li>
<li><a href="command-ref/new-cli/./nix3-profile.html"><code>nix profile</code></a> - manage Nix profiles</li>
<li><a href="command-ref/new-cli/./nix3-run.html"><code>nix run</code></a> - run a Nix application</li>
<li><a href="command-ref/new-cli/./nix3-search.html"><code>nix search</code></a> - search for packages</li>
</ul>
<p><strong>Main commands:</strong></p>
<ul>
<li><a href="command-ref/new-cli/./nix3-repl.html"><code>nix repl</code></a> - start an interactive environment for evaluating Nix expressions</li>
</ul>
<p><strong>Infrequently used commands:</strong></p>
<ul>
<li><a href="command-ref/new-cli/./nix3-bundle.html"><code>nix bundle</code></a> - bundle an application so that it works outside of the Nix store</li>
<li><a href="command-ref/new-cli/./nix3-copy.html"><code>nix copy</code></a> - copy paths between Nix stores</li>
<li><a href="command-ref/new-cli/./nix3-edit.html"><code>nix edit</code></a> - open the Nix expression of a Nix package in $EDITOR</li>
<li><a href="command-ref/new-cli/./nix3-eval.html"><code>nix eval</code></a> - evaluate a Nix expression</li>
<li><a href="command-ref/new-cli/./nix3-fmt.html"><code>nix fmt</code></a> - reformat your code in the standard style</li>
<li><a href="command-ref/new-cli/./nix3-log.html"><code>nix log</code></a> - show the build log of the specified packages or paths, if available</li>
<li><a href="command-ref/new-cli/./nix3-path-info.html"><code>nix path-info</code></a> - query information about store paths</li>
<li><a href="command-ref/new-cli/./nix3-registry.html"><code>nix registry</code></a> - manage the flake registry</li>
<li><a href="command-ref/new-cli/./nix3-why-depends.html"><code>nix why-depends</code></a> - show why a package has another package in its closure</li>
</ul>
<p><strong>Utility/scripting commands:</strong></p>
<ul>
<li><a href="command-ref/new-cli/./nix3-config.html"><code>nix config</code></a> - manipulate the Nix configuration</li>
<li><a href="command-ref/new-cli/./nix3-daemon.html"><code>nix daemon</code></a> - daemon to perform store operations on behalf of non-root clients</li>
<li><a href="command-ref/new-cli/./nix3-derivation.html"><code>nix derivation</code></a> - Work with derivations, Nix's notion of a build plan.</li>
<li><a href="command-ref/new-cli/./nix3-env.html"><code>nix env</code></a> - manipulate the process environment</li>
<li><a href="command-ref/new-cli/./nix3-hash.html"><code>nix hash</code></a> - compute and convert cryptographic hashes</li>
<li><a href="command-ref/new-cli/./nix3-key.html"><code>nix key</code></a> - generate and convert Nix signing keys</li>
<li><a href="command-ref/new-cli/./nix3-nar.html"><code>nix nar</code></a> - create or inspect NAR files</li>
<li><a href="command-ref/new-cli/./nix3-print-dev-env.html"><code>nix print-dev-env</code></a> - print shell code that can be sourced by bash to reproduce the build environment of a derivation</li>
<li><a href="command-ref/new-cli/./nix3-realisation.html"><code>nix realisation</code></a> - manipulate a Nix realisation</li>
<li><a href="command-ref/new-cli/./nix3-store.html"><code>nix store</code></a> - manipulate a Nix store</li>
</ul>
<p><strong>Commands for upgrading or troubleshooting your Nix installation:</strong></p>
<ul>
<li><a href="command-ref/new-cli/./nix3-upgrade-nix.html"><code>nix upgrade-nix</code></a> - upgrade Nix to the latest stable version</li>
</ul>
<h1 id="examples-26"><a class="header" href="#examples-26">Examples</a></h1>
<ul>
<li>
<p>Create a new flake:</p>
<pre><code class="language-console"># nix flake new hello
# cd hello
</code></pre>
</li>
<li>
<p>Build the flake in the current directory:</p>
<pre><code class="language-console"># nix build
# ./result/bin/hello
Hello, world!
</code></pre>
</li>
<li>
<p>Run the flake in the current directory:</p>
<pre><code class="language-console"># nix run
Hello, world!
</code></pre>
</li>
<li>
<p>Start a development shell for hacking on this flake:</p>
<pre><code class="language-console"># nix develop
# unpackPhase
# cd hello-*
# configurePhase
# buildPhase
# ./hello
Hello, world!
# installPhase
# ../outputs/out/bin/hello
Hello, world!
</code></pre>
</li>
</ul>
<h1 id="description-42"><a class="header" href="#description-42">Description</a></h1>
<p>Nix is a tool for building software, configurations and other
artifacts in a reproducible and declarative way. For more information,
see the <a href="https://nixos.org/">Nix homepage</a> or the <a href="https://nixos.org/manual/nix/stable/">Nix
manual</a>.</p>
<h1 id="installables"><a class="header" href="#installables">Installables</a></h1>
<blockquote>
<p><strong>Warning</strong> <br />
Installables are part of the unstable
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><code>nix-command</code> experimental feature</a>,
and subject to change without notice.</p>
</blockquote>
<p>Many <code>nix</code> subcommands operate on one or more <em>installables</em>.
These are command line arguments that represent something that can be realised in the Nix store.</p>
<p>The following types of installable are supported by most commands:</p>
<ul>
<li><a href="command-ref/new-cli/nix.html#flake-output-attribute">Flake output attribute</a> (experimental)
<ul>
<li>This is the default</li>
</ul>
</li>
<li><a href="command-ref/new-cli/nix.html#store-path">Store path</a>
<ul>
<li>This is assumed if the argument is a Nix store path or a symlink to a Nix store path</li>
</ul>
</li>
<li><a href="command-ref/new-cli/nix.html#nix-file">Nix file</a>, optionally qualified by an attribute path
<ul>
<li>Specified with <code>--file</code>/<code>-f</code></li>
</ul>
</li>
<li><a href="command-ref/new-cli/nix.html#nix-expression">Nix expression</a>, optionally qualified by an attribute path
<ul>
<li>Specified with <code>--expr</code></li>
</ul>
</li>
</ul>
<p>For most commands, if no installable is specified, <code>.</code> is assumed.
That is, Nix will operate on the default flake output attribute of the flake in the current directory.</p>
<h3 id="flake-output-attribute"><a class="header" href="#flake-output-attribute">Flake output attribute</a></h3>
<blockquote>
<p><strong>Warning</strong> <br />
Flake output attribute installables depend on both the
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-flakes"><code>flakes</code></a>
and
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><code>nix-command</code></a>
experimental features, and subject to change without notice.</p>
</blockquote>
<p>Example: <code>nixpkgs#hello</code></p>
<p>These have the form <em>flakeref</em>[<code>#</code><em>attrpath</em>], where <em>flakeref</em> is a
<a href="command-ref/new-cli/./nix3-flake.html#flake-references">flake reference</a> and <em>attrpath</em> is an optional attribute path. For
more information on flakes, see <a href="command-ref/new-cli/./nix3-flake.html">the <code>nix flake</code> manual
page</a>.  Flake references are most commonly a flake
identifier in the flake registry (e.g. <code>nixpkgs</code>), or a raw path
(e.g. <code>/path/to/my-flake</code> or <code>.</code> or <code>../foo</code>), or a full URL
(e.g. <code>github:nixos/nixpkgs</code> or <code>path:.</code>)</p>
<p>When the flake reference is a raw path (a path without any URL
scheme), it is interpreted as a <code>path:</code> or <code>git+file:</code> url in the following
way:</p>
<ul>
<li>
<p>If the path is within a Git repository, then the url will be of the form
<code>git+file://[GIT_REPO_ROOT]?dir=[RELATIVE_FLAKE_DIR_PATH]</code>
where <code>GIT_REPO_ROOT</code> is the path to the root of the git repository,
and <code>RELATIVE_FLAKE_DIR_PATH</code> is the path (relative to the directory
root) of the closest parent of the given path that contains a <code>flake.nix</code> within
the git repository.
If no such directory exists, then Nix will error-out.</p>
<p>Note that the search will only include files indexed by git. In particular, files
which are matched by <code>.gitignore</code> or have never been <code>git add</code>-ed will not be
available in the flake. If this is undesirable, specify <code>path:&lt;directory&gt;</code> explicitly;</p>
<p>For example, if <code>/foo/bar</code> is a git repository with the following structure:</p>
<pre><code>.
└── baz
    ├── blah
    │   └── file.txt
    └── flake.nix
</code></pre>
<p>Then <code>/foo/bar/baz/blah</code> will resolve to <code>git+file:///foo/bar?dir=baz</code></p>
</li>
<li>
<p>If the supplied path is not a git repository, then the url will have the form
<code>path:FLAKE_DIR_PATH</code> where <code>FLAKE_DIR_PATH</code> is the closest parent
of the supplied path that contains a <code>flake.nix</code> file (within the same file-system).
If no such directory exists, then Nix will error-out.</p>
<p>For example, if <code>/foo/bar/flake.nix</code> exists, then <code>/foo/bar/baz/</code> will resolve to
<code>path:/foo/bar</code></p>
</li>
</ul>
<p>If <em>attrpath</em> is omitted, Nix tries some default values; for most
subcommands, the default is <code>packages.</code><em>system</em><code>.default</code>
(e.g. <code>packages.x86_64-linux.default</code>), but some subcommands have
other defaults. If <em>attrpath</em> <em>is</em> specified, <em>attrpath</em> is
interpreted as relative to one or more prefixes; for most
subcommands, these are <code>packages.</code><em>system</em>,
<code>legacyPackages.*system*</code> and the empty prefix. Thus, on
<code>x86_64-linux</code> <code>nix build nixpkgs#hello</code> will try to build the
attributes <code>packages.x86_64-linux.hello</code>,
<code>legacyPackages.x86_64-linux.hello</code> and <code>hello</code>.</p>
<p>If <em>attrpath</em> begins with <code>.</code> then no prefixes or defaults are attempted. This allows the form <em>flakeref</em>[<code>#.</code><em>attrpath</em>], such as <code>github:NixOS/nixpkgs#.lib.fakeSha256</code> to avoid a search of <code>packages.*system*.lib.fakeSha256</code></p>
<h3 id="store-path-1"><a class="header" href="#store-path-1">Store path</a></h3>
<p>Example: <code>/nix/store/v5sv61sszx301i0x6xysaqzla09nksnd-hello-2.10</code></p>
<p>These are paths inside the Nix store, or symlinks that resolve to a path in the Nix store.</p>
<p>A <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> is also addressed by store path.</p>
<p>Example: <code>/nix/store/p7gp6lxdg32h4ka1q398wd9r2zkbbz2v-hello-2.10.drv</code></p>
<p>If you want to refer to an output path of that store derivation, add the output name preceded by a caret (<code>^</code>).</p>
<p>Example: <code>/nix/store/p7gp6lxdg32h4ka1q398wd9r2zkbbz2v-hello-2.10.drv^out</code></p>
<p>All outputs can be referred to at once with the special syntax <code>^*</code>.</p>
<p>Example: <code>/nix/store/p7gp6lxdg32h4ka1q398wd9r2zkbbz2v-hello-2.10.drv^*</code></p>
<h3 id="nix-file"><a class="header" href="#nix-file">Nix file</a></h3>
<p>Example: <code>--file /path/to/nixpkgs hello</code></p>
<p>When the option <code>-f</code> / <code>--file</code> <em>path</em> [<em>attrpath</em>...] is given, installables are interpreted as the value of the expression in the Nix file at <em>path</em>.
If attribute paths are provided, commands will operate on the corresponding values accessible at these paths.
The Nix expression in that file, or any selected attribute, must evaluate to a derivation.</p>
<h3 id="nix-expression"><a class="header" href="#nix-expression">Nix expression</a></h3>
<p>Example: <code>--expr 'import &lt;nixpkgs&gt; {}' hello</code></p>
<p>When the option <code>--expr</code> <em>expression</em> [<em>attrpath</em>...] is given, installables are interpreted as the value of the of the Nix expression.
If attribute paths are provided, commands will operate on the corresponding values accessible at these paths.
The Nix expression, or any selected attribute, must evaluate to a derivation.</p>
<p>You may need to specify <code>--impure</code> if the expression references impure inputs (such as <code>&lt;nixpkgs&gt;</code>).</p>
<h2 id="derivation-output-selection"><a class="header" href="#derivation-output-selection">Derivation output selection</a></h2>
<p>Derivations can have multiple outputs, each corresponding to a
different store path. For instance, a package can have a <code>bin</code> output
that contains programs, and a <code>dev</code> output that provides development
artifacts like C/C++ header files. The outputs on which <code>nix</code> commands
operate are determined as follows:</p>
<ul>
<li>
<p>You can explicitly specify the desired outputs using the syntax <em>installable</em><code>^</code><em>output1</em><code>,</code><em>...</em><code>,</code><em>outputN</em> — that is, a caret followed immediately by a comma-separated list of derivation outputs to select.
For installables specified as <a href="command-ref/new-cli/nix.html#flake-output-attribute">Flake output attributes</a> or <a href="command-ref/new-cli/nix.html#store-path">Store paths</a>, the output is specified in the same argument:</p>
<p>For example, you can obtain the <code>dev</code> and <code>static</code> outputs of the <code>glibc</code> package:</p>
<pre><code class="language-console"># nix build 'nixpkgs#glibc^dev,static'
# ls ./result-dev/include/ ./result-static/lib/
…
</code></pre>
<p>and likewise, using a store path to a "drv" file to specify the derivation:</p>
<pre><code class="language-console"># nix build '/nix/store/gzaflydcr6sb3567hap9q6srzx8ggdgg-glibc-2.33-78.drv^dev,static'
…
</code></pre>
<p>For <code>--expr</code> and <code>-f</code>/<code>--file</code>, the derivation output is specified as part of the attribute path:</p>
<pre><code class="language-console">$ nix build -f '&lt;nixpkgs&gt;' 'glibc^dev,static'
$ nix build --impure --expr 'import &lt;nixpkgs&gt; { }' 'glibc^dev,static'
</code></pre>
<p>This syntax is the same even if the actual attribute path is empty:</p>
<pre><code class="language-console">$ nix build --impure --expr 'let pkgs = import &lt;nixpkgs&gt; { }; in pkgs.glibc' '^dev,static'
</code></pre>
</li>
<li>
<p>You can also specify that <em>all</em> outputs should be used using the
syntax <em>installable</em><code>^*</code>. For example, the following shows the size
of all outputs of the <code>glibc</code> package in the binary cache:</p>
<pre><code class="language-console"># nix path-info --closure-size --eval-store auto --store https://cache.nixos.org 'nixpkgs#glibc^*'
/nix/store/g02b1lpbddhymmcjb923kf0l7s9nww58-glibc-2.33-123                 33208200
/nix/store/851dp95qqiisjifi639r0zzg5l465ny4-glibc-2.33-123-bin             36142896
/nix/store/kdgs3q6r7xdff1p7a9hnjr43xw2404z7-glibc-2.33-123-debug          155787312
/nix/store/n4xa8h6pbmqmwnq0mmsz08l38abb06zc-glibc-2.33-123-static          42488328
/nix/store/q6580lr01jpcsqs4r5arlh4ki2c1m9rv-glibc-2.33-123-dev             44200560
</code></pre>
<p>and likewise, using a store path to a "drv" file to specify the derivation:</p>
<pre><code class="language-console"># nix path-info --closure-size '/nix/store/gzaflydcr6sb3567hap9q6srzx8ggdgg-glibc-2.33-78.drv^*'
…
</code></pre>
</li>
<li>
<p>If you didn't specify the desired outputs, but the derivation has an
attribute <code>meta.outputsToInstall</code>, Nix will use those outputs. For
example, since the package <code>nixpkgs#libxml2</code> has this attribute:</p>
<pre><code class="language-console"># nix eval 'nixpkgs#libxml2.meta.outputsToInstall'
[ "bin" "man" ]
</code></pre>
<p>a command like <code>nix shell nixpkgs#libxml2</code> will provide only those
two outputs by default.</p>
<p>Note that a <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> (given by its <code>.drv</code> file store path) doesn't have
any attributes like <code>meta</code>, and thus this case doesn't apply to it.</p>
</li>
<li>
<p>Otherwise, Nix will use all outputs of the derivation.</p>
</li>
</ul>
<h1 id="nix-stores"><a class="header" href="#nix-stores">Nix stores</a></h1>
<p>Most <code>nix</code> subcommands operate on a <em>Nix store</em>.
The various store types are documented in the
<a href="command-ref/new-cli/../../store/types/index.html">Store Types</a>
section of the manual.</p>
<p>The same information is also available from the <a href="command-ref/new-cli/./nix3-help-stores.html"><code>nix help-stores</code></a> command.</p>
<h1 id="shebang-interpreter"><a class="header" href="#shebang-interpreter">Shebang interpreter</a></h1>
<p>The <code>nix</code> command can be used as a <code>#!</code> interpreter.
Arguments to Nix can be passed on subsequent lines in the script.</p>
<p>Verbatim strings may be passed in double backtick (<code>``</code>) quotes. <!-- that's markdown for two backticks in inline code. -->
Sequences of <em>n</em> backticks of 3 or longer are parsed as <em>n-1</em> literal backticks.
A single space before the closing <code>``</code> is ignored if present.</p>
<p><code>--file</code> and <code>--expr</code> resolve relative paths based on the script location.</p>
<p>Examples:</p>
<pre><code>#!/usr/bin/env nix
#! nix shell --file ``&lt;nixpkgs&gt;`` hello cowsay --command bash

hello | cowsay
</code></pre>
<p>or with <strong>flakes</strong>:</p>
<pre><code>#!/usr/bin/env nix
#! nix shell nixpkgs#bash nixpkgs#hello nixpkgs#cowsay --command bash

hello | cowsay
</code></pre>
<p>or with an <strong>expression</strong>:</p>
<pre><code class="language-bash">#! /usr/bin/env nix
#! nix shell --impure --expr ``
#! nix with (import (builtins.getFlake "nixpkgs") {});
#! nix terraform.withPlugins (plugins: [ plugins.openstack ])
#! nix ``
#! nix --command bash

terraform "$@"
</code></pre>
<p>or with cascading interpreters. Note that the <code>#! nix</code> lines don't need to follow after the first line, to accommodate other interpreters.</p>
<pre><code>#!/usr/bin/env nix
//! ```cargo
//! [dependencies]
//! time = "0.1.25"
//! ```
/*
#!nix shell nixpkgs#rustc nixpkgs#rust-script nixpkgs#cargo --command rust-script
*/
fn main() {
    for argument in std::env::args().skip(1) {
        println!("{}", argument);
    };
    println!("{}", std::env::var("HOME").expect(""));
    println!("{}", time::now().rfc822z());
}
// vim: ft=rust
</code></pre>
<h1 id="options-39"><a class="header" href="#options-39">Options</a></h1>
<h2 id="logging-related-options"><a class="header" href="#logging-related-options">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options"><a class="header" href="#miscellaneous-global-options">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-43"><a class="header" href="#name-43">Name</a></h1>
<p><code>nix build</code> - build a derivation or fetch a store path</p>
<h1 id="synopsis-43"><a class="header" href="#synopsis-43">Synopsis</a></h1>
<p><code>nix build</code> [<em>option</em>...] <em>installables</em>...</p>
<h1 id="examples-27"><a class="header" href="#examples-27">Examples</a></h1>
<ul>
<li>
<p>Build the default package from the flake in the current directory:</p>
<pre><code class="language-console"># nix build
</code></pre>
</li>
<li>
<p>Build and run GNU Hello from the <code>nixpkgs</code> flake:</p>
<pre><code class="language-console"># nix build nixpkgs#hello
# ./result/bin/hello
Hello, world!
</code></pre>
</li>
<li>
<p>Build GNU Hello and Cowsay, leaving two result symlinks:</p>
<pre><code class="language-console"># nix build nixpkgs#hello nixpkgs#cowsay
# ls -l result*
lrwxrwxrwx 1 … result -&gt; /nix/store/v5sv61sszx301i0x6xysaqzla09nksnd-hello-2.10
lrwxrwxrwx 1 … result-1 -&gt; /nix/store/rkfrm0z6x6jmi7d3gsmma4j53h15mg33-cowsay-3.03+dfsg2
</code></pre>
</li>
<li>
<p>Build GNU Hello and print the resulting store path.</p>
<pre><code class="language-console"># nix build nixpkgs#hello --print-out-paths
/nix/store/v5sv61sszx301i0x6xysaqzla09nksnd-hello-2.10
</code></pre>
</li>
<li>
<p>Build a specific output:</p>
<pre><code class="language-console"># nix build nixpkgs#glibc.dev
# ls -ld ./result-dev
lrwxrwxrwx 1 … ./result-dev -&gt; /nix/store/dkm3gwl0xrx0wrw6zi5x3px3lpgjhlw4-glibc-2.32-dev
</code></pre>
</li>
<li>
<p>Build all outputs:</p>
<pre><code class="language-console"># nix build "nixpkgs#openssl^*" --print-out-paths
/nix/store/gvad6v0cmq1qccmc4wphsazqbj0xzjsl-openssl-3.0.13-bin
/nix/store/a07jqdrc8afnk8r6f3lnhh4gvab7chk4-openssl-3.0.13-debug
/nix/store/yg75achq89wgqn2fi3gglgsd77kjpi03-openssl-3.0.13-dev
/nix/store/bvdcihi8c88fw31cg6gzzmpnwglpn1jv-openssl-3.0.13-doc
/nix/store/gjqcvq47cmxazxga0cirspm3jywkmvfv-openssl-3.0.13-man
/nix/store/7nmrrad8skxr47f9hfl3xc0pfqmwq51b-openssl-3.0.13
</code></pre>
</li>
<li>
<p>Build attribute <code>build.x86_64-linux</code> from (non-flake) Nix expression
<code>release.nix</code>:</p>
<pre><code class="language-console"># nix build --file release.nix build.x86_64-linux
</code></pre>
</li>
<li>
<p>Build a NixOS system configuration from a flake, and make a profile
point to the result:</p>
<pre><code class="language-console"># nix build --profile /nix/var/nix/profiles/system \
    ~/my-configurations#nixosConfigurations.machine.config.system.build.toplevel
</code></pre>
<p>(This is essentially what <code>nixos-rebuild</code> does.)</p>
</li>
<li>
<p>Build an expression specified on the command line:</p>
<pre><code class="language-console"># nix build --impure --expr \
    'with import &lt;nixpkgs&gt; {};
     runCommand "foo" {
       buildInputs = [ hello ];
     }
     "hello &gt; $out"'
# cat ./result
Hello, world!
</code></pre>
<p>Note that <code>--impure</code> is needed because we're using <code>&lt;nixpkgs&gt;</code>,
which relies on the <code>$NIX_PATH</code> environment variable.</p>
</li>
<li>
<p>Fetch a store path from the configured substituters, if it doesn't
already exist:</p>
<pre><code class="language-console"># nix build /nix/store/rkfrm0z6x6jmi7d3gsmma4j53h15mg33-cowsay-3.03+dfsg2
</code></pre>
</li>
</ul>
<h1 id="description-43"><a class="header" href="#description-43">Description</a></h1>
<p><code>nix build</code> builds the specified <em>installables</em>. <a href="command-ref/new-cli/./nix.html#installables">Installables</a> that
resolve to derivations are built (or substituted if possible). Store
path installables are substituted.</p>
<p>Unless <code>--no-link</code> is specified, after a successful build, it creates
symlinks to the store paths of the installables. These symlinks have
the prefix <code>./result</code> by default; this can be overridden using the
<code>--out-link</code> option. Each symlink has a suffix <code>-&lt;N&gt;-&lt;outname&gt;</code>, where
<em>N</em> is the index of the installable (with the left-most installable
having index 0), and <em>outname</em> is the symbolic derivation output name
(e.g. <code>bin</code>, <code>dev</code> or <code>lib</code>). <code>-&lt;N&gt;</code> is omitted if <em>N</em> = 0, and
<code>-&lt;outname&gt;</code> is omitted if <em>outname</em> = <code>out</code> (denoting the default
output).</p>
<h1 id="options-40"><a class="header" href="#options-40">Options</a></h1>
<ul>
<li>
<p><span id="opt-dry-run"><a href="command-ref/new-cli/nix3-build.html#opt-dry-run"><code>--dry-run</code></a></span></p>
<p>Show what this command would do without doing it.</p>
</li>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-build.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
<li>
<p><span id="opt-no-link"><a href="command-ref/new-cli/nix3-build.html#opt-no-link"><code>--no-link</code></a></span></p>
<p>Do not create symlinks to the build results.</p>
</li>
<li>
<p><span id="opt-out-link"><a href="command-ref/new-cli/nix3-build.html#opt-out-link"><code>--out-link</code></a></span> / <code>-o</code> <em>path</em></p>
<p>Use <em>path</em> as prefix for the symlinks to the build results. It defaults to <code>result</code>.</p>
</li>
<li>
<p><span id="opt-print-out-paths"><a href="command-ref/new-cli/nix3-build.html#opt-print-out-paths"><code>--print-out-paths</code></a></span></p>
<p>Print the resulting output paths</p>
</li>
<li>
<p><span id="opt-profile"><a href="command-ref/new-cli/nix3-build.html#opt-profile"><code>--profile</code></a></span> <em>path</em></p>
<p>The profile to operate on.</p>
</li>
<li>
<p><span id="opt-rebuild"><a href="command-ref/new-cli/nix3-build.html#opt-rebuild"><code>--rebuild</code></a></span></p>
<p>Rebuild an already built package and compare the result to the existing store paths.</p>
</li>
<li>
<p><span id="opt-stdin"><a href="command-ref/new-cli/nix3-build.html#opt-stdin"><code>--stdin</code></a></span></p>
<p>Read installables from the standard input. No default installable applied.</p>
</li>
</ul>
<h2 id="common-evaluation-options"><a class="header" href="#common-evaluation-options">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-build.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-build.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-build.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-build.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-build.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-build.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-build.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-build.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-build.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options"><a class="header" href="#common-flake-related-options">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-build.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-build.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-build.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-build.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-build.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-build.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-build.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-build.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-build.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-build.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-1"><a class="header" href="#logging-related-options-1">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-build.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-build.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-build.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-build.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-build.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-1"><a class="header" href="#miscellaneous-global-options-1">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-build.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-build.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-build.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-build.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-build.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-build.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables"><a class="header" href="#options-that-change-the-interpretation-of-installables">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-build.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-build.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-44"><a class="header" href="#name-44">Name</a></h1>
<p><code>nix bundle</code> - bundle an application so that it works outside of the Nix store</p>
<h1 id="synopsis-44"><a class="header" href="#synopsis-44">Synopsis</a></h1>
<p><code>nix bundle</code> [<em>option</em>...] <em>installable</em></p>
<h1 id="examples-28"><a class="header" href="#examples-28">Examples</a></h1>
<ul>
<li>
<p>Bundle Hello:</p>
<pre><code class="language-console"># nix bundle nixpkgs#hello
# ./hello
Hello, world!
</code></pre>
</li>
<li>
<p>Bundle a specific version of Nix:</p>
<pre><code class="language-console"># nix bundle github:NixOS/nix/e3ddffb27e5fc37a209cfd843c6f7f6a9460a8ec
# ./nix --version
nix (Nix) 2.4pre20201215_e3ddffb
</code></pre>
</li>
<li>
<p>Bundle a Hello using a specific bundler:</p>
<pre><code class="language-console"># nix bundle --bundler github:NixOS/bundlers#toDockerImage nixpkgs#hello
# docker load &lt; hello-2.10.tar.gz
# docker run hello-2.10:latest hello
Hello, world!
</code></pre>
</li>
</ul>
<h1 id="description-44"><a class="header" href="#description-44">Description</a></h1>
<p><code>nix bundle</code>, by default, packs the closure of the <a href="command-ref/new-cli/./nix.html#installables"><em>installable</em></a> into a single
self-extracting executable. See the <a href="https://github.com/NixOS/bundlers"><code>bundlers</code>
homepage</a> for more details.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>This command only works on Linux.</p>
</blockquote>
<h1 id="flake-output-attributes"><a class="header" href="#flake-output-attributes">Flake output attributes</a></h1>
<p>If no flake output attribute is given, <code>nix bundle</code> tries the following
flake output attributes:</p>
<ul>
<li><code>bundlers.&lt;system&gt;.default</code></li>
</ul>
<p>If an attribute <em>name</em> is given, <code>nix bundle</code> tries the following flake
output attributes:</p>
<ul>
<li><code>bundlers.&lt;system&gt;.&lt;name&gt;</code></li>
</ul>
<h1 id="bundlers"><a class="header" href="#bundlers">Bundlers</a></h1>
<p>A bundler is specified by a flake output attribute named
<code>bundlers.&lt;system&gt;.&lt;name&gt;</code>. It looks like this:</p>
<pre><code class="language-nix">bundlers.x86_64-linux = rec {
  identity = drv: drv;

  blender_2_79 = drv: self.packages.x86_64-linux.blender_2_79;

  default = identity;
};
</code></pre>
<p>A bundler must be a function that accepts an arbitrary value (typically a
derivation or app definition) and returns a derivation.</p>
<h1 id="options-41"><a class="header" href="#options-41">Options</a></h1>
<ul>
<li>
<p><span id="opt-bundler"><a href="command-ref/new-cli/nix3-bundle.html#opt-bundler"><code>--bundler</code></a></span> <em>flake-url</em></p>
<p>Use a custom bundler instead of the default (<code>github:NixOS/bundlers</code>).</p>
</li>
<li>
<p><span id="opt-out-link"><a href="command-ref/new-cli/nix3-bundle.html#opt-out-link"><code>--out-link</code></a></span> / <code>-o</code> <em>path</em></p>
<p>Override the name of the symlink to the build result. It defaults to the base name of the app.</p>
</li>
</ul>
<h2 id="common-evaluation-options-1"><a class="header" href="#common-evaluation-options-1">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-bundle.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-bundle.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-bundle.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-bundle.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-bundle.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-bundle.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-bundle.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-bundle.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-bundle.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-1"><a class="header" href="#common-flake-related-options-1">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-bundle.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-bundle.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-bundle.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-bundle.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-bundle.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-bundle.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-bundle.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-bundle.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-bundle.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-bundle.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-2"><a class="header" href="#logging-related-options-2">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-bundle.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-bundle.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-bundle.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-bundle.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-bundle.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-2"><a class="header" href="#miscellaneous-global-options-2">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-bundle.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-bundle.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-bundle.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-bundle.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-bundle.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-bundle.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-1"><a class="header" href="#options-that-change-the-interpretation-of-installables-1">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-bundle.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-bundle.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-45"><a class="header" href="#name-45">Name</a></h1>
<p><code>nix config</code> - manipulate the Nix configuration</p>
<h1 id="synopsis-45"><a class="header" href="#synopsis-45">Synopsis</a></h1>
<p><code>nix config</code> [<em>option</em>...] <em>subcommand</em></p>
<p>where <em>subcommand</em> is one of the following:</p>
<p><strong>:</strong></p>
<ul>
<li><a href="command-ref/new-cli/./nix3-config-show.html"><code>nix config show</code></a> - show the Nix configuration or the value of a specific setting</li>
</ul>
<p><strong>:</strong></p>
<ul>
<li><a href="command-ref/new-cli/./nix3-config-check.html"><code>nix config check</code></a> - check your system for potential problems and print a PASS or FAIL for each check</li>
</ul>
<h1 id="options-42"><a class="header" href="#options-42">Options</a></h1>
<h2 id="logging-related-options-3"><a class="header" href="#logging-related-options-3">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-config.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-config.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-config.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-config.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-config.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-3"><a class="header" href="#miscellaneous-global-options-3">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-config.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-config.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-config.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-config.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-config.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-46"><a class="header" href="#name-46">Name</a></h1>
<p><code>nix config check</code> - check your system for potential problems and print a PASS or FAIL for each check</p>
<h1 id="synopsis-46"><a class="header" href="#synopsis-46">Synopsis</a></h1>
<p><code>nix config check</code> [<em>option</em>...]</p>
<h1 id="options-43"><a class="header" href="#options-43">Options</a></h1>
<h2 id="logging-related-options-4"><a class="header" href="#logging-related-options-4">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-config-check.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-config-check.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-config-check.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-config-check.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-config-check.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-4"><a class="header" href="#miscellaneous-global-options-4">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-config-check.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-config-check.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-config-check.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-config-check.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-config-check.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-47"><a class="header" href="#name-47">Name</a></h1>
<p><code>nix config show</code> - show the Nix configuration or the value of a specific setting</p>
<h1 id="synopsis-47"><a class="header" href="#synopsis-47">Synopsis</a></h1>
<p><code>nix config show</code> [<em>option</em>...] <em>name</em></p>
<h1 id="options-44"><a class="header" href="#options-44">Options</a></h1>
<ul>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-config-show.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
</ul>
<h2 id="logging-related-options-5"><a class="header" href="#logging-related-options-5">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-config-show.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-config-show.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-config-show.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-config-show.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-config-show.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-5"><a class="header" href="#miscellaneous-global-options-5">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-config-show.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-config-show.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-config-show.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-config-show.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-config-show.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-48"><a class="header" href="#name-48">Name</a></h1>
<p><code>nix copy</code> - copy paths between Nix stores</p>
<h1 id="synopsis-48"><a class="header" href="#synopsis-48">Synopsis</a></h1>
<p><code>nix copy</code> [<em>option</em>...] <em>installables</em>...</p>
<h1 id="examples-29"><a class="header" href="#examples-29">Examples</a></h1>
<ul>
<li>
<p>Copy Firefox from the local store to a binary cache in <code>/tmp/cache</code>:</p>
<pre><code class="language-console"># nix copy --to file:///tmp/cache $(type -p firefox)
</code></pre>
<p>Note the <code>file://</code> - without this, the destination is a chroot
store, not a binary cache.</p>
</li>
<li>
<p>Copy all store paths from a local binary cache in <code>/tmp/cache</code> to the local store:</p>
<pre><code class="language-console"># nix copy --all --from file:///tmp/cache
</code></pre>
</li>
<li>
<p>Copy the entire current NixOS system closure to another machine via
SSH:</p>
<pre><code class="language-console"># nix copy --substitute-on-destination --to ssh://server /run/current-system
</code></pre>
<p>The <code>-s</code> flag causes the remote machine to try to substitute missing
store paths, which may be faster if the link between the local and
remote machines is slower than the link between the remote machine
and its substituters (e.g. <code>https://cache.nixos.org</code>).</p>
</li>
<li>
<p>Copy a closure from another machine via SSH:</p>
<pre><code class="language-console"># nix copy --from ssh://server /nix/store/a6cnl93nk1wxnq84brbbwr6hxw9gp2w9-blender-2.79-rc2
</code></pre>
</li>
<li>
<p>Copy Hello to a binary cache in an Amazon S3 bucket:</p>
<pre><code class="language-console"># nix copy --to s3://my-bucket?region=eu-west-1 nixpkgs#hello
</code></pre>
<p>or to an S3-compatible storage system:</p>
<pre><code class="language-console"># nix copy --to s3://my-bucket?region=eu-west-1&amp;endpoint=example.com nixpkgs#hello
</code></pre>
<p>Note that this only works if Nix is built with AWS support.</p>
</li>
<li>
<p>Copy a closure from <code>/nix/store</code> to the chroot store <code>/tmp/nix/nix/store</code>:</p>
<pre><code class="language-console"># nix copy --to /tmp/nix nixpkgs#hello --no-check-sigs
</code></pre>
</li>
<li>
<p>Update the NixOS system profile to point to a closure copied from a
remote machine:</p>
<pre><code class="language-console"># nix copy --from ssh://server \
    --profile /nix/var/nix/profiles/system \
    /nix/store/r14v3km89zm3prwsa521fab5kgzvfbw4-nixos-system-foobar-24.05.20240925.759537f
</code></pre>
</li>
</ul>
<h1 id="description-45"><a class="header" href="#description-45">Description</a></h1>
<p><code>nix copy</code> copies store path closures between two Nix stores. The
source store is specified using <code>--from</code> and the destination using
<code>--to</code>. If one of these is omitted, it defaults to the local store.</p>
<h1 id="options-45"><a class="header" href="#options-45">Options</a></h1>
<ul>
<li>
<p><span id="opt-from"><a href="command-ref/new-cli/nix3-copy.html#opt-from"><code>--from</code></a></span> <em>store-uri</em></p>
<p>URL of the source Nix store.</p>
</li>
<li>
<p><span id="opt-no-check-sigs"><a href="command-ref/new-cli/nix3-copy.html#opt-no-check-sigs"><code>--no-check-sigs</code></a></span></p>
<p>Do not require that paths are signed by trusted keys.</p>
</li>
<li>
<p><span id="opt-out-link"><a href="command-ref/new-cli/nix3-copy.html#opt-out-link"><code>--out-link</code></a></span> / <code>-o</code> <em>path</em></p>
<p>Create symlinks prefixed with <em>path</em> to the top-level store paths fetched from the source store.</p>
</li>
<li>
<p><span id="opt-profile"><a href="command-ref/new-cli/nix3-copy.html#opt-profile"><code>--profile</code></a></span> <em>path</em></p>
<p>The profile to operate on.</p>
</li>
<li>
<p><span id="opt-stdin"><a href="command-ref/new-cli/nix3-copy.html#opt-stdin"><code>--stdin</code></a></span></p>
<p>Read installables from the standard input. No default installable applied.</p>
</li>
<li>
<p><span id="opt-substitute-on-destination"><a href="command-ref/new-cli/nix3-copy.html#opt-substitute-on-destination"><code>--substitute-on-destination</code></a></span> / <code>-s</code></p>
<p>Whether to try substitutes on the destination store (only supported by SSH stores).</p>
</li>
<li>
<p><span id="opt-to"><a href="command-ref/new-cli/nix3-copy.html#opt-to"><code>--to</code></a></span> <em>store-uri</em></p>
<p>URL of the destination Nix store.</p>
</li>
</ul>
<h2 id="common-evaluation-options-2"><a class="header" href="#common-evaluation-options-2">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-copy.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-copy.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-copy.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-copy.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-copy.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-copy.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-copy.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-copy.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-copy.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-2"><a class="header" href="#common-flake-related-options-2">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-copy.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-copy.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-copy.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-copy.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-copy.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-copy.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-copy.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-copy.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-copy.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-copy.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-6"><a class="header" href="#logging-related-options-6">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-copy.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-copy.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-copy.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-copy.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-copy.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-6"><a class="header" href="#miscellaneous-global-options-6">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-copy.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-copy.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-copy.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-copy.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-copy.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-copy.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-2"><a class="header" href="#options-that-change-the-interpretation-of-installables-2">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-all"><a href="command-ref/new-cli/nix3-copy.html#opt-all"><code>--all</code></a></span></p>
<p>Apply the operation to every store path.</p>
</li>
<li>
<p><span id="opt-derivation"><a href="command-ref/new-cli/nix3-copy.html#opt-derivation"><code>--derivation</code></a></span></p>
<p>Operate on the <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> rather than its outputs.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-copy.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-copy.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
<li>
<p><span id="opt-no-recursive"><a href="command-ref/new-cli/nix3-copy.html#opt-no-recursive"><code>--no-recursive</code></a></span></p>
<p>Apply operation to specified paths only.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-49"><a class="header" href="#name-49">Name</a></h1>
<p><code>nix daemon</code> - daemon to perform store operations on behalf of non-root clients</p>
<h1 id="synopsis-49"><a class="header" href="#synopsis-49">Synopsis</a></h1>
<p><code>nix daemon</code> [<em>option</em>...]</p>
<h1 id="examples-30"><a class="header" href="#examples-30">Examples</a></h1>
<ul>
<li>
<p>Run the daemon:</p>
<pre><code class="language-console"># nix daemon
</code></pre>
</li>
<li>
<p>Run the daemon and listen on standard I/O instead of binding to a UNIX socket:</p>
<pre><code class="language-console"># nix daemon --stdio
</code></pre>
</li>
<li>
<p>Run the daemon and force all connections to be trusted:</p>
<pre><code class="language-console"># nix daemon --force-trusted
</code></pre>
</li>
<li>
<p>Run the daemon and force all connections to be untrusted:</p>
<pre><code class="language-console"># nix daemon --force-untrusted
</code></pre>
</li>
<li>
<p>Run the daemon, listen on standard I/O, and force all connections to use Nix's default trust:</p>
<pre><code class="language-console"># nix daemon --stdio --default-trust
</code></pre>
</li>
</ul>
<h1 id="description-46"><a class="header" href="#description-46">Description</a></h1>
<p>This command runs the Nix daemon, which is a required component in
multi-user Nix installations. It runs build tasks and other
operations on the Nix store on behalf of non-root users. Usually you
don't run the daemon directly; instead it's managed by a service
management framework such as <code>systemd</code> on Linux, or <code>launchctl</code> on Darwin.</p>
<p>Note that this daemon does not fork into the background.</p>
<h1 id="options-46"><a class="header" href="#options-46">Options</a></h1>
<ul>
<li>
<p><span id="opt-default-trust"><a href="command-ref/new-cli/nix3-daemon.html#opt-default-trust"><code>--default-trust</code></a></span></p>
<p>Use Nix's default trust.</p>
</li>
<li>
<p><span id="opt-force-trusted"><a href="command-ref/new-cli/nix3-daemon.html#opt-force-trusted"><code>--force-trusted</code></a></span></p>
<p>Force the daemon to trust connecting clients.</p>
</li>
<li>
<p><span id="opt-force-untrusted"><a href="command-ref/new-cli/nix3-daemon.html#opt-force-untrusted"><code>--force-untrusted</code></a></span></p>
<p>Force the daemon to not trust connecting clients. The connection will be processed by the receiving daemon before forwarding commands.</p>
</li>
<li>
<p><span id="opt-process-ops"><a href="command-ref/new-cli/nix3-daemon.html#opt-process-ops"><code>--process-ops</code></a></span></p>
<p>Forces the daemon to process received commands itself rather than forwarding the commands straight to the remote store.</p>
<pre><code>        This is useful for the `mounted-ssh://` store where some actions need to be performed on the remote end but as connected user, and not as the user of the underlying daemon on the remote end.
</code></pre>
</li>
<li>
<p><span id="opt-stdio"><a href="command-ref/new-cli/nix3-daemon.html#opt-stdio"><code>--stdio</code></a></span></p>
<p>Attach to standard I/O, instead of trying to bind to a UNIX socket.</p>
</li>
</ul>
<h2 id="logging-related-options-7"><a class="header" href="#logging-related-options-7">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-daemon.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-daemon.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-daemon.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-daemon.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-daemon.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-7"><a class="header" href="#miscellaneous-global-options-7">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-daemon.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-daemon.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-daemon.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-daemon.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-daemon.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-50"><a class="header" href="#name-50">Name</a></h1>
<p><code>nix derivation</code> - Work with derivations, Nix's notion of a build plan.</p>
<h1 id="synopsis-50"><a class="header" href="#synopsis-50">Synopsis</a></h1>
<p><code>nix derivation</code> [<em>option</em>...] <em>subcommand</em></p>
<p>where <em>subcommand</em> is one of the following:</p>
<ul>
<li><a href="command-ref/new-cli/./nix3-derivation-add.html"><code>nix derivation add</code></a> - Add a store derivation</li>
<li><a href="command-ref/new-cli/./nix3-derivation-show.html"><code>nix derivation show</code></a> - show the contents of a store derivation</li>
</ul>
<h1 id="options-47"><a class="header" href="#options-47">Options</a></h1>
<h2 id="logging-related-options-8"><a class="header" href="#logging-related-options-8">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-derivation.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-derivation.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-derivation.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-derivation.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-derivation.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-8"><a class="header" href="#miscellaneous-global-options-8">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-derivation.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-derivation.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-derivation.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-derivation.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-derivation.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-51"><a class="header" href="#name-51">Name</a></h1>
<p><code>nix derivation add</code> - Add a store derivation</p>
<h1 id="synopsis-51"><a class="header" href="#synopsis-51">Synopsis</a></h1>
<p><code>nix derivation add</code> [<em>option</em>...]</p>
<h1 id="description-47"><a class="header" href="#description-47">Description</a></h1>
<p>This command reads from standard input a JSON representation of a
<a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a>.</p>
<p>Store derivations are used internally by Nix. They are store paths with
extension <code>.drv</code> that represent the build-time dependency graph to which
a Nix expression evaluates.</p>
<p><code>nix derivation add</code> takes a single derivation in the following format:</p>
<h1 id="derivation-json-format"><a class="header" href="#derivation-json-format">Derivation JSON Format</a></h1>
<blockquote>
<p><strong>Warning</strong></p>
<p>This JSON format is currently
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and subject to change.</p>
</blockquote>
<p>The JSON serialization of a
<a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">derivations</a>
is a JSON object with the following fields:</p>
<ul>
<li>
<p><code>name</code>:
The name of the derivation.
This is used when calculating the store paths of the derivation's outputs.</p>
</li>
<li>
<p><code>outputs</code>:
Information about the output paths of the derivation.
This is a JSON object with one member per output, where the key is the output name and the value is a JSON object with these fields:</p>
<ul>
<li>
<p><code>path</code>:
The output path, if it is known in advanced.
Otherwise, <code>null</code>.</p>
</li>
<li>
<p><code>method</code>:
For an output which will be [content addresed], a string representing the <a href="command-ref/new-cli/../../store/store-object/content-address.html">method</a> of content addressing that is chosen.
Valid method strings are:</p>
<ul>
<li><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-flat"><code>flat</code></a></li>
<li><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-nix-archive"><code>nar</code></a></li>
<li><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-text"><code>text</code></a></li>
<li><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-git"><code>git</code></a></li>
</ul>
<p>Otherwise, <code>null</code>.</p>
</li>
<li>
<p><code>hashAlgo</code>:
For an output which will be [content addresed], the name of the hash algorithm used.
Valid algorithm strings are:</p>
<ul>
<li><code>blake3</code></li>
<li><code>md5</code></li>
<li><code>sha1</code></li>
<li><code>sha256</code></li>
<li><code>sha512</code></li>
</ul>
</li>
<li>
<p><code>hash</code>:
For fixed-output derivations, the expected content hash in base-16.</p>
</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-json">"outputs": {
  "out": {
    "path": "/nix/store/2543j7c6jn75blc3drf4g5vhb1rhdq29-source",
    "method": "nar",
    "hashAlgo": "sha256",
    "hash": "6fc80dcc62179dbc12fc0b5881275898f93444833d21b89dfe5f7fbcbb1d0d62"
  }
}
</code></pre>
</blockquote>
</li>
<li>
<p><code>inputSrcs</code>:
A list of store paths on which this derivation depends.</p>
</li>
<li>
<p><code>inputDrvs</code>:
A JSON object specifying the derivations on which this derivation depends, and what outputs of those derivations.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-json">"inputDrvs": {
  "/nix/store/6lkh5yi7nlb7l6dr8fljlli5zfd9hq58-curl-7.73.0.drv": ["dev"],
  "/nix/store/fn3kgnfzl5dzym26j8g907gq3kbm8bfh-unzip-6.0.drv": ["out"]
}
</code></pre>
</blockquote>
<p>specifies that this derivation depends on the <code>dev</code> output of <code>curl</code>, and the <code>out</code> output of <code>unzip</code>.</p>
</li>
<li>
<p><code>system</code>:
The system type on which this derivation is to be built
(e.g. <code>x86_64-linux</code>).</p>
</li>
<li>
<p><code>builder</code>:
The absolute path of the program to be executed to run the build.
Typically this is the <code>bash</code> shell
(e.g. <code>/nix/store/r3j288vpmczbl500w6zz89gyfa4nr0b1-bash-4.4-p23/bin/bash</code>).</p>
</li>
<li>
<p><code>args</code>:
The command-line arguments passed to the <code>builder</code>.</p>
</li>
<li>
<p><code>env</code>:
The environment passed to the <code>builder</code>.</p>
</li>
</ul>
<h1 id="options-48"><a class="header" href="#options-48">Options</a></h1>
<ul>
<li>
<p><span id="opt-dry-run"><a href="command-ref/new-cli/nix3-derivation-add.html#opt-dry-run"><code>--dry-run</code></a></span></p>
<p>Show what this command would do without doing it.</p>
</li>
</ul>
<h2 id="logging-related-options-9"><a class="header" href="#logging-related-options-9">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-derivation-add.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-derivation-add.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-derivation-add.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-derivation-add.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-derivation-add.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-9"><a class="header" href="#miscellaneous-global-options-9">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-derivation-add.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-derivation-add.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-derivation-add.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-derivation-add.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-derivation-add.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-52"><a class="header" href="#name-52">Name</a></h1>
<p><code>nix derivation show</code> - show the contents of a store derivation</p>
<h1 id="synopsis-52"><a class="header" href="#synopsis-52">Synopsis</a></h1>
<p><code>nix derivation show</code> [<em>option</em>...] <em>installables</em>...</p>
<h1 id="examples-31"><a class="header" href="#examples-31">Examples</a></h1>
<ul>
<li>
<p>Show the <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> that results from evaluating the Hello
package:</p>
<pre><code class="language-console"># nix derivation show nixpkgs#hello
{
  "/nix/store/s6rn4jz1sin56rf4qj5b5v8jxjm32hlk-hello-2.10.drv": {
    …
  }
}
</code></pre>
</li>
<li>
<p>Show the full derivation graph (if available) that produced your
NixOS system:</p>
<pre><code class="language-console"># nix derivation show -r /run/current-system
</code></pre>
</li>
<li>
<p>Print all files fetched using <code>fetchurl</code> by Firefox's dependency
graph:</p>
<pre><code class="language-console"># nix derivation show -r nixpkgs#firefox \
  | jq -r '.[] | select(.outputs.out.hash and .env.urls) | .env.urls' \
  | uniq | sort
</code></pre>
<p>Note that <code>.outputs.out.hash</code> selects <em>fixed-output derivations</em>
(derivations that produce output with a specified content hash),
while <code>.env.urls</code> selects derivations with a <code>urls</code> attribute.</p>
</li>
</ul>
<h1 id="description-48"><a class="header" href="#description-48">Description</a></h1>
<p>This command prints on standard output a JSON representation of the
<a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a>s to which <a href="command-ref/new-cli/./nix.html#installables"><em>installables</em></a> evaluate.</p>
<p>Store derivations are used internally by Nix. They are store paths with
extension <code>.drv</code> that represent the build-time dependency graph to which
a Nix expression evaluates.</p>
<p>By default, this command only shows top-level derivations, but with
<code>--recursive</code>, it also shows their dependencies.</p>
<p><code>nix derivation show</code> outputs a JSON map of <a href="command-ref/new-cli/../../store/store-path.html">store path</a>s to derivations in the following format:</p>
<h1 id="derivation-json-format-1"><a class="header" href="#derivation-json-format-1">Derivation JSON Format</a></h1>
<blockquote>
<p><strong>Warning</strong></p>
<p>This JSON format is currently
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and subject to change.</p>
</blockquote>
<p>The JSON serialization of a
<a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">derivations</a>
is a JSON object with the following fields:</p>
<ul>
<li>
<p><code>name</code>:
The name of the derivation.
This is used when calculating the store paths of the derivation's outputs.</p>
</li>
<li>
<p><code>outputs</code>:
Information about the output paths of the derivation.
This is a JSON object with one member per output, where the key is the output name and the value is a JSON object with these fields:</p>
<ul>
<li>
<p><code>path</code>:
The output path, if it is known in advanced.
Otherwise, <code>null</code>.</p>
</li>
<li>
<p><code>method</code>:
For an output which will be [content addresed], a string representing the <a href="command-ref/new-cli/../../store/store-object/content-address.html">method</a> of content addressing that is chosen.
Valid method strings are:</p>
<ul>
<li><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-flat"><code>flat</code></a></li>
<li><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-nix-archive"><code>nar</code></a></li>
<li><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-text"><code>text</code></a></li>
<li><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-git"><code>git</code></a></li>
</ul>
<p>Otherwise, <code>null</code>.</p>
</li>
<li>
<p><code>hashAlgo</code>:
For an output which will be [content addresed], the name of the hash algorithm used.
Valid algorithm strings are:</p>
<ul>
<li><code>blake3</code></li>
<li><code>md5</code></li>
<li><code>sha1</code></li>
<li><code>sha256</code></li>
<li><code>sha512</code></li>
</ul>
</li>
<li>
<p><code>hash</code>:
For fixed-output derivations, the expected content hash in base-16.</p>
</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-json">"outputs": {
  "out": {
    "path": "/nix/store/2543j7c6jn75blc3drf4g5vhb1rhdq29-source",
    "method": "nar",
    "hashAlgo": "sha256",
    "hash": "6fc80dcc62179dbc12fc0b5881275898f93444833d21b89dfe5f7fbcbb1d0d62"
  }
}
</code></pre>
</blockquote>
</li>
<li>
<p><code>inputSrcs</code>:
A list of store paths on which this derivation depends.</p>
</li>
<li>
<p><code>inputDrvs</code>:
A JSON object specifying the derivations on which this derivation depends, and what outputs of those derivations.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-json">"inputDrvs": {
  "/nix/store/6lkh5yi7nlb7l6dr8fljlli5zfd9hq58-curl-7.73.0.drv": ["dev"],
  "/nix/store/fn3kgnfzl5dzym26j8g907gq3kbm8bfh-unzip-6.0.drv": ["out"]
}
</code></pre>
</blockquote>
<p>specifies that this derivation depends on the <code>dev</code> output of <code>curl</code>, and the <code>out</code> output of <code>unzip</code>.</p>
</li>
<li>
<p><code>system</code>:
The system type on which this derivation is to be built
(e.g. <code>x86_64-linux</code>).</p>
</li>
<li>
<p><code>builder</code>:
The absolute path of the program to be executed to run the build.
Typically this is the <code>bash</code> shell
(e.g. <code>/nix/store/r3j288vpmczbl500w6zz89gyfa4nr0b1-bash-4.4-p23/bin/bash</code>).</p>
</li>
<li>
<p><code>args</code>:
The command-line arguments passed to the <code>builder</code>.</p>
</li>
<li>
<p><code>env</code>:
The environment passed to the <code>builder</code>.</p>
</li>
</ul>
<h1 id="options-49"><a class="header" href="#options-49">Options</a></h1>
<ul>
<li>
<p><span id="opt-recursive"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-recursive"><code>--recursive</code></a></span> / <code>-r</code></p>
<p>Include the dependencies of the specified derivations.</p>
</li>
<li>
<p><span id="opt-stdin"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-stdin"><code>--stdin</code></a></span></p>
<p>Read installables from the standard input. No default installable applied.</p>
</li>
</ul>
<h2 id="common-evaluation-options-3"><a class="header" href="#common-evaluation-options-3">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-3"><a class="header" href="#common-flake-related-options-3">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-10"><a class="header" href="#logging-related-options-10">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-10"><a class="header" href="#miscellaneous-global-options-10">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-3"><a class="header" href="#options-that-change-the-interpretation-of-installables-3">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-derivation-show.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-53"><a class="header" href="#name-53">Name</a></h1>
<p><code>nix develop</code> - run a bash shell that provides the build environment of a derivation</p>
<h1 id="synopsis-53"><a class="header" href="#synopsis-53">Synopsis</a></h1>
<p><code>nix develop</code> [<em>option</em>...] <em>installable</em></p>
<h1 id="examples-32"><a class="header" href="#examples-32">Examples</a></h1>
<ul>
<li>
<p>Start a shell with the build environment of the default package of
the flake in the current directory:</p>
<pre><code class="language-console"># nix develop
</code></pre>
<p>Typical commands to run inside this shell are:</p>
<pre><code class="language-console"># configurePhase
# buildPhase
# installPhase
</code></pre>
<p>Alternatively, you can run whatever build tools your project uses
directly, e.g. for a typical Unix project:</p>
<pre><code class="language-console"># ./configure --prefix=$out
# make
# make install
</code></pre>
</li>
<li>
<p>Run a particular build phase directly:</p>
<pre><code class="language-console"># nix develop --unpack
# nix develop --configure
# nix develop --build
# nix develop --check
# nix develop --install
# nix develop --installcheck
</code></pre>
</li>
<li>
<p>Start a shell with the build environment of GNU Hello:</p>
<pre><code class="language-console"># nix develop nixpkgs#hello
</code></pre>
</li>
<li>
<p>Record a build environment in a profile:</p>
<pre><code class="language-console"># nix develop --profile /tmp/my-build-env nixpkgs#hello
</code></pre>
</li>
<li>
<p>Use a build environment previously recorded in a profile:</p>
<pre><code class="language-console"># nix develop /tmp/my-build-env
</code></pre>
</li>
<li>
<p>Replace all occurrences of the store path corresponding to
<code>glibc.dev</code> with a writable directory:</p>
<pre><code class="language-console"># nix develop --redirect nixpkgs#glibc.dev ~/my-glibc/outputs/dev
</code></pre>
<p>Note that this is useful if you're running a <code>nix develop</code> shell for
<code>nixpkgs#glibc</code> in <code>~/my-glibc</code> and want to compile another package
against it.</p>
</li>
<li>
<p>Run a series of script commands:</p>
<pre><code class="language-console"># nix develop --command bash -c "mkdir build &amp;&amp; cmake .. &amp;&amp; make"
</code></pre>
</li>
</ul>
<h1 id="description-49"><a class="header" href="#description-49">Description</a></h1>
<p><code>nix develop</code> starts a <code>bash</code> shell that provides an interactive build
environment nearly identical to what Nix would use to build
<a href="command-ref/new-cli/./nix.html#installables"><em>installable</em></a>. Inside this shell, environment variables and shell
functions are set up so that you can interactively and incrementally
build your package.</p>
<p>Nix determines the build environment by building a modified version of
the derivation <em>installable</em> that just records the environment
initialised by <code>stdenv</code> and exits. This build environment can be
recorded into a profile using <code>--profile</code>.</p>
<p>The prompt used by the <code>bash</code> shell can be customised by setting the
<code>bash-prompt</code>, <code>bash-prompt-prefix</code>, and <code>bash-prompt-suffix</code> settings in
<code>nix.conf</code> or in the flake's <code>nixConfig</code> attribute.</p>
<h1 id="flake-output-attributes-1"><a class="header" href="#flake-output-attributes-1">Flake output attributes</a></h1>
<p>If no flake output attribute is given, <code>nix develop</code> tries the following
flake output attributes:</p>
<ul>
<li>
<p><code>devShells.&lt;system&gt;.default</code></p>
</li>
<li>
<p><code>packages.&lt;system&gt;.default</code></p>
</li>
</ul>
<p>If a flake output <em>name</em> is given, <code>nix develop</code> tries the following flake
output attributes:</p>
<ul>
<li>
<p><code>devShells.&lt;system&gt;.&lt;name&gt;</code></p>
</li>
<li>
<p><code>packages.&lt;system&gt;.&lt;name&gt;</code></p>
</li>
<li>
<p><code>legacyPackages.&lt;system&gt;.&lt;name&gt;</code></p>
</li>
</ul>
<h1 id="options-50"><a class="header" href="#options-50">Options</a></h1>
<ul>
<li>
<p><span id="opt-build"><a href="command-ref/new-cli/nix3-develop.html#opt-build"><code>--build</code></a></span></p>
<p>Run the <code>build</code> phase.</p>
</li>
<li>
<p><span id="opt-check"><a href="command-ref/new-cli/nix3-develop.html#opt-check"><code>--check</code></a></span></p>
<p>Run the <code>check</code> phase.</p>
</li>
<li>
<p><span id="opt-command"><a href="command-ref/new-cli/nix3-develop.html#opt-command"><code>--command</code></a></span> / <code>-c</code> <em>command</em> <em>args</em></p>
<p>Instead of starting an interactive shell, start the specified command and arguments.</p>
</li>
<li>
<p><span id="opt-configure"><a href="command-ref/new-cli/nix3-develop.html#opt-configure"><code>--configure</code></a></span></p>
<p>Run the <code>configure</code> phase.</p>
</li>
<li>
<p><span id="opt-install"><a href="command-ref/new-cli/nix3-develop.html#opt-install"><code>--install</code></a></span></p>
<p>Run the <code>install</code> phase.</p>
</li>
<li>
<p><span id="opt-installcheck"><a href="command-ref/new-cli/nix3-develop.html#opt-installcheck"><code>--installcheck</code></a></span></p>
<p>Run the <code>installcheck</code> phase.</p>
</li>
<li>
<p><span id="opt-phase"><a href="command-ref/new-cli/nix3-develop.html#opt-phase"><code>--phase</code></a></span> <em>phase-name</em></p>
<p>The stdenv phase to run (e.g. <code>build</code> or <code>configure</code>).</p>
</li>
<li>
<p><span id="opt-profile"><a href="command-ref/new-cli/nix3-develop.html#opt-profile"><code>--profile</code></a></span> <em>path</em></p>
<p>The profile to operate on.</p>
</li>
<li>
<p><span id="opt-redirect"><a href="command-ref/new-cli/nix3-develop.html#opt-redirect"><code>--redirect</code></a></span> <em>installable</em> <em>outputs-dir</em></p>
<p>Redirect a store path to a mutable location.</p>
</li>
<li>
<p><span id="opt-unpack"><a href="command-ref/new-cli/nix3-develop.html#opt-unpack"><code>--unpack</code></a></span></p>
<p>Run the <code>unpack</code> phase.</p>
</li>
</ul>
<h2 id="common-evaluation-options-4"><a class="header" href="#common-evaluation-options-4">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-develop.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-develop.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-develop.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-develop.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-develop.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-develop.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-develop.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-develop.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-develop.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-4"><a class="header" href="#common-flake-related-options-4">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-develop.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-develop.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-develop.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-develop.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-develop.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-develop.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-develop.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-develop.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-develop.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-develop.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-11"><a class="header" href="#logging-related-options-11">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-develop.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-develop.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-develop.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-develop.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-develop.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-11"><a class="header" href="#miscellaneous-global-options-11">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-develop.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-develop.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-develop.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-develop.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-develop.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-develop.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-environment-variables"><a class="header" href="#options-that-change-environment-variables">Options that change environment variables</a></h2>
<ul>
<li>
<p><span id="opt-ignore-env"><a href="command-ref/new-cli/nix3-develop.html#opt-ignore-env"><code>--ignore-env</code></a></span> / <code>-i</code></p>
<p>Clear the entire environment, except for those specified with <code>--keep-env-var</code>.</p>
</li>
<li>
<p><span id="opt-keep-env-var"><a href="command-ref/new-cli/nix3-develop.html#opt-keep-env-var"><code>--keep-env-var</code></a></span> / <code>-k</code> <em>name</em></p>
<p>Keep the environment variable <em>name</em>, when using <code>--ignore-env</code>.</p>
</li>
<li>
<p><span id="opt-set-env-var"><a href="command-ref/new-cli/nix3-develop.html#opt-set-env-var"><code>--set-env-var</code></a></span> / <code>-s</code> <em>name</em> <em>value</em></p>
<p>Sets an environment variable <em>name</em> with <em>value</em>.</p>
</li>
<li>
<p><span id="opt-unset-env-var"><a href="command-ref/new-cli/nix3-develop.html#opt-unset-env-var"><code>--unset-env-var</code></a></span> / <code>-u</code> <em>name</em></p>
<p>Unset the environment variable <em>name</em>.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-4"><a class="header" href="#options-that-change-the-interpretation-of-installables-4">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-develop.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-develop.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-54"><a class="header" href="#name-54">Name</a></h1>
<p><code>nix edit</code> - open the Nix expression of a Nix package in $EDITOR</p>
<h1 id="synopsis-54"><a class="header" href="#synopsis-54">Synopsis</a></h1>
<p><code>nix edit</code> [<em>option</em>...] <em>installable</em></p>
<h1 id="examples-33"><a class="header" href="#examples-33">Examples</a></h1>
<ul>
<li>
<p>Open the Nix expression of the GNU Hello package:</p>
<pre><code class="language-console"># nix edit nixpkgs#hello
</code></pre>
</li>
<li>
<p>Get the filename and line number used by <code>nix edit</code>:</p>
<pre><code class="language-console"># nix eval --raw nixpkgs#hello.meta.position
/nix/store/fvafw0gvwayzdan642wrv84pzm5bgpmy-source/pkgs/applications/misc/hello/default.nix:15
</code></pre>
</li>
</ul>
<h1 id="description-50"><a class="header" href="#description-50">Description</a></h1>
<p>This command opens the Nix expression of a derivation in an
editor. The filename and line number of the derivation are taken from
its <code>meta.position</code> attribute. Nixpkgs' <code>stdenv.mkDerivation</code> sets
this attribute to the location of the definition of the
<code>meta.description</code>, <code>version</code> or <code>name</code> derivation attributes.</p>
<p>The editor to invoke is specified by the <code>EDITOR</code> environment
variable. It defaults to <code>cat</code>. If the editor is <code>emacs</code>, <code>nano</code>,
<code>vim</code> or <code>kak</code>, it is passed the line number of the derivation using
the argument <code>+&lt;lineno&gt;</code>.</p>
<h1 id="options-51"><a class="header" href="#options-51">Options</a></h1>
<h2 id="common-evaluation-options-5"><a class="header" href="#common-evaluation-options-5">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-edit.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-edit.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-edit.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-edit.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-edit.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-edit.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-edit.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-edit.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-edit.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-5"><a class="header" href="#common-flake-related-options-5">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-edit.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-edit.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-edit.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-edit.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-edit.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-edit.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-edit.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-edit.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-edit.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-edit.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-12"><a class="header" href="#logging-related-options-12">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-edit.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-edit.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-edit.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-edit.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-edit.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-12"><a class="header" href="#miscellaneous-global-options-12">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-edit.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-edit.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-edit.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-edit.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-edit.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-edit.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-5"><a class="header" href="#options-that-change-the-interpretation-of-installables-5">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-edit.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-edit.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-55"><a class="header" href="#name-55">Name</a></h1>
<p><code>nix env</code> - manipulate the process environment</p>
<h1 id="synopsis-55"><a class="header" href="#synopsis-55">Synopsis</a></h1>
<p><code>nix env</code> [<em>option</em>...] <em>subcommand</em></p>
<p>where <em>subcommand</em> is one of the following:</p>
<ul>
<li><a href="command-ref/new-cli/./nix3-env-shell.html"><code>nix env shell</code></a> - run a shell in which the specified packages are available</li>
</ul>
<h1 id="options-52"><a class="header" href="#options-52">Options</a></h1>
<h2 id="logging-related-options-13"><a class="header" href="#logging-related-options-13">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-env.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-env.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-env.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-env.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-env.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-13"><a class="header" href="#miscellaneous-global-options-13">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-env.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-env.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-env.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-env.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-env.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-56"><a class="header" href="#name-56">Name</a></h1>
<p><code>nix env shell</code> - run a shell in which the specified packages are available</p>
<h1 id="synopsis-56"><a class="header" href="#synopsis-56">Synopsis</a></h1>
<p><code>nix env shell</code> [<em>option</em>...] <em>installables</em>...</p>
<h1 id="examples-34"><a class="header" href="#examples-34">Examples</a></h1>
<ul>
<li>
<p>Start a shell providing <code>youtube-dl</code> from the <code>nixpkgs</code> flake:</p>
<pre><code class="language-console"># nix shell nixpkgs#youtube-dl
# youtube-dl --version
2020.11.01.1
</code></pre>
</li>
<li>
<p>Start a shell providing GNU Hello from NixOS 20.03:</p>
<pre><code class="language-console"># nix shell nixpkgs/nixos-20.03#hello
</code></pre>
</li>
<li>
<p>Run GNU Hello:</p>
<pre><code class="language-console"># nix shell nixpkgs#hello --command hello --greeting 'Hi everybody!'
Hi everybody!
</code></pre>
</li>
<li>
<p>Run multiple commands in a shell environment:</p>
<pre><code class="language-console"># nix shell nixpkgs#gnumake --command sh -c "cd src &amp;&amp; make"
</code></pre>
</li>
<li>
<p>Run GNU Hello in a chroot store:</p>
<pre><code class="language-console"># nix shell --store ~/my-nix nixpkgs#hello --command hello
</code></pre>
</li>
<li>
<p>Start a shell providing GNU Hello in a chroot store:</p>
<pre><code class="language-console"># nix shell --store ~/my-nix nixpkgs#hello nixpkgs#bashInteractive --command bash
</code></pre>
<p>Note that it's necessary to specify <code>bash</code> explicitly because your
default shell (e.g. <code>/bin/bash</code>) generally will not exist in the
chroot.</p>
</li>
</ul>
<h1 id="description-51"><a class="header" href="#description-51">Description</a></h1>
<p><code>nix shell</code> runs a command in an environment in which the <code>$PATH</code> variable
provides the specified <a href="command-ref/new-cli/./nix.html#installables"><em>installables</em></a>. If no command is specified, it starts the
default shell of your user account specified by <code>$SHELL</code>.</p>
<h1 id="use-as-a--interpreter-1"><a class="header" href="#use-as-a--interpreter-1">Use as a <code>#!</code>-interpreter</a></h1>
<p>You can use <code>nix</code> as a script interpreter to allow scripts written
in arbitrary languages to obtain their own dependencies via Nix. This is
done by starting the script with the following lines:</p>
<pre><code class="language-bash">#! /usr/bin/env nix
#! nix shell installables --command real-interpreter
</code></pre>
<p>where <em>real-interpreter</em> is the “real” script interpreter that will be
invoked by <code>nix shell</code> after it has obtained the dependencies and
initialised the environment, and <em>installables</em> are the attribute names of
the dependencies in Nixpkgs.</p>
<p>The lines starting with <code>#! nix</code> specify options (see above). Note that you
cannot write <code>#! /usr/bin/env nix shell -i ...</code> because many operating systems
only allow one argument in <code>#!</code> lines.</p>
<p>For example, here is a Python script that depends on Python and the
<code>prettytable</code> package:</p>
<pre><code class="language-python">#! /usr/bin/env nix
#! nix shell github:tomberek/-#python3With.prettytable --command python

import prettytable

# Print a simple table.
t = prettytable.PrettyTable(["N", "N^2"])
for n in range(1, 10): t.add_row([n, n * n])
print t
</code></pre>
<p>Similarly, the following is a Perl script that specifies that it
requires Perl and the <code>HTML::TokeParser::Simple</code> and <code>LWP</code> packages:</p>
<pre><code class="language-perl">#! /usr/bin/env nix
#! nix shell github:tomberek/-#perlWith.HTMLTokeParserSimple.LWP --command perl -x

use HTML::TokeParser::Simple;

# Fetch nixos.org and print all hrefs.
my $p = HTML::TokeParser::Simple-&gt;new(url =&gt; 'http://nixos.org/');

while (my $token = $p-&gt;get_tag("a")) {
    my $href = $token-&gt;get_attr("href");
    print "$href\n" if $href;
}
</code></pre>
<p>Sometimes you need to pass a simple Nix expression to customize a
package like Terraform:</p>
<pre><code class="language-bash">#! /usr/bin/env nix
#! nix shell --impure --expr ``
#! nix with (import (builtins.getFlake ''nixpkgs'') {});
#! nix terraform.withPlugins (plugins: [ plugins.openstack ])
#! nix ``
#! nix --command bash

terraform "$@"
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>You must use double backticks (<code>``</code>) when passing a simple Nix expression
in a nix shell shebang.</p>
</blockquote>
<p>Finally, using the merging of multiple nix shell shebangs the following
Haskell script uses a specific branch of Nixpkgs/NixOS (the 21.11 stable
branch):</p>
<pre><code class="language-haskell">#!/usr/bin/env nix
#!nix shell --override-input nixpkgs github:NixOS/nixpkgs/nixos-21.11
#!nix github:tomberek/-#haskellWith.download-curl.tagsoup --command runghc

import Network.Curl.Download
import Text.HTML.TagSoup
import Data.Either
import Data.ByteString.Char8 (unpack)

-- Fetch nixos.org and print all hrefs.
main = do
  resp &lt;- openURI "https://nixos.org/"
  let tags = filter (isTagOpenName "a") $ parseTags $ unpack $ fromRight undefined resp
  let tags' = map (fromAttrib "href") tags
  mapM_ putStrLn $ filter (/= "") tags'
</code></pre>
<p>If you want to be even more precise, you can specify a specific revision
of Nixpkgs:</p>
<pre><code>#!nix shell --override-input nixpkgs github:NixOS/nixpkgs/eabc38219184cc3e04a974fe31857d8e0eac098d
</code></pre>
<p>You can also use a Nix expression to build your own dependencies. For example,
the Python example could have been written as:</p>
<pre><code class="language-python">#! /usr/bin/env nix
#! nix shell --impure --file deps.nix -i python
</code></pre>
<p>where the file <code>deps.nix</code> in the same directory as the <code>#!</code>-script
contains:</p>
<pre><code class="language-nix">with import &lt;nixpkgs&gt; {};
python3.withPackages (ps: with ps; [ prettytable ])
</code></pre>
<h1 id="options-53"><a class="header" href="#options-53">Options</a></h1>
<ul>
<li>
<p><span id="opt-command"><a href="command-ref/new-cli/nix3-env-shell.html#opt-command"><code>--command</code></a></span> / <code>-c</code> <em>command</em> <em>args</em></p>
<p>Command and arguments to be executed, defaulting to <code>$SHELL</code></p>
</li>
<li>
<p><span id="opt-stdin"><a href="command-ref/new-cli/nix3-env-shell.html#opt-stdin"><code>--stdin</code></a></span></p>
<p>Read installables from the standard input. No default installable applied.</p>
</li>
</ul>
<h2 id="common-evaluation-options-6"><a class="header" href="#common-evaluation-options-6">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-env-shell.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-env-shell.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-env-shell.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-env-shell.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-env-shell.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-env-shell.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-env-shell.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-env-shell.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-env-shell.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-6"><a class="header" href="#common-flake-related-options-6">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-env-shell.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-env-shell.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-env-shell.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-env-shell.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-env-shell.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-env-shell.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-env-shell.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-env-shell.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-env-shell.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-env-shell.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-14"><a class="header" href="#logging-related-options-14">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-env-shell.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-env-shell.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-env-shell.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-env-shell.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-env-shell.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-14"><a class="header" href="#miscellaneous-global-options-14">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-env-shell.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-env-shell.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-env-shell.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-env-shell.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-env-shell.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-env-shell.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-environment-variables-1"><a class="header" href="#options-that-change-environment-variables-1">Options that change environment variables</a></h2>
<ul>
<li>
<p><span id="opt-ignore-env"><a href="command-ref/new-cli/nix3-env-shell.html#opt-ignore-env"><code>--ignore-env</code></a></span> / <code>-i</code></p>
<p>Clear the entire environment, except for those specified with <code>--keep-env-var</code>.</p>
</li>
<li>
<p><span id="opt-keep-env-var"><a href="command-ref/new-cli/nix3-env-shell.html#opt-keep-env-var"><code>--keep-env-var</code></a></span> / <code>-k</code> <em>name</em></p>
<p>Keep the environment variable <em>name</em>, when using <code>--ignore-env</code>.</p>
</li>
<li>
<p><span id="opt-set-env-var"><a href="command-ref/new-cli/nix3-env-shell.html#opt-set-env-var"><code>--set-env-var</code></a></span> / <code>-s</code> <em>name</em> <em>value</em></p>
<p>Sets an environment variable <em>name</em> with <em>value</em>.</p>
</li>
<li>
<p><span id="opt-unset-env-var"><a href="command-ref/new-cli/nix3-env-shell.html#opt-unset-env-var"><code>--unset-env-var</code></a></span> / <code>-u</code> <em>name</em></p>
<p>Unset the environment variable <em>name</em>.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-6"><a class="header" href="#options-that-change-the-interpretation-of-installables-6">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-env-shell.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-env-shell.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-57"><a class="header" href="#name-57">Name</a></h1>
<p><code>nix eval</code> - evaluate a Nix expression</p>
<h1 id="synopsis-57"><a class="header" href="#synopsis-57">Synopsis</a></h1>
<p><code>nix eval</code> [<em>option</em>...] <em>installable</em></p>
<h1 id="examples-35"><a class="header" href="#examples-35">Examples</a></h1>
<ul>
<li>
<p>Evaluate a Nix expression given on the command line:</p>
<pre><code class="language-console"># nix eval --expr '1 + 2'
</code></pre>
</li>
<li>
<p>Evaluate a Nix expression to JSON:</p>
<pre><code class="language-console"># nix eval --json --expr '{ x = 1; }'
{"x":1}
</code></pre>
</li>
<li>
<p>Evaluate a Nix expression from a file:</p>
<pre><code class="language-console"># nix eval --file ./my-nixpkgs hello.name
</code></pre>
</li>
<li>
<p>Get the current version of the <code>nixpkgs</code> flake:</p>
<pre><code class="language-console"># nix eval --raw nixpkgs#lib.version
</code></pre>
</li>
<li>
<p>Print the store path of the Hello package:</p>
<pre><code class="language-console"># nix eval --raw nixpkgs#hello
</code></pre>
</li>
<li>
<p>Get a list of checks in the <code>nix</code> flake:</p>
<pre><code class="language-console"># nix eval nix#checks.x86_64-linux --apply builtins.attrNames
</code></pre>
</li>
<li>
<p>Generate a directory with the specified contents:</p>
<pre><code class="language-console"># nix eval --write-to ./out --expr '{ foo = "bar"; subdir.bla = "123"; }'
# cat ./out/foo
bar
# cat ./out/subdir/bla
123

</code></pre>
</li>
</ul>
<h1 id="description-52"><a class="header" href="#description-52">Description</a></h1>
<p>This command evaluates the given Nix expression, and prints the result on standard output.</p>
<p>It also evaluates any nested attribute values and list items.</p>
<h1 id="output-format"><a class="header" href="#output-format">Output format</a></h1>
<p><code>nix eval</code> can produce output in several formats:</p>
<ul>
<li>
<p>By default, the evaluation result is printed as a Nix expression.</p>
</li>
<li>
<p>With <code>--json</code>, the evaluation result is printed in JSON format. Note
that this fails if the result contains values that are not
representable as JSON, such as functions.</p>
</li>
<li>
<p>With <code>--raw</code>, the evaluation result must be a string, which is
printed verbatim, without any quoting.</p>
</li>
<li>
<p>With <code>--write-to</code> <em>path</em>, the evaluation result must be a string or
a nested attribute set whose leaf values are strings. These strings
are written to files named <em>path</em>/<em>attrpath</em>. <em>path</em> must not
already exist.</p>
</li>
</ul>
<h1 id="options-54"><a class="header" href="#options-54">Options</a></h1>
<ul>
<li>
<p><span id="opt-apply"><a href="command-ref/new-cli/nix3-eval.html#opt-apply"><code>--apply</code></a></span> <em>expr</em></p>
<p>Apply the function <em>expr</em> to each argument.</p>
</li>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-eval.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
<li>
<p><span id="opt-raw"><a href="command-ref/new-cli/nix3-eval.html#opt-raw"><code>--raw</code></a></span></p>
<p>Print strings without quotes or escaping.</p>
</li>
<li>
<p><span id="opt-read-only"><a href="command-ref/new-cli/nix3-eval.html#opt-read-only"><code>--read-only</code></a></span></p>
<p>Do not instantiate each evaluated derivation. This improves performance, but can cause errors when accessing store paths of derivations during evaluation.</p>
</li>
<li>
<p><span id="opt-write-to"><a href="command-ref/new-cli/nix3-eval.html#opt-write-to"><code>--write-to</code></a></span> <em>path</em></p>
<p>Write a string or attrset of strings to <em>path</em>.</p>
</li>
</ul>
<h2 id="common-evaluation-options-7"><a class="header" href="#common-evaluation-options-7">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-eval.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-eval.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-eval.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-eval.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-eval.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-eval.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-eval.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-eval.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-eval.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-7"><a class="header" href="#common-flake-related-options-7">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-eval.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-eval.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-eval.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-eval.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-eval.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-eval.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-eval.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-eval.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-eval.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-eval.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-15"><a class="header" href="#logging-related-options-15">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-eval.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-eval.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-eval.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-eval.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-eval.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-15"><a class="header" href="#miscellaneous-global-options-15">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-eval.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-eval.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-eval.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-eval.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-eval.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-eval.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-7"><a class="header" href="#options-that-change-the-interpretation-of-installables-7">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-eval.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-eval.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-58"><a class="header" href="#name-58">Name</a></h1>
<p><code>nix flake</code> - manage Nix flakes</p>
<h1 id="synopsis-58"><a class="header" href="#synopsis-58">Synopsis</a></h1>
<p><code>nix flake</code> [<em>option</em>...] <em>subcommand</em></p>
<p>where <em>subcommand</em> is one of the following:</p>
<ul>
<li><a href="command-ref/new-cli/./nix3-flake-archive.html"><code>nix flake archive</code></a> - copy a flake and all its inputs to a store</li>
<li><a href="command-ref/new-cli/./nix3-flake-check.html"><code>nix flake check</code></a> - check whether the flake evaluates and run its tests</li>
<li><a href="command-ref/new-cli/./nix3-flake-clone.html"><code>nix flake clone</code></a> - clone flake repository</li>
<li><a href="command-ref/new-cli/./nix3-flake-info.html"><code>nix flake info</code></a> - show flake metadata</li>
<li><a href="command-ref/new-cli/./nix3-flake-init.html"><code>nix flake init</code></a> - create a flake in the current directory from a template</li>
<li><a href="command-ref/new-cli/./nix3-flake-lock.html"><code>nix flake lock</code></a> - create missing lock file entries</li>
<li><a href="command-ref/new-cli/./nix3-flake-metadata.html"><code>nix flake metadata</code></a> - show flake metadata</li>
<li><a href="command-ref/new-cli/./nix3-flake-new.html"><code>nix flake new</code></a> - create a flake in the specified directory from a template</li>
<li><a href="command-ref/new-cli/./nix3-flake-prefetch.html"><code>nix flake prefetch</code></a> - download the source tree denoted by a flake reference into the Nix store</li>
<li><a href="command-ref/new-cli/./nix3-flake-show.html"><code>nix flake show</code></a> - show the outputs provided by a flake</li>
<li><a href="command-ref/new-cli/./nix3-flake-update.html"><code>nix flake update</code></a> - update flake lock file</li>
</ul>
<h1 id="description-53"><a class="header" href="#description-53">Description</a></h1>
<p><code>nix flake</code> provides subcommands for creating, modifying and querying
<em>Nix flakes</em>. Flakes are the unit for packaging Nix code in a
reproducible and discoverable way. They can have dependencies on other
flakes, making it possible to have multi-repository Nix projects.</p>
<p>A flake is a filesystem tree (typically fetched from a Git repository
or a tarball) that contains a file named <code>flake.nix</code> in the root
directory. <code>flake.nix</code> specifies some metadata about the flake such as
dependencies (called <em>inputs</em>), as well as its <em>outputs</em> (the Nix
values such as packages or NixOS modules provided by the flake).</p>
<h1 id="flake-references"><a class="header" href="#flake-references">Flake references</a></h1>
<p>Flake references (<em>flakerefs</em>) are a way to specify the location of a
flake. These have two different forms:</p>
<h2 id="attribute-set-representation"><a class="header" href="#attribute-set-representation">Attribute set representation</a></h2>
<p>Example:</p>
<pre><code class="language-nix">{
  type = "github";
  owner = "NixOS";
  repo = "nixpkgs";
}
</code></pre>
<p>The only required attribute is <code>type</code>. The supported types are
listed below.</p>
<h2 id="url-like-syntax"><a class="header" href="#url-like-syntax">URL-like syntax</a></h2>
<p>Example:</p>
<pre><code>github:NixOS/nixpkgs
</code></pre>
<p>These are used on the command line as a more convenient alternative
to the attribute set representation. For instance, in the command</p>
<pre><code class="language-console"># nix build github:NixOS/nixpkgs#hello
</code></pre>
<p><code>github:NixOS/nixpkgs</code> is a flake reference (while <code>hello</code> is an
output attribute). They are also allowed in the <code>inputs</code> attribute
of a flake, e.g.</p>
<pre><code class="language-nix">inputs.nixpkgs.url = "github:NixOS/nixpkgs";
</code></pre>
<p>is equivalent to</p>
<pre><code class="language-nix">inputs.nixpkgs = {
  type = "github";
  owner = "NixOS";
  repo = "nixpkgs";
};
</code></pre>
<p>Following <a href="https://datatracker.ietf.org/doc/html/rfc3986#section-2.1">RFC 3986</a>,
characters outside of the allowed range (i.e. neither <a href="https://datatracker.ietf.org/doc/html/rfc3986#section-2.2">reserved characters</a>
nor <a href="https://datatracker.ietf.org/doc/html/rfc3986#section-2.3">unreserved characters</a>)
must be percent-encoded.</p>
<h3 id="examples-36"><a class="header" href="#examples-36">Examples</a></h3>
<p>Here are some examples of flake references in their URL-like representation:</p>
<ul>
<li><code>nixpkgs</code>: The <code>nixpkgs</code> entry in the flake registry.</li>
<li><code>nixpkgs/a3a3dda3bacf61e8a39258a0ed9c924eeca8e293</code>: The <code>nixpkgs</code>
entry in the flake registry, with its Git revision overridden to a
specific value.</li>
<li><code>github:NixOS/nixpkgs</code>: The <code>master</code> branch of the <code>NixOS/nixpkgs</code>
repository on GitHub.</li>
<li><code>github:NixOS/nixpkgs/nixos-20.09</code>: The <code>nixos-20.09</code> branch of the
<code>nixpkgs</code> repository.</li>
<li><code>github:NixOS/nixpkgs/pull/357207/head</code>: The <code>357207</code> pull request
of the nixpkgs repository.</li>
<li><code>github:NixOS/nixpkgs/a3a3dda3bacf61e8a39258a0ed9c924eeca8e293</code>: A
specific revision of the <code>nixpkgs</code> repository.</li>
<li><code>github:edolstra/nix-warez?dir=blender</code>: A flake in a subdirectory
of a GitHub repository.</li>
<li><code>git+https://github.com/NixOS/patchelf</code>: A Git repository.</li>
<li><code>git+https://github.com/NixOS/patchelf?ref=master</code>: A specific
branch of a Git repository.</li>
<li><code>git+https://github.com/NixOS/patchelf?ref=master&amp;rev=f34751b88bd07d7f44f5cd3200fb4122bf916c7e</code>:
A specific branch <em>and</em> revision of a Git repository.</li>
<li><code>https://github.com/NixOS/patchelf/archive/master.tar.gz</code>: A tarball
flake.</li>
</ul>
<h2 id="path-like-syntax"><a class="header" href="#path-like-syntax">Path-like syntax</a></h2>
<p>Flakes corresponding to a local path can also be referred to by a direct
path reference, either <code>/absolute/path/to/the/flake</code> or<code>./relative/path/to/the/flake</code>.
Note that the leading <code>./</code> is mandatory for relative paths. If it is
omitted, the path will be interpreted as <a href="command-ref/new-cli/nix3-flake.html#url-like-syntax">URL-like syntax</a>,
which will cause error messages like this:</p>
<pre><code class="language-console">error: cannot find flake 'flake:relative/path/to/the/flake' in the flake registries
</code></pre>
<p>The semantic of such a path is as follows:</p>
<ul>
<li>If the directory is part of a Git repository, then the input will be treated as a <code>git+file:</code> URL, otherwise it will be treated as a <code>path:</code> url;</li>
<li>If the directory doesn't contain a <code>flake.nix</code> file, then Nix will search for such a file upwards in the file system hierarchy until it finds any of:
<ol>
<li>The Git repository root, or</li>
<li>The filesystem root (/), or</li>
<li>A folder on a different mount point.</li>
</ol>
</li>
</ul>
<p>Contrary to URL-like references, path-like flake references can contain arbitrary unicode characters (except <code>#</code> and <code>?</code>).</p>
<h3 id="examples-37"><a class="header" href="#examples-37">Examples</a></h3>
<ul>
<li><code>.</code>: The flake to which the current directory belongs.</li>
<li><code>/home/alice/src/patchelf</code>: A flake in some other directory.</li>
<li><code>./../sub directory/with Ûñî©ôδ€</code>: A flake in another relative directory that
has Unicode characters in its name.</li>
</ul>
<h2 id="flake-reference-attributes"><a class="header" href="#flake-reference-attributes">Flake reference attributes</a></h2>
<p>The following generic flake reference attributes are supported:</p>
<ul>
<li>
<p><code>dir</code>: The subdirectory of the flake in which <code>flake.nix</code> is
located. This parameter enables having multiple flakes in a
repository or tarball. The default is the root directory of the
flake.</p>
</li>
<li>
<p><code>narHash</code>: The hash of the
<a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive (NAR) serialisation</a>
(in SRI format) of the
contents of the flake. This is useful for flake types such as
tarballs that lack a unique content identifier such as a Git commit
hash.</p>
</li>
</ul>
<p>In addition, the following attributes are common to several flake
reference types:</p>
<ul>
<li>
<p><code>rev</code>: A Git or Mercurial commit hash.</p>
</li>
<li>
<p><code>ref</code>: A Git or Mercurial branch or tag name.</p>
</li>
</ul>
<p>Finally, some attributes are typically not specified by the user, but
can occur in <em>locked</em> flake references and are available to Nix code:</p>
<ul>
<li>
<p><code>revCount</code>: The number of ancestors of the commit <code>rev</code>.</p>
</li>
<li>
<p><code>lastModified</code>: The timestamp (in seconds since the Unix epoch) of
the last modification of this version of the flake. For
Git/Mercurial flakes, this is the commit time of commit <em>rev</em>, while
for tarball flakes, it's the most recent timestamp of any file
inside the tarball.</p>
</li>
</ul>
<h2 id="types"><a class="header" href="#types">Types</a></h2>
<p>Currently the <code>type</code> attribute can be one of the following:</p>
<ul>
<li>
<p><code>indirect</code>: <em>The default</em>. These are symbolic references to flakes
that are looked up in <a href="command-ref/new-cli/./nix3-registry.html">the flake registries</a>.
These have the form</p>
<pre><code>[flake:]&lt;flake-id&gt;(/&lt;rev-or-ref&gt;(/rev)?)?
</code></pre>
<p>These perform a lookup of <code>&lt;flake-id&gt;</code> in the flake registry. For
example, <code>nixpkgs</code> and <code>nixpkgs/release-20.09</code> are indirect flake
references. The specified <code>rev</code> and/or <code>ref</code> are merged with the
entry in the registry; see <a href="command-ref/new-cli/./nix3-registry.html">nix registry</a> for
details.</p>
<p>For example, these are valid indirect flake references:</p>
<ul>
<li><code>nixpkgs</code></li>
<li><code>nixpkgs/nixos-unstable</code></li>
<li><code>nixpkgs/a3a3dda3bacf61e8a39258a0ed9c924eeca8e293</code></li>
<li><code>nixpkgs/nixos-unstable/a3a3dda3bacf61e8a39258a0ed9c924eeca8e293</code></li>
<li><code>sub/dir</code> (if a flake named <code>sub</code> is in the registry)</li>
</ul>
</li>
<li>
<p><a name="path-fetcher"></a><code>path</code>: arbitrary local directories. The required attribute <code>path</code>
specifies the path of the flake. The URL form is</p>
<pre><code>path:&lt;path&gt;(\?&lt;params&gt;)?
</code></pre>
<p>where <em>path</em> is an absolute path to a directory in the file system
containing a file named <code>flake.nix</code>.</p>
<p>If the flake at <em>path</em> is not inside a git repository, the <code>path:</code>
prefix is implied and can be omitted.</p>
<p>If <em>path</em> is a relative path (i.e. if it does not start with <code>/</code>),
it is interpreted as follows:</p>
<ul>
<li>
<p>If <em>path</em> is a command line argument, it is interpreted relative
to the current directory.</p>
</li>
<li>
<p>If <em>path</em> is used in a <code>flake.nix</code>, it is interpreted relative to
the directory containing that <code>flake.nix</code>. However, the resolved
path must be in the same tree. For instance, a <code>flake.nix</code> in the
root of a tree can use <code>path:./foo</code> to access the flake in
subdirectory <code>foo</code>, but <code>path:../bar</code> is illegal. On the other
hand, a flake in the <code>/foo</code> directory of a tree can use
<code>path:../bar</code> to refer to the flake in <code>/bar</code>.</p>
</li>
</ul>
<p>Path inputs can be specified with path values in <code>flake.nix</code>. Path values are a syntax for <code>path</code> inputs, and they are converted by</p>
<ol>
<li>resolving them into relative paths, relative to the base directory of <code>flake.nix</code></li>
<li>escaping URL characters (refer to IETF RFC?)</li>
<li>prepending <code>path:</code></li>
</ol>
<p>Note that the allowed syntax for path values in flake <code>inputs</code> may be more restrictive than general Nix, so you may need to use <code>path:</code> if your path contains certain special characters. See <a href="command-ref/new-cli/../../language/syntax.html#path-literal">Path literals</a></p>
<p>Note that if you omit <code>path:</code>, relative paths must start with <code>.</code> to
avoid ambiguity with registry lookups (e.g. <code>nixpkgs</code> is a registry
lookup; <code>./nixpkgs</code> is a relative path).</p>
<p>For example, these are valid path flake references:</p>
<ul>
<li><code>path:/home/user/sub/dir</code></li>
<li><code>/home/user/sub/dir</code> (if <code>dir/flake.nix</code> is <em>not</em> in a git repository)</li>
<li><code>path:sub/dir</code></li>
<li><code>./sub/dir</code></li>
<li><code>path:../parent</code></li>
</ul>
</li>
<li>
<p><code>git</code>: Git repositories. The location of the repository is specified
by the attribute <code>url</code>.</p>
<p>They have the URL form</p>
<pre><code>git(+http|+https|+ssh|+git|+file):(//&lt;server&gt;)?&lt;path&gt;(\?&lt;params&gt;)?
</code></pre>
<p>If <em>path</em> starts with <code>/</code> (or <code>./</code> when used as an argument on the
command line) and is a local path to a git repository, the leading
<code>git:</code> or <code>+file</code> prefixes are implied and can be omitted.</p>
<p>The <code>ref</code> attribute defaults to resolving the <code>HEAD</code> reference.</p>
<p>The <code>rev</code> attribute must denote a commit that exists in the branch
or tag specified by the <code>ref</code> attribute, since Nix doesn't do a full
clone of the remote repository by default (and the Git protocol
doesn't allow fetching a <code>rev</code> without a known <code>ref</code>). The default
is the commit currently pointed to by <code>ref</code>.</p>
<p>When <code>git+file</code> is used without specifying <code>ref</code> or <code>rev</code>, files are
fetched directly from the local <code>path</code> as long as they have been added
to the Git repository. If there are uncommitted changes, the reference
is treated as dirty and a warning is printed.</p>
<p>For example, the following are valid Git flake references:</p>
<ul>
<li><code>git:/home/user/sub/dir</code></li>
<li><code>/home/user/sub/dir</code> (if <code>dir/flake.nix</code> is in a git repository)</li>
<li><code>./sub/dir</code> (when used on the command line and <code>dir/flake.nix</code> is in a git repository)</li>
<li><code>git+https://example.org/my/repo</code></li>
<li><code>git+https://example.org/my/repo?dir=flake1</code></li>
<li><code>git+https://example.org/my/repo?shallow=1</code> A shallow clone of the repository.
For large repositories, the shallow clone option can significantly speed up fresh clones compared
to non-shallow clones, while still providing faster updates than other fetch methods such as <code>tarball:</code> or <code>github:</code>.</li>
<li><code>git+ssh://git@github.com/NixOS/nix?ref=v1.2.3</code></li>
<li><code>git://github.com/edolstra/dwarffs?ref=unstable&amp;rev=e486d8d40e626a20e06d792db8cc5ac5aba9a5b4</code></li>
<li><code>git+file:///home/my-user/some-repo/some-repo</code></li>
</ul>
</li>
<li>
<p><code>mercurial</code>: Mercurial repositories. The URL form is similar to the
<code>git</code> type, except that the URL schema must be one of <code>hg+http</code>,
<code>hg+https</code>, <code>hg+ssh</code> or <code>hg+file</code>.</p>
</li>
<li>
<p><code>tarball</code>: Tarballs. The location of the tarball is specified by the
attribute <code>url</code>.</p>
<p>In URL form, the schema must be <code>tarball+http://</code>, <code>tarball+https://</code> or <code>tarball+file://</code>.
If the extension corresponds to a known archive format (<code>.zip</code>, <code>.tar</code>,
<code>.tgz</code>, <code>.tar.gz</code>, <code>.tar.xz</code>, <code>.tar.bz2</code> or <code>.tar.zst</code>), then the <code>tarball+</code>
can be dropped.</p>
<p>This can also be used to set the location of gitea/forgejo branches. <a href="command-ref/new-cli/../../protocols/tarball-fetcher.html#gitea-and-forgejo-support">See here</a></p>
</li>
<li>
<p><code>file</code>: Plain files or directory tarballs, either over http(s) or from the local
disk.</p>
<p>In URL form, the schema must be <code>file+http://</code>, <code>file+https://</code> or <code>file+file://</code>.
If the extension doesn’t correspond to a known archive format (as defined by the
<code>tarball</code> fetcher), then the <code>file+</code> prefix can be dropped.</p>
</li>
<li>
<p><code>github</code>: A more efficient way to fetch repositories from
GitHub. The following attributes are required:</p>
<ul>
<li>
<p><code>owner</code>: The owner of the repository.</p>
</li>
<li>
<p><code>repo</code>: The name of the repository.</p>
</li>
</ul>
<p>These are downloaded as tarball archives, rather than
through Git. This is often much faster and uses less disk space
since it doesn't require fetching the entire history of the
repository. On the other hand, it doesn't allow incremental fetching
(but full downloads are often faster than incremental fetches!).</p>
<p>The URL syntax for <code>github</code> flakes is:</p>
<pre><code>github:&lt;owner&gt;/&lt;repo&gt;(/&lt;rev-or-ref&gt;)?(\?&lt;params&gt;)?
</code></pre>
<p><code>&lt;rev-or-ref&gt;</code> specifies the name of a branch or tag (<code>ref</code>), or a
commit hash (<code>rev</code>). Note that unlike Git, GitHub allows fetching by
commit hash without specifying a branch or tag.</p>
<p>You can also specify <code>host</code> as a parameter, to point to a custom GitHub
Enterprise server.</p>
<p>Some examples:</p>
<ul>
<li><code>github:edolstra/dwarffs</code></li>
<li><code>github:edolstra/dwarffs/unstable</code></li>
<li><code>github:edolstra/dwarffs/d3f2baba8f425779026c6ec04021b2e927f61e31</code></li>
<li><code>github:internal/project?host=company-github.example.org</code></li>
</ul>
</li>
<li>
<p><code>gitlab</code>: Similar to <code>github</code>, is a more efficient way to fetch
GitLab repositories. The following attributes are required:</p>
<ul>
<li>
<p><code>owner</code>: The owner of the repository.</p>
</li>
<li>
<p><code>repo</code>: The name of the repository.</p>
</li>
</ul>
<p>Like <code>github</code>, these are downloaded as tarball archives.</p>
<p>The URL syntax for <code>gitlab</code> flakes is:</p>
<p><code>gitlab:&lt;owner&gt;/&lt;repo&gt;(/&lt;rev-or-ref&gt;)?(\?&lt;params&gt;)?</code></p>
<p><code>&lt;rev-or-ref&gt;</code> works the same as <code>github</code>. Either a branch or tag name
(<code>ref</code>), or a commit hash (<code>rev</code>) can be specified.</p>
<p>Since GitLab allows for self-hosting, you can specify <code>host</code> as
a parameter, to point to any instances other than <code>gitlab.com</code>.</p>
<p>Some examples:</p>
<ul>
<li><code>gitlab:veloren/veloren</code></li>
<li><code>gitlab:veloren/veloren/master</code></li>
<li><code>gitlab:veloren/veloren/80a4d7f13492d916e47d6195be23acae8001985a</code></li>
<li><code>gitlab:openldap/openldap?host=git.openldap.org</code></li>
</ul>
<p>When accessing a project in a (nested) subgroup, make sure to URL-encode any
slashes, i.e. replace <code>/</code> with <code>%2F</code>:</p>
<ul>
<li><code>gitlab:veloren%2Fdev/rfcs</code></li>
</ul>
</li>
<li>
<p><code>sourcehut</code>: Similar to <code>github</code>, is a more efficient way to fetch
SourceHut repositories. The following attributes are required:</p>
<ul>
<li>
<p><code>owner</code>: The owner of the repository (including leading <code>~</code>).</p>
</li>
<li>
<p><code>repo</code>: The name of the repository.</p>
</li>
</ul>
<p>Like <code>github</code>, these are downloaded as tarball archives.</p>
<p>The URL syntax for <code>sourcehut</code> flakes is:</p>
<p><code>sourcehut:&lt;owner&gt;/&lt;repo&gt;(/&lt;rev-or-ref&gt;)?(\?&lt;params&gt;)?</code></p>
<p><code>&lt;rev-or-ref&gt;</code> works the same as <code>github</code>. Either a branch or tag name
(<code>ref</code>), or a commit hash (<code>rev</code>) can be specified.</p>
<p>Since SourceHut allows for self-hosting, you can specify <code>host</code> as
a parameter, to point to any instances other than <code>git.sr.ht</code>.</p>
<p>Currently, <code>ref</code> name resolution only works for Git repositories.
You can refer to Mercurial repositories by simply changing <code>host</code> to
<code>hg.sr.ht</code> (or any other Mercurial instance). With the caveat
that you must explicitly specify a commit hash (<code>rev</code>).</p>
<p>Some examples:</p>
<ul>
<li><code>sourcehut:~misterio/nix-colors</code></li>
<li><code>sourcehut:~misterio/nix-colors/main</code></li>
<li><code>sourcehut:~misterio/nix-colors?host=git.example.org</code></li>
<li><code>sourcehut:~misterio/nix-colors/182b4b8709b8ffe4e9774a4c5d6877bf6bb9a21c</code></li>
<li><code>sourcehut:~misterio/nix-colors/21c1a380a6915d890d408e9f22203436a35bb2de?host=hg.sr.ht</code></li>
</ul>
</li>
</ul>
<h1 id="flake-format"><a class="header" href="#flake-format">Flake format</a></h1>
<p>As an example, here is a simple <code>flake.nix</code> that depends on the
Nixpkgs flake and provides a single package (i.e. an
<a href="command-ref/new-cli/./nix.html#installables">installable</a> derivation):</p>
<pre><code class="language-nix">{
  description = "A flake for building Hello World";

  inputs.nixpkgs.url = "github:NixOS/nixpkgs/nixos-20.03";

  outputs = { self, nixpkgs }: {

    packages.x86_64-linux.default =
      # Notice the reference to nixpkgs here.
      with import nixpkgs { system = "x86_64-linux"; };
      stdenv.mkDerivation {
        name = "hello";
        src = self;
        buildPhase = "gcc -o hello ./hello.c";
        installPhase = "mkdir -p $out/bin; install -t $out/bin hello";
      };

  };
}
</code></pre>
<p>The following attributes are supported in <code>flake.nix</code>:</p>
<ul>
<li>
<p><code>description</code>: A short, one-line description of the flake.</p>
</li>
<li>
<p><code>inputs</code>: An attrset specifying the dependencies of the flake
(described below).</p>
</li>
<li>
<p><code>outputs</code>: A function that, given an attribute set containing the
outputs of each of the input flakes keyed by their identifier,
yields the Nix values provided by this flake. Thus, in the example
above, <code>inputs.nixpkgs</code> contains the result of the call to the
<code>outputs</code> function of the <code>nixpkgs</code> flake.</p>
<p>In addition to the outputs of each input, each input in <code>inputs</code>
also contains some metadata about the inputs. These are:</p>
<ul>
<li>
<p><code>outPath</code>: The path in the Nix store of the flake's source tree.
This way, the attribute set can be passed to <code>import</code> as if it was a path,
as in the example above (<code>import nixpkgs</code>).</p>
</li>
<li>
<p><code>rev</code>: The commit hash of the flake's repository, if applicable.</p>
</li>
<li>
<p><code>revCount</code>: The number of ancestors of the revision <code>rev</code>. This is
not available for <code>github</code> repositories, since they're fetched as
tarballs rather than as Git repositories.</p>
</li>
<li>
<p><code>lastModifiedDate</code>: The commit time of the revision <code>rev</code>, in the
format <code>%Y%m%d%H%M%S</code> (e.g. <code>20181231100934</code>). Unlike <code>revCount</code>,
this is available for both Git and GitHub repositories, so it's
useful for generating (hopefully) monotonically increasing version
strings.</p>
</li>
<li>
<p><code>lastModified</code>: The commit time of the revision <code>rev</code> as an integer
denoting the number of seconds since 1970.</p>
</li>
<li>
<p><code>narHash</code>: The SHA-256 (in SRI format) of the
<a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive (NAR) serialisation</a>
NAR serialization of the flake's source tree.</p>
</li>
</ul>
<p>The value returned by the <code>outputs</code> function must be an attribute
set. The attributes can have arbitrary values; however, various
<code>nix</code> subcommands require specific attributes to have a specific
value (e.g. <code>packages.x86_64-linux</code> must be an attribute set of
derivations built for the <code>x86_64-linux</code> platform).</p>
</li>
<li>
<p><code>nixConfig</code>: a set of <code>nix.conf</code> options to be set when evaluating any
part of a flake. In the interests of security, only a small set of
set of options is allowed to be set without confirmation so long as <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-accept-flake-config"><code>accept-flake-config</code></a> is not enabled in the global configuration:</p>
<ul>
<li><a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-bash-prompt"><code>bash-prompt</code></a></li>
<li><a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-bash-prompt-prefix"><code>bash-prompt-prefix</code></a></li>
<li><a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-bash-prompt-suffix"><code>bash-prompt-suffix</code></a></li>
<li><a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-flake-registry"><code>flake-registry</code></a></li>
<li><a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-commit-lock-file-summary"><code>commit-lock-file-summary</code></a></li>
</ul>
</li>
</ul>
<h2 id="flake-inputs"><a class="header" href="#flake-inputs">Flake inputs</a></h2>
<p>The attribute <code>inputs</code> specifies the dependencies of a flake, as an
attrset mapping input names to flake references. For example, the
following specifies a dependency on the <code>nixpkgs</code> and <code>import-cargo</code>
repositories:</p>
<pre><code class="language-nix"># A GitHub repository.
inputs.import-cargo = {
  type = "github";
  owner = "edolstra";
  repo = "import-cargo";
};

# An indirection through the flake registry.
inputs.nixpkgs = {
  type = "indirect";
  id = "nixpkgs";
};
</code></pre>
<p>Alternatively, you can use the URL-like syntax:</p>
<pre><code class="language-nix">inputs.import-cargo.url = "github:edolstra/import-cargo";
inputs.nixpkgs.url = "nixpkgs";
</code></pre>
<p>Each input is fetched, evaluated and passed to the <code>outputs</code> function
as a set of attributes with the same name as the corresponding
input. The special input named <code>self</code> refers to the outputs and source
tree of <em>this</em> flake. Thus, a typical <code>outputs</code> function looks like
this:</p>
<pre><code class="language-nix">outputs = { self, nixpkgs, import-cargo }: {
  ... outputs ...
};
</code></pre>
<p>It is also possible to omit an input entirely and <em>only</em> list it as
expected function argument to <code>outputs</code>. Thus,</p>
<pre><code class="language-nix">outputs = { self, nixpkgs }: ...;
</code></pre>
<p>without an <code>inputs.nixpkgs</code> attribute is equivalent to</p>
<pre><code class="language-nix">inputs.nixpkgs = {
  type = "indirect";
  id = "nixpkgs";
};
</code></pre>
<p>Repositories that don't contain a <code>flake.nix</code> can also be used as
inputs, by setting the input's <code>flake</code> attribute to <code>false</code>:</p>
<pre><code class="language-nix">inputs.grcov = {
  type = "github";
  owner = "mozilla";
  repo = "grcov";
  flake = false;
};

outputs = { self, nixpkgs, grcov }: {
  packages.x86_64-linux.grcov = stdenv.mkDerivation {
    src = grcov;
    ...
  };
};
</code></pre>
<p>Transitive inputs can be overridden from a <code>flake.nix</code> file. For
example, the following overrides the <code>nixpkgs</code> input of the <code>nixops</code>
input:</p>
<pre><code class="language-nix">inputs.nixops.inputs.nixpkgs = {
  type = "github";
  owner = "my-org";
  repo = "nixpkgs";
};
</code></pre>
<p>It is also possible to "inherit" an input from another input. This is
useful to minimize flake dependencies. For example, the following sets
the <code>nixpkgs</code> input of the top-level flake to be equal to the
<code>nixpkgs</code> input of the <code>dwarffs</code> input of the top-level flake:</p>
<pre><code class="language-nix">inputs.nixpkgs.follows = "dwarffs/nixpkgs";
</code></pre>
<p>The value of the <code>follows</code> attribute is a <code>/</code>-separated sequence of
input names denoting the path of inputs to be followed from the root
flake.</p>
<p>Overrides and <code>follows</code> can be combined, e.g.</p>
<pre><code class="language-nix">inputs.nixops.inputs.nixpkgs.follows = "dwarffs/nixpkgs";
</code></pre>
<p>sets the <code>nixpkgs</code> input of <code>nixops</code> to be the same as the <code>nixpkgs</code>
input of <code>dwarffs</code>. It is worth noting, however, that it is generally
not useful to eliminate transitive <code>nixpkgs</code> flake inputs in this
way. Most flakes provide their functionality through Nixpkgs overlays
or NixOS modules, which are composed into the top-level flake's
<code>nixpkgs</code> input; so their own <code>nixpkgs</code> input is usually irrelevant.</p>
<h1 id="lock-files"><a class="header" href="#lock-files">Lock files</a></h1>
<p>Inputs specified in <code>flake.nix</code> are typically "unlocked" in the sense
that they don't specify an exact revision. To ensure reproducibility,
Nix will automatically generate and use a <em>lock file</em> called
<code>flake.lock</code> in the flake's directory.
The lock file is a UTF-8 JSON file.
It contains a graph structure isomorphic to the graph of dependencies of the root
flake. Each node in the graph (except the root node) maps the
(usually) unlocked input specifications in <code>flake.nix</code> to locked input
specifications. Each node also contains some metadata, such as the
dependencies (outgoing edges) of the node.</p>
<p>For example, if <code>flake.nix</code> has the inputs in the example above, then
the resulting lock file might be:</p>
<pre><code class="language-json">{
  "version": 7,
  "root": "n1",
  "nodes": {
    "n1": {
      "inputs": {
        "nixpkgs": "n2",
        "import-cargo": "n3",
        "grcov": "n4"
      }
    },
    "n2": {
      "inputs": {},
      "locked": {
        "owner": "edolstra",
        "repo": "nixpkgs",
        "rev": "7f8d4b088e2df7fdb6b513bc2d6941f1d422a013",
        "type": "github",
        "lastModified": 1580555482,
        "narHash": "sha256-OnpEWzNxF/AU4KlqBXM2s5PWvfI5/BS6xQrPvkF5tO8="
      },
      "original": {
        "id": "nixpkgs",
        "type": "indirect"
      }
    },
    "n3": {
      "inputs": {},
      "locked": {
        "owner": "edolstra",
        "repo": "import-cargo",
        "rev": "8abf7b3a8cbe1c8a885391f826357a74d382a422",
        "type": "github",
        "lastModified": 1567183309,
        "narHash": "sha256-wIXWOpX9rRjK5NDsL6WzuuBJl2R0kUCnlpZUrASykSc="
      },
      "original": {
        "owner": "edolstra",
        "repo": "import-cargo",
        "type": "github"
      }
    },
    "n4": {
      "inputs": {},
      "locked": {
        "owner": "mozilla",
        "repo": "grcov",
        "rev": "989a84bb29e95e392589c4e73c29189fd69a1d4e",
        "type": "github",
        "lastModified": 1580729070,
        "narHash": "sha256-235uMxYlHxJ5y92EXZWAYEsEb6mm+b069GAd+BOIOxI="
      },
      "original": {
        "owner": "mozilla",
        "repo": "grcov",
        "type": "github"
      },
      "flake": false
    }
  }
}
</code></pre>
<p>This graph has 4 nodes: the root flake, and its 3 dependencies. The
nodes have arbitrary labels (e.g. <code>n1</code>). The label of the root node of
the graph is specified by the <code>root</code> attribute. Nodes contain the
following fields:</p>
<ul>
<li>
<p><code>inputs</code>: The dependencies of this node, as a mapping from input
names (e.g. <code>nixpkgs</code>) to node labels (e.g. <code>n2</code>).</p>
</li>
<li>
<p><code>original</code>: The original input specification from <code>flake.nix</code>, as a
set of <code>builtins.fetchTree</code> arguments.</p>
</li>
<li>
<p><code>locked</code>: The locked input specification, as a set of
<code>builtins.fetchTree</code> arguments. Thus, in the example above, when we
build this flake, the input <code>nixpkgs</code> is mapped to revision
<code>7f8d4b088e2df7fdb6b513bc2d6941f1d422a013</code> of the <code>edolstra/nixpkgs</code>
repository on GitHub.</p>
<p>It also includes the attribute <code>narHash</code>, specifying the expected
contents of the tree in the Nix store (as computed by <code>nix hash-path</code>), and may include input-type-specific attributes such as
the <code>lastModified</code> or <code>revCount</code>. The main reason for these
attributes is to allow flake inputs to be substituted from a binary
cache: <code>narHash</code> allows the store path to be computed, while the
other attributes are necessary because they provide information not
stored in the store path.</p>
<p>The attributes in <code>locked</code> are considered "final", meaning that they are the only ones that are passed via the arguments of the <code>outputs</code> function of a flake.
For instance, if <code>locked</code> contains a <code>lastModified</code> attribute while the fetcher does not return a <code>lastModified</code> attribute, then the <code>lastModified</code> attribute will be passed to the <code>outputs</code> function.
Conversely, if <code>locked</code> does <em>not</em> contain a <code>lastModified</code> attribute while the fetcher <em>does</em> return a <code>lastModified</code> attribute, then no <code>lastModified</code> attribute will be passed.
If <code>locked</code> contains a <code>lastModifed</code> attribute and the fetcher returns a <code>lastModified</code> attribute, then they must have the same value.</p>
</li>
<li>
<p><code>flake</code>: A Boolean denoting whether this is a flake or non-flake
dependency. Corresponds to the <code>flake</code> attribute in the <code>inputs</code>
attribute in <code>flake.nix</code>.</p>
</li>
</ul>
<p>The <code>original</code> and <code>locked</code> attributes are omitted for the root
node. This is because we cannot record the commit hash or content hash
of the root flake, since modifying <code>flake.lock</code> will invalidate these.</p>
<p>The graph representation of lock files allows circular dependencies
between flakes. For example, here are two flakes that reference each
other:</p>
<pre><code class="language-nix">{
  inputs.b = ... location of flake B ...;
  # Tell the 'b' flake not to fetch 'a' again, to ensure its 'a' is
  # *this* 'a'.
  inputs.b.inputs.a.follows = "";
  outputs = { self, b }: {
    foo = 123 + b.bar;
    xyzzy = 1000;
  };
}
</code></pre>
<p>and</p>
<pre><code class="language-nix">{
  inputs.a = ... location of flake A ...;
  inputs.a.inputs.b.follows = "";
  outputs = { self, a }: {
    bar = 456 + a.xyzzy;
  };
}
</code></pre>
<p>Lock files transitively lock direct as well as indirect
dependencies. That is, if a lock file exists and is up to date, Nix
will not look at the lock files of dependencies. However, lock file
generation itself <em>does</em> use the lock files of dependencies by
default.</p>
<h1 id="options-55"><a class="header" href="#options-55">Options</a></h1>
<h2 id="logging-related-options-16"><a class="header" href="#logging-related-options-16">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-flake.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-flake.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-flake.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-flake.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-flake.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-16"><a class="header" href="#miscellaneous-global-options-16">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-flake.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-flake.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-flake.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-flake.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-flake.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-59"><a class="header" href="#name-59">Name</a></h1>
<p><code>nix flake archive</code> - copy a flake and all its inputs to a store</p>
<h1 id="synopsis-59"><a class="header" href="#synopsis-59">Synopsis</a></h1>
<p><code>nix flake archive</code> [<em>option</em>...] <em>flake-url</em></p>
<h1 id="examples-38"><a class="header" href="#examples-38">Examples</a></h1>
<ul>
<li>
<p>Copy the <code>dwarffs</code> flake and its dependencies to a binary cache:</p>
<pre><code class="language-console"># nix flake archive --to file:///tmp/my-cache dwarffs
</code></pre>
</li>
<li>
<p>Fetch the <code>dwarffs</code> flake and its dependencies to the local Nix
store:</p>
<pre><code class="language-console"># nix flake archive dwarffs
</code></pre>
</li>
<li>
<p>Print the store paths of the flake sources of NixOps without
fetching them:</p>
<pre><code class="language-console"># nix flake archive --json --dry-run nixops
</code></pre>
</li>
<li>
<p>Upload all flake inputs to a different machine for remote evaluation</p>
<pre><code># nix flake archive --to ssh://some-machine
</code></pre>
<p>On the remote machine the flake can then be accessed via its store path. That's computed like this:</p>
<pre><code># nix flake metadata --json | jq -r '.path'
</code></pre>
</li>
</ul>
<h1 id="description-54"><a class="header" href="#description-54">Description</a></h1>
<p>Copy a flake and all its inputs to a store. This is useful i.e. to evaluate flakes on a different host.</p>
<h1 id="options-56"><a class="header" href="#options-56">Options</a></h1>
<ul>
<li>
<p><span id="opt-dry-run"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-dry-run"><code>--dry-run</code></a></span></p>
<p>Show what this command would do without doing it.</p>
</li>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
<li>
<p><span id="opt-to"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-to"><code>--to</code></a></span> <em>store-uri</em></p>
<p>URI of the destination Nix store</p>
</li>
</ul>
<h2 id="common-evaluation-options-8"><a class="header" href="#common-evaluation-options-8">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-8"><a class="header" href="#common-flake-related-options-8">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-17"><a class="header" href="#logging-related-options-17">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-17"><a class="header" href="#miscellaneous-global-options-17">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-flake-archive.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-60"><a class="header" href="#name-60">Name</a></h1>
<p><code>nix flake check</code> - check whether the flake evaluates and run its tests</p>
<h1 id="synopsis-60"><a class="header" href="#synopsis-60">Synopsis</a></h1>
<p><code>nix flake check</code> [<em>option</em>...] <em>flake-url</em></p>
<h1 id="examples-39"><a class="header" href="#examples-39">Examples</a></h1>
<ul>
<li>
<p>Evaluate the flake in the current directory, and build its checks:</p>
<pre><code class="language-console"># nix flake check
</code></pre>
</li>
<li>
<p>Verify that the <code>patchelf</code> flake evaluates, but don't build its
checks:</p>
<pre><code class="language-console"># nix flake check --no-build github:NixOS/patchelf
</code></pre>
</li>
</ul>
<h1 id="description-55"><a class="header" href="#description-55">Description</a></h1>
<p>This command verifies that the flake specified by flake reference
<em>flake-url</em> can be evaluated successfully (as detailed below), and
that the derivations specified by the flake's <code>checks</code> output can be
built successfully.</p>
<p>If the <code>keep-going</code> option is set to <code>true</code>, Nix will keep evaluating as much
as it can and report the errors as it encounters them. Otherwise it will stop
at the first error.</p>
<h1 id="evaluation-checks"><a class="header" href="#evaluation-checks">Evaluation checks</a></h1>
<p>The following flake output attributes must be derivations:</p>
<ul>
<li><code>checks.</code><em>system</em><code>.</code><em>name</em></li>
<li><code>defaultPackage.</code><em>system</em></li>
<li><code>devShell.</code><em>system</em></li>
<li><code>devShells.</code><em>system</em><code>.</code><em>name</em></li>
<li><code>nixosConfigurations.</code><em>name</em><code>.config.system.build.toplevel</code></li>
<li><code>packages.</code><em>system</em><code>.</code><em>name</em></li>
</ul>
<p>The following flake output attributes must be <a href="command-ref/new-cli/./nix3-run.html">app
definitions</a>:</p>
<ul>
<li><code>apps.</code><em>system</em><code>.</code><em>name</em></li>
<li><code>defaultApp.</code><em>system</em></li>
</ul>
<p>The following flake output attributes must be <a href="command-ref/new-cli/./nix3-flake-init.html">template
definitions</a>:</p>
<ul>
<li><code>defaultTemplate</code></li>
<li><code>templates.</code><em>name</em></li>
</ul>
<p>The following flake output attributes must be <em>Nixpkgs overlays</em>:</p>
<ul>
<li><code>overlay</code></li>
<li><code>overlays.</code><em>name</em></li>
</ul>
<p>The following flake output attributes must be <em>NixOS modules</em>:</p>
<ul>
<li><code>nixosModule</code></li>
<li><code>nixosModules.</code><em>name</em></li>
</ul>
<p>The following flake output attributes must be
<a href="command-ref/new-cli/./nix3-bundle.html">bundlers</a>:</p>
<ul>
<li><code>bundlers.</code><em>name</em></li>
<li><code>defaultBundler</code></li>
</ul>
<p>In addition, the <code>hydraJobs</code> output is evaluated in the same way as
Hydra's <code>hydra-eval-jobs</code> (i.e. as a arbitrarily deeply nested
attribute set of derivations). Similarly, the
<code>legacyPackages</code>.<em>system</em> output is evaluated like <code>nix-env --query --available </code>.</p>
<h1 id="options-57"><a class="header" href="#options-57">Options</a></h1>
<ul>
<li>
<p><span id="opt-all-systems"><a href="command-ref/new-cli/nix3-flake-check.html#opt-all-systems"><code>--all-systems</code></a></span></p>
<p>Check the outputs for all systems.</p>
</li>
<li>
<p><span id="opt-no-build"><a href="command-ref/new-cli/nix3-flake-check.html#opt-no-build"><code>--no-build</code></a></span></p>
<p>Do not build checks.</p>
</li>
</ul>
<h2 id="common-evaluation-options-9"><a class="header" href="#common-evaluation-options-9">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-flake-check.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-flake-check.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-flake-check.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-flake-check.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-flake-check.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-flake-check.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-flake-check.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-flake-check.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-flake-check.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-9"><a class="header" href="#common-flake-related-options-9">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-flake-check.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-flake-check.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-flake-check.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-flake-check.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-flake-check.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-flake-check.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-flake-check.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-flake-check.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-flake-check.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-flake-check.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-18"><a class="header" href="#logging-related-options-18">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-flake-check.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-flake-check.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-flake-check.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-flake-check.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-flake-check.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-18"><a class="header" href="#miscellaneous-global-options-18">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-flake-check.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-flake-check.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-flake-check.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-flake-check.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-flake-check.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-flake-check.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-61"><a class="header" href="#name-61">Name</a></h1>
<p><code>nix flake clone</code> - clone flake repository</p>
<h1 id="synopsis-61"><a class="header" href="#synopsis-61">Synopsis</a></h1>
<p><code>nix flake clone</code> [<em>option</em>...] <em>flake-url</em></p>
<h1 id="examples-40"><a class="header" href="#examples-40">Examples</a></h1>
<ul>
<li>
<p>Check out the source code of the <code>dwarffs</code> flake and build it:</p>
<pre><code class="language-console"># nix flake clone dwarffs --dest dwarffs
# cd dwarffs
# nix build
</code></pre>
</li>
</ul>
<h1 id="description-56"><a class="header" href="#description-56">Description</a></h1>
<p>This command performs a Git or Mercurial clone of the repository
containing the source code of the flake <em>flake-url</em>.</p>
<h1 id="options-58"><a class="header" href="#options-58">Options</a></h1>
<ul>
<li>
<p><span id="opt-dest"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-dest"><code>--dest</code></a></span> / <code>-f</code> <em>path</em></p>
<p>Clone the flake to path <em>dest</em>.</p>
</li>
</ul>
<h2 id="common-evaluation-options-10"><a class="header" href="#common-evaluation-options-10">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-10"><a class="header" href="#common-flake-related-options-10">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-19"><a class="header" href="#logging-related-options-19">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-19"><a class="header" href="#miscellaneous-global-options-19">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-flake-clone.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-62"><a class="header" href="#name-62">Name</a></h1>
<p><code>nix flake info</code> - show flake metadata</p>
<h1 id="synopsis-62"><a class="header" href="#synopsis-62">Synopsis</a></h1>
<p><code>nix flake info</code> [<em>option</em>...] <em>flake-url</em></p>
<h1 id="examples-41"><a class="header" href="#examples-41">Examples</a></h1>
<ul>
<li>
<p>Show what <code>dwarffs</code> resolves to:</p>
<pre><code class="language-console"># nix flake metadata dwarffs
Resolved URL:  github:edolstra/dwarffs
Locked URL:    github:edolstra/dwarffs/f691e2c991e75edb22836f1dbe632c40324215c5
Description:   A filesystem that fetches DWARF debug info from the Internet on demand
Path:          /nix/store/769s05vjydmc2lcf6b02az28wsa9ixh1-source
Revision:      f691e2c991e75edb22836f1dbe632c40324215c5
Last modified: 2021-01-21 15:41:26
Inputs:
├───nix: github:NixOS/nix/6254b1f5d298ff73127d7b0f0da48f142bdc753c
│   ├───lowdown-src: github:kristapsdz/lowdown/1705b4a26fbf065d9574dce47a94e8c7c79e052f
│   └───nixpkgs: github:NixOS/nixpkgs/ad0d20345219790533ebe06571f82ed6b034db31
└───nixpkgs follows input 'nix/nixpkgs'
</code></pre>
</li>
<li>
<p>Show information about <code>dwarffs</code> in JSON format:</p>
<pre><code class="language-console"># nix flake metadata dwarffs --json | jq .
{
  "description": "A filesystem that fetches DWARF debug info from the Internet on demand",
  "lastModified": 1597153508,
  "locked": {
    "lastModified": 1597153508,
    "narHash": "sha256-VHg3MYVgQ12LeRSU2PSoDeKlSPD8PYYEFxxwkVVDRd0=",
    "owner": "edolstra",
    "repo": "dwarffs",
    "rev": "d181d714fd36eb06f4992a1997cd5601e26db8f5",
    "type": "github"
  },
  "locks": { ... },
  "original": {
    "id": "dwarffs",
    "type": "indirect"
  },
  "originalUrl": "flake:dwarffs",
  "path": "/nix/store/hang3792qwdmm2n0d9nsrs5n6bsws6kv-source",
  "resolved": {
    "owner": "edolstra",
    "repo": "dwarffs",
    "type": "github"
  },
  "resolvedUrl": "github:edolstra/dwarffs",
  "revision": "d181d714fd36eb06f4992a1997cd5601e26db8f5",
  "url": "github:edolstra/dwarffs/d181d714fd36eb06f4992a1997cd5601e26db8f5"
}
</code></pre>
</li>
</ul>
<h1 id="description-57"><a class="header" href="#description-57">Description</a></h1>
<p>This command shows information about the flake specified by the flake
reference <em>flake-url</em>. It resolves the flake reference using the
<a href="command-ref/new-cli/./nix3-registry.html">flake registry</a>, fetches it, and prints some meta
data. This includes:</p>
<ul>
<li>
<p><code>Resolved URL</code>: If <em>flake-url</em> is a flake identifier, then this is
the flake reference that specifies its actual location, looked up in
the flake registry.</p>
</li>
<li>
<p><code>Locked URL</code>: A flake reference that contains a commit or content
hash and thus uniquely identifies a specific flake version.</p>
</li>
<li>
<p><code>Description</code>: A one-line description of the flake, taken from the
<code>description</code> field in <code>flake.nix</code>.</p>
</li>
<li>
<p><code>Path</code>: The store path containing the source code of the flake.</p>
</li>
<li>
<p><code>Revision</code>: The Git or Mercurial commit hash of the locked flake.</p>
</li>
<li>
<p><code>Revisions</code>: The number of ancestors of the Git or Mercurial commit
of the locked flake. Note that this is not available for <code>github</code>
flakes.</p>
</li>
<li>
<p><code>Last modified</code>: For Git or Mercurial flakes, this is the commit
time of the commit of the locked flake; for tarball flakes, it's the
most recent timestamp of any file inside the tarball.</p>
</li>
<li>
<p><code>Inputs</code>: The flake inputs with their corresponding lock file
entries.</p>
</li>
</ul>
<p>With <code>--json</code>, the output is a JSON object with the following fields:</p>
<ul>
<li>
<p><code>original</code> and <code>originalUrl</code>: The flake reference specified by the
user (<em>flake-url</em>) in attribute set and URL representation.</p>
</li>
<li>
<p><code>resolved</code> and <code>resolvedUrl</code>: The resolved flake reference (see
above) in attribute set and URL representation.</p>
</li>
<li>
<p><code>locked</code> and <code>lockedUrl</code>: The locked flake reference (see above) in
attribute set and URL representation.</p>
</li>
<li>
<p><code>description</code>: See <code>Description</code> above.</p>
</li>
<li>
<p><code>path</code>: See <code>Path</code> above.</p>
</li>
<li>
<p><code>revision</code>: See <code>Revision</code> above.</p>
</li>
<li>
<p><code>revCount</code>: See <code>Revisions</code> above.</p>
</li>
<li>
<p><code>lastModified</code>: See <code>Last modified</code> above.</p>
</li>
<li>
<p><code>locks</code>: The contents of <code>flake.lock</code>.</p>
</li>
</ul>
<h1 id="options-59"><a class="header" href="#options-59">Options</a></h1>
<ul>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-flake-info.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
</ul>
<h2 id="common-evaluation-options-11"><a class="header" href="#common-evaluation-options-11">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-flake-info.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-flake-info.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-flake-info.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-flake-info.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-flake-info.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-flake-info.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-flake-info.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-flake-info.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-flake-info.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-11"><a class="header" href="#common-flake-related-options-11">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-flake-info.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-flake-info.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-flake-info.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-flake-info.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-flake-info.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-flake-info.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-flake-info.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-flake-info.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-flake-info.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-flake-info.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-20"><a class="header" href="#logging-related-options-20">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-flake-info.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-flake-info.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-flake-info.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-flake-info.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-flake-info.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-20"><a class="header" href="#miscellaneous-global-options-20">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-flake-info.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-flake-info.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-flake-info.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-flake-info.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-flake-info.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-flake-info.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-63"><a class="header" href="#name-63">Name</a></h1>
<p><code>nix flake init</code> - create a flake in the current directory from a template</p>
<h1 id="synopsis-63"><a class="header" href="#synopsis-63">Synopsis</a></h1>
<p><code>nix flake init</code> [<em>option</em>...]</p>
<h1 id="examples-42"><a class="header" href="#examples-42">Examples</a></h1>
<ul>
<li>
<p>Create a flake using the default template:</p>
<pre><code class="language-console"># nix flake init
</code></pre>
</li>
<li>
<p>List available templates:</p>
<pre><code class="language-console"># nix flake show templates
</code></pre>
</li>
<li>
<p>Create a flake from a specific template:</p>
<pre><code class="language-console"># nix flake init -t templates#simpleContainer
</code></pre>
</li>
</ul>
<h1 id="description-58"><a class="header" href="#description-58">Description</a></h1>
<p>This command creates a flake in the current directory by copying the
files of a template. It will not overwrite existing files. The default
template is <code>templates#templates.default</code>, but this can be overridden
using <code>-t</code>.</p>
<h1 id="template-definitions"><a class="header" href="#template-definitions">Template definitions</a></h1>
<p>A flake can declare templates through its <code>templates</code> output
attribute. A template has the following attributes:</p>
<ul>
<li>
<p><code>description</code>: A one-line description of the template, in CommonMark
syntax.</p>
</li>
<li>
<p><code>path</code>: The path of the directory to be copied.</p>
</li>
<li>
<p><code>welcomeText</code>: A block of markdown text to display when a user initializes a
new flake based on this template.</p>
</li>
</ul>
<p>Here is an example:</p>
<pre><code>outputs = { self }: {

  templates.rust = {
    path = ./rust;
    description = "A simple Rust/Cargo project";
    welcomeText = ''
      # Simple Rust/Cargo Template
      ## Intended usage
      The intended usage of this flake is...

      ## More info
      - [Rust language](https://www.rust-lang.org/)
      - [Rust on the NixOS Wiki](https://wiki.nixos.org/wiki/Rust)
      - ...
    '';
  };

  templates.default = self.templates.rust;
}
</code></pre>
<h1 id="options-60"><a class="header" href="#options-60">Options</a></h1>
<ul>
<li>
<p><span id="opt-template"><a href="command-ref/new-cli/nix3-flake-init.html#opt-template"><code>--template</code></a></span> / <code>-t</code> <em>template</em></p>
<p>The template to use.</p>
</li>
</ul>
<h2 id="common-evaluation-options-12"><a class="header" href="#common-evaluation-options-12">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-flake-init.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-flake-init.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-flake-init.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-flake-init.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-flake-init.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-flake-init.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-flake-init.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-flake-init.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-flake-init.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="logging-related-options-21"><a class="header" href="#logging-related-options-21">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-flake-init.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-flake-init.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-flake-init.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-flake-init.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-flake-init.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-21"><a class="header" href="#miscellaneous-global-options-21">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-flake-init.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-flake-init.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-flake-init.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-flake-init.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-flake-init.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-flake-init.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-64"><a class="header" href="#name-64">Name</a></h1>
<p><code>nix flake lock</code> - create missing lock file entries</p>
<h1 id="synopsis-64"><a class="header" href="#synopsis-64">Synopsis</a></h1>
<p><code>nix flake lock</code> [<em>option</em>...] <em>flake-url</em></p>
<h1 id="examples-43"><a class="header" href="#examples-43">Examples</a></h1>
<ul>
<li>
<p>Create the lock file for the flake in the current directory:</p>
<pre><code class="language-console"># nix flake lock
warning: creating lock file '/home/myself/repos/testflake/flake.lock':
• Added input 'nix':
    'github:NixOS/nix/9fab14adbc3810d5cc1f88672fde1eee4358405c' (2023-06-28)
• Added input 'nixpkgs':
    'github:NixOS/nixpkgs/3d2d8f281a27d466fa54b469b5993f7dde198375' (2023-06-30)
</code></pre>
</li>
<li>
<p>Add missing inputs to the lock file for a flake in a different directory:</p>
<pre><code class="language-console"># nix flake lock ~/repos/another
warning: updating lock file '/home/myself/repos/another/flake.lock':
• Added input 'nixpkgs':
    'github:NixOS/nixpkgs/3d2d8f281a27d466fa54b469b5993f7dde198375' (2023-06-30)
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>When trying to refer to a flake in a subdirectory, write <code>./another</code>
instead of <code>another</code>.
Otherwise Nix will try to look up the flake in the registry.</p>
</blockquote>
</li>
</ul>
<h1 id="description-59"><a class="header" href="#description-59">Description</a></h1>
<p>This command updates the lock file of a flake (<code>flake.lock</code>)
so that it contains an up-to-date lock for every flake input specified in
<code>flake.nix</code>. Lock file entries are aready up-to-date are not modified.</p>
<p>If you want to update existing lock entries, use
<a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a></p>
<h1 id="options-61"><a class="header" href="#options-61">Options</a></h1>
<h2 id="common-evaluation-options-13"><a class="header" href="#common-evaluation-options-13">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-12"><a class="header" href="#common-flake-related-options-12">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-22"><a class="header" href="#logging-related-options-22">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-22"><a class="header" href="#miscellaneous-global-options-22">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-flake-lock.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-65"><a class="header" href="#name-65">Name</a></h1>
<p><code>nix flake metadata</code> - show flake metadata</p>
<h1 id="synopsis-65"><a class="header" href="#synopsis-65">Synopsis</a></h1>
<p><code>nix flake metadata</code> [<em>option</em>...] <em>flake-url</em></p>
<h1 id="examples-44"><a class="header" href="#examples-44">Examples</a></h1>
<ul>
<li>
<p>Show what <code>dwarffs</code> resolves to:</p>
<pre><code class="language-console"># nix flake metadata dwarffs
Resolved URL:  github:edolstra/dwarffs
Locked URL:    github:edolstra/dwarffs/f691e2c991e75edb22836f1dbe632c40324215c5
Description:   A filesystem that fetches DWARF debug info from the Internet on demand
Path:          /nix/store/769s05vjydmc2lcf6b02az28wsa9ixh1-source
Revision:      f691e2c991e75edb22836f1dbe632c40324215c5
Last modified: 2021-01-21 15:41:26
Inputs:
├───nix: github:NixOS/nix/6254b1f5d298ff73127d7b0f0da48f142bdc753c
│   ├───lowdown-src: github:kristapsdz/lowdown/1705b4a26fbf065d9574dce47a94e8c7c79e052f
│   └───nixpkgs: github:NixOS/nixpkgs/ad0d20345219790533ebe06571f82ed6b034db31
└───nixpkgs follows input 'nix/nixpkgs'
</code></pre>
</li>
<li>
<p>Show information about <code>dwarffs</code> in JSON format:</p>
<pre><code class="language-console"># nix flake metadata dwarffs --json | jq .
{
  "description": "A filesystem that fetches DWARF debug info from the Internet on demand",
  "lastModified": 1597153508,
  "locked": {
    "lastModified": 1597153508,
    "narHash": "sha256-VHg3MYVgQ12LeRSU2PSoDeKlSPD8PYYEFxxwkVVDRd0=",
    "owner": "edolstra",
    "repo": "dwarffs",
    "rev": "d181d714fd36eb06f4992a1997cd5601e26db8f5",
    "type": "github"
  },
  "locks": { ... },
  "original": {
    "id": "dwarffs",
    "type": "indirect"
  },
  "originalUrl": "flake:dwarffs",
  "path": "/nix/store/hang3792qwdmm2n0d9nsrs5n6bsws6kv-source",
  "resolved": {
    "owner": "edolstra",
    "repo": "dwarffs",
    "type": "github"
  },
  "resolvedUrl": "github:edolstra/dwarffs",
  "revision": "d181d714fd36eb06f4992a1997cd5601e26db8f5",
  "url": "github:edolstra/dwarffs/d181d714fd36eb06f4992a1997cd5601e26db8f5"
}
</code></pre>
</li>
</ul>
<h1 id="description-60"><a class="header" href="#description-60">Description</a></h1>
<p>This command shows information about the flake specified by the flake
reference <em>flake-url</em>. It resolves the flake reference using the
<a href="command-ref/new-cli/./nix3-registry.html">flake registry</a>, fetches it, and prints some meta
data. This includes:</p>
<ul>
<li>
<p><code>Resolved URL</code>: If <em>flake-url</em> is a flake identifier, then this is
the flake reference that specifies its actual location, looked up in
the flake registry.</p>
</li>
<li>
<p><code>Locked URL</code>: A flake reference that contains a commit or content
hash and thus uniquely identifies a specific flake version.</p>
</li>
<li>
<p><code>Description</code>: A one-line description of the flake, taken from the
<code>description</code> field in <code>flake.nix</code>.</p>
</li>
<li>
<p><code>Path</code>: The store path containing the source code of the flake.</p>
</li>
<li>
<p><code>Revision</code>: The Git or Mercurial commit hash of the locked flake.</p>
</li>
<li>
<p><code>Revisions</code>: The number of ancestors of the Git or Mercurial commit
of the locked flake. Note that this is not available for <code>github</code>
flakes.</p>
</li>
<li>
<p><code>Last modified</code>: For Git or Mercurial flakes, this is the commit
time of the commit of the locked flake; for tarball flakes, it's the
most recent timestamp of any file inside the tarball.</p>
</li>
<li>
<p><code>Inputs</code>: The flake inputs with their corresponding lock file
entries.</p>
</li>
</ul>
<p>With <code>--json</code>, the output is a JSON object with the following fields:</p>
<ul>
<li>
<p><code>original</code> and <code>originalUrl</code>: The flake reference specified by the
user (<em>flake-url</em>) in attribute set and URL representation.</p>
</li>
<li>
<p><code>resolved</code> and <code>resolvedUrl</code>: The resolved flake reference (see
above) in attribute set and URL representation.</p>
</li>
<li>
<p><code>locked</code> and <code>lockedUrl</code>: The locked flake reference (see above) in
attribute set and URL representation.</p>
</li>
<li>
<p><code>description</code>: See <code>Description</code> above.</p>
</li>
<li>
<p><code>path</code>: See <code>Path</code> above.</p>
</li>
<li>
<p><code>revision</code>: See <code>Revision</code> above.</p>
</li>
<li>
<p><code>revCount</code>: See <code>Revisions</code> above.</p>
</li>
<li>
<p><code>lastModified</code>: See <code>Last modified</code> above.</p>
</li>
<li>
<p><code>locks</code>: The contents of <code>flake.lock</code>.</p>
</li>
</ul>
<h1 id="options-62"><a class="header" href="#options-62">Options</a></h1>
<ul>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
</ul>
<h2 id="common-evaluation-options-14"><a class="header" href="#common-evaluation-options-14">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-13"><a class="header" href="#common-flake-related-options-13">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-23"><a class="header" href="#logging-related-options-23">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-23"><a class="header" href="#miscellaneous-global-options-23">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-flake-metadata.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-66"><a class="header" href="#name-66">Name</a></h1>
<p><code>nix flake new</code> - create a flake in the specified directory from a template</p>
<h1 id="synopsis-66"><a class="header" href="#synopsis-66">Synopsis</a></h1>
<p><code>nix flake new</code> [<em>option</em>...] <em>dest-dir</em></p>
<h1 id="examples-45"><a class="header" href="#examples-45">Examples</a></h1>
<ul>
<li>
<p>Create a flake using the default template in the directory <code>hello</code>:</p>
<pre><code class="language-console"># nix flake new hello
</code></pre>
</li>
<li>
<p>List available templates:</p>
<pre><code class="language-console"># nix flake show templates
</code></pre>
</li>
<li>
<p>Create a flake from a specific template in the directory <code>hello</code>:</p>
<pre><code class="language-console"># nix flake new hello -t templates#trivial
</code></pre>
</li>
</ul>
<h1 id="description-61"><a class="header" href="#description-61">Description</a></h1>
<p>This command creates a flake in the directory <code>dest-dir</code>, which must
not already exist. It's equivalent to:</p>
<pre><code class="language-console"># mkdir dest-dir
# cd dest-dir
# nix flake init
</code></pre>
<h1 id="options-63"><a class="header" href="#options-63">Options</a></h1>
<ul>
<li>
<p><span id="opt-template"><a href="command-ref/new-cli/nix3-flake-new.html#opt-template"><code>--template</code></a></span> / <code>-t</code> <em>template</em></p>
<p>The template to use.</p>
</li>
</ul>
<h2 id="common-evaluation-options-15"><a class="header" href="#common-evaluation-options-15">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-flake-new.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-flake-new.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-flake-new.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-flake-new.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-flake-new.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-flake-new.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-flake-new.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-flake-new.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-flake-new.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="logging-related-options-24"><a class="header" href="#logging-related-options-24">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-flake-new.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-flake-new.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-flake-new.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-flake-new.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-flake-new.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-24"><a class="header" href="#miscellaneous-global-options-24">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-flake-new.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-flake-new.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-flake-new.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-flake-new.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-flake-new.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-flake-new.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-67"><a class="header" href="#name-67">Name</a></h1>
<p><code>nix flake prefetch</code> - download the source tree denoted by a flake reference into the Nix store</p>
<h1 id="synopsis-67"><a class="header" href="#synopsis-67">Synopsis</a></h1>
<p><code>nix flake prefetch</code> [<em>option</em>...] <em>flake-url</em></p>
<h1 id="examples-46"><a class="header" href="#examples-46">Examples</a></h1>
<ul>
<li>
<p>Download a tarball and unpack it:</p>
<pre><code class="language-console"># nix flake prefetch https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.10.5.tar.xz --out-link ./result
Downloaded 'https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.10.5.tar.xz?narHash=sha256-3XYHZANT6AFBV0BqegkAZHbba6oeDkIUCDwbATLMhAY='
to '/nix/store/sl5vvk8mb4ma1sjyy03kwpvkz50hd22d-source' (hash
'sha256-3XYHZANT6AFBV0BqegkAZHbba6oeDkIUCDwbATLMhAY=').

# cat ./result/README
Linux kernel
…
</code></pre>
</li>
<li>
<p>Download the <code>dwarffs</code> flake (looked up in the flake registry):</p>
<pre><code class="language-console"># nix flake prefetch dwarffs --json
{"hash":"sha256-VHg3MYVgQ12LeRSU2PSoDeKlSPD8PYYEFxxwkVVDRd0="
,"storePath":"/nix/store/hang3792qwdmm2n0d9nsrs5n6bsws6kv-source"}
</code></pre>
</li>
</ul>
<h1 id="description-62"><a class="header" href="#description-62">Description</a></h1>
<p>This command downloads the source tree denoted by flake reference
<em>flake-url</em>. Note that this does not need to be a flake (i.e. it does
not have to contain a <code>flake.nix</code> file).</p>
<h1 id="options-64"><a class="header" href="#options-64">Options</a></h1>
<ul>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
<li>
<p><span id="opt-out-link"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-out-link"><code>--out-link</code></a></span> / <code>-o</code> <em>path</em></p>
<p>Create symlink named <em>path</em> to the resulting store path.</p>
</li>
</ul>
<h2 id="common-evaluation-options-16"><a class="header" href="#common-evaluation-options-16">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-14"><a class="header" href="#common-flake-related-options-14">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-25"><a class="header" href="#logging-related-options-25">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-25"><a class="header" href="#miscellaneous-global-options-25">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-flake-prefetch.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-68"><a class="header" href="#name-68">Name</a></h1>
<p><code>nix flake show</code> - show the outputs provided by a flake</p>
<h1 id="synopsis-68"><a class="header" href="#synopsis-68">Synopsis</a></h1>
<p><code>nix flake show</code> [<em>option</em>...] <em>flake-url</em></p>
<h1 id="examples-47"><a class="header" href="#examples-47">Examples</a></h1>
<ul>
<li>
<p>Show the output attributes provided by the <code>patchelf</code> flake:</p>
<pre><code class="language-console">github:NixOS/patchelf/f34751b88bd07d7f44f5cd3200fb4122bf916c7e
├───checks
│   ├───aarch64-linux
│   │   └───build: derivation 'patchelf-0.12.20201207.f34751b'
│   ├───i686-linux
│   │   └───build: derivation 'patchelf-0.12.20201207.f34751b'
│   └───x86_64-linux
│       └───build: derivation 'patchelf-0.12.20201207.f34751b'
├───packages
│   ├───aarch64-linux
│   │   └───default: package 'patchelf-0.12.20201207.f34751b'
│   ├───i686-linux
│   │   └───default: package 'patchelf-0.12.20201207.f34751b'
│   └───x86_64-linux
│       └───default: package 'patchelf-0.12.20201207.f34751b'
├───hydraJobs
│   ├───build
│   │   ├───aarch64-linux: derivation 'patchelf-0.12.20201207.f34751b'
│   │   ├───i686-linux: derivation 'patchelf-0.12.20201207.f34751b'
│   │   └───x86_64-linux: derivation 'patchelf-0.12.20201207.f34751b'
│   ├───coverage: derivation 'patchelf-coverage-0.12.20201207.f34751b'
│   ├───release: derivation 'patchelf-0.12.20201207.f34751b'
│   └───tarball: derivation 'patchelf-tarball-0.12.20201207.f34751b'
└───overlay: Nixpkgs overlay
</code></pre>
</li>
</ul>
<h1 id="description-63"><a class="header" href="#description-63">Description</a></h1>
<p>This command shows the output attributes provided by the flake
specified by flake reference <em>flake-url</em>. These are the top-level
attributes in the <code>outputs</code> of the flake, as well as lower-level
attributes for some standard outputs (e.g. <code>packages</code> or <code>checks</code>).</p>
<p>With <code>--json</code>, the output is in a JSON representation suitable for automatic
processing by other tools.</p>
<h1 id="options-65"><a class="header" href="#options-65">Options</a></h1>
<ul>
<li>
<p><span id="opt-all-systems"><a href="command-ref/new-cli/nix3-flake-show.html#opt-all-systems"><code>--all-systems</code></a></span></p>
<p>Show the contents of outputs for all systems.</p>
</li>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-flake-show.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
<li>
<p><span id="opt-legacy"><a href="command-ref/new-cli/nix3-flake-show.html#opt-legacy"><code>--legacy</code></a></span></p>
<p>Show the contents of the <code>legacyPackages</code> output.</p>
</li>
</ul>
<h2 id="common-evaluation-options-17"><a class="header" href="#common-evaluation-options-17">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-flake-show.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-flake-show.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-flake-show.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-flake-show.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-flake-show.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-flake-show.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-flake-show.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-flake-show.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-flake-show.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-15"><a class="header" href="#common-flake-related-options-15">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-flake-show.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-flake-show.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-flake-show.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-flake-show.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-flake-show.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-flake-show.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-flake-show.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-flake-show.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-flake-show.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-flake-show.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-26"><a class="header" href="#logging-related-options-26">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-flake-show.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-flake-show.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-flake-show.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-flake-show.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-flake-show.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-26"><a class="header" href="#miscellaneous-global-options-26">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-flake-show.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-flake-show.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-flake-show.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-flake-show.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-flake-show.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-flake-show.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-69"><a class="header" href="#name-69">Name</a></h1>
<p><code>nix flake update</code> - update flake lock file</p>
<h1 id="synopsis-69"><a class="header" href="#synopsis-69">Synopsis</a></h1>
<p><code>nix flake update</code> [<em>option</em>...] <em>inputs</em>...</p>
<h1 id="examples-48"><a class="header" href="#examples-48">Examples</a></h1>
<ul>
<li>
<p>Update all inputs (i.e. recreate the lock file from scratch):</p>
<pre><code class="language-console"># nix flake update
warning: updating lock file '/home/myself/repos/testflake/flake.lock':
• Updated input 'nix':
    'github:NixOS/nix/9fab14adbc3810d5cc1f88672fde1eee4358405c' (2023-06-28)
  → 'github:NixOS/nix/8927cba62f5afb33b01016d5c4f7f8b7d0adde3c' (2023-07-11)
• Updated input 'nixpkgs':
    'github:NixOS/nixpkgs/3d2d8f281a27d466fa54b469b5993f7dde198375' (2023-06-30)
  → 'github:NixOS/nixpkgs/a3a3dda3bacf61e8a39258a0ed9c924eeca8e293' (2023-07-05)
</code></pre>
</li>
<li>
<p>Update only a single input:</p>
<pre><code class="language-console"># nix flake update nixpkgs
warning: updating lock file '/home/myself/repos/testflake/flake.lock':
• Updated input 'nixpkgs':
    'github:NixOS/nixpkgs/3d2d8f281a27d466fa54b469b5993f7dde198375' (2023-06-30)
  → 'github:NixOS/nixpkgs/a3a3dda3bacf61e8a39258a0ed9c924eeca8e293' (2023-07-05)
</code></pre>
</li>
<li>
<p>Update multiple inputs:</p>
<pre><code class="language-console"># nix flake update nixpkgs nixpkgs-unstable
warning: updating lock file '/home/myself/repos/testflake/flake.lock':
• Updated input 'nixpkgs':
    'github:nixos/nixpkgs/8f7492cce28977fbf8bd12c72af08b1f6c7c3e49' (2024-09-14)
  → 'github:nixos/nixpkgs/086b448a5d54fd117f4dc2dee55c9f0ff461bdc1' (2024-09-16)
• Updated input 'nixpkgs-unstable':
    'github:nixos/nixpkgs/345c263f2f53a3710abe117f28a5cb86d0ba4059' (2024-09-13)
  → 'github:nixos/nixpkgs/99dc8785f6a0adac95f5e2ab05cc2e1bf666d172' (2024-09-16)
</code></pre>
</li>
<li>
<p>Update only a single input of a flake in a different directory:</p>
<pre><code class="language-console"># nix flake update nixpkgs --flake ~/repos/another
warning: updating lock file '/home/myself/repos/another/flake.lock':
• Updated input 'nixpkgs':
    'github:NixOS/nixpkgs/3d2d8f281a27d466fa54b469b5993f7dde198375' (2023-06-30)
  → 'github:NixOS/nixpkgs/a3a3dda3bacf61e8a39258a0ed9c924eeca8e293' (2023-07-05)
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>When trying to refer to a flake in a subdirectory, write <code>./another</code>
instead of <code>another</code>.
Otherwise Nix will try to look up the flake in the registry.</p>
</blockquote>
</li>
</ul>
<h1 id="description-64"><a class="header" href="#description-64">Description</a></h1>
<p>This command updates the inputs in a lock file (<code>flake.lock</code>).
<strong>By default, all inputs are updated</strong>. If the lock file doesn't exist
yet, it will be created. If inputs are not in the lock file yet, they will be added.</p>
<p>Unlike other <code>nix flake</code> commands, <code>nix flake update</code> takes a list of names of inputs
to update as its positional arguments and operates on the flake in the current directory.
You can pass a different flake-url with <code>--flake</code> to override that default.</p>
<p>The related command <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-lock.html"><code>nix flake lock</code></a>
also creates lock files and adds missing inputs, but is safer as it
will never update inputs already in the lock file.</p>
<h1 id="options-66"><a class="header" href="#options-66">Options</a></h1>
<ul>
<li>
<p><span id="opt-flake"><a href="command-ref/new-cli/nix3-flake-update.html#opt-flake"><code>--flake</code></a></span> <em>flake-url</em></p>
<p>The flake to operate on. Default is the current directory.</p>
</li>
</ul>
<h2 id="common-evaluation-options-18"><a class="header" href="#common-evaluation-options-18">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-flake-update.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-flake-update.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-flake-update.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-flake-update.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-flake-update.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-flake-update.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-flake-update.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-flake-update.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-flake-update.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-16"><a class="header" href="#common-flake-related-options-16">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-flake-update.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-flake-update.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-flake-update.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-flake-update.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-flake-update.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-flake-update.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-flake-update.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-flake-update.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-27"><a class="header" href="#logging-related-options-27">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-flake-update.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-flake-update.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-flake-update.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-flake-update.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-flake-update.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-27"><a class="header" href="#miscellaneous-global-options-27">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-flake-update.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-flake-update.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-flake-update.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-flake-update.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-flake-update.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-flake-update.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-70"><a class="header" href="#name-70">Name</a></h1>
<p><code>nix fmt</code> - reformat your code in the standard style</p>
<h1 id="synopsis-70"><a class="header" href="#synopsis-70">Synopsis</a></h1>
<p><code>nix fmt</code> [<em>option</em>...] <em>args</em>...</p>
<h1 id="description-65"><a class="header" href="#description-65">Description</a></h1>
<p><code>nix fmt</code> calls the formatter specified in the flake.</p>
<p>Flags can be forwarded to the formatter by using <code>--</code> followed by the flags.</p>
<p>Any arguments will be forwarded to the formatter. Typically these are the files to format.</p>
<h1 id="examples-49"><a class="header" href="#examples-49">Examples</a></h1>
<p>With <a href="https://github.com/nix-community/nixpkgs-fmt">nixpkgs-fmt</a>:</p>
<pre><code class="language-nix"># flake.nix
{
  outputs = { nixpkgs, self }: {
    formatter.x86_64-linux = nixpkgs.legacyPackages.x86_64-linux.nixpkgs-fmt;
  };
}
</code></pre>
<p>With <a href="https://github.com/NixOS/nixfmt">nixfmt</a>:</p>
<pre><code class="language-nix"># flake.nix
{
  outputs = { nixpkgs, self }: {
    formatter.x86_64-linux = nixpkgs.legacyPackages.x86_64-linux.nixfmt-rfc-style;
  };
}
</code></pre>
<p>With <a href="https://github.com/kamadorueda/alejandra">Alejandra</a>:</p>
<pre><code class="language-nix"># flake.nix
{
  outputs = { nixpkgs, self }: {
    formatter.x86_64-linux = nixpkgs.legacyPackages.x86_64-linux.alejandra;
  };
}
</code></pre>
<h1 id="options-67"><a class="header" href="#options-67">Options</a></h1>
<h2 id="common-evaluation-options-19"><a class="header" href="#common-evaluation-options-19">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-fmt.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-fmt.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-fmt.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-fmt.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-fmt.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-fmt.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-fmt.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-fmt.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-fmt.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-17"><a class="header" href="#common-flake-related-options-17">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-fmt.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-fmt.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-fmt.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-fmt.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-fmt.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-fmt.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-fmt.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-fmt.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-fmt.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-fmt.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-28"><a class="header" href="#logging-related-options-28">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-fmt.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-fmt.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-fmt.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-fmt.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-fmt.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-28"><a class="header" href="#miscellaneous-global-options-28">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-fmt.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-fmt.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-fmt.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-fmt.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-fmt.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-fmt.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-8"><a class="header" href="#options-that-change-the-interpretation-of-installables-8">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-fmt.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-fmt.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-71"><a class="header" href="#name-71">Name</a></h1>
<p><code>nix hash</code> - compute and convert cryptographic hashes</p>
<h1 id="synopsis-71"><a class="header" href="#synopsis-71">Synopsis</a></h1>
<p><code>nix hash</code> [<em>option</em>...] <em>subcommand</em></p>
<p>where <em>subcommand</em> is one of the following:</p>
<p><strong>Available commands:</strong></p>
<ul>
<li><a href="command-ref/new-cli/./nix3-hash-file.html"><code>nix hash file</code></a> - print cryptographic hash of a regular file</li>
<li><a href="command-ref/new-cli/./nix3-hash-path.html"><code>nix hash path</code></a> - print cryptographic hash of the NAR serialisation of a path</li>
<li><a href="command-ref/new-cli/./nix3-hash-to-base16.html"><code>nix hash to-base16</code></a> - convert a hash to base-16 representation (deprecated, use <code>nix hash convert</code> instead)</li>
<li><a href="command-ref/new-cli/./nix3-hash-to-base32.html"><code>nix hash to-base32</code></a> - convert a hash to base-32 representation (deprecated, use <code>nix hash convert</code> instead)</li>
<li><a href="command-ref/new-cli/./nix3-hash-to-base64.html"><code>nix hash to-base64</code></a> - convert a hash to base-64 representation (deprecated, use <code>nix hash convert</code> instead)</li>
<li><a href="command-ref/new-cli/./nix3-hash-to-sri.html"><code>nix hash to-sri</code></a> - convert a hash to SRI representation (deprecated, use <code>nix hash convert</code> instead)</li>
</ul>
<p><strong>:</strong></p>
<ul>
<li><a href="command-ref/new-cli/./nix3-hash-convert.html"><code>nix hash convert</code></a> - convert between hash formats</li>
</ul>
<h1 id="options-68"><a class="header" href="#options-68">Options</a></h1>
<h2 id="logging-related-options-29"><a class="header" href="#logging-related-options-29">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-hash.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-hash.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-hash.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-hash.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-hash.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-29"><a class="header" href="#miscellaneous-global-options-29">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-hash.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-hash.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-hash.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-hash.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-hash.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-72"><a class="header" href="#name-72">Name</a></h1>
<p><code>nix hash convert</code> - convert between hash formats</p>
<h1 id="synopsis-72"><a class="header" href="#synopsis-72">Synopsis</a></h1>
<p><code>nix hash convert</code> [<em>option</em>...] <em>hashes</em>...</p>
<h1 id="examples-50"><a class="header" href="#examples-50">Examples</a></h1>
<ul>
<li>
<p>Convert a hash to <code>nix32</code> (a base-32 encoding with a Nix-specific character set).</p>
<pre><code class="language-console">$ nix hash convert --hash-algo sha1 --to nix32 800d59cfcd3c05e900cb4e214be48f6b886a08df
vw46m23bizj4n8afrc0fj19wrp7mj3c0
</code></pre>
</li>
<li>
<p>Convert a hash to <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity">the <code>sri</code> format</a> that includes an algorithm specification:</p>
<pre><code class="language-console"># nix hash convert --hash-algo sha1 800d59cfcd3c05e900cb4e214be48f6b886a08df
sha1-gA1Zz808BekAy04hS+SPa4hqCN8=
</code></pre>
<p>or with an explicit <code>--to</code> format:</p>
<pre><code class="language-console"># nix hash convert --hash-algo sha1 --to sri 800d59cfcd3c05e900cb4e214be48f6b886a08df
sha1-gA1Zz808BekAy04hS+SPa4hqCN8=
</code></pre>
</li>
<li>
<p>Assert the input format of the hash:</p>
<pre><code class="language-console"># nix hash convert --hash-algo sha256 --from nix32 ungWv48Bz+pBQUDeXa4iI7ADYaOWF3qctBD/YfIAFa0=
error: input hash 'ungWv48Bz+pBQUDeXa4iI7ADYaOWF3qctBD/YfIAFa0=' does not have the expected format '--from nix32'

# nix hash convert --hash-algo sha256 --from nix32 1b8m03r63zqhnjf7l5wnldhh7c134ap5vpj0850ymkq1iyzicy5s
sha256-ungWv48Bz+pBQUDeXa4iI7ADYaOWF3qctBD/YfIAFa0=
</code></pre>
</li>
</ul>
<h1 id="description-66"><a class="header" href="#description-66">Description</a></h1>
<p><code>nix hash convert</code> converts hashes from one encoding to another.</p>
<h1 id="options-69"><a class="header" href="#options-69">Options</a></h1>
<ul>
<li>
<p><span id="opt-from"><a href="command-ref/new-cli/nix3-hash-convert.html#opt-from"><code>--from</code></a></span> <em>hash-format</em></p>
<p>Hash format (<code>base16</code>, <code>nix32</code>, <code>base64</code>, <code>sri</code>).</p>
</li>
<li>
<p><span id="opt-hash-algo"><a href="command-ref/new-cli/nix3-hash-convert.html#opt-hash-algo"><code>--hash-algo</code></a></span> <em>hash-algo</em></p>
<p>Hash algorithm (<code>blake3</code>, <code>md5</code>, <code>sha1</code>, <code>sha256</code>, or <code>sha512</code>). Can be omitted for SRI hashes.</p>
</li>
<li>
<p><span id="opt-to"><a href="command-ref/new-cli/nix3-hash-convert.html#opt-to"><code>--to</code></a></span> <em>hash-format</em></p>
<p>Hash format (<code>base16</code>, <code>nix32</code>, <code>base64</code>, <code>sri</code>). Default: <code>sri</code>.</p>
</li>
</ul>
<h2 id="logging-related-options-30"><a class="header" href="#logging-related-options-30">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-hash-convert.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-hash-convert.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-hash-convert.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-hash-convert.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-hash-convert.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-30"><a class="header" href="#miscellaneous-global-options-30">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-hash-convert.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-hash-convert.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-hash-convert.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-hash-convert.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-hash-convert.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-73"><a class="header" href="#name-73">Name</a></h1>
<p><code>nix hash file</code> - print cryptographic hash of a regular file</p>
<h1 id="synopsis-73"><a class="header" href="#synopsis-73">Synopsis</a></h1>
<p><code>nix hash file</code> [<em>option</em>...] <em>paths</em>...</p>
<h1 id="options-70"><a class="header" href="#options-70">Options</a></h1>
<ul>
<li>
<p><span id="opt-base16"><a href="command-ref/new-cli/nix3-hash-file.html#opt-base16"><code>--base16</code></a></span></p>
<p>Print the hash in base-16 format.</p>
</li>
<li>
<p><span id="opt-base32"><a href="command-ref/new-cli/nix3-hash-file.html#opt-base32"><code>--base32</code></a></span></p>
<p>Print the hash in base-32 (Nix-specific) format.</p>
</li>
<li>
<p><span id="opt-base64"><a href="command-ref/new-cli/nix3-hash-file.html#opt-base64"><code>--base64</code></a></span></p>
<p>Print the hash in base-64 format.</p>
</li>
<li>
<p><span id="opt-sri"><a href="command-ref/new-cli/nix3-hash-file.html#opt-sri"><code>--sri</code></a></span></p>
<p>Print the hash in SRI format.</p>
</li>
<li>
<p><span id="opt-type"><a href="command-ref/new-cli/nix3-hash-file.html#opt-type"><code>--type</code></a></span> <em>hash-algo</em></p>
<p>Hash algorithm (<code>blake3</code>, <code>md5</code>, <code>sha1</code>, <code>sha256</code>, or <code>sha512</code>).</p>
</li>
</ul>
<h2 id="logging-related-options-31"><a class="header" href="#logging-related-options-31">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-hash-file.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-hash-file.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-hash-file.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-hash-file.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-hash-file.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-31"><a class="header" href="#miscellaneous-global-options-31">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-hash-file.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-hash-file.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-hash-file.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-hash-file.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-hash-file.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-74"><a class="header" href="#name-74">Name</a></h1>
<p><code>nix hash path</code> - print cryptographic hash of the NAR serialisation of a path</p>
<h1 id="synopsis-74"><a class="header" href="#synopsis-74">Synopsis</a></h1>
<p><code>nix hash path</code> [<em>option</em>...] <em>paths</em>...</p>
<h1 id="options-71"><a class="header" href="#options-71">Options</a></h1>
<ul>
<li>
<p><span id="opt-algo"><a href="command-ref/new-cli/nix3-hash-path.html#opt-algo"><code>--algo</code></a></span> <em>hash-algo</em></p>
<p>Hash algorithm (<code>blake3</code>, <code>md5</code>, <code>sha1</code>, <code>sha256</code>, or <code>sha512</code>).</p>
</li>
<li>
<p><span id="opt-base16"><a href="command-ref/new-cli/nix3-hash-path.html#opt-base16"><code>--base16</code></a></span></p>
<p>Print the hash in base-16 format.</p>
</li>
<li>
<p><span id="opt-base32"><a href="command-ref/new-cli/nix3-hash-path.html#opt-base32"><code>--base32</code></a></span></p>
<p>Print the hash in base-32 (Nix-specific) format.</p>
</li>
<li>
<p><span id="opt-base64"><a href="command-ref/new-cli/nix3-hash-path.html#opt-base64"><code>--base64</code></a></span></p>
<p>Print the hash in base-64 format.</p>
</li>
<li>
<p><span id="opt-format"><a href="command-ref/new-cli/nix3-hash-path.html#opt-format"><code>--format</code></a></span> <em>hash-format</em></p>
<p>Hash format (<code>base16</code>, <code>nix32</code>, <code>base64</code>, <code>sri</code>). Default: <code>sri</code>.</p>
</li>
<li>
<p><span id="opt-mode"><a href="command-ref/new-cli/nix3-hash-path.html#opt-mode"><code>--mode</code></a></span> <em>file-ingestion-method</em></p>
<p>How to compute the hash of the input.
One of:</p>
<ul>
<li>
<p><code>nar</code> (the default):
Serialises the input as a
<a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive</a>
and passes that to the hash function.</p>
</li>
<li>
<p><code>flat</code>:
Assumes that the input is a single file and
<a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-flat">directly passes</a>
it to the hash function.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-sri"><a href="command-ref/new-cli/nix3-hash-path.html#opt-sri"><code>--sri</code></a></span></p>
<p>Print the hash in SRI format.</p>
</li>
<li>
<p><span id="opt-type"><a href="command-ref/new-cli/nix3-hash-path.html#opt-type"><code>--type</code></a></span> <em>hash-algo</em></p>
<p>Hash algorithm (<code>blake3</code>, <code>md5</code>, <code>sha1</code>, <code>sha256</code>, or <code>sha512</code>).</p>
</li>
</ul>
<h2 id="logging-related-options-32"><a class="header" href="#logging-related-options-32">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-hash-path.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-hash-path.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-hash-path.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-hash-path.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-hash-path.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-32"><a class="header" href="#miscellaneous-global-options-32">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-hash-path.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-hash-path.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-hash-path.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-hash-path.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-hash-path.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-75"><a class="header" href="#name-75">Name</a></h1>
<p><code>nix hash to-base16</code> - convert a hash to base-16 representation (deprecated, use <code>nix hash convert</code> instead)</p>
<h1 id="synopsis-75"><a class="header" href="#synopsis-75">Synopsis</a></h1>
<p><code>nix hash to-base16</code> [<em>option</em>...] <em>strings</em>...</p>
<h1 id="options-72"><a class="header" href="#options-72">Options</a></h1>
<ul>
<li>
<p><span id="opt-type"><a href="command-ref/new-cli/nix3-hash-to-base16.html#opt-type"><code>--type</code></a></span> <em>hash-algo</em></p>
<p>Hash algorithm (<code>blake3</code>, <code>md5</code>, <code>sha1</code>, <code>sha256</code>, or <code>sha512</code>). Can be omitted for SRI hashes.</p>
</li>
</ul>
<h2 id="logging-related-options-33"><a class="header" href="#logging-related-options-33">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-hash-to-base16.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-hash-to-base16.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-hash-to-base16.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-hash-to-base16.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-hash-to-base16.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-33"><a class="header" href="#miscellaneous-global-options-33">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-hash-to-base16.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-hash-to-base16.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-hash-to-base16.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-hash-to-base16.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-hash-to-base16.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-76"><a class="header" href="#name-76">Name</a></h1>
<p><code>nix hash to-base32</code> - convert a hash to base-32 representation (deprecated, use <code>nix hash convert</code> instead)</p>
<h1 id="synopsis-76"><a class="header" href="#synopsis-76">Synopsis</a></h1>
<p><code>nix hash to-base32</code> [<em>option</em>...] <em>strings</em>...</p>
<h1 id="options-73"><a class="header" href="#options-73">Options</a></h1>
<ul>
<li>
<p><span id="opt-type"><a href="command-ref/new-cli/nix3-hash-to-base32.html#opt-type"><code>--type</code></a></span> <em>hash-algo</em></p>
<p>Hash algorithm (<code>blake3</code>, <code>md5</code>, <code>sha1</code>, <code>sha256</code>, or <code>sha512</code>). Can be omitted for SRI hashes.</p>
</li>
</ul>
<h2 id="logging-related-options-34"><a class="header" href="#logging-related-options-34">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-hash-to-base32.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-hash-to-base32.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-hash-to-base32.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-hash-to-base32.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-hash-to-base32.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-34"><a class="header" href="#miscellaneous-global-options-34">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-hash-to-base32.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-hash-to-base32.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-hash-to-base32.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-hash-to-base32.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-hash-to-base32.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-77"><a class="header" href="#name-77">Name</a></h1>
<p><code>nix hash to-base64</code> - convert a hash to base-64 representation (deprecated, use <code>nix hash convert</code> instead)</p>
<h1 id="synopsis-77"><a class="header" href="#synopsis-77">Synopsis</a></h1>
<p><code>nix hash to-base64</code> [<em>option</em>...] <em>strings</em>...</p>
<h1 id="options-74"><a class="header" href="#options-74">Options</a></h1>
<ul>
<li>
<p><span id="opt-type"><a href="command-ref/new-cli/nix3-hash-to-base64.html#opt-type"><code>--type</code></a></span> <em>hash-algo</em></p>
<p>Hash algorithm (<code>blake3</code>, <code>md5</code>, <code>sha1</code>, <code>sha256</code>, or <code>sha512</code>). Can be omitted for SRI hashes.</p>
</li>
</ul>
<h2 id="logging-related-options-35"><a class="header" href="#logging-related-options-35">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-hash-to-base64.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-hash-to-base64.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-hash-to-base64.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-hash-to-base64.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-hash-to-base64.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-35"><a class="header" href="#miscellaneous-global-options-35">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-hash-to-base64.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-hash-to-base64.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-hash-to-base64.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-hash-to-base64.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-hash-to-base64.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-78"><a class="header" href="#name-78">Name</a></h1>
<p><code>nix hash to-sri</code> - convert a hash to SRI representation (deprecated, use <code>nix hash convert</code> instead)</p>
<h1 id="synopsis-78"><a class="header" href="#synopsis-78">Synopsis</a></h1>
<p><code>nix hash to-sri</code> [<em>option</em>...] <em>strings</em>...</p>
<h1 id="options-75"><a class="header" href="#options-75">Options</a></h1>
<ul>
<li>
<p><span id="opt-type"><a href="command-ref/new-cli/nix3-hash-to-sri.html#opt-type"><code>--type</code></a></span> <em>hash-algo</em></p>
<p>Hash algorithm (<code>blake3</code>, <code>md5</code>, <code>sha1</code>, <code>sha256</code>, or <code>sha512</code>). Can be omitted for SRI hashes.</p>
</li>
</ul>
<h2 id="logging-related-options-36"><a class="header" href="#logging-related-options-36">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-hash-to-sri.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-hash-to-sri.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-hash-to-sri.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-hash-to-sri.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-hash-to-sri.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-36"><a class="header" href="#miscellaneous-global-options-36">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-hash-to-sri.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-hash-to-sri.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-hash-to-sri.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-hash-to-sri.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-hash-to-sri.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-79"><a class="header" href="#name-79">Name</a></h1>
<p><code>nix help</code> - show help about <code>nix</code> or a particular subcommand</p>
<h1 id="synopsis-79"><a class="header" href="#synopsis-79">Synopsis</a></h1>
<p><code>nix help</code> [<em>option</em>...] <em>subcommand</em>...</p>
<h1 id="examples-51"><a class="header" href="#examples-51">Examples</a></h1>
<ul>
<li>
<p>Show help about <code>nix</code> in general:</p>
<pre><code class="language-console"># nix help
</code></pre>
</li>
<li>
<p>Show help about a particular subcommand:</p>
<pre><code class="language-console">    # nix help flake info
</code></pre>
</li>
</ul>
<h1 id="options-76"><a class="header" href="#options-76">Options</a></h1>
<h2 id="logging-related-options-37"><a class="header" href="#logging-related-options-37">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-help.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-help.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-help.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-help.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-help.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-37"><a class="header" href="#miscellaneous-global-options-37">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-help.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-help.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-help.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-help.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-help.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-80"><a class="header" href="#name-80">Name</a></h1>
<p><code>nix help-stores</code> - show help about store types and their settings</p>
<h1 id="synopsis-80"><a class="header" href="#synopsis-80">Synopsis</a></h1>
<p><code>nix help-stores</code> [<em>option</em>...]</p>
<p>Nix supports different types of stores:</p>
<ul>
<li><a href="command-ref/new-cli/nix3-help-stores.html#dummy-store">Dummy Store</a></li>
<li><a href="command-ref/new-cli/nix3-help-stores.html#experimental-local-overlay-store">Experimental Local Overlay Store</a></li>
<li><a href="command-ref/new-cli/nix3-help-stores.html#experimental-ssh-store">Experimental SSH Store</a></li>
<li><a href="command-ref/new-cli/nix3-help-stores.html#experimental-ssh-store-with-filesystem-mounted">Experimental SSH Store with filesystem mounted</a></li>
<li><a href="command-ref/new-cli/nix3-help-stores.html#http-binary-cache-store">HTTP Binary Cache Store</a></li>
<li><a href="command-ref/new-cli/nix3-help-stores.html#local-binary-cache-store">Local Binary Cache Store</a></li>
<li><a href="command-ref/new-cli/nix3-help-stores.html#local-daemon-store">Local Daemon Store</a></li>
<li><a href="command-ref/new-cli/nix3-help-stores.html#local-store">Local Store</a></li>
<li><a href="command-ref/new-cli/nix3-help-stores.html#s3-binary-cache-store">S3 Binary Cache Store</a></li>
<li><a href="command-ref/new-cli/nix3-help-stores.html#ssh-store">SSH Store</a></li>
</ul>
<h2 id="store-url-format-1"><a class="header" href="#store-url-format-1">Store URL format</a></h2>
<p>Stores are specified using a URL-like syntax. For example, the command</p>
<pre><code class="language-console"># nix path-info --store https://cache.nixos.org/ --json \
  /nix/store/a7gvj343m05j2s32xcnwr35v31ynlypr-coreutils-9.1
</code></pre>
<p>fetches information about a store path in the HTTP binary cache
located at https://cache.nixos.org/, which is a type of store.</p>
<p>Store URLs can specify <strong>store settings</strong> using URL query strings,
i.e. by appending <code>?name1=value1&amp;name2=value2&amp;...</code> to the URL. For
instance,</p>
<pre><code>--store ssh://machine.example.org?ssh-key=/path/to/my/key
</code></pre>
<p>tells Nix to access the store on a remote machine via the SSH
protocol, using <code>/path/to/my/key</code> as the SSH private key. The
supported settings for each store type are documented below.</p>
<p>The special store URL <code>auto</code> causes Nix to automatically select a
store as follows:</p>
<ul>
<li>
<p>Use the <a href="command-ref/new-cli/nix3-help-stores.html#local-store">local store</a> <code>/nix/store</code> if <code>/nix/var/nix</code>
is writable by the current user.</p>
</li>
<li>
<p>Otherwise, if <code>/nix/var/nix/daemon-socket/socket</code> exists, <a href="command-ref/new-cli/nix3-help-stores.html#local-daemon-store">connect
to the Nix daemon listening on that socket</a>.</p>
</li>
<li>
<p>Otherwise, on Linux only, use the <a href="command-ref/new-cli/nix3-help-stores.html#local-store">local chroot store</a>
<code>~/.local/share/nix/root</code>, which will be created automatically if it
does not exist.</p>
</li>
<li>
<p>Otherwise, use the <a href="command-ref/new-cli/nix3-help-stores.html#local-store">local store</a> <code>/nix/store</code>.</p>
</li>
</ul>
<h1 id="dummy-store-1"><a class="header" href="#dummy-store-1">Dummy Store</a></h1>
<p><strong>Store URL format</strong>: <code>dummy://</code></p>
<p>This store type represents a store that contains no store paths and
cannot be written to. It's useful when you want to use the Nix
evaluator when no actual Nix store exists, e.g.</p>
<pre><code class="language-console"># nix eval --store dummy:// --expr '1 + 2'
</code></pre>
<h2 id="settings-10"><a class="header" href="#settings-10">Settings</a></h2>
<ul>
<li>
<p><span id="store-dummy-store-path-info-cache-size"><a href="command-ref/new-cli/nix3-help-stores.html#store-dummy-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-dummy-store-priority"><a href="command-ref/new-cli/nix3-help-stores.html#store-dummy-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-dummy-store-store"><a href="command-ref/new-cli/nix3-help-stores.html#store-dummy-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-dummy-store-system-features"><a href="command-ref/new-cli/nix3-help-stores.html#store-dummy-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-dummy-store-trusted"><a href="command-ref/new-cli/nix3-help-stores.html#store-dummy-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-dummy-store-want-mass-query"><a href="command-ref/new-cli/nix3-help-stores.html#store-dummy-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<h1 id="experimental-local-overlay-store-1"><a class="header" href="#experimental-local-overlay-store-1">Experimental Local Overlay Store</a></h1>
<blockquote>
<p><strong>Warning</strong></p>
<p>This store is part of an
<a href="command-ref/new-cli/../../development/experimental-features.html">experimental feature</a>.</p>
<p>To use this store, make sure the
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-local-overlay-store"><code>local-overlay-store</code> experimental feature</a>
is enabled.
For example, include the following in <a href="command-ref/new-cli/../../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = local-overlay-store
</code></pre>
</blockquote>
<p><strong>Store URL format</strong>: <code>local-overlay</code></p>
<p>This store type is a variation of the [local store] designed to leverage Linux's <a href="https://docs.kernel.org/filesystems/overlayfs.html">Overlay Filesystem</a> (OverlayFS for short).
Just as OverlayFS combines a lower and upper filesystem by treating the upper one as a patch against the lower, the local overlay store combines a lower store with an upper almost-[local store].
("almost" because while the upper filesystems for OverlayFS is valid on its own, the upper almost-store is not a valid local store on its own because some references will dangle.)
To use this store, you will first need to configure an OverlayFS mountpoint <a href="command-ref/new-cli/nix3-help-stores.html#example-filesystem-layout">appropriately</a> as Nix will not do this for you (though it will verify the mountpoint is configured correctly).</p>
<h3 id="conceptual-parts-of-a-local-overlay-store-1"><a class="header" href="#conceptual-parts-of-a-local-overlay-store-1">Conceptual parts of a local overlay store</a></h3>
<p><em>This is a more abstract/conceptual description of the parts of a layered store, an authoritative reference.
For more "practical" instructions, see the worked-out example in the next subsection.</em></p>
<p>The parts of a local overlay store are as follows:</p>
<ul>
<li>
<p><strong>Lower store</strong>:</p>
<blockquote>
<p>Specified with the <a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-lower-store"><code>lower-store</code></a> setting.</p>
</blockquote>
<p>This is any store implementation that includes a store directory as part of the native operating system filesystem.
For example, this could be a [local store], [local daemon store], or even another local overlay store.</p>
<p>The local overlay store never tries to modify the lower store in any way.
Something else could modify the lower store, but there are restrictions on this
Nix itself requires that this store only grow, and not change in other ways.
For example, new store objects can be added, but deleting or modifying store objects is not allowed in general, because that will confuse and corrupt any local overlay store using those objects.
(In addition, the underlying filesystem overlay mechanism may impose additional restrictions, see below.)</p>
<p>The lower store must not change while it is mounted as part of an overlay store.
To ensure it does not, you might want to mount the store directory read-only (which then requires the [read-only] parameter to be set to <code>true</code>).</p>
<ul>
<li>
<p><strong>Lower store directory</strong>:</p>
<blockquote>
<p>Specified with <code>lower-store.real</code> setting.</p>
</blockquote>
<p>This is the directory used/exposed by the lower store.</p>
<p>As specified above, Nix requires the local store can only grow not change in other ways.
Linux's OverlayFS in addition imposes the further requirement that this directory cannot change at all.
That means that, while any local overlay store exists that is using this store as a lower store, this directory must not change.</p>
</li>
<li>
<p><strong>Lower metadata source</strong>:</p>
<blockquote>
<p>Not directly specified.
A consequence of the <code>lower-store</code> setting, depending on the type of lower store chosen.</p>
</blockquote>
<p>This is abstract, just some way to read the metadata of lower store <a href="command-ref/new-cli/../../store/store-object.html">store objects</a>.
For example it could be a SQLite database (for the [local store]), or a socket connection (for the [local daemon store]).</p>
<p>This need not be writable.
As stated above a local overlay store never tries to modify its lower store.
The lower store's metadata is considered part of the lower store, just as the store's <a href="command-ref/new-cli/../../store/file-system-object.html">file system objects</a> that appear in the store directory are.</p>
</li>
</ul>
</li>
<li>
<p><strong>Upper almost-store</strong>:</p>
<blockquote>
<p>Not directly specified.
Instead the constituent parts are independently specified as described below.</p>
</blockquote>
<p>This is almost but not quite just a [local store].
That is because taken in isolation, not as part of a local overlay store, by itself, it would appear corrupted.
But combined with everything else as part of an overlay local store, it is valid.</p>
<ul>
<li>
<p><strong>Upper layer directory</strong>:</p>
<blockquote>
<p>Specified with <a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-upper-layer"><code>upper-layer</code></a> setting.</p>
</blockquote>
<p>This contains additional <a href="command-ref/new-cli/../../store/store-object.html">store objects</a>
(or, strictly speaking, their <a href="command-ref/new-cli/../../store/file-system-object.html">file system objects</a> that the local overlay store will extend the lower store with).</p>
</li>
<li>
<p><strong>Upper store directory</strong>:</p>
<blockquote>
<p>Specified with the <a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-real"><code>real</code></a> setting.
This the same as the base local store setting, and can also be indirectly specified with the <a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-root"><code>root</code></a> setting.</p>
</blockquote>
<p>This contains all the store objects from each of the two directories.</p>
<p>The lower store directory and upper layer directory are combined via OverlayFS to create this directory.
Nix doesn't do this itself, because it typically wouldn't have the permissions to do so, so it is the responsibility of the user to set this up first.
Nix can, however, optionally check that the OverlayFS mount settings appear as expected, matching Nix's own settings.</p>
</li>
<li>
<p><strong>Upper SQLite database</strong>:</p>
<blockquote>
<p>Not directly specified.
The location of the database instead depends on the <a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-state"><code>state</code></a> setting.
It is always <code>${state}/db</code>.</p>
</blockquote>
<p>This contains the metadata of all of the upper layer <a href="command-ref/new-cli/../../store/store-object.html">store objects</a> (everything beyond their file system objects), and also duplicate copies of some lower layer store object's metadta.
The duplication is so the metadata for the <a href="command-ref/new-cli/../../glossary.html#gloss-closure">closure</a> of upper layer <a href="command-ref/new-cli/../../store/store-object.html">store objects</a> can be found entirely within the upper layer.
(This allows us to use the same SQL Schema as the [local store]'s SQLite database, as foreign keys in that schema enforce closure metadata to be self-contained in this way.)</p>
</li>
</ul>
</li>
</ul>
<h3 id="example-filesystem-layout-1"><a class="header" href="#example-filesystem-layout-1">Example filesystem layout</a></h3>
<p>Here is a worked out example of usage, following the concepts in the previous section.</p>
<p>Say we have the following paths:</p>
<ul>
<li>
<p><code>/mnt/example/merged-store/nix/store</code></p>
</li>
<li>
<p><code>/mnt/example/store-a/nix/store</code></p>
</li>
<li>
<p><code>/mnt/example/store-b</code></p>
</li>
</ul>
<p>Then the following store URI can be used to access a local-overlay store at <code>/mnt/example/merged-store</code>:</p>
<pre><code>local-overlay://?root=/mnt/example/merged-store&amp;lower-store=/mnt/example/store-a&amp;upper-layer=/mnt/example/store-b
</code></pre>
<p>The lower store directory is located at <code>/mnt/example/store-a/nix/store</code>, while the upper layer is at <code>/mnt/example/store-b</code>.</p>
<p>Before accessing the overlay store you will need to ensure the OverlayFS mount is set up correctly:</p>
<pre><code class="language-shell">mount -t overlay overlay \
  -o lowerdir="/mnt/example/store-a/nix/store" \
  -o upperdir="/mnt/example/store-b" \
  -o workdir="/mnt/example/workdir" \
  "/mnt/example/merged-store/nix/store"
</code></pre>
<p>Note that OverlayFS requires <code>/mnt/example/workdir</code> to be on the same volume as the <code>upperdir</code>.</p>
<p>By default, Nix will check that the mountpoint as been set up correctly and fail with an error if it has not.
You can override this behaviour by passing <a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-check-mount"><code>check-mount=false</code></a> if you need to.</p>
<h2 id="settings-11"><a class="header" href="#settings-11">Settings</a></h2>
<ul>
<li>
<p><span id="store-experimental-local-overlay-store-check-mount"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-check-mount"><code>check-mount</code></a></span></p>
<p>Check that the overlay filesystem is correctly mounted.</p>
<p>Nix does not manage the overlayfs mount point itself, but the correct
functioning of the overlay store does depend on this mount point being set up
correctly. Rather than just assume this is the case, check that the lowerdir
and upperdir options are what we expect them to be. This check is on by
default, but can be disabled if needed.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-log"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-log"><code>log</code></a></span></p>
<p>directory where Nix will store log files.</p>
<p><strong>Default:</strong> <code>/nix/var/log/nix</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-lower-store"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-lower-store"><code>lower-store</code></a></span></p>
<p><a href="command-ref/new-cli/../../command-ref/new-cli/nix3-help-stores.html#store-url-format">Store URL</a>
for the lower store. The default is <code>auto</code> (i.e. use the Nix daemon or <code>/nix/store</code> directly).</p>
<p>Must be a store with a store dir on the file system.
Must be used as OverlayFS lower layer for this store's store dir.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-path-info-cache-size"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-priority"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-read-only"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-read-only"><code>read-only</code></a></span></p>
<p>Allow this store to be opened when its <a href="command-ref/new-cli/../../glossary.html#gloss-nix-database">database</a> is on a read-only filesystem.</p>
<p>Normally Nix will attempt to open the store database in read-write mode, even for querying (when write access is not needed), causing it to fail if the database is on a read-only filesystem.</p>
<p>Enable read-only mode to disable locking and open the SQLite database with the <a href="https://www.sqlite.org/c3ref/open.html"><code>immutable</code> parameter</a> set.</p>
<blockquote>
<p><strong>Warning</strong>
Do not use this unless the filesystem is read-only.</p>
<p>Using it when the filesystem is writable can cause incorrect query results or corruption errors if the database is changed by another process.
While the filesystem the database resides on might appear to be read-only, consider whether another user or system might have write access to it.</p>
</blockquote>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-real"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-real"><code>real</code></a></span></p>
<p>Physical path of the Nix store.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-remount-hook"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-remount-hook"><code>remount-hook</code></a></span></p>
<p>Script or other executable to run when overlay filesystem needs remounting.</p>
<p>This is occasionally necessary when deleting a store path that exists in both upper and lower layers.
In such a situation, bypassing OverlayFS and deleting the path in the upper layer directly
is the only way to perform the deletion without creating a "whiteout".
However this causes the OverlayFS kernel data structures to get out-of-sync,
and can lead to 'stale file handle' errors; remounting solves the problem.</p>
<p>The store directory is passed as an argument to the invoked executable.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-require-sigs"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-require-sigs"><code>require-sigs</code></a></span></p>
<p>Whether store paths copied into this store should have a trusted signature.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-root"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-root"><code>root</code></a></span></p>
<p>Directory prefixed to all other paths.</p>
<p><strong>Default:</strong> ``</p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-state"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-state"><code>state</code></a></span></p>
<p>Directory where Nix will store state.</p>
<p><strong>Default:</strong> <code>/dummy</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-store"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-system-features"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-trusted"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-upper-layer"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-upper-layer"><code>upper-layer</code></a></span></p>
<p>Directory containing the OverlayFS upper layer for this store's store dir.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-local-overlay-store-want-mass-query"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-local-overlay-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<h1 id="experimental-ssh-store-with-filesystem-mounted-1"><a class="header" href="#experimental-ssh-store-with-filesystem-mounted-1">Experimental SSH Store with filesystem mounted</a></h1>
<blockquote>
<p><strong>Warning</strong></p>
<p>This store is part of an
<a href="command-ref/new-cli/../../development/experimental-features.html">experimental feature</a>.</p>
<p>To use this store, make sure the
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-mounted-ssh-store"><code>mounted-ssh-store</code> experimental feature</a>
is enabled.
For example, include the following in <a href="command-ref/new-cli/../../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = mounted-ssh-store
</code></pre>
</blockquote>
<p><strong>Store URL format</strong>: <code>mounted-ssh-ng://[username@]hostname</code></p>
<p>Experimental store type that allows full access to a Nix store on a remote machine,
and additionally requires that store be mounted in the local file system.</p>
<p>The mounting of that store is not managed by Nix, and must by managed manually.
It could be accomplished with SSHFS or NFS, for example.</p>
<p>The local file system is used to optimize certain operations.
For example, rather than serializing Nix archives and sending over the Nix channel,
we can directly access the file system data via the mount-point.</p>
<p>The local file system is also used to make certain operations possible that wouldn't otherwise be.
For example, persistent GC roots can be created if they reside on the same file system as the remote store:
the remote side will create the symlinks necessary to avoid race conditions.</p>
<h2 id="settings-12"><a class="header" href="#settings-12">Settings</a></h2>
<ul>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-base64-ssh-public-host-key"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-base64-ssh-public-host-key"><code>base64-ssh-public-host-key</code></a></span></p>
<p>The public host key of the remote machine.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-compress"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-compress"><code>compress</code></a></span></p>
<p>Whether to enable SSH compression.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-log"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-log"><code>log</code></a></span></p>
<p>directory where Nix will store log files.</p>
<p><strong>Default:</strong> <code>/nix/var/log/nix</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-max-connection-age"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-max-connection-age"><code>max-connection-age</code></a></span></p>
<p>Maximum age of a connection before it is closed.</p>
<p><strong>Default:</strong> <code>4294967295</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-max-connections"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-max-connections"><code>max-connections</code></a></span></p>
<p>Maximum number of concurrent connections to the Nix daemon.</p>
<p><strong>Default:</strong> <code>1</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-path-info-cache-size"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-priority"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-real"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-real"><code>real</code></a></span></p>
<p>Physical path of the Nix store.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-remote-program"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-remote-program"><code>remote-program</code></a></span></p>
<p>Path to the <code>nix-daemon</code> executable on the remote machine.</p>
<p><strong>Default:</strong> <code>nix-daemon</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-remote-store"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-remote-store"><code>remote-store</code></a></span></p>
<p><a href="command-ref/new-cli/../../store/types/index.html#store-url-format">Store URL</a>
to be used on the remote machine. The default is <code>auto</code>
(i.e. use the Nix daemon or <code>/nix/store</code> directly).</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-root"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-root"><code>root</code></a></span></p>
<p>Directory prefixed to all other paths.</p>
<p><strong>Default:</strong> ``</p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-ssh-key"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-ssh-key"><code>ssh-key</code></a></span></p>
<p>Path to the SSH private key used to authenticate to the remote machine.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-state"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-state"><code>state</code></a></span></p>
<p>Directory where Nix will store state.</p>
<p><strong>Default:</strong> <code>/dummy</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-store"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-system-features"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-trusted"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-with-filesystem-mounted-want-mass-query"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-with-filesystem-mounted-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<h1 id="experimental-ssh-store-1"><a class="header" href="#experimental-ssh-store-1">Experimental SSH Store</a></h1>
<p><strong>Store URL format</strong>: <code>ssh-ng://[username@]hostname</code></p>
<p>Experimental store type that allows full access to a Nix store on a
remote machine.</p>
<h2 id="settings-13"><a class="header" href="#settings-13">Settings</a></h2>
<ul>
<li>
<p><span id="store-experimental-ssh-store-base64-ssh-public-host-key"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-base64-ssh-public-host-key"><code>base64-ssh-public-host-key</code></a></span></p>
<p>The public host key of the remote machine.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-compress"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-compress"><code>compress</code></a></span></p>
<p>Whether to enable SSH compression.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-max-connection-age"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-max-connection-age"><code>max-connection-age</code></a></span></p>
<p>Maximum age of a connection before it is closed.</p>
<p><strong>Default:</strong> <code>4294967295</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-max-connections"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-max-connections"><code>max-connections</code></a></span></p>
<p>Maximum number of concurrent connections to the Nix daemon.</p>
<p><strong>Default:</strong> <code>1</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-path-info-cache-size"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-priority"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-remote-program"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-remote-program"><code>remote-program</code></a></span></p>
<p>Path to the <code>nix-daemon</code> executable on the remote machine.</p>
<p><strong>Default:</strong> <code>nix-daemon</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-remote-store"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-remote-store"><code>remote-store</code></a></span></p>
<p><a href="command-ref/new-cli/../../store/types/index.html#store-url-format">Store URL</a>
to be used on the remote machine. The default is <code>auto</code>
(i.e. use the Nix daemon or <code>/nix/store</code> directly).</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-ssh-key"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-ssh-key"><code>ssh-key</code></a></span></p>
<p>Path to the SSH private key used to authenticate to the remote machine.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-store"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-system-features"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-trusted"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-experimental-ssh-store-want-mass-query"><a href="command-ref/new-cli/nix3-help-stores.html#store-experimental-ssh-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<h1 id="http-binary-cache-store-1"><a class="header" href="#http-binary-cache-store-1">HTTP Binary Cache Store</a></h1>
<p><strong>Store URL format</strong>: <code>http://...</code>, <code>https://...</code></p>
<p>This store allows a binary cache to be accessed via the HTTP
protocol.</p>
<h2 id="settings-14"><a class="header" href="#settings-14">Settings</a></h2>
<ul>
<li>
<p><span id="store-http-binary-cache-store-compression"><a href="command-ref/new-cli/nix3-help-stores.html#store-http-binary-cache-store-compression"><code>compression</code></a></span></p>
<p>NAR compression method (<code>xz</code>, <code>bzip2</code>, <code>gzip</code>, <code>zstd</code>, or <code>none</code>).</p>
<p><strong>Default:</strong> <code>xz</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-compression-level"><a href="command-ref/new-cli/nix3-help-stores.html#store-http-binary-cache-store-compression-level"><code>compression-level</code></a></span></p>
<p>The <em>preset level</em> to be used when compressing NARs.
The meaning and accepted values depend on the compression method selected.
<code>-1</code> specifies that the default compression level should be used.</p>
<p><strong>Default:</strong> <code>-1</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-index-debug-info"><a href="command-ref/new-cli/nix3-help-stores.html#store-http-binary-cache-store-index-debug-info"><code>index-debug-info</code></a></span></p>
<p>Whether to index DWARF debug info files by build ID. This allows <a href="https://github.com/edolstra/dwarffs"><code>dwarffs</code></a> to
fetch debug info on demand</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-local-nar-cache"><a href="command-ref/new-cli/nix3-help-stores.html#store-http-binary-cache-store-local-nar-cache"><code>local-nar-cache</code></a></span></p>
<p>Path to a local cache of NARs fetched from this binary cache, used by commands such as <code>nix store cat</code>.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-parallel-compression"><a href="command-ref/new-cli/nix3-help-stores.html#store-http-binary-cache-store-parallel-compression"><code>parallel-compression</code></a></span></p>
<p>Enable multi-threaded compression of NARs. This is currently only available for <code>xz</code> and <code>zstd</code>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-path-info-cache-size"><a href="command-ref/new-cli/nix3-help-stores.html#store-http-binary-cache-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-priority"><a href="command-ref/new-cli/nix3-help-stores.html#store-http-binary-cache-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-secret-key"><a href="command-ref/new-cli/nix3-help-stores.html#store-http-binary-cache-store-secret-key"><code>secret-key</code></a></span></p>
<p>Path to the secret key used to sign the binary cache.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-store"><a href="command-ref/new-cli/nix3-help-stores.html#store-http-binary-cache-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-system-features"><a href="command-ref/new-cli/nix3-help-stores.html#store-http-binary-cache-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-trusted"><a href="command-ref/new-cli/nix3-help-stores.html#store-http-binary-cache-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-want-mass-query"><a href="command-ref/new-cli/nix3-help-stores.html#store-http-binary-cache-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-http-binary-cache-store-write-nar-listing"><a href="command-ref/new-cli/nix3-help-stores.html#store-http-binary-cache-store-write-nar-listing"><code>write-nar-listing</code></a></span></p>
<p>Whether to write a JSON file that lists the files in each NAR.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<h1 id="local-binary-cache-store-1"><a class="header" href="#local-binary-cache-store-1">Local Binary Cache Store</a></h1>
<p><strong>Store URL format</strong>: <code>file://</code><em>path</em></p>
<p>This store allows reading and writing a binary cache stored in <em>path</em>
in the local filesystem. If <em>path</em> does not exist, it will be created.</p>
<p>For example, the following builds or downloads <code>nixpkgs#hello</code> into
the local store and then copies it to the binary cache in
<code>/tmp/binary-cache</code>:</p>
<pre><code># nix copy --to file:///tmp/binary-cache nixpkgs#hello
</code></pre>
<h2 id="settings-15"><a class="header" href="#settings-15">Settings</a></h2>
<ul>
<li>
<p><span id="store-local-binary-cache-store-compression"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-binary-cache-store-compression"><code>compression</code></a></span></p>
<p>NAR compression method (<code>xz</code>, <code>bzip2</code>, <code>gzip</code>, <code>zstd</code>, or <code>none</code>).</p>
<p><strong>Default:</strong> <code>xz</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-compression-level"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-binary-cache-store-compression-level"><code>compression-level</code></a></span></p>
<p>The <em>preset level</em> to be used when compressing NARs.
The meaning and accepted values depend on the compression method selected.
<code>-1</code> specifies that the default compression level should be used.</p>
<p><strong>Default:</strong> <code>-1</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-index-debug-info"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-binary-cache-store-index-debug-info"><code>index-debug-info</code></a></span></p>
<p>Whether to index DWARF debug info files by build ID. This allows <a href="https://github.com/edolstra/dwarffs"><code>dwarffs</code></a> to
fetch debug info on demand</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-local-nar-cache"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-binary-cache-store-local-nar-cache"><code>local-nar-cache</code></a></span></p>
<p>Path to a local cache of NARs fetched from this binary cache, used by commands such as <code>nix store cat</code>.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-parallel-compression"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-binary-cache-store-parallel-compression"><code>parallel-compression</code></a></span></p>
<p>Enable multi-threaded compression of NARs. This is currently only available for <code>xz</code> and <code>zstd</code>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-path-info-cache-size"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-binary-cache-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-priority"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-binary-cache-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-secret-key"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-binary-cache-store-secret-key"><code>secret-key</code></a></span></p>
<p>Path to the secret key used to sign the binary cache.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-store"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-binary-cache-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-system-features"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-binary-cache-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-trusted"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-binary-cache-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-want-mass-query"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-binary-cache-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-local-binary-cache-store-write-nar-listing"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-binary-cache-store-write-nar-listing"><code>write-nar-listing</code></a></span></p>
<p>Whether to write a JSON file that lists the files in each NAR.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<h1 id="local-daemon-store-1"><a class="header" href="#local-daemon-store-1">Local Daemon Store</a></h1>
<p><strong>Store URL format</strong>: <code>daemon</code>, <code>unix://</code><em>path</em></p>
<p>This store type accesses a Nix store by talking to a Nix daemon
listening on the Unix domain socket <em>path</em>. The store pseudo-URL
<code>daemon</code> is equivalent to <code>unix:///nix/var/nix/daemon-socket/socket</code>.</p>
<h2 id="settings-16"><a class="header" href="#settings-16">Settings</a></h2>
<ul>
<li>
<p><span id="store-local-daemon-store-log"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-daemon-store-log"><code>log</code></a></span></p>
<p>directory where Nix will store log files.</p>
<p><strong>Default:</strong> <code>/nix/var/log/nix</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-max-connection-age"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-daemon-store-max-connection-age"><code>max-connection-age</code></a></span></p>
<p>Maximum age of a connection before it is closed.</p>
<p><strong>Default:</strong> <code>4294967295</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-max-connections"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-daemon-store-max-connections"><code>max-connections</code></a></span></p>
<p>Maximum number of concurrent connections to the Nix daemon.</p>
<p><strong>Default:</strong> <code>1</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-path-info-cache-size"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-daemon-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-priority"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-daemon-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-real"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-daemon-store-real"><code>real</code></a></span></p>
<p>Physical path of the Nix store.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-root"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-daemon-store-root"><code>root</code></a></span></p>
<p>Directory prefixed to all other paths.</p>
<p><strong>Default:</strong> ``</p>
</li>
<li>
<p><span id="store-local-daemon-store-state"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-daemon-store-state"><code>state</code></a></span></p>
<p>Directory where Nix will store state.</p>
<p><strong>Default:</strong> <code>/dummy</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-store"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-daemon-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-system-features"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-daemon-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-local-daemon-store-trusted"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-daemon-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-local-daemon-store-want-mass-query"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-daemon-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<h1 id="local-store-1"><a class="header" href="#local-store-1">Local Store</a></h1>
<p><strong>Store URL format</strong>: <code>local</code>, <em>root</em></p>
<p>This store type accesses a Nix store in the local filesystem directly
(i.e. not via the Nix daemon). <em>root</em> is an absolute path that is
prefixed to other directories such as the Nix store directory. The
store pseudo-URL <code>local</code> denotes a store that uses <code>/</code> as its root
directory.</p>
<p>A store that uses a <em>root</em> other than <code>/</code> is called a <em>chroot
store</em>. With such stores, the store directory is "logically" still
<code>/nix/store</code>, so programs stored in them can only be built and
executed by <code>chroot</code>-ing into <em>root</em>. Chroot stores only support
building and running on Linux when <a href="https://man7.org/linux/man-pages/man7/mount_namespaces.7.html"><code>mount namespaces</code></a> and <a href="https://man7.org/linux/man-pages/man7/user_namespaces.7.html"><code>user namespaces</code></a> are
enabled.</p>
<p>For example, the following uses <code>/tmp/root</code> as the chroot environment
to build or download <code>nixpkgs#hello</code> and then execute it:</p>
<pre><code class="language-console"># nix run --store /tmp/root nixpkgs#hello
Hello, world!
</code></pre>
<p>Here, the "physical" store location is <code>/tmp/root/nix/store</code>, and
Nix's store metadata is in <code>/tmp/root/nix/var/nix/db</code>.</p>
<p>It is also possible, but not recommended, to change the "logical"
location of the Nix store from its default of <code>/nix/store</code>. This makes
it impossible to use default substituters such as
<code>https://cache.nixos.org/</code>, and thus you may have to build everything
locally. Here is an example:</p>
<pre><code class="language-console"># nix build --store 'local?store=/tmp/my-nix/store&amp;state=/tmp/my-nix/state&amp;log=/tmp/my-nix/log' nixpkgs#hello
</code></pre>
<h2 id="settings-17"><a class="header" href="#settings-17">Settings</a></h2>
<ul>
<li>
<p><span id="store-local-store-log"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-store-log"><code>log</code></a></span></p>
<p>directory where Nix will store log files.</p>
<p><strong>Default:</strong> <code>/nix/var/log/nix</code></p>
</li>
<li>
<p><span id="store-local-store-path-info-cache-size"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-local-store-priority"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-local-store-read-only"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-store-read-only"><code>read-only</code></a></span></p>
<p>Allow this store to be opened when its <a href="command-ref/new-cli/../../glossary.html#gloss-nix-database">database</a> is on a read-only filesystem.</p>
<p>Normally Nix will attempt to open the store database in read-write mode, even for querying (when write access is not needed), causing it to fail if the database is on a read-only filesystem.</p>
<p>Enable read-only mode to disable locking and open the SQLite database with the <a href="https://www.sqlite.org/c3ref/open.html"><code>immutable</code> parameter</a> set.</p>
<blockquote>
<p><strong>Warning</strong>
Do not use this unless the filesystem is read-only.</p>
<p>Using it when the filesystem is writable can cause incorrect query results or corruption errors if the database is changed by another process.
While the filesystem the database resides on might appear to be read-only, consider whether another user or system might have write access to it.</p>
</blockquote>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-local-store-real"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-store-real"><code>real</code></a></span></p>
<p>Physical path of the Nix store.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-local-store-require-sigs"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-store-require-sigs"><code>require-sigs</code></a></span></p>
<p>Whether store paths copied into this store should have a trusted signature.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="store-local-store-root"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-store-root"><code>root</code></a></span></p>
<p>Directory prefixed to all other paths.</p>
<p><strong>Default:</strong> ``</p>
</li>
<li>
<p><span id="store-local-store-state"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-store-state"><code>state</code></a></span></p>
<p>Directory where Nix will store state.</p>
<p><strong>Default:</strong> <code>/dummy</code></p>
</li>
<li>
<p><span id="store-local-store-store"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-local-store-system-features"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-local-store-trusted"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-local-store-want-mass-query"><a href="command-ref/new-cli/nix3-help-stores.html#store-local-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<h1 id="s3-binary-cache-store-1"><a class="header" href="#s3-binary-cache-store-1">S3 Binary Cache Store</a></h1>
<p><strong>Store URL format</strong>: <code>s3://</code><em>bucket-name</em></p>
<p>This store allows reading and writing a binary cache stored in an AWS S3 (or S3-compatible service) bucket.
This store shares many idioms with the <a href="command-ref/new-cli/../../store/types/http-binary-cache-store.html">HTTP Binary Cache Store</a>.</p>
<p>For AWS S3, the binary cache URL for a bucket named <code>example-nix-cache</code> will be exactly <a href="s3://example-nix-cache">s3://example-nix-cache</a>.
For S3 compatible binary caches, consult that cache's documentation.</p>
<h3 id="anonymous-reads-to-your-s3-compatible-binary-cache-1"><a class="header" href="#anonymous-reads-to-your-s3-compatible-binary-cache-1">Anonymous reads to your S3-compatible binary cache</a></h3>
<blockquote>
<p>If your binary cache is publicly accessible and does not require authentication,
it is simplest to use the [HTTP Binary Cache Store] rather than S3 Binary Cache Store with
<a href="https://example-nix-cache.s3.amazonaws.com">https://example-nix-cache.s3.amazonaws.com</a> instead of <a href="s3://example-nix-cache">s3://example-nix-cache</a>.</p>
</blockquote>
<p>Your bucket will need a
<a href="https://docs.aws.amazon.com/AmazonS3/v1/userguide/bucket-policies.html">bucket policy</a>
like the following to be accessible:</p>
<pre><code class="language-json">{
    "Id": "DirectReads",
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowDirectReads",
            "Action": [
                "s3:GetObject",
                "s3:GetBucketLocation"
            ],
            "Effect": "Allow",
            "Resource": [
                "arn:aws:s3:::example-nix-cache",
                "arn:aws:s3:::example-nix-cache/*"
            ],
            "Principal": "*"
        }
    ]
}
</code></pre>
<h3 id="authentication-1"><a class="header" href="#authentication-1">Authentication</a></h3>
<p>Nix will use the
<a href="https://docs.aws.amazon.com/sdk-for-cpp/v1/developer-guide/credentials.html">default credential provider chain</a>
for authenticating requests to Amazon S3.</p>
<p>Note that this means Nix will read environment variables and files with different idioms than with Nix's own settings, as implemented by the AWS SDK.
Consult the documentation linked above for further details.</p>
<h3 id="authenticated-reads-to-your-s3-binary-cache-1"><a class="header" href="#authenticated-reads-to-your-s3-binary-cache-1">Authenticated reads to your S3 binary cache</a></h3>
<p>Your bucket will need a bucket policy allowing the desired users to perform the <code>s3:GetObject</code> and <code>s3:GetBucketLocation</code> action on all objects in the bucket.
The <a href="command-ref/new-cli/nix3-help-stores.html#anonymous-reads-to-your-s3-compatible-binary-cache">anonymous policy given above</a> can be updated to have a restricted <code>Principal</code> to support this.</p>
<h3 id="authenticated-writes-to-your-s3-compatible-binary-cache-1"><a class="header" href="#authenticated-writes-to-your-s3-compatible-binary-cache-1">Authenticated writes to your S3-compatible binary cache</a></h3>
<p>Your account will need an IAM policy to support uploading to the bucket:</p>
<pre><code class="language-json">{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "UploadToCache",
      "Effect": "Allow",
      "Action": [
        "s3:AbortMultipartUpload",
        "s3:GetBucketLocation",
        "s3:GetObject",
        "s3:ListBucket",
        "s3:ListBucketMultipartUploads",
        "s3:ListMultipartUploadParts",
        "s3:PutObject"
      ],
      "Resource": [
        "arn:aws:s3:::example-nix-cache",
        "arn:aws:s3:::example-nix-cache/*"
      ]
    }
  ]
}
</code></pre>
<h3 id="examples-52"><a class="header" href="#examples-52">Examples</a></h3>
<p>With bucket policies and authentication set up as described above, uploading works via <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-copy.html"><code>nix copy</code></a> (experimental).</p>
<ul>
<li>
<p>To upload with a specific credential profile for Amazon S3:</p>
<pre><code class="language-console">$ nix copy nixpkgs.hello \
  --to 's3://example-nix-cache?profile=cache-upload&amp;region=eu-west-2'
</code></pre>
</li>
<li>
<p>To upload to an S3-compatible binary cache:</p>
<pre><code class="language-console">$ nix copy nixpkgs.hello --to \
  's3://example-nix-cache?profile=cache-upload&amp;scheme=https&amp;endpoint=minio.example.com'
</code></pre>
</li>
</ul>
<h2 id="settings-18"><a class="header" href="#settings-18">Settings</a></h2>
<ul>
<li>
<p><span id="store-s3-binary-cache-store-buffer-size"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-buffer-size"><code>buffer-size</code></a></span></p>
<p>Size (in bytes) of each part in multi-part uploads.</p>
<p><strong>Default:</strong> <code>5242880</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-compression"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-compression"><code>compression</code></a></span></p>
<p>NAR compression method (<code>xz</code>, <code>bzip2</code>, <code>gzip</code>, <code>zstd</code>, or <code>none</code>).</p>
<p><strong>Default:</strong> <code>xz</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-compression-level"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-compression-level"><code>compression-level</code></a></span></p>
<p>The <em>preset level</em> to be used when compressing NARs.
The meaning and accepted values depend on the compression method selected.
<code>-1</code> specifies that the default compression level should be used.</p>
<p><strong>Default:</strong> <code>-1</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-endpoint"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-endpoint"><code>endpoint</code></a></span></p>
<p>The URL of the endpoint of an S3-compatible service such as MinIO.
Do not specify this setting if you're using Amazon S3.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>This endpoint must support HTTPS and will use path-based
addressing instead of virtual host based addressing.</p>
</blockquote>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-index-debug-info"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-index-debug-info"><code>index-debug-info</code></a></span></p>
<p>Whether to index DWARF debug info files by build ID. This allows <a href="https://github.com/edolstra/dwarffs"><code>dwarffs</code></a> to
fetch debug info on demand</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-local-nar-cache"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-local-nar-cache"><code>local-nar-cache</code></a></span></p>
<p>Path to a local cache of NARs fetched from this binary cache, used by commands such as <code>nix store cat</code>.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-log-compression"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-log-compression"><code>log-compression</code></a></span></p>
<p>Compression method for <code>log/*</code> files. It is recommended to
use a compression method supported by most web browsers
(e.g. <code>brotli</code>).</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-ls-compression"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-ls-compression"><code>ls-compression</code></a></span></p>
<p>Compression method for <code>.ls</code> files.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-multipart-upload"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-multipart-upload"><code>multipart-upload</code></a></span></p>
<p>Whether to use multi-part uploads.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-narinfo-compression"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-narinfo-compression"><code>narinfo-compression</code></a></span></p>
<p>Compression method for <code>.narinfo</code> files.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-parallel-compression"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-parallel-compression"><code>parallel-compression</code></a></span></p>
<p>Enable multi-threaded compression of NARs. This is currently only available for <code>xz</code> and <code>zstd</code>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-path-info-cache-size"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-priority"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-profile"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-profile"><code>profile</code></a></span></p>
<p>The name of the AWS configuration profile to use. By default
Nix will use the <code>default</code> profile.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-region"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-region"><code>region</code></a></span></p>
<p>The region of the S3 bucket. If your bucket is not in
<code>us–east-1</code>, you should always explicitly specify the region
parameter.</p>
<p><strong>Default:</strong> <code>us-east-1</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-scheme"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-scheme"><code>scheme</code></a></span></p>
<p>The scheme used for S3 requests, <code>https</code> (default) or <code>http</code>. This
option allows you to disable HTTPS for binary caches which don't
support it.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>HTTPS should be used if the cache might contain sensitive
information.</p>
</blockquote>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-secret-key"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-secret-key"><code>secret-key</code></a></span></p>
<p>Path to the secret key used to sign the binary cache.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-store"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-system-features"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-trusted"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-want-mass-query"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-s3-binary-cache-store-write-nar-listing"><a href="command-ref/new-cli/nix3-help-stores.html#store-s3-binary-cache-store-write-nar-listing"><code>write-nar-listing</code></a></span></p>
<p>Whether to write a JSON file that lists the files in each NAR.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<h1 id="ssh-store-1"><a class="header" href="#ssh-store-1">SSH Store</a></h1>
<p><strong>Store URL format</strong>: <code>ssh://[username@]hostname</code></p>
<p>This store type allows limited access to a remote store on another
machine via SSH.</p>
<h2 id="settings-19"><a class="header" href="#settings-19">Settings</a></h2>
<ul>
<li>
<p><span id="store-ssh-store-base64-ssh-public-host-key"><a href="command-ref/new-cli/nix3-help-stores.html#store-ssh-store-base64-ssh-public-host-key"><code>base64-ssh-public-host-key</code></a></span></p>
<p>The public host key of the remote machine.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-ssh-store-compress"><a href="command-ref/new-cli/nix3-help-stores.html#store-ssh-store-compress"><code>compress</code></a></span></p>
<p>Whether to enable SSH compression.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-ssh-store-max-connections"><a href="command-ref/new-cli/nix3-help-stores.html#store-ssh-store-max-connections"><code>max-connections</code></a></span></p>
<p>Maximum number of concurrent SSH connections.</p>
<p><strong>Default:</strong> <code>1</code></p>
</li>
<li>
<p><span id="store-ssh-store-path-info-cache-size"><a href="command-ref/new-cli/nix3-help-stores.html#store-ssh-store-path-info-cache-size"><code>path-info-cache-size</code></a></span></p>
<p>Size of the in-memory store path metadata cache.</p>
<p><strong>Default:</strong> <code>65536</code></p>
</li>
<li>
<p><span id="store-ssh-store-priority"><a href="command-ref/new-cli/nix3-help-stores.html#store-ssh-store-priority"><code>priority</code></a></span></p>
<p>Priority of this store when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.
A lower value means a higher priority.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="store-ssh-store-remote-program"><a href="command-ref/new-cli/nix3-help-stores.html#store-ssh-store-remote-program"><code>remote-program</code></a></span></p>
<p>Path to the <code>nix-store</code> executable on the remote machine.</p>
<p><strong>Default:</strong> <code>nix-store</code></p>
</li>
<li>
<p><span id="store-ssh-store-remote-store"><a href="command-ref/new-cli/nix3-help-stores.html#store-ssh-store-remote-store"><code>remote-store</code></a></span></p>
<p><a href="command-ref/new-cli/../../store/types/index.html#store-url-format">Store URL</a>
to be used on the remote machine. The default is <code>auto</code>
(i.e. use the Nix daemon or <code>/nix/store</code> directly).</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-ssh-store-ssh-key"><a href="command-ref/new-cli/nix3-help-stores.html#store-ssh-store-ssh-key"><code>ssh-key</code></a></span></p>
<p>Path to the SSH private key used to authenticate to the remote machine.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="store-ssh-store-store"><a href="command-ref/new-cli/nix3-help-stores.html#store-ssh-store-store"><code>store</code></a></span></p>
<p>Logical location of the Nix store, usually
<code>/nix/store</code>. Note that you can only copy store paths
between stores if they have the same <code>store</code> setting.</p>
<p><strong>Default:</strong> <code>/nix/store</code></p>
</li>
<li>
<p><span id="store-ssh-store-system-features"><a href="command-ref/new-cli/nix3-help-stores.html#store-ssh-store-system-features"><code>system-features</code></a></span></p>
<p>Optional <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-system-features">system features</a> available on the system this store uses to build derivations.</p>
<p>Example: <code>"kvm"</code></p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="store-ssh-store-trusted"><a href="command-ref/new-cli/nix3-help-stores.html#store-ssh-store-trusted"><code>trusted</code></a></span></p>
<p>Whether paths from this store can be used as substitutes
even if they are not signed by a key listed in the
<a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a>
setting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="store-ssh-store-want-mass-query"><a href="command-ref/new-cli/nix3-help-stores.html#store-ssh-store-want-mass-query"><code>want-mass-query</code></a></span></p>
<p>Whether this store can be queried efficiently for path validity when used as a <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-substituters">substituter</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
</ul>
<h1 id="options-77"><a class="header" href="#options-77">Options</a></h1>
<h2 id="logging-related-options-38"><a class="header" href="#logging-related-options-38">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-help-stores.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-help-stores.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-help-stores.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-help-stores.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-help-stores.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-38"><a class="header" href="#miscellaneous-global-options-38">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-help-stores.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-help-stores.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-help-stores.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-help-stores.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-help-stores.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-81"><a class="header" href="#name-81">Name</a></h1>
<p><code>nix key</code> - generate and convert Nix signing keys</p>
<h1 id="synopsis-81"><a class="header" href="#synopsis-81">Synopsis</a></h1>
<p><code>nix key</code> [<em>option</em>...] <em>subcommand</em></p>
<p>where <em>subcommand</em> is one of the following:</p>
<ul>
<li><a href="command-ref/new-cli/./nix3-key-convert-secret-to-public.html"><code>nix key convert-secret-to-public</code></a> - generate a public key for verifying store paths from a secret key read from standard input</li>
<li><a href="command-ref/new-cli/./nix3-key-generate-secret.html"><code>nix key generate-secret</code></a> - generate a secret key for signing store paths</li>
</ul>
<h1 id="options-78"><a class="header" href="#options-78">Options</a></h1>
<h2 id="logging-related-options-39"><a class="header" href="#logging-related-options-39">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-key.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-key.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-key.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-key.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-key.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-39"><a class="header" href="#miscellaneous-global-options-39">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-key.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-key.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-key.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-key.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-key.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-82"><a class="header" href="#name-82">Name</a></h1>
<p><code>nix key convert-secret-to-public</code> - generate a public key for verifying store paths from a secret key read from standard input</p>
<h1 id="synopsis-82"><a class="header" href="#synopsis-82">Synopsis</a></h1>
<p><code>nix key convert-secret-to-public</code> [<em>option</em>...]</p>
<h1 id="examples-53"><a class="header" href="#examples-53">Examples</a></h1>
<ul>
<li>
<p>Convert a secret key to a public key:</p>
<pre><code class="language-console"># echo cache.example.org-0:E7lAO+MsPwTFfPXsdPtW8GKui/5ho4KQHVcAGnX+Tti1V4dUxoVoqLyWJ4YESuZJwQ67GVIksDt47og+tPVUZw== \
  | nix key convert-secret-to-public
cache.example.org-0:tVeHVMaFaKi8lieGBErmScEOuxlSJLA7eO6IPrT1VGc=
</code></pre>
</li>
</ul>
<h1 id="description-67"><a class="header" href="#description-67">Description</a></h1>
<p>This command reads a Ed25519 secret key from standard input, and
writes the corresponding public key to standard output. For more
details, see <a href="command-ref/new-cli/./nix3-key-generate-secret.html">nix key generate-secret</a>.</p>
<h1 id="options-79"><a class="header" href="#options-79">Options</a></h1>
<h2 id="logging-related-options-40"><a class="header" href="#logging-related-options-40">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-key-convert-secret-to-public.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-key-convert-secret-to-public.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-key-convert-secret-to-public.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-key-convert-secret-to-public.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-key-convert-secret-to-public.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-40"><a class="header" href="#miscellaneous-global-options-40">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-key-convert-secret-to-public.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-key-convert-secret-to-public.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-key-convert-secret-to-public.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-key-convert-secret-to-public.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-key-convert-secret-to-public.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-83"><a class="header" href="#name-83">Name</a></h1>
<p><code>nix key generate-secret</code> - generate a secret key for signing store paths</p>
<h1 id="synopsis-83"><a class="header" href="#synopsis-83">Synopsis</a></h1>
<p><code>nix key generate-secret</code> [<em>option</em>...]</p>
<h1 id="examples-54"><a class="header" href="#examples-54">Examples</a></h1>
<ul>
<li>
<p>Generate a new secret key:</p>
<pre><code class="language-console"># nix key generate-secret --key-name cache.example.org-1 &gt; ./secret-key
</code></pre>
<p>We can then use this key to sign the closure of the Hello package:</p>
<pre><code class="language-console"># nix build nixpkgs#hello
# nix store sign --key-file ./secret-key --recursive ./result
</code></pre>
<p>Finally, we can verify the store paths using the corresponding
public key:</p>
<pre><code># nix store verify --trusted-public-keys $(nix key convert-secret-to-public &lt; ./secret-key) ./result
</code></pre>
</li>
</ul>
<h1 id="description-68"><a class="header" href="#description-68">Description</a></h1>
<p>This command generates a new Ed25519 secret key for signing store
paths and prints it on standard output. Use <code>nix key convert-secret-to-public</code> to get the corresponding public key for
verifying signed store paths.</p>
<p>The mandatory argument <code>--key-name</code> specifies a key name (such as
<code>cache.example.org-1</code>). It is used to look up keys on the client when
it verifies signatures. It can be anything, but it’s suggested to use
the host name of your cache (e.g.  <code>cache.example.org</code>) with a suffix
denoting the number of the key (to be incremented every time you need
to revoke a key).</p>
<h1 id="format"><a class="header" href="#format">Format</a></h1>
<p>Both secret and public keys are represented as the key name followed
by a base-64 encoding of the Ed25519 key data, e.g.</p>
<pre><code>cache.example.org-0:E7lAO+MsPwTFfPXsdPtW8GKui/5ho4KQHVcAGnX+Tti1V4dUxoVoqLyWJ4YESuZJwQ67GVIksDt47og+tPVUZw==
</code></pre>
<h1 id="options-80"><a class="header" href="#options-80">Options</a></h1>
<ul>
<li>
<p><span id="opt-key-name"><a href="command-ref/new-cli/nix3-key-generate-secret.html#opt-key-name"><code>--key-name</code></a></span> <em>name</em></p>
<p>Identifier of the key (e.g. <code>cache.example.org-1</code>).</p>
</li>
</ul>
<h2 id="logging-related-options-41"><a class="header" href="#logging-related-options-41">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-key-generate-secret.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-key-generate-secret.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-key-generate-secret.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-key-generate-secret.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-key-generate-secret.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-41"><a class="header" href="#miscellaneous-global-options-41">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-key-generate-secret.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-key-generate-secret.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-key-generate-secret.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-key-generate-secret.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-key-generate-secret.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-84"><a class="header" href="#name-84">Name</a></h1>
<p><code>nix log</code> - show the build log of the specified packages or paths, if available</p>
<h1 id="synopsis-84"><a class="header" href="#synopsis-84">Synopsis</a></h1>
<p><code>nix log</code> [<em>option</em>...] <em>installable</em></p>
<h1 id="examples-55"><a class="header" href="#examples-55">Examples</a></h1>
<ul>
<li>
<p>Get the build log of GNU Hello:</p>
<pre><code class="language-console"># nix log nixpkgs#hello
</code></pre>
</li>
<li>
<p>Get the build log of a specific store path:</p>
<pre><code class="language-console"># nix log /nix/store/lmngj4wcm9rkv3w4dfhzhcyij3195hiq-thunderbird-52.2.1
</code></pre>
</li>
<li>
<p>Get a build log from a specific binary cache:</p>
<pre><code class="language-console"># nix log --store https://cache.nixos.org nixpkgs#hello
</code></pre>
</li>
</ul>
<h1 id="description-69"><a class="header" href="#description-69">Description</a></h1>
<p>This command prints the log of a previous build of the <a href="command-ref/new-cli/./nix.html#installables"><em>installable</em></a> on standard output.</p>
<p>Nix looks for build logs in two places:</p>
<ul>
<li>
<p>In the directory <code>/nix/var/log/nix/drvs</code>, which contains logs for
locally built derivations.</p>
</li>
<li>
<p>In the binary caches listed in the <code>substituters</code> setting. Logs
should be named <code>&lt;cache&gt;/log/&lt;base-name-of-store-path&gt;</code>, where
<code>store-path</code> is a derivation,
e.g. <code>https://cache.nixos.org/log/dvmig8jgrdapvbyxb1rprckdmdqx08kv-hello-2.10.drv</code>.
For non-derivation store paths, Nix will first try to determine the
deriver by fetching the <code>.narinfo</code> file for this store path.</p>
</li>
</ul>
<h1 id="options-81"><a class="header" href="#options-81">Options</a></h1>
<h2 id="common-evaluation-options-20"><a class="header" href="#common-evaluation-options-20">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-log.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-log.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-log.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-log.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-log.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-log.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-log.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-log.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-log.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-18"><a class="header" href="#common-flake-related-options-18">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-log.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-log.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-log.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-log.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-log.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-log.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-log.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-log.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-log.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-log.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-42"><a class="header" href="#logging-related-options-42">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-log.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-log.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-log.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-log.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-log.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-42"><a class="header" href="#miscellaneous-global-options-42">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-log.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-log.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-log.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-log.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-log.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-log.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-9"><a class="header" href="#options-that-change-the-interpretation-of-installables-9">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-log.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-log.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-85"><a class="header" href="#name-85">Name</a></h1>
<p><code>nix nar</code> - create or inspect NAR files</p>
<h1 id="synopsis-85"><a class="header" href="#synopsis-85">Synopsis</a></h1>
<p><code>nix nar</code> [<em>option</em>...] <em>subcommand</em></p>
<p>where <em>subcommand</em> is one of the following:</p>
<ul>
<li><a href="command-ref/new-cli/./nix3-nar-cat.html"><code>nix nar cat</code></a> - print the contents of a file inside a NAR file on stdout</li>
<li><a href="command-ref/new-cli/./nix3-nar-dump-path.html"><code>nix nar dump-path</code></a> - serialise a path to stdout in NAR format</li>
<li><a href="command-ref/new-cli/./nix3-nar-ls.html"><code>nix nar ls</code></a> - show information about a path inside a NAR file</li>
<li><a href="command-ref/new-cli/./nix3-nar-pack.html"><code>nix nar pack</code></a> - serialise a path to stdout in NAR format</li>
</ul>
<h1 id="description-70"><a class="header" href="#description-70">Description</a></h1>
<p><code>nix nar</code> provides several subcommands for creating and inspecting
<a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-nix-archive"><em>Nix Archives</em> (NARs)</a>.</p>
<h1 id="file-format"><a class="header" href="#file-format">File format</a></h1>
<p>For the definition of the Nix Archive file format, see
<a href="command-ref/new-cli/../../protocols/nix-archive.html">within the protocols chapter</a>
of the manual.</p>
<h1 id="options-82"><a class="header" href="#options-82">Options</a></h1>
<h2 id="logging-related-options-43"><a class="header" href="#logging-related-options-43">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-nar.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-nar.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-nar.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-nar.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-nar.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-43"><a class="header" href="#miscellaneous-global-options-43">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-nar.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-nar.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-nar.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-nar.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-nar.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-86"><a class="header" href="#name-86">Name</a></h1>
<p><code>nix nar cat</code> - print the contents of a file inside a NAR file on stdout</p>
<h1 id="synopsis-86"><a class="header" href="#synopsis-86">Synopsis</a></h1>
<p><code>nix nar cat</code> [<em>option</em>...] <em>nar</em> <em>path</em></p>
<h1 id="examples-56"><a class="header" href="#examples-56">Examples</a></h1>
<ul>
<li>
<p>List a file in a <a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive (NAR)</a> and pipe it through <code>gunzip</code>:</p>
<pre><code class="language-console"># nix nar cat ./hello.nar /share/man/man1/hello.1.gz | gunzip
.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.46.4.
.TH HELLO "1" "November 2014" "hello 2.10" "User Commands"
…
</code></pre>
</li>
</ul>
<h1 id="description-71"><a class="header" href="#description-71">Description</a></h1>
<p>This command prints on standard output the contents of the regular
file <em>path</em> inside the NAR file <em>nar</em>.</p>
<h1 id="options-83"><a class="header" href="#options-83">Options</a></h1>
<h2 id="logging-related-options-44"><a class="header" href="#logging-related-options-44">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-nar-cat.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-nar-cat.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-nar-cat.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-nar-cat.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-nar-cat.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-44"><a class="header" href="#miscellaneous-global-options-44">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-nar-cat.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-nar-cat.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-nar-cat.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-nar-cat.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-nar-cat.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-87"><a class="header" href="#name-87">Name</a></h1>
<p><code>nix nar dump-path</code> - serialise a path to stdout in NAR format</p>
<h1 id="synopsis-87"><a class="header" href="#synopsis-87">Synopsis</a></h1>
<p><code>nix nar dump-path</code> [<em>option</em>...] <em>path</em></p>
<h1 id="examples-57"><a class="header" href="#examples-57">Examples</a></h1>
<ul>
<li>
<p>To serialise directory <code>foo</code> as a <a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive (NAR)</a>:</p>
<pre><code class="language-console"># nix nar pack ./foo &gt; foo.nar
</code></pre>
</li>
</ul>
<h1 id="description-72"><a class="header" href="#description-72">Description</a></h1>
<p>This command generates a <a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive (NAR)</a> file containing the serialisation of
<em>path</em>, which must contain only regular files, directories and
symbolic links. The NAR is written to standard output.</p>
<h1 id="options-84"><a class="header" href="#options-84">Options</a></h1>
<h2 id="logging-related-options-45"><a class="header" href="#logging-related-options-45">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-nar-dump-path.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-nar-dump-path.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-nar-dump-path.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-nar-dump-path.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-nar-dump-path.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-45"><a class="header" href="#miscellaneous-global-options-45">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-nar-dump-path.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-nar-dump-path.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-nar-dump-path.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-nar-dump-path.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-nar-dump-path.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-88"><a class="header" href="#name-88">Name</a></h1>
<p><code>nix nar ls</code> - show information about a path inside a NAR file</p>
<h1 id="synopsis-88"><a class="header" href="#synopsis-88">Synopsis</a></h1>
<p><code>nix nar ls</code> [<em>option</em>...] <em>nar</em> <em>path</em></p>
<h1 id="examples-58"><a class="header" href="#examples-58">Examples</a></h1>
<ul>
<li>
<p>To list a specific file in a <a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-nix-archive">NAR</a>:</p>
<pre><code class="language-console"># nix nar ls --long ./hello.nar /bin/hello
-r-xr-xr-x                38184 hello
</code></pre>
</li>
<li>
<p>To recursively list the contents of a directory inside a NAR, in JSON
format:</p>
<pre><code class="language-console"># nix nar ls --json --recursive ./hello.nar /bin
{"type":"directory","entries":{"hello":{"type":"regular","size":38184,"executable":true,"narOffset":400}}}
</code></pre>
</li>
</ul>
<h1 id="description-73"><a class="header" href="#description-73">Description</a></h1>
<p>This command shows information about a <em>path</em> inside <a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive (NAR)</a> file <em>nar</em>.</p>
<h1 id="options-85"><a class="header" href="#options-85">Options</a></h1>
<ul>
<li>
<p><span id="opt-directory"><a href="command-ref/new-cli/nix3-nar-ls.html#opt-directory"><code>--directory</code></a></span> / <code>-d</code></p>
<p>Show directories rather than their contents.</p>
</li>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-nar-ls.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
<li>
<p><span id="opt-long"><a href="command-ref/new-cli/nix3-nar-ls.html#opt-long"><code>--long</code></a></span> / <code>-l</code></p>
<p>Show detailed file information.</p>
</li>
<li>
<p><span id="opt-recursive"><a href="command-ref/new-cli/nix3-nar-ls.html#opt-recursive"><code>--recursive</code></a></span> / <code>-R</code></p>
<p>List subdirectories recursively.</p>
</li>
</ul>
<h2 id="logging-related-options-46"><a class="header" href="#logging-related-options-46">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-nar-ls.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-nar-ls.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-nar-ls.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-nar-ls.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-nar-ls.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-46"><a class="header" href="#miscellaneous-global-options-46">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-nar-ls.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-nar-ls.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-nar-ls.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-nar-ls.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-nar-ls.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-89"><a class="header" href="#name-89">Name</a></h1>
<p><code>nix nar pack</code> - serialise a path to stdout in NAR format</p>
<h1 id="synopsis-89"><a class="header" href="#synopsis-89">Synopsis</a></h1>
<p><code>nix nar pack</code> [<em>option</em>...] <em>path</em></p>
<h1 id="examples-59"><a class="header" href="#examples-59">Examples</a></h1>
<ul>
<li>
<p>To serialise directory <code>foo</code> as a <a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive (NAR)</a>:</p>
<pre><code class="language-console"># nix nar pack ./foo &gt; foo.nar
</code></pre>
</li>
</ul>
<h1 id="description-74"><a class="header" href="#description-74">Description</a></h1>
<p>This command generates a <a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive (NAR)</a> file containing the serialisation of
<em>path</em>, which must contain only regular files, directories and
symbolic links. The NAR is written to standard output.</p>
<h1 id="options-86"><a class="header" href="#options-86">Options</a></h1>
<h2 id="logging-related-options-47"><a class="header" href="#logging-related-options-47">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-nar-pack.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-nar-pack.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-nar-pack.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-nar-pack.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-nar-pack.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-47"><a class="header" href="#miscellaneous-global-options-47">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-nar-pack.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-nar-pack.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-nar-pack.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-nar-pack.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-nar-pack.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-90"><a class="header" href="#name-90">Name</a></h1>
<p><code>nix path-info</code> - query information about store paths</p>
<h1 id="synopsis-90"><a class="header" href="#synopsis-90">Synopsis</a></h1>
<p><code>nix path-info</code> [<em>option</em>...] <em>installables</em>...</p>
<h1 id="examples-60"><a class="header" href="#examples-60">Examples</a></h1>
<ul>
<li>
<p>Print the store path produced by <code>nixpkgs#hello</code>:</p>
<pre><code class="language-console"># nix path-info nixpkgs#hello
/nix/store/v5sv61sszx301i0x6xysaqzla09nksnd-hello-2.10
</code></pre>
</li>
<li>
<p>Show the closure sizes of every path in the current NixOS system
closure, sorted by size:</p>
<pre><code class="language-console"># nix path-info --recursive --closure-size /run/current-system | sort -nk2
/nix/store/hl5xwp9kdrd1zkm0idm3kkby9q66z404-empty                                                96
/nix/store/27324qvqhnxj3rncazmxc4mwy79kz8ha-nameservers                                         112
…
/nix/store/539jkw9a8dyry7clcv60gk6na816j7y8-etc                                          5783255504
/nix/store/zqamz3cz4dbzfihki2mk7a63mbkxz9xq-nixos-system-machine-20.09.20201112.3090c65  5887562256
</code></pre>
</li>
<li>
<p>Show a package's closure size and all its dependencies with human
readable sizes:</p>
<pre><code class="language-console"># nix path-info --recursive --size --closure-size --human-readable nixpkgs#rustc
/nix/store/01rrgsg5zk3cds0xgdsq40zpk6g51dz9-ncurses-6.2-dev      386.7 KiB   69.1 MiB
/nix/store/0q783wnvixpqz6dxjp16nw296avgczam-libpfm-4.11.0          5.9 MiB   37.4 MiB
…
</code></pre>
</li>
<li>
<p>Check the existence of a path in a binary cache:</p>
<pre><code class="language-console"># nix path-info --recursive /nix/store/blzxgyvrk32ki6xga10phr4sby2xf25q-geeqie-1.5.1 --store https://cache.nixos.org/
path '/nix/store/blzxgyvrk32ki6xga10phr4sby2xf25q-geeqie-1.5.1' is not valid

</code></pre>
</li>
<li>
<p>Print the 10 most recently added paths (using --json and the jq(1)
command):</p>
<pre><code class="language-console"># nix path-info --json --all | jq -r 'to_entries | sort_by(.value.registrationTime) | .[-11:-1][] | .key'
</code></pre>
</li>
<li>
<p>Show the size of the entire Nix store:</p>
<pre><code class="language-console"># nix path-info --json --all | jq 'map(.narSize) | add'
49812020936
</code></pre>
</li>
<li>
<p>Show every path whose closure is bigger than 1 GB, sorted by closure
size:</p>
<pre><code class="language-console"># nix path-info --json --all --closure-size \
  | jq 'map_values(.closureSize | select(. &lt; 1e9)) | to_entries | sort_by(.value)'
[
  …,
  {
    .key = "/nix/store/zqamz3cz4dbzfihki2mk7a63mbkxz9xq-nixos-system-machine-20.09.20201112.3090c65",
    .value = 5887562256,
  }
]
</code></pre>
</li>
<li>
<p>Print the path of the <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> produced by <code>nixpkgs#hello</code>:</p>
<pre><code class="language-console"># nix path-info --derivation nixpkgs#hello
/nix/store/s6rn4jz1sin56rf4qj5b5v8jxjm32hlk-hello-2.10.drv
</code></pre>
</li>
</ul>
<h1 id="description-75"><a class="header" href="#description-75">Description</a></h1>
<p>This command shows information about the store paths produced by
<a href="command-ref/new-cli/./nix.html#installables"><em>installables</em></a>, or about all paths in the store if you pass <code>--all</code>.</p>
<p>By default, this command only prints the store paths. You can get
additional information by passing flags such as <code>--closure-size</code>,
<code>--size</code>, <code>--sigs</code> or <code>--json</code>.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Note that <code>nix path-info</code> does not build or substitute the
<em>installables</em> you specify. Thus, if the corresponding store paths
don't already exist, this command will fail. You can use <code>nix build</code>
to ensure that they exist.</p>
</blockquote>
<h1 id="options-87"><a class="header" href="#options-87">Options</a></h1>
<ul>
<li>
<p><span id="opt-closure-size"><a href="command-ref/new-cli/nix3-path-info.html#opt-closure-size"><code>--closure-size</code></a></span> / <code>-S</code></p>
<p>Print the sum of the sizes of the NAR serialisations of the closure of each path.</p>
</li>
<li>
<p><span id="opt-human-readable"><a href="command-ref/new-cli/nix3-path-info.html#opt-human-readable"><code>--human-readable</code></a></span> / <code>-h</code></p>
<p>With <code>-s</code> and <code>-S</code>, print sizes in a human-friendly format such as <code>5.67G</code>.</p>
</li>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-path-info.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
<li>
<p><span id="opt-sigs"><a href="command-ref/new-cli/nix3-path-info.html#opt-sigs"><code>--sigs</code></a></span></p>
<p>Show signatures.</p>
</li>
<li>
<p><span id="opt-size"><a href="command-ref/new-cli/nix3-path-info.html#opt-size"><code>--size</code></a></span> / <code>-s</code></p>
<p>Print the size of the NAR serialisation of each path.</p>
</li>
<li>
<p><span id="opt-stdin"><a href="command-ref/new-cli/nix3-path-info.html#opt-stdin"><code>--stdin</code></a></span></p>
<p>Read installables from the standard input. No default installable applied.</p>
</li>
</ul>
<h2 id="common-evaluation-options-21"><a class="header" href="#common-evaluation-options-21">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-path-info.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-path-info.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-path-info.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-path-info.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-path-info.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-path-info.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-path-info.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-path-info.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-path-info.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-19"><a class="header" href="#common-flake-related-options-19">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-path-info.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-path-info.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-path-info.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-path-info.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-path-info.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-path-info.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-path-info.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-path-info.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-path-info.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-path-info.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-48"><a class="header" href="#logging-related-options-48">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-path-info.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-path-info.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-path-info.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-path-info.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-path-info.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-48"><a class="header" href="#miscellaneous-global-options-48">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-path-info.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-path-info.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-path-info.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-path-info.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-path-info.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-path-info.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-10"><a class="header" href="#options-that-change-the-interpretation-of-installables-10">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-all"><a href="command-ref/new-cli/nix3-path-info.html#opt-all"><code>--all</code></a></span></p>
<p>Apply the operation to every store path.</p>
</li>
<li>
<p><span id="opt-derivation"><a href="command-ref/new-cli/nix3-path-info.html#opt-derivation"><code>--derivation</code></a></span></p>
<p>Operate on the <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> rather than its outputs.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-path-info.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-path-info.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
<li>
<p><span id="opt-recursive"><a href="command-ref/new-cli/nix3-path-info.html#opt-recursive"><code>--recursive</code></a></span> / <code>-r</code></p>
<p>Apply operation to closure of the specified paths.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-91"><a class="header" href="#name-91">Name</a></h1>
<p><code>nix print-dev-env</code> - print shell code that can be sourced by bash to reproduce the build environment of a derivation</p>
<h1 id="synopsis-91"><a class="header" href="#synopsis-91">Synopsis</a></h1>
<p><code>nix print-dev-env</code> [<em>option</em>...] <em>installable</em></p>
<h1 id="examples-61"><a class="header" href="#examples-61">Examples</a></h1>
<ul>
<li>
<p>Apply the build environment of GNU hello to the current shell:</p>
<pre><code class="language-console"># . &lt;(nix print-dev-env nixpkgs#hello)
</code></pre>
</li>
<li>
<p>Get the build environment in JSON format:</p>
<pre><code class="language-console"># nix print-dev-env nixpkgs#hello --json
</code></pre>
<p>The output will look like this:</p>
<pre><code class="language-json">{
  "bashFunctions": {
    "buildPhase": " \n    runHook preBuild;\n...",
    ...
  },
  "variables": {
    "src": {
      "type": "exported",
      "value": "/nix/store/3x7dwzq014bblazs7kq20p9hyzz0qh8g-hello-2.10.tar.gz"
    },
    "postUnpackHooks": {
      "type": "array",
      "value": ["_updateSourceDateEpochFromSourceRoot"]
    },
    ...
  }
}
</code></pre>
</li>
</ul>
<h1 id="description-76"><a class="header" href="#description-76">Description</a></h1>
<p>This command prints a shell script that can be sourced by <code>bash</code> and
that sets the variables and shell functions defined by the build
process of <a href="command-ref/new-cli/./nix.html#installables"><em>installable</em></a>. This allows you to get a similar build
environment in your current shell rather than in a subshell (as with
<code>nix develop</code>).</p>
<p>With <code>--json</code>, the output is a JSON serialisation of the variables and
functions defined by the build process.</p>
<h1 id="options-88"><a class="header" href="#options-88">Options</a></h1>
<ul>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
<li>
<p><span id="opt-profile"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-profile"><code>--profile</code></a></span> <em>path</em></p>
<p>The profile to operate on.</p>
</li>
<li>
<p><span id="opt-redirect"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-redirect"><code>--redirect</code></a></span> <em>installable</em> <em>outputs-dir</em></p>
<p>Redirect a store path to a mutable location.</p>
</li>
</ul>
<h2 id="common-evaluation-options-22"><a class="header" href="#common-evaluation-options-22">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-20"><a class="header" href="#common-flake-related-options-20">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-49"><a class="header" href="#logging-related-options-49">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-49"><a class="header" href="#miscellaneous-global-options-49">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-11"><a class="header" href="#options-that-change-the-interpretation-of-installables-11">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-print-dev-env.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-92"><a class="header" href="#name-92">Name</a></h1>
<p><code>nix profile</code> - manage Nix profiles</p>
<h1 id="synopsis-92"><a class="header" href="#synopsis-92">Synopsis</a></h1>
<p><code>nix profile</code> [<em>option</em>...] <em>subcommand</em></p>
<p>where <em>subcommand</em> is one of the following:</p>
<ul>
<li><a href="command-ref/new-cli/./nix3-profile-diff-closures.html"><code>nix profile diff-closures</code></a> - show the closure difference between each version of a profile</li>
<li><a href="command-ref/new-cli/./nix3-profile-history.html"><code>nix profile history</code></a> - show all versions of a profile</li>
<li><a href="command-ref/new-cli/./nix3-profile-install.html"><code>nix profile install</code></a> - install a package into a profile</li>
<li><a href="command-ref/new-cli/./nix3-profile-list.html"><code>nix profile list</code></a> - list installed packages</li>
<li><a href="command-ref/new-cli/./nix3-profile-remove.html"><code>nix profile remove</code></a> - remove packages from a profile</li>
<li><a href="command-ref/new-cli/./nix3-profile-rollback.html"><code>nix profile rollback</code></a> - roll back to the previous version or a specified version of a profile</li>
<li><a href="command-ref/new-cli/./nix3-profile-upgrade.html"><code>nix profile upgrade</code></a> - upgrade packages using their most recent flake</li>
<li><a href="command-ref/new-cli/./nix3-profile-wipe-history.html"><code>nix profile wipe-history</code></a> - delete non-current versions of a profile</li>
</ul>
<h1 id="description-77"><a class="header" href="#description-77">Description</a></h1>
<p><code>nix profile</code> allows you to create and manage <em>Nix profiles</em>. A Nix
profile is a set of packages that can be installed and upgraded
independently from each other. Nix profiles are versioned, allowing
them to be rolled back easily.</p>
<h1 id="files-2"><a class="header" href="#files-2">Files</a></h1>
<h2 id="profiles-2"><a class="header" href="#profiles-2">Profiles</a></h2>
<p>A directory that contains links to profiles managed by <a href="command-ref/new-cli/../../command-ref/nix-env.html"><code>nix-env</code></a> and <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-profile.html"><code>nix profile</code></a>:</p>
<ul>
<li><code>$XDG_STATE_HOME/nix/profiles</code> for regular users</li>
<li><code>$NIX_STATE_DIR/profiles/per-user/root</code> if the user is <code>root</code></li>
</ul>
<p>A profile is a directory of symlinks to files in the Nix store.</p>
<h3 id="filesystem-layout-1"><a class="header" href="#filesystem-layout-1">Filesystem layout</a></h3>
<p>Profiles are versioned as follows. When using a profile named <em>path</em>, <em>path</em> is a symlink to <em>path</em><code>-</code><em>N</em><code>-link</code>, where <em>N</em> is the version of the profile.
In turn, <em>path</em><code>-</code><em>N</em><code>-link</code> is a symlink to a path in the Nix store.
For example:</p>
<pre><code class="language-console">$ ls -l ~alice/.local/state/nix/profiles/profile*
lrwxrwxrwx 1 alice users 14 Nov 25 14:35 /home/alice/.local/state/nix/profiles/profile -&gt; profile-7-link
lrwxrwxrwx 1 alice users 51 Oct 28 16:18 /home/alice/.local/state/nix/profiles/profile-5-link -&gt; /nix/store/q69xad13ghpf7ir87h0b2gd28lafjj1j-profile
lrwxrwxrwx 1 alice users 51 Oct 29 13:20 /home/alice/.local/state/nix/profiles/profile-6-link -&gt; /nix/store/6bvhpysd7vwz7k3b0pndn7ifi5xr32dg-profile
lrwxrwxrwx 1 alice users 51 Nov 25 14:35 /home/alice/.local/state/nix/profiles/profile-7-link -&gt; /nix/store/mp0x6xnsg0b8qhswy6riqvimai4gm677-profile
</code></pre>
<p>Each of these symlinks is a root for the Nix garbage collector.</p>
<p>The contents of the store path corresponding to each version of the
profile is a tree of symlinks to the files of the installed packages,
e.g.</p>
<pre><code class="language-console">$ ll -R ~eelco/.local/state/nix/profiles/profile-7-link/
/home/eelco/.local/state/nix/profiles/profile-7-link/:
total 20
dr-xr-xr-x 2 root root 4096 Jan  1  1970 bin
-r--r--r-- 2 root root 1402 Jan  1  1970 manifest.nix
dr-xr-xr-x 4 root root 4096 Jan  1  1970 share

/home/eelco/.local/state/nix/profiles/profile-7-link/bin:
total 20
lrwxrwxrwx 5 root root 79 Jan  1  1970 chromium -&gt; /nix/store/ijm5k0zqisvkdwjkc77mb9qzb35xfi4m-chromium-86.0.4240.111/bin/chromium
lrwxrwxrwx 7 root root 87 Jan  1  1970 spotify -&gt; /nix/store/w9182874m1bl56smps3m5zjj36jhp3rn-spotify-1.1.26.501.gbe11e53b-15/bin/spotify
lrwxrwxrwx 3 root root 79 Jan  1  1970 zoom-us -&gt; /nix/store/wbhg2ga8f3h87s9h5k0slxk0m81m4cxl-zoom-us-5.3.469451.0927/bin/zoom-us

/home/eelco/.local/state/nix/profiles/profile-7-link/share/applications:
total 12
lrwxrwxrwx 4 root root 120 Jan  1  1970 chromium-browser.desktop -&gt; /nix/store/4cf803y4vzfm3gyk3vzhzb2327v0kl8a-chromium-unwrapped-86.0.4240.111/share/applications/chromium-browser.desktop
lrwxrwxrwx 7 root root 110 Jan  1  1970 spotify.desktop -&gt; /nix/store/w9182874m1bl56smps3m5zjj36jhp3rn-spotify-1.1.26.501.gbe11e53b-15/share/applications/spotify.desktop
lrwxrwxrwx 3 root root 107 Jan  1  1970 us.zoom.Zoom.desktop -&gt; /nix/store/wbhg2ga8f3h87s9h5k0slxk0m81m4cxl-zoom-us-5.3.469451.0927/share/applications/us.zoom.Zoom.desktop

…
</code></pre>
<p>Each profile version contains a manifest file:</p>
<ul>
<li><a href="command-ref/new-cli/../../command-ref/files/manifest.nix.html"><code>manifest.nix</code></a> used by <a href="command-ref/new-cli/../../command-ref/nix-env.html"><code>nix-env</code></a>.</li>
<li><a href="command-ref/new-cli/../../command-ref/files/manifest.json.html"><code>manifest.json</code></a> used by <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-profile.html"><code>nix profile</code></a> (experimental).</li>
</ul>
<h2 id="user-profile-link-1"><a class="header" href="#user-profile-link-1">User profile link</a></h2>
<p>A symbolic link to the user's current profile:</p>
<ul>
<li><code>~/.nix-profile</code></li>
<li><code>$XDG_STATE_HOME/nix/profile</code> if <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is set to <code>true</code>.</li>
</ul>
<p>By default, this symlink points to:</p>
<ul>
<li><code>$XDG_STATE_HOME/nix/profiles/profile</code> for regular users</li>
<li><code>$NIX_STATE_DIR/profiles/per-user/root/profile</code> for <code>root</code></li>
</ul>
<p>The <code>PATH</code> environment variable should include <code>/bin</code> subdirectory of the profile link (e.g. <code>~/.nix-profile/bin</code>) for the user environment to be visible to the user.
The <a href="command-ref/new-cli/../../installation/installing-binary.html">installer</a> sets this up by default, unless you enable <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a>.</p>
<h3 id="profile-compatibility"><a class="header" href="#profile-compatibility">Profile compatibility</a></h3>
<blockquote>
<p><strong>Warning</strong></p>
<p>Once you have used <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-profile.html"><code>nix profile</code></a> you can no longer use <a href="command-ref/new-cli/../../command-ref/nix-env.html"><code>nix-env</code></a> without first deleting <code>$XDG_STATE_HOME/nix/profiles/profile</code></p>
</blockquote>
<p>Once you installed a package with <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-profile.html"><code>nix profile</code></a>, you get the following error message when using <a href="command-ref/new-cli/../../command-ref/nix-env.html"><code>nix-env</code></a>:</p>
<pre><code class="language-console">$ nix-env -f '&lt;nixpkgs&gt;' -iA 'hello'
error: nix-env
profile '/home/alice/.local/state/nix/profiles/profile' is incompatible with 'nix-env'; please use 'nix profile' instead
</code></pre>
<p>To migrate back to <code>nix-env</code> you can delete your current profile:</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This will delete packages that have been installed before, so you may want to back up this information before running the command.</p>
</blockquote>
<pre><code class="language-console"> $ rm -rf "${XDG_STATE_HOME-$HOME/.local/state}/nix/profiles/profile"
</code></pre>
<h1 id="options-89"><a class="header" href="#options-89">Options</a></h1>
<h2 id="logging-related-options-50"><a class="header" href="#logging-related-options-50">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-profile.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-profile.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-profile.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-profile.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-profile.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-50"><a class="header" href="#miscellaneous-global-options-50">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-profile.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-profile.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-profile.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-profile.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-profile.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-93"><a class="header" href="#name-93">Name</a></h1>
<p><code>nix profile diff-closures</code> - show the closure difference between each version of a profile</p>
<h1 id="synopsis-93"><a class="header" href="#synopsis-93">Synopsis</a></h1>
<p><code>nix profile diff-closures</code> [<em>option</em>...]</p>
<h1 id="examples-62"><a class="header" href="#examples-62">Examples</a></h1>
<ul>
<li>
<p>Show what changed between each version of the NixOS system
profile:</p>
<pre><code class="language-console"># nix profile diff-closures --profile /nix/var/nix/profiles/system
Version 13 -&gt; 14:
  acpi-call: 2020-04-07-5.8.13 → 2020-04-07-5.8.14
  aws-sdk-cpp: -6723.1 KiB
  …

Version 14 -&gt; 15:
  acpi-call: 2020-04-07-5.8.14 → 2020-04-07-5.8.16
  attica: -996.2 KiB
  breeze-icons: -78713.5 KiB
  brotli: 1.0.7 → 1.0.9, +44.2 KiB
</code></pre>
</li>
</ul>
<h1 id="description-78"><a class="header" href="#description-78">Description</a></h1>
<p>This command shows the difference between the closures of subsequent
versions of a profile. See <a href="command-ref/new-cli/nix3-store-diff-closures.html"><code>nix store diff-closures</code></a> for details.</p>
<h1 id="options-90"><a class="header" href="#options-90">Options</a></h1>
<ul>
<li>
<p><span id="opt-profile"><a href="command-ref/new-cli/nix3-profile-diff-closures.html#opt-profile"><code>--profile</code></a></span> <em>path</em></p>
<p>The profile to operate on.</p>
</li>
</ul>
<h2 id="logging-related-options-51"><a class="header" href="#logging-related-options-51">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-profile-diff-closures.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-profile-diff-closures.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-profile-diff-closures.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-profile-diff-closures.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-profile-diff-closures.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-51"><a class="header" href="#miscellaneous-global-options-51">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-profile-diff-closures.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-profile-diff-closures.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-profile-diff-closures.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-profile-diff-closures.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-profile-diff-closures.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-94"><a class="header" href="#name-94">Name</a></h1>
<p><code>nix profile history</code> - show all versions of a profile</p>
<h1 id="synopsis-94"><a class="header" href="#synopsis-94">Synopsis</a></h1>
<p><code>nix profile history</code> [<em>option</em>...]</p>
<h1 id="examples-63"><a class="header" href="#examples-63">Examples</a></h1>
<ul>
<li>
<p>Show the changes between each version of your default profile:</p>
<pre><code class="language-console"># nix profile history
Version 508 (2020-04-10):
  flake:nixpkgs#legacyPackages.x86_64-linux.awscli: ∅ -&gt; 1.17.13

Version 509 (2020-05-16) &lt;- 508:
  flake:nixpkgs#legacyPackages.x86_64-linux.awscli: 1.17.13 -&gt; 1.18.211
</code></pre>
</li>
</ul>
<h1 id="description-79"><a class="header" href="#description-79">Description</a></h1>
<p>This command shows what packages were added, removed or upgraded
between subsequent versions of a profile. It only shows top-level
packages, not dependencies; for that, use <a href="command-ref/new-cli/./nix3-profile-diff-closures.html"><code>nix profile diff-closures</code></a>.</p>
<p>The addition of a package to a profile is denoted by the string <code>∅ -&gt;</code>
<em>version</em>, whereas the removal is denoted by <em>version</em> <code>-&gt; ∅</code>.</p>
<h1 id="options-91"><a class="header" href="#options-91">Options</a></h1>
<ul>
<li>
<p><span id="opt-profile"><a href="command-ref/new-cli/nix3-profile-history.html#opt-profile"><code>--profile</code></a></span> <em>path</em></p>
<p>The profile to operate on.</p>
</li>
</ul>
<h2 id="common-evaluation-options-23"><a class="header" href="#common-evaluation-options-23">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-profile-history.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-profile-history.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-profile-history.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-profile-history.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-profile-history.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-profile-history.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-profile-history.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-profile-history.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-profile-history.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="logging-related-options-52"><a class="header" href="#logging-related-options-52">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-profile-history.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-profile-history.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-profile-history.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-profile-history.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-profile-history.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-52"><a class="header" href="#miscellaneous-global-options-52">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-profile-history.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-profile-history.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-profile-history.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-profile-history.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-profile-history.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-profile-history.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-95"><a class="header" href="#name-95">Name</a></h1>
<p><code>nix profile install</code> - install a package into a profile</p>
<h1 id="synopsis-95"><a class="header" href="#synopsis-95">Synopsis</a></h1>
<p><code>nix profile install</code> [<em>option</em>...] <em>installables</em>...</p>
<h1 id="examples-64"><a class="header" href="#examples-64">Examples</a></h1>
<ul>
<li>
<p>Install a package from Nixpkgs:</p>
<pre><code class="language-console"># nix profile install nixpkgs#hello
</code></pre>
</li>
<li>
<p>Install a package from a specific branch of Nixpkgs:</p>
<pre><code class="language-console"># nix profile install nixpkgs/release-20.09#hello
</code></pre>
</li>
<li>
<p>Install a package from a specific revision of Nixpkgs:</p>
<pre><code class="language-console"># nix profile install nixpkgs/d73407e8e6002646acfdef0e39ace088bacc83da#hello
</code></pre>
</li>
<li>
<p>Install a specific output of a package:</p>
<pre><code class="language-console"># nix profile install nixpkgs#bash^man
</code></pre>
</li>
</ul>
<h1 id="description-80"><a class="header" href="#description-80">Description</a></h1>
<p>This command adds <a href="command-ref/new-cli/./nix.html#installables"><em>installables</em></a> to a Nix profile.</p>
<h1 id="options-92"><a class="header" href="#options-92">Options</a></h1>
<ul>
<li>
<p><span id="opt-priority"><a href="command-ref/new-cli/nix3-profile-install.html#opt-priority"><code>--priority</code></a></span> <em>priority</em></p>
<p>The priority of the package to install.</p>
</li>
<li>
<p><span id="opt-profile"><a href="command-ref/new-cli/nix3-profile-install.html#opt-profile"><code>--profile</code></a></span> <em>path</em></p>
<p>The profile to operate on.</p>
</li>
<li>
<p><span id="opt-stdin"><a href="command-ref/new-cli/nix3-profile-install.html#opt-stdin"><code>--stdin</code></a></span></p>
<p>Read installables from the standard input. No default installable applied.</p>
</li>
</ul>
<h2 id="common-evaluation-options-24"><a class="header" href="#common-evaluation-options-24">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-profile-install.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-profile-install.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-profile-install.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-profile-install.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-profile-install.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-profile-install.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-profile-install.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-profile-install.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-profile-install.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-21"><a class="header" href="#common-flake-related-options-21">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-profile-install.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-profile-install.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-profile-install.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-profile-install.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-profile-install.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-profile-install.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-profile-install.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-profile-install.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-profile-install.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-profile-install.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-53"><a class="header" href="#logging-related-options-53">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-profile-install.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-profile-install.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-profile-install.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-profile-install.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-profile-install.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-53"><a class="header" href="#miscellaneous-global-options-53">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-profile-install.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-profile-install.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-profile-install.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-profile-install.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-profile-install.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-profile-install.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-12"><a class="header" href="#options-that-change-the-interpretation-of-installables-12">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-profile-install.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-profile-install.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-96"><a class="header" href="#name-96">Name</a></h1>
<p><code>nix profile list</code> - list installed packages</p>
<h1 id="synopsis-96"><a class="header" href="#synopsis-96">Synopsis</a></h1>
<p><code>nix profile list</code> [<em>option</em>...]</p>
<h1 id="examples-65"><a class="header" href="#examples-65">Examples</a></h1>
<ul>
<li>
<p>Show what packages are installed in the default profile:</p>
<pre><code class="language-console"># nix profile list
Name:               gdb
Flake attribute:    legacyPackages.x86_64-linux.gdb
Original flake URL: flake:nixpkgs
Locked flake URL:   github:NixOS/nixpkgs/7b38b03d76ab71bdc8dc325e3f6338d984cc35ca
Store paths:        /nix/store/indzcw5wvlhx6vwk7k4iq29q15chvr3d-gdb-11.1

Name:               blender-bin
Flake attribute:    packages.x86_64-linux.default
Original flake URL: flake:blender-bin
Locked flake URL:   github:edolstra/nix-warez/91f2ffee657bf834e4475865ae336e2379282d34?dir=blender
Store paths:        /nix/store/i798sxl3j40wpdi1rgf391id1b5klw7g-blender-bin-3.1.2
</code></pre>
<p>Note that you can unambiguously rebuild a package from a profile
through its locked flake URL and flake attribute, e.g.</p>
<pre><code class="language-console"># nix build github:edolstra/nix-warez/91f2ffee657bf834e4475865ae336e2379282d34?dir=blender#packages.x86_64-linux.default
</code></pre>
<p>will build the package <code>blender-bin</code> shown above.</p>
</li>
</ul>
<h1 id="description-81"><a class="header" href="#description-81">Description</a></h1>
<p>This command shows what packages are currently installed in a
profile. For each installed package, it shows the following
information:</p>
<ul>
<li>
<p><code>Name</code>: A unique name used to unambiguously identify the
package in invocations of <code>nix profile remove</code> and <code>nix profile upgrade</code>.</p>
</li>
<li>
<p><code>Index</code>: An integer that can be used to unambiguously identify the
package in invocations of <code>nix profile remove</code> and <code>nix profile upgrade</code>.
(<em>Deprecated, will be removed in a future version in favor of <code>Name</code>.</em>)</p>
</li>
<li>
<p><code>Flake attribute</code>: The flake output attribute path that provides the
package (e.g. <code>packages.x86_64-linux.hello</code>).</p>
</li>
<li>
<p><code>Original flake URL</code>: The original ("unlocked") flake reference
specified by the user when the package was first installed via <code>nix profile install</code>.</p>
</li>
<li>
<p><code>Locked flake URL</code>: The locked flake reference to which the original
flake reference was resolved.</p>
</li>
<li>
<p><code>Store paths</code>: The store path(s) of the package.</p>
</li>
</ul>
<h1 id="options-93"><a class="header" href="#options-93">Options</a></h1>
<ul>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-profile-list.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
<li>
<p><span id="opt-profile"><a href="command-ref/new-cli/nix3-profile-list.html#opt-profile"><code>--profile</code></a></span> <em>path</em></p>
<p>The profile to operate on.</p>
</li>
</ul>
<h2 id="common-evaluation-options-25"><a class="header" href="#common-evaluation-options-25">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-profile-list.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-profile-list.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-profile-list.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-profile-list.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-profile-list.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-profile-list.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-profile-list.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-profile-list.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-profile-list.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="logging-related-options-54"><a class="header" href="#logging-related-options-54">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-profile-list.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-profile-list.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-profile-list.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-profile-list.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-profile-list.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-54"><a class="header" href="#miscellaneous-global-options-54">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-profile-list.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-profile-list.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-profile-list.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-profile-list.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-profile-list.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-profile-list.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-97"><a class="header" href="#name-97">Name</a></h1>
<p><code>nix profile remove</code> - remove packages from a profile</p>
<h1 id="synopsis-97"><a class="header" href="#synopsis-97">Synopsis</a></h1>
<p><code>nix profile remove</code> [<em>option</em>...] <em>elements</em>...</p>
<h1 id="examples-66"><a class="header" href="#examples-66">Examples</a></h1>
<ul>
<li>
<p>Remove a package by name:</p>
<pre><code class="language-console"># nix profile remove hello
</code></pre>
</li>
<li>
<p>Remove all packages:</p>
<pre><code class="language-console"># nix profile remove --all
</code></pre>
</li>
<li>
<p>Remove packages by regular expression:</p>
<pre><code class="language-console"># nix profile remove --regex '.*vim.*'
</code></pre>
</li>
<li>
<p>Remove a package by store path:</p>
<pre><code class="language-console"># nix profile remove /nix/store/rr3y0c6zyk7kjjl8y19s4lsrhn4aiq1z-hello-2.10
</code></pre>
</li>
</ul>
<h1 id="description-82"><a class="header" href="#description-82">Description</a></h1>
<p>This command removes a package from a profile.</p>
<h1 id="options-94"><a class="header" href="#options-94">Options</a></h1>
<ul>
<li>
<p><span id="opt-all"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-all"><code>--all</code></a></span></p>
<p>Match all packages in the profile.</p>
</li>
<li>
<p><span id="opt-profile"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-profile"><code>--profile</code></a></span> <em>path</em></p>
<p>The profile to operate on.</p>
</li>
<li>
<p><span id="opt-regex"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-regex"><code>--regex</code></a></span> <em>pattern</em></p>
<p>A regular expression to match one or more packages in the profile.</p>
</li>
</ul>
<h2 id="common-evaluation-options-26"><a class="header" href="#common-evaluation-options-26">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="logging-related-options-55"><a class="header" href="#logging-related-options-55">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-55"><a class="header" href="#miscellaneous-global-options-55">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-profile-remove.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-98"><a class="header" href="#name-98">Name</a></h1>
<p><code>nix profile rollback</code> - roll back to the previous version or a specified version of a profile</p>
<h1 id="synopsis-98"><a class="header" href="#synopsis-98">Synopsis</a></h1>
<p><code>nix profile rollback</code> [<em>option</em>...]</p>
<h1 id="examples-67"><a class="header" href="#examples-67">Examples</a></h1>
<ul>
<li>
<p>Roll back your default profile to the previous version:</p>
<pre><code class="language-console"># nix profile rollback
switching profile from version 519 to 518
</code></pre>
</li>
<li>
<p>Switch your default profile to version 510:</p>
<pre><code class="language-console"># nix profile rollback --to 510
switching profile from version 518 to 510
</code></pre>
</li>
</ul>
<h1 id="description-83"><a class="header" href="#description-83">Description</a></h1>
<p>This command switches a profile to the most recent version older
than the currently active version, or if <code>--to</code> <em>N</em> is given, to
version <em>N</em> of the profile. To see the available versions of a
profile, use <code>nix profile history</code>.</p>
<h1 id="options-95"><a class="header" href="#options-95">Options</a></h1>
<ul>
<li>
<p><span id="opt-dry-run"><a href="command-ref/new-cli/nix3-profile-rollback.html#opt-dry-run"><code>--dry-run</code></a></span></p>
<p>Show what this command would do without doing it.</p>
</li>
<li>
<p><span id="opt-profile"><a href="command-ref/new-cli/nix3-profile-rollback.html#opt-profile"><code>--profile</code></a></span> <em>path</em></p>
<p>The profile to operate on.</p>
</li>
<li>
<p><span id="opt-to"><a href="command-ref/new-cli/nix3-profile-rollback.html#opt-to"><code>--to</code></a></span> <em>version</em></p>
<p>The profile version to roll back to.</p>
</li>
</ul>
<h2 id="logging-related-options-56"><a class="header" href="#logging-related-options-56">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-profile-rollback.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-profile-rollback.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-profile-rollback.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-profile-rollback.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-profile-rollback.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-56"><a class="header" href="#miscellaneous-global-options-56">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-profile-rollback.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-profile-rollback.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-profile-rollback.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-profile-rollback.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-profile-rollback.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-99"><a class="header" href="#name-99">Name</a></h1>
<p><code>nix profile upgrade</code> - upgrade packages using their most recent flake</p>
<h1 id="synopsis-99"><a class="header" href="#synopsis-99">Synopsis</a></h1>
<p><code>nix profile upgrade</code> [<em>option</em>...] <em>elements</em>...</p>
<h1 id="examples-68"><a class="header" href="#examples-68">Examples</a></h1>
<ul>
<li>
<p>Upgrade all packages that were installed using an unlocked flake
reference:</p>
<pre><code class="language-console"># nix profile upgrade --all
</code></pre>
</li>
<li>
<p>Upgrade a specific package by name:</p>
<pre><code class="language-console"># nix profile upgrade hello
</code></pre>
</li>
<li>
<p>Upgrade all packages that include 'vim' in their name:</p>
<pre><code class="language-console"># nix profile upgrade --regex '.*vim.*'
</code></pre>
</li>
</ul>
<h1 id="description-84"><a class="header" href="#description-84">Description</a></h1>
<p>This command upgrades a previously installed package in a Nix profile,
by fetching and evaluating the latest version of the flake from which
the package was installed.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This only works if you used an <em>unlocked</em> flake reference at
installation time, e.g. <code>nixpkgs#hello</code>. It does not work if you
used a <em>locked</em> flake reference
(e.g. <code>github:NixOS/nixpkgs/13d0c311e3ae923a00f734b43fd1d35b47d8943a#hello</code>),
since in that case the "latest version" is always the same.</p>
</blockquote>
<h1 id="options-96"><a class="header" href="#options-96">Options</a></h1>
<ul>
<li>
<p><span id="opt-all"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-all"><code>--all</code></a></span></p>
<p>Match all packages in the profile.</p>
</li>
<li>
<p><span id="opt-profile"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-profile"><code>--profile</code></a></span> <em>path</em></p>
<p>The profile to operate on.</p>
</li>
<li>
<p><span id="opt-regex"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-regex"><code>--regex</code></a></span> <em>pattern</em></p>
<p>A regular expression to match one or more packages in the profile.</p>
</li>
</ul>
<h2 id="common-evaluation-options-27"><a class="header" href="#common-evaluation-options-27">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-22"><a class="header" href="#common-flake-related-options-22">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-57"><a class="header" href="#logging-related-options-57">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-57"><a class="header" href="#miscellaneous-global-options-57">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-13"><a class="header" href="#options-that-change-the-interpretation-of-installables-13">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-profile-upgrade.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-100"><a class="header" href="#name-100">Name</a></h1>
<p><code>nix profile wipe-history</code> - delete non-current versions of a profile</p>
<h1 id="synopsis-100"><a class="header" href="#synopsis-100">Synopsis</a></h1>
<p><code>nix profile wipe-history</code> [<em>option</em>...]</p>
<h1 id="examples-69"><a class="header" href="#examples-69">Examples</a></h1>
<ul>
<li>
<p>Delete all versions of the default profile older than 100 days:</p>
<pre><code class="language-console"># nix profile wipe-history --profile /tmp/profile --older-than 100d
removing profile version 515
removing profile version 514
</code></pre>
</li>
</ul>
<h1 id="description-85"><a class="header" href="#description-85">Description</a></h1>
<p>This command deletes non-current versions of a profile, making it
impossible to roll back to these versions. By default, all non-current
versions are deleted. With <code>--older-than</code> <em>N</em><code>d</code>, all non-current
versions older than <em>N</em> days are deleted.</p>
<h1 id="options-97"><a class="header" href="#options-97">Options</a></h1>
<ul>
<li>
<p><span id="opt-dry-run"><a href="command-ref/new-cli/nix3-profile-wipe-history.html#opt-dry-run"><code>--dry-run</code></a></span></p>
<p>Show what this command would do without doing it.</p>
</li>
<li>
<p><span id="opt-older-than"><a href="command-ref/new-cli/nix3-profile-wipe-history.html#opt-older-than"><code>--older-than</code></a></span> <em>age</em></p>
<p>Delete versions older than the specified age. <em>age</em> must be in the format <em>N</em><code>d</code>, where <em>N</em> denotes a number of days.</p>
</li>
<li>
<p><span id="opt-profile"><a href="command-ref/new-cli/nix3-profile-wipe-history.html#opt-profile"><code>--profile</code></a></span> <em>path</em></p>
<p>The profile to operate on.</p>
</li>
</ul>
<h2 id="logging-related-options-58"><a class="header" href="#logging-related-options-58">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-profile-wipe-history.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-profile-wipe-history.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-profile-wipe-history.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-profile-wipe-history.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-profile-wipe-history.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-58"><a class="header" href="#miscellaneous-global-options-58">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-profile-wipe-history.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-profile-wipe-history.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-profile-wipe-history.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-profile-wipe-history.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-profile-wipe-history.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-101"><a class="header" href="#name-101">Name</a></h1>
<p><code>nix realisation</code> - manipulate a Nix realisation</p>
<h1 id="synopsis-101"><a class="header" href="#synopsis-101">Synopsis</a></h1>
<p><code>nix realisation</code> [<em>option</em>...] <em>subcommand</em></p>
<p>where <em>subcommand</em> is one of the following:</p>
<ul>
<li><a href="command-ref/new-cli/./nix3-realisation-info.html"><code>nix realisation info</code></a> - query information about one or several realisations</li>
</ul>
<h1 id="options-98"><a class="header" href="#options-98">Options</a></h1>
<h2 id="logging-related-options-59"><a class="header" href="#logging-related-options-59">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-realisation.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-realisation.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-realisation.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-realisation.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-realisation.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-59"><a class="header" href="#miscellaneous-global-options-59">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-realisation.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-realisation.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-realisation.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-realisation.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-realisation.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-102"><a class="header" href="#name-102">Name</a></h1>
<p><code>nix realisation info</code> - query information about one or several realisations</p>
<h1 id="synopsis-102"><a class="header" href="#synopsis-102">Synopsis</a></h1>
<p><code>nix realisation info</code> [<em>option</em>...] <em>installables</em>...</p>
<h1 id="description-86"><a class="header" href="#description-86">Description</a></h1>
<p>Display some information about the given realisation</p>
<h1 id="examples-70"><a class="header" href="#examples-70">Examples</a></h1>
<p>Show some information about the realisation of the <code>hello</code> package:</p>
<pre><code class="language-console">$ nix realisation info nixpkgs#hello --json
[{"id":"sha256:3d382378a00588e064ee30be96dd0fa7e7df7cf3fbcace85a0e7b7dada1eef25!out","outPath":"fd3m7xawvrqcg98kgz5hc2vk3x9q0lh7-hello"}]
</code></pre>
<h1 id="options-99"><a class="header" href="#options-99">Options</a></h1>
<ul>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
<li>
<p><span id="opt-stdin"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-stdin"><code>--stdin</code></a></span></p>
<p>Read installables from the standard input. No default installable applied.</p>
</li>
</ul>
<h2 id="common-evaluation-options-28"><a class="header" href="#common-evaluation-options-28">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-23"><a class="header" href="#common-flake-related-options-23">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-60"><a class="header" href="#logging-related-options-60">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-60"><a class="header" href="#miscellaneous-global-options-60">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-14"><a class="header" href="#options-that-change-the-interpretation-of-installables-14">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-all"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-all"><code>--all</code></a></span></p>
<p>Apply the operation to every store path.</p>
</li>
<li>
<p><span id="opt-derivation"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-derivation"><code>--derivation</code></a></span></p>
<p>Operate on the <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> rather than its outputs.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
<li>
<p><span id="opt-recursive"><a href="command-ref/new-cli/nix3-realisation-info.html#opt-recursive"><code>--recursive</code></a></span> / <code>-r</code></p>
<p>Apply operation to closure of the specified paths.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-103"><a class="header" href="#name-103">Name</a></h1>
<p><code>nix registry</code> - manage the flake registry</p>
<h1 id="synopsis-103"><a class="header" href="#synopsis-103">Synopsis</a></h1>
<p><code>nix registry</code> [<em>option</em>...] <em>subcommand</em></p>
<p>where <em>subcommand</em> is one of the following:</p>
<ul>
<li><a href="command-ref/new-cli/./nix3-registry-add.html"><code>nix registry add</code></a> - add/replace flake in user flake registry</li>
<li><a href="command-ref/new-cli/./nix3-registry-list.html"><code>nix registry list</code></a> - list available Nix flakes</li>
<li><a href="command-ref/new-cli/./nix3-registry-pin.html"><code>nix registry pin</code></a> - pin a flake to its current version or to the current version of a flake URL</li>
<li><a href="command-ref/new-cli/./nix3-registry-remove.html"><code>nix registry remove</code></a> - remove flake from user flake registry</li>
</ul>
<h1 id="description-87"><a class="header" href="#description-87">Description</a></h1>
<p><code>nix registry</code> provides subcommands for managing <em>flake
registries</em>. Flake registries are a convenience feature that allows
you to refer to flakes using symbolic identifiers such as <code>nixpkgs</code>,
rather than full URLs such as <code>git://github.com/NixOS/nixpkgs</code>. You
can use these identifiers on the command line (e.g. when you do <code>nix run nixpkgs#hello</code>) or in flake input specifications in <code>flake.nix</code>
files. The latter are automatically resolved to full URLs and recorded
in the flake's <code>flake.lock</code> file.</p>
<p>In addition, the flake registry allows you to redirect arbitrary flake
references (e.g. <code>github:NixOS/patchelf</code>) to another location, such as
a local fork.</p>
<p>There are multiple registries. These are, in order from lowest to
highest precedence:</p>
<ul>
<li>
<p>The global registry, which is a file downloaded from the URL
specified by the setting <code>flake-registry</code>. It is cached locally and
updated automatically when it's older than <code>tarball-ttl</code>
seconds. The default global registry is kept in <a href="https://github.com/NixOS/flake-registry">a GitHub
repository</a>.</p>
</li>
<li>
<p>The system registry, which is shared by all users. The default
location is <code>/etc/nix/registry.json</code>. On NixOS, the system registry
can be specified using the NixOS option <code>nix.registry</code>.</p>
</li>
<li>
<p>The user registry <code>~/.config/nix/registry.json</code>. This registry can
be modified by commands such as <code>nix registry pin</code>.</p>
</li>
<li>
<p>Overrides specified on the command line using the option
<code>--override-flake</code>.</p>
</li>
</ul>
<p>Note that the system and user registries are not used to resolve flake references in <code>flake.nix</code>. They are only used to resolve flake references on the command line.</p>
<h1 id="registry-format"><a class="header" href="#registry-format">Registry format</a></h1>
<p>A registry is a JSON file with the following format:</p>
<pre><code class="language-json">{
  "version": 2,
  "flakes": [
    {
      "from": {
        "type": "indirect",
        "id": "nixpkgs"
      },
      "to": {
        "type": "github",
        "owner": "NixOS",
        "repo": "nixpkgs"
      }
    },
    ...
  ]
}
</code></pre>
<p>That is, it contains a list of objects with attributes <code>from</code> and
<code>to</code>, both of which contain a flake reference in attribute
representation. (For example, <code>{"type": "indirect", "id": "nixpkgs"}</code>
is the attribute representation of <code>nixpkgs</code>, while <code>{"type": "github", "owner": "NixOS", "repo": "nixpkgs"}</code> is the attribute
representation of <code>github:NixOS/nixpkgs</code>.)</p>
<p>Given some flake reference <em>R</em>, a registry entry is used if its
<code>from</code> flake reference <em>matches</em> <em>R</em>. <em>R</em> is then replaced by the
<em>unification</em> of the <code>to</code> flake reference with <em>R</em>.</p>
<h1 id="matching"><a class="header" href="#matching">Matching</a></h1>
<p>The <code>from</code> flake reference in a registry entry <em>matches</em> some flake
reference <em>R</em> if the attributes in <code>from</code> are the same as the
attributes in <code>R</code>. For example:</p>
<ul>
<li>
<p><code>nixpkgs</code> matches with <code>nixpkgs</code>.</p>
</li>
<li>
<p><code>nixpkgs</code> matches with <code>nixpkgs/nixos-20.09</code>.</p>
</li>
<li>
<p><code>nixpkgs/nixos-20.09</code> does not match with <code>nixpkgs</code>.</p>
</li>
<li>
<p><code>nixpkgs</code> does not match with <code>git://github.com/NixOS/patchelf</code>.</p>
</li>
</ul>
<h1 id="unification"><a class="header" href="#unification">Unification</a></h1>
<p>The <code>to</code> flake reference in a registry entry is <em>unified</em> with some flake
reference <em>R</em> by taking <code>to</code> and applying the <code>rev</code> and <code>ref</code>
attributes from <em>R</em>, if specified. For example:</p>
<ul>
<li>
<p><code>github:NixOS/nixpkgs</code> unified with <code>nixpkgs</code> produces <code>github:NixOS/nixpkgs</code>.</p>
</li>
<li>
<p><code>github:NixOS/nixpkgs</code> unified with <code>nixpkgs/nixos-20.09</code> produces <code>github:NixOS/nixpkgs/nixos-20.09</code>.</p>
</li>
<li>
<p><code>github:NixOS/nixpkgs/master</code> unified with <code>nixpkgs/nixos-20.09</code> produces <code>github:NixOS/nixpkgs/nixos-20.09</code>.</p>
</li>
</ul>
<h1 id="options-100"><a class="header" href="#options-100">Options</a></h1>
<h2 id="logging-related-options-61"><a class="header" href="#logging-related-options-61">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-registry.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-registry.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-registry.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-registry.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-registry.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-61"><a class="header" href="#miscellaneous-global-options-61">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-registry.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-registry.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-registry.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-registry.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-registry.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-104"><a class="header" href="#name-104">Name</a></h1>
<p><code>nix registry add</code> - add/replace flake in user flake registry</p>
<h1 id="synopsis-104"><a class="header" href="#synopsis-104">Synopsis</a></h1>
<p><code>nix registry add</code> [<em>option</em>...] <em>from-url</em> <em>to-url</em></p>
<h1 id="examples-71"><a class="header" href="#examples-71">Examples</a></h1>
<ul>
<li>
<p>Set the <code>nixpkgs</code> flake identifier to a specific branch of Nixpkgs:</p>
<pre><code class="language-console"># nix registry add nixpkgs github:NixOS/nixpkgs/nixos-20.03
</code></pre>
</li>
<li>
<p>Pin <code>nixpkgs</code> to a specific revision:</p>
<pre><code class="language-console"># nix registry add nixpkgs github:NixOS/nixpkgs/925b70cd964ceaedee26fde9b19cc4c4f081196a
</code></pre>
</li>
<li>
<p>Add an entry that redirects a specific branch of <code>nixpkgs</code> to
another fork:</p>
<pre><code class="language-console"># nix registry add nixpkgs/nixos-20.03 ~/Dev/nixpkgs
</code></pre>
</li>
<li>
<p>Add <code>nixpkgs</code> pointing to <code>github:nixos/nixpkgs</code> to your custom flake
registry:</p>
<pre><code class="language-console">nix registry add --registry ./custom-flake-registry.json nixpkgs github:nixos/nixpkgs
</code></pre>
</li>
</ul>
<h1 id="description-88"><a class="header" href="#description-88">Description</a></h1>
<p>This command adds an entry to the user registry that maps flake
reference <em>from-url</em> to flake reference <em>to-url</em>. If an entry for
<em>from-url</em> already exists, it is overwritten.</p>
<p>Entries can be removed using <a href="command-ref/new-cli/./nix3-registry-remove.html"><code>nix registry remove</code></a>.</p>
<h1 id="options-101"><a class="header" href="#options-101">Options</a></h1>
<ul>
<li>
<p><span id="opt-registry"><a href="command-ref/new-cli/nix3-registry-add.html#opt-registry"><code>--registry</code></a></span> <em>registry</em></p>
<p>The registry to operate on.</p>
</li>
</ul>
<h2 id="common-evaluation-options-29"><a class="header" href="#common-evaluation-options-29">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-registry-add.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-registry-add.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-registry-add.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-registry-add.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-registry-add.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-registry-add.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-registry-add.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-registry-add.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="logging-related-options-62"><a class="header" href="#logging-related-options-62">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-registry-add.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-registry-add.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-registry-add.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-registry-add.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-registry-add.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-62"><a class="header" href="#miscellaneous-global-options-62">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-registry-add.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-registry-add.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-registry-add.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-registry-add.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-registry-add.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-registry-add.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-105"><a class="header" href="#name-105">Name</a></h1>
<p><code>nix registry list</code> - list available Nix flakes</p>
<h1 id="synopsis-105"><a class="header" href="#synopsis-105">Synopsis</a></h1>
<p><code>nix registry list</code> [<em>option</em>...]</p>
<h1 id="examples-72"><a class="header" href="#examples-72">Examples</a></h1>
<ul>
<li>
<p>Show the contents of all registries:</p>
<pre><code class="language-console"># nix registry list
user   flake:dwarffs github:edolstra/dwarffs/d181d714fd36eb06f4992a1997cd5601e26db8f5
system flake:nixpkgs path:/nix/store/fxl9mrm5xvzam0lxi9ygdmksskx4qq8s-source?lastModified=1605220118&amp;narHash=sha256-Und10ixH1WuW0XHYMxxuHRohKYb45R%2fT8CwZuLd2D2Q=&amp;rev=3090c65041104931adda7625d37fa874b2b5c124
global flake:blender-bin github:edolstra/nix-warez?dir=blender
global flake:dwarffs github:edolstra/dwarffs
…
</code></pre>
</li>
</ul>
<h1 id="description-89"><a class="header" href="#description-89">Description</a></h1>
<p>This command displays the contents of all registries on standard
output. Each line represents one registry entry in the format <em>type</em>
<em>from</em> <em>to</em>, where <em>type</em> denotes the registry containing the entry:</p>
<ul>
<li><code>flags</code>: entries specified on the command line using <code>--override-flake</code>.</li>
<li><code>user</code>: the user registry.</li>
<li><code>system</code>: the system registry.</li>
<li><code>global</code>: the global registry.</li>
</ul>
<p>See the <a href="command-ref/new-cli/./nix3-registry.html"><code>nix registry</code> manual page</a> for more details.</p>
<h1 id="options-102"><a class="header" href="#options-102">Options</a></h1>
<h2 id="logging-related-options-63"><a class="header" href="#logging-related-options-63">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-registry-list.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-registry-list.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-registry-list.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-registry-list.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-registry-list.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-63"><a class="header" href="#miscellaneous-global-options-63">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-registry-list.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-registry-list.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-registry-list.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-registry-list.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-registry-list.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-106"><a class="header" href="#name-106">Name</a></h1>
<p><code>nix registry pin</code> - pin a flake to its current version or to the current version of a flake URL</p>
<h1 id="synopsis-106"><a class="header" href="#synopsis-106">Synopsis</a></h1>
<p><code>nix registry pin</code> [<em>option</em>...] <em>url</em> <em>locked</em></p>
<h1 id="examples-73"><a class="header" href="#examples-73">Examples</a></h1>
<ul>
<li>
<p>Pin <code>nixpkgs</code> to its most recent Git revision:</p>
<pre><code class="language-console"># nix registry pin nixpkgs
</code></pre>
<p>Afterwards the user registry will have an entry like this:</p>
<pre><code class="language-console">nix registry list | grep '^user '
user   flake:nixpkgs github:NixOS/nixpkgs/925b70cd964ceaedee26fde9b19cc4c4f081196a
</code></pre>
<p>and <code>nix flake metadata</code> will say:</p>
<pre><code class="language-console"># nix flake metadata nixpkgs
Resolved URL:  github:NixOS/nixpkgs/925b70cd964ceaedee26fde9b19cc4c4f081196a
Locked URL:    github:NixOS/nixpkgs/925b70cd964ceaedee26fde9b19cc4c4f081196a
…
</code></pre>
</li>
<li>
<p>Pin <code>nixpkgs</code> in a custom registry to its most recent Git revision:</p>
<pre><code class="language-console"># nix registry pin --registry ./custom-flake-registry.json nixpkgs
</code></pre>
</li>
</ul>
<h1 id="description-90"><a class="header" href="#description-90">Description</a></h1>
<p>This command adds an entry to the user registry that maps flake
reference <em>url</em> to the corresponding <em>locked</em> flake reference, that
is, a flake reference that specifies an exact revision or content
hash. This ensures that until this registry entry is removed, all uses
of <em>url</em> will resolve to exactly the same flake.</p>
<p>Entries can be removed using <a href="command-ref/new-cli/./nix3-registry-remove.html"><code>nix registry remove</code></a>.</p>
<h1 id="options-103"><a class="header" href="#options-103">Options</a></h1>
<ul>
<li>
<p><span id="opt-registry"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-registry"><code>--registry</code></a></span> <em>registry</em></p>
<p>The registry to operate on.</p>
</li>
</ul>
<h2 id="common-evaluation-options-30"><a class="header" href="#common-evaluation-options-30">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="logging-related-options-64"><a class="header" href="#logging-related-options-64">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-64"><a class="header" href="#miscellaneous-global-options-64">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-registry-pin.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-107"><a class="header" href="#name-107">Name</a></h1>
<p><code>nix registry remove</code> - remove flake from user flake registry</p>
<h1 id="synopsis-107"><a class="header" href="#synopsis-107">Synopsis</a></h1>
<p><code>nix registry remove</code> [<em>option</em>...] <em>url</em></p>
<h1 id="examples-74"><a class="header" href="#examples-74">Examples</a></h1>
<ul>
<li>
<p>Remove the entry <code>nixpkgs</code> from the user registry:</p>
<pre><code class="language-console"># nix registry remove nixpkgs
</code></pre>
</li>
<li>
<p>Remove the entry <code>nixpkgs</code> from a custom registry:</p>
<pre><code class="language-console"># nix registry remove --registry ./custom-flake-registry.json nixpkgs
</code></pre>
</li>
</ul>
<h1 id="description-91"><a class="header" href="#description-91">Description</a></h1>
<p>This command removes from the user registry any entry for flake
reference <em>url</em>.</p>
<h1 id="options-104"><a class="header" href="#options-104">Options</a></h1>
<ul>
<li>
<p><span id="opt-registry"><a href="command-ref/new-cli/nix3-registry-remove.html#opt-registry"><code>--registry</code></a></span> <em>registry</em></p>
<p>The registry to operate on.</p>
</li>
</ul>
<h2 id="logging-related-options-65"><a class="header" href="#logging-related-options-65">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-registry-remove.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-registry-remove.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-registry-remove.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-registry-remove.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-registry-remove.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-65"><a class="header" href="#miscellaneous-global-options-65">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-registry-remove.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-registry-remove.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-registry-remove.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-registry-remove.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-registry-remove.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-108"><a class="header" href="#name-108">Name</a></h1>
<p><code>nix repl</code> - start an interactive environment for evaluating Nix expressions</p>
<h1 id="synopsis-108"><a class="header" href="#synopsis-108">Synopsis</a></h1>
<p><code>nix repl</code> [<em>option</em>...] <em>installables</em>...</p>
<h1 id="examples-75"><a class="header" href="#examples-75">Examples</a></h1>
<ul>
<li>
<p>Display all special commands within the REPL:</p>
<pre><code class="language-console"># nix repl
nix-repl&gt; :?
</code></pre>
</li>
<li>
<p>Evaluate some simple Nix expressions:</p>
<pre><code class="language-console"># nix repl

nix-repl&gt; 1 + 2
3

nix-repl&gt; map (x: x * 2) [1 2 3]
[ 2 4 6 ]
</code></pre>
</li>
<li>
<p>Interact with Nixpkgs in the REPL:</p>
<pre><code class="language-console"># nix repl --file example.nix
Loading Installable ''...
Added 3 variables.

# nix repl --expr '{a={b=3;c=4;};}'
Loading Installable ''...
Added 1 variables.

# nix repl --expr '{a={b=3;c=4;};}' a
Loading Installable ''...
Added 1 variables.

# nix repl --extra-experimental-features 'flakes' nixpkgs
Loading Installable 'flake:nixpkgs#'...
Added 5 variables.

nix-repl&gt; legacyPackages.x86_64-linux.emacs.name
"emacs-27.1"

nix-repl&gt; :q

# nix repl --expr 'import &lt;nixpkgs&gt;{}'

Loading Installable ''...
Added 12439 variables.

nix-repl&gt; emacs.name
"emacs-27.1"

nix-repl&gt; emacs.drvPath
"/nix/store/lp0sjrhgg03y2n0l10n70rg0k7hhyz0l-emacs-27.1.drv"

nix-repl&gt; drv = runCommand "hello" { buildInputs = [ hello ]; } "hello; hello &gt; $out"

nix-repl&gt; :b drv
this derivation produced the following outputs:
  out -&gt; /nix/store/0njwbgwmkwls0w5dv9mpc1pq5fj39q0l-hello

nix-repl&gt; builtins.readFile drv
"Hello, world!\n"

nix-repl&gt; :log drv
Hello, world!
</code></pre>
</li>
</ul>
<h1 id="description-92"><a class="header" href="#description-92">Description</a></h1>
<p>This command provides an interactive environment for evaluating Nix
expressions. (REPL stands for 'read–eval–print loop'.)</p>
<p>On startup, it loads the Nix expressions named <em>files</em> and adds them
into the lexical scope. You can load addition files using the <code>:l &lt;filename&gt;</code> command, or reload all files using <code>:r</code>.</p>
<h1 id="options-105"><a class="header" href="#options-105">Options</a></h1>
<ul>
<li>
<p><span id="opt-stdin"><a href="command-ref/new-cli/nix3-repl.html#opt-stdin"><code>--stdin</code></a></span></p>
<p>Read installables from the standard input. No default installable applied.</p>
</li>
</ul>
<h2 id="common-evaluation-options-31"><a class="header" href="#common-evaluation-options-31">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-repl.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-repl.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-repl.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-repl.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-repl.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-repl.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-repl.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-repl.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-repl.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-24"><a class="header" href="#common-flake-related-options-24">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-repl.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-repl.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-repl.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-repl.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-repl.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-repl.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-repl.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-repl.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-repl.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-repl.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-66"><a class="header" href="#logging-related-options-66">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-repl.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-repl.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-repl.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-repl.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-repl.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-66"><a class="header" href="#miscellaneous-global-options-66">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-repl.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-repl.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-repl.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-repl.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-repl.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-repl.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-15"><a class="header" href="#options-that-change-the-interpretation-of-installables-15">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-repl.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-repl.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-109"><a class="header" href="#name-109">Name</a></h1>
<p><code>nix run</code> - run a Nix application</p>
<h1 id="synopsis-109"><a class="header" href="#synopsis-109">Synopsis</a></h1>
<p><code>nix run</code> [<em>option</em>...] <em>installable</em> <em>args</em>...</p>
<h1 id="examples-76"><a class="header" href="#examples-76">Examples</a></h1>
<ul>
<li>
<p>Run the default app from the <code>blender-bin</code> flake:</p>
<pre><code class="language-console"># nix run blender-bin
</code></pre>
</li>
<li>
<p>Run a non-default app from the <code>blender-bin</code> flake:</p>
<pre><code class="language-console"># nix run blender-bin#blender_2_83
</code></pre>
<p>Tip: you can find apps provided by this flake by running <code>nix flake show blender-bin</code>.</p>
</li>
<li>
<p>Run <code>vim</code> from the <code>nixpkgs</code> flake:</p>
<pre><code class="language-console"># nix run nixpkgs#vim
</code></pre>
<p>Note that <code>vim</code> (as of the time of writing of this page) is not an
app but a package. Thus, Nix runs the eponymous file from the <code>vim</code>
package.</p>
</li>
<li>
<p>Run <code>vim</code> with arguments:</p>
<pre><code class="language-console"># nix run nixpkgs#vim -- --help
</code></pre>
</li>
</ul>
<h1 id="description-93"><a class="header" href="#description-93">Description</a></h1>
<p><code>nix run</code> builds and runs <a href="command-ref/new-cli/./nix.html#installables"><em>installable</em></a>, which must evaluate to an
<em>app</em> or a regular Nix derivation.</p>
<p>If <em>installable</em> evaluates to an <em>app</em> (see below), it executes the
program specified by the app definition.</p>
<p>If <em>installable</em> evaluates to a derivation, it will try to execute the
program <code>&lt;out&gt;/bin/&lt;name&gt;</code>, where <em>out</em> is the primary output store
path of the derivation, and <em>name</em> is the first of the following that
exists:</p>
<ul>
<li>The <code>meta.mainProgram</code> attribute of the derivation.</li>
<li>The <code>pname</code> attribute of the derivation.</li>
<li>The name part of the value of the <code>name</code> attribute of the derivation.</li>
</ul>
<p>For instance, if <code>name</code> is set to <code>hello-1.10</code>, <code>nix run</code> will run
<code>$out/bin/hello</code>.</p>
<h1 id="flake-output-attributes-2"><a class="header" href="#flake-output-attributes-2">Flake output attributes</a></h1>
<p>If no flake output attribute is given, <code>nix run</code> tries the following
flake output attributes:</p>
<ul>
<li>
<p><code>apps.&lt;system&gt;.default</code></p>
</li>
<li>
<p><code>packages.&lt;system&gt;.default</code></p>
</li>
</ul>
<p>If an attribute <em>name</em> is given, <code>nix run</code> tries the following flake
output attributes:</p>
<ul>
<li>
<p><code>apps.&lt;system&gt;.&lt;name&gt;</code></p>
</li>
<li>
<p><code>packages.&lt;system&gt;.&lt;name&gt;</code></p>
</li>
<li>
<p><code>legacyPackages.&lt;system&gt;.&lt;name&gt;</code></p>
</li>
</ul>
<h1 id="apps"><a class="header" href="#apps">Apps</a></h1>
<p>An app is specified by a flake output attribute named
<code>apps.&lt;system&gt;.&lt;name&gt;</code>. It looks like this:</p>
<pre><code class="language-nix">apps.x86_64-linux.blender_2_79 = {
  type = "app";
  program = "${self.packages.x86_64-linux.blender_2_79}/bin/blender";
  meta.description = "Run Blender, a free and open-source 3D creation suite.";
};
</code></pre>
<p>The only supported attributes are:</p>
<ul>
<li>
<p><code>type</code> (required): Must be set to <code>app</code>.</p>
</li>
<li>
<p><code>program</code> (required): The full path of the executable to run. It
must reside in the Nix store.</p>
</li>
<li>
<p><code>meta.description</code> (optional): A description of the app.</p>
</li>
</ul>
<h1 id="options-106"><a class="header" href="#options-106">Options</a></h1>
<h2 id="common-evaluation-options-32"><a class="header" href="#common-evaluation-options-32">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-run.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-run.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-run.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-run.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-run.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-run.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-run.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-run.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-run.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-25"><a class="header" href="#common-flake-related-options-25">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-run.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-run.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-run.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-run.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-run.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-run.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-run.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-run.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-run.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-run.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-67"><a class="header" href="#logging-related-options-67">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-run.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-run.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-run.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-run.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-run.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-67"><a class="header" href="#miscellaneous-global-options-67">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-run.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-run.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-run.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-run.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-run.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-run.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-environment-variables-2"><a class="header" href="#options-that-change-environment-variables-2">Options that change environment variables</a></h2>
<ul>
<li>
<p><span id="opt-ignore-env"><a href="command-ref/new-cli/nix3-run.html#opt-ignore-env"><code>--ignore-env</code></a></span> / <code>-i</code></p>
<p>Clear the entire environment, except for those specified with <code>--keep-env-var</code>.</p>
</li>
<li>
<p><span id="opt-keep-env-var"><a href="command-ref/new-cli/nix3-run.html#opt-keep-env-var"><code>--keep-env-var</code></a></span> / <code>-k</code> <em>name</em></p>
<p>Keep the environment variable <em>name</em>, when using <code>--ignore-env</code>.</p>
</li>
<li>
<p><span id="opt-set-env-var"><a href="command-ref/new-cli/nix3-run.html#opt-set-env-var"><code>--set-env-var</code></a></span> / <code>-s</code> <em>name</em> <em>value</em></p>
<p>Sets an environment variable <em>name</em> with <em>value</em>.</p>
</li>
<li>
<p><span id="opt-unset-env-var"><a href="command-ref/new-cli/nix3-run.html#opt-unset-env-var"><code>--unset-env-var</code></a></span> / <code>-u</code> <em>name</em></p>
<p>Unset the environment variable <em>name</em>.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-16"><a class="header" href="#options-that-change-the-interpretation-of-installables-16">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-run.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-run.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-110"><a class="header" href="#name-110">Name</a></h1>
<p><code>nix search</code> - search for packages</p>
<h1 id="synopsis-110"><a class="header" href="#synopsis-110">Synopsis</a></h1>
<p><code>nix search</code> [<em>option</em>...] <em>installable</em> <em>regex</em>...</p>
<h1 id="examples-77"><a class="header" href="#examples-77">Examples</a></h1>
<ul>
<li>
<p>Show all packages in the <code>nixpkgs</code> flake:</p>
<pre><code class="language-console"># nix search nixpkgs ^
* legacyPackages.x86_64-linux.AMB-plugins (0.8.1)
  A set of ambisonics ladspa plugins

* legacyPackages.x86_64-linux.ArchiSteamFarm (4.3.1.0)
  Application with primary purpose of idling Steam cards from multiple accounts simultaneously
…
</code></pre>
</li>
<li>
<p>Show packages in the <code>nixpkgs</code> flake containing <code>blender</code> in its
name or description:</p>
<pre><code class="language-console"># nix search nixpkgs blender
* legacyPackages.x86_64-linux.blender (2.91.0)
  3D Creation/Animation/Publishing System
</code></pre>
</li>
<li>
<p>Search for packages underneath the attribute <code>gnome3</code> in Nixpkgs:</p>
<pre><code class="language-console"># nix search nixpkgs#gnome3 vala
* legacyPackages.x86_64-linux.gnome3.vala (0.48.9)
  Compiler for GObject type system
</code></pre>
</li>
<li>
<p>Show all packages in the flake in the current directory:</p>
<pre><code class="language-console"># nix search . ^
</code></pre>
</li>
<li>
<p>Search for Firefox or Chromium:</p>
<pre><code class="language-console"># nix search nixpkgs 'firefox|chromium'
</code></pre>
</li>
<li>
<p>Search for packages containing <code>git</code> and either <code>frontend</code> or <code>gui</code>:</p>
<pre><code class="language-console"># nix search nixpkgs git 'frontend|gui'
</code></pre>
</li>
<li>
<p>Search for packages containing <code>neovim</code> but hide ones containing either <code>gui</code> or <code>python</code>:</p>
<pre><code class="language-console"># nix search nixpkgs neovim --exclude 'python|gui'
</code></pre>
<p>or</p>
<pre><code class="language-console"># nix search nixpkgs neovim --exclude 'python' --exclude 'gui'
</code></pre>
</li>
</ul>
<h1 id="description-94"><a class="header" href="#description-94">Description</a></h1>
<p><code>nix search</code> searches <a href="command-ref/new-cli/./nix.html#installables"><em>installable</em></a> that can be evaluated, that is, a
flake or Nix expression, but not a <a href="command-ref/new-cli/../../glossary.html#gloss-store-path">store path</a> or <a href="command-ref/new-cli/../../glossary.html#gloss-deriving-path">deriving path</a>) for packages whose name or description matches all of the
regular expressions <em>regex</em>. For each matching package, It prints the
full attribute name (from the root of the <a href="command-ref/new-cli/./nix.html#installables">installable</a>), the version
and the <code>meta.description</code> field, highlighting the substrings that
were matched by the regular expressions.</p>
<p>To show all packages, use the regular expression <code>^</code>. In contrast to <code>.*</code>,
it avoids highlighting the entire name and description of every package.</p>
<blockquote>
<p>Note that in this context, <code>^</code> is the regex character to match the beginning of a string, <em>not</em> the delimiter for
<a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#derivation-output-selection">selecting a derivation output</a>.</p>
</blockquote>
<h1 id="flake-output-attributes-3"><a class="header" href="#flake-output-attributes-3">Flake output attributes</a></h1>
<p>If no flake output attribute is given, <code>nix search</code> searches for
packages:</p>
<ul>
<li>
<p>Directly underneath <code>packages.&lt;system&gt;</code>.</p>
</li>
<li>
<p>Underneath <code>legacyPackages.&lt;system&gt;</code>, recursing into attribute sets
that contain an attribute <code>recurseForDerivations = true</code>.</p>
</li>
</ul>
<h1 id="options-107"><a class="header" href="#options-107">Options</a></h1>
<ul>
<li>
<p><span id="opt-exclude"><a href="command-ref/new-cli/nix3-search.html#opt-exclude"><code>--exclude</code></a></span> / <code>-e</code> <em>regex</em></p>
<p>Hide packages whose attribute path, name or description contain <em>regex</em>.</p>
</li>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-search.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
</ul>
<h2 id="common-evaluation-options-33"><a class="header" href="#common-evaluation-options-33">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-search.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-search.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-search.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-search.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-search.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-search.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-search.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-search.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-search.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-26"><a class="header" href="#common-flake-related-options-26">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-search.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-search.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-search.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-search.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-search.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-search.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-search.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-search.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-search.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-search.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-68"><a class="header" href="#logging-related-options-68">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-search.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-search.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-search.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-search.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-search.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-68"><a class="header" href="#miscellaneous-global-options-68">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-search.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-search.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-search.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-search.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-search.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-search.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-17"><a class="header" href="#options-that-change-the-interpretation-of-installables-17">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-search.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-search.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-111"><a class="header" href="#name-111">Name</a></h1>
<p><code>nix store</code> - manipulate a Nix store</p>
<h1 id="synopsis-111"><a class="header" href="#synopsis-111">Synopsis</a></h1>
<p><code>nix store</code> [<em>option</em>...] <em>subcommand</em></p>
<p>where <em>subcommand</em> is one of the following:</p>
<ul>
<li><a href="command-ref/new-cli/./nix3-store-add.html"><code>nix store add</code></a> - Add a file or directory to the Nix store</li>
<li><a href="command-ref/new-cli/./nix3-store-add-file.html"><code>nix store add-file</code></a> - Deprecated. Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-store-add.html"><code>nix store add --mode flat</code></a> instead.</li>
<li><a href="command-ref/new-cli/./nix3-store-add-path.html"><code>nix store add-path</code></a> - Deprecated alias to <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-store-add.html"><code>nix store add</code></a>.</li>
<li><a href="command-ref/new-cli/./nix3-store-cat.html"><code>nix store cat</code></a> - print the contents of a file in the Nix store on stdout</li>
<li><a href="command-ref/new-cli/./nix3-store-copy-log.html"><code>nix store copy-log</code></a> - copy build logs between Nix stores</li>
<li><a href="command-ref/new-cli/./nix3-store-copy-sigs.html"><code>nix store copy-sigs</code></a> - copy store path signatures from substituters</li>
<li><a href="command-ref/new-cli/./nix3-store-delete.html"><code>nix store delete</code></a> - delete paths from the Nix store</li>
<li><a href="command-ref/new-cli/./nix3-store-diff-closures.html"><code>nix store diff-closures</code></a> - show what packages and versions were added and removed between two closures</li>
<li><a href="command-ref/new-cli/./nix3-store-dump-path.html"><code>nix store dump-path</code></a> - serialise a store path to stdout in NAR format</li>
<li><a href="command-ref/new-cli/./nix3-store-gc.html"><code>nix store gc</code></a> - perform garbage collection on a Nix store</li>
<li><a href="command-ref/new-cli/./nix3-store-info.html"><code>nix store info</code></a> - test whether a store can be accessed</li>
<li><a href="command-ref/new-cli/./nix3-store-ls.html"><code>nix store ls</code></a> - show information about a path in the Nix store</li>
<li><a href="command-ref/new-cli/./nix3-store-make-content-addressed.html"><code>nix store make-content-addressed</code></a> - rewrite a path or closure to content-addressed form</li>
<li><a href="command-ref/new-cli/./nix3-store-optimise.html"><code>nix store optimise</code></a> - replace identical files in the store by hard links</li>
<li><a href="command-ref/new-cli/./nix3-store-path-from-hash-part.html"><code>nix store path-from-hash-part</code></a> - get a store path from its hash part</li>
<li><a href="command-ref/new-cli/./nix3-store-ping.html"><code>nix store ping</code></a> - test whether a store can be accessed</li>
<li><a href="command-ref/new-cli/./nix3-store-prefetch-file.html"><code>nix store prefetch-file</code></a> - download a file into the Nix store</li>
<li><a href="command-ref/new-cli/./nix3-store-repair.html"><code>nix store repair</code></a> - repair store paths</li>
<li><a href="command-ref/new-cli/./nix3-store-sign.html"><code>nix store sign</code></a> - sign store paths with a local key</li>
<li><a href="command-ref/new-cli/./nix3-store-verify.html"><code>nix store verify</code></a> - verify the integrity of store paths</li>
</ul>
<h1 id="options-108"><a class="header" href="#options-108">Options</a></h1>
<h2 id="logging-related-options-69"><a class="header" href="#logging-related-options-69">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-69"><a class="header" href="#miscellaneous-global-options-69">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-112"><a class="header" href="#name-112">Name</a></h1>
<p><code>nix store add</code> - Add a file or directory to the Nix store</p>
<h1 id="synopsis-112"><a class="header" href="#synopsis-112">Synopsis</a></h1>
<p><code>nix store add</code> [<em>option</em>...] <em>path</em></p>
<h1 id="description-95"><a class="header" href="#description-95">Description</a></h1>
<p>Copy <em>path</em> to the Nix store, and print the resulting store path on
standard output.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>The resulting store path is not registered as a garbage
collector root, so it could be deleted before you have a
chance to register it.</p>
</blockquote>
<h1 id="examples-78"><a class="header" href="#examples-78">Examples</a></h1>
<p>Add a directory to the store:</p>
<pre><code class="language-console"># mkdir dir
# echo foo &gt; dir/bar

# nix store add ./dir
/nix/store/6pmjx56pm94n66n4qw1nff0y1crm8nqg-dir

# cat /nix/store/6pmjx56pm94n66n4qw1nff0y1crm8nqg-dir/bar
foo
</code></pre>
<h1 id="options-109"><a class="header" href="#options-109">Options</a></h1>
<ul>
<li>
<p><span id="opt-dry-run"><a href="command-ref/new-cli/nix3-store-add.html#opt-dry-run"><code>--dry-run</code></a></span></p>
<p>Show what this command would do without doing it.</p>
</li>
<li>
<p><span id="opt-hash-algo"><a href="command-ref/new-cli/nix3-store-add.html#opt-hash-algo"><code>--hash-algo</code></a></span> <em>hash-algo</em></p>
<p>Hash algorithm (<code>blake3</code>, <code>md5</code>, <code>sha1</code>, <code>sha256</code>, or <code>sha512</code>).</p>
</li>
<li>
<p><span id="opt-mode"><a href="command-ref/new-cli/nix3-store-add.html#opt-mode"><code>--mode</code></a></span> <em>content-address-method</em></p>
<p>How to compute the content-address of the store object.
One of:</p>
<ul>
<li>
<p><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-nix-archive"><code>nar</code></a>
(the default):
Serialises the input as a
<a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive</a>
and passes that to the hash function.</p>
</li>
<li>
<p><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-flat"><code>flat</code></a>:
Assumes that the input is a single file and
<a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-flat">directly passes</a>
it to the hash function.</p>
</li>
<li>
<p><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-text"><code>text</code></a>:
Like <code>flat</code>, but used for
<a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">derivations</a> serialized in store object and
<a href="command-ref/new-cli/../../language/builtins.html#builtins-toFile"><code>builtins.toFile</code></a>.
For advanced use-cases only;
for regular usage prefer <code>nar</code> and <code>flat</code>.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-name"><a href="command-ref/new-cli/nix3-store-add.html#opt-name"><code>--name</code></a></span> / <code>-n</code> <em>name</em></p>
<p>Override the name component of the store path. It defaults to the base name of <em>path</em>.</p>
</li>
</ul>
<h2 id="logging-related-options-70"><a class="header" href="#logging-related-options-70">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-add.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-add.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-add.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-add.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-add.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-70"><a class="header" href="#miscellaneous-global-options-70">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-add.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-add.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-add.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-add.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-add.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-113"><a class="header" href="#name-113">Name</a></h1>
<p><code>nix store add-file</code> - Deprecated. Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-store-add.html"><code>nix store add --mode flat</code></a> instead.</p>
<h1 id="synopsis-113"><a class="header" href="#synopsis-113">Synopsis</a></h1>
<p><code>nix store add-file</code> [<em>option</em>...] <em>path</em></p>
<h1 id="options-110"><a class="header" href="#options-110">Options</a></h1>
<ul>
<li>
<p><span id="opt-dry-run"><a href="command-ref/new-cli/nix3-store-add-file.html#opt-dry-run"><code>--dry-run</code></a></span></p>
<p>Show what this command would do without doing it.</p>
</li>
<li>
<p><span id="opt-hash-algo"><a href="command-ref/new-cli/nix3-store-add-file.html#opt-hash-algo"><code>--hash-algo</code></a></span> <em>hash-algo</em></p>
<p>Hash algorithm (<code>blake3</code>, <code>md5</code>, <code>sha1</code>, <code>sha256</code>, or <code>sha512</code>).</p>
</li>
<li>
<p><span id="opt-mode"><a href="command-ref/new-cli/nix3-store-add-file.html#opt-mode"><code>--mode</code></a></span> <em>content-address-method</em></p>
<p>How to compute the content-address of the store object.
One of:</p>
<ul>
<li>
<p><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-nix-archive"><code>nar</code></a>
(the default):
Serialises the input as a
<a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive</a>
and passes that to the hash function.</p>
</li>
<li>
<p><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-flat"><code>flat</code></a>:
Assumes that the input is a single file and
<a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-flat">directly passes</a>
it to the hash function.</p>
</li>
<li>
<p><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-text"><code>text</code></a>:
Like <code>flat</code>, but used for
<a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">derivations</a> serialized in store object and
<a href="command-ref/new-cli/../../language/builtins.html#builtins-toFile"><code>builtins.toFile</code></a>.
For advanced use-cases only;
for regular usage prefer <code>nar</code> and <code>flat</code>.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-name"><a href="command-ref/new-cli/nix3-store-add-file.html#opt-name"><code>--name</code></a></span> / <code>-n</code> <em>name</em></p>
<p>Override the name component of the store path. It defaults to the base name of <em>path</em>.</p>
</li>
</ul>
<h2 id="logging-related-options-71"><a class="header" href="#logging-related-options-71">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-add-file.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-add-file.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-add-file.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-add-file.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-add-file.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-71"><a class="header" href="#miscellaneous-global-options-71">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-add-file.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-add-file.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-add-file.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-add-file.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-add-file.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-114"><a class="header" href="#name-114">Name</a></h1>
<p><code>nix store add-path</code> - Deprecated alias to <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-store-add.html"><code>nix store add</code></a>.</p>
<h1 id="synopsis-114"><a class="header" href="#synopsis-114">Synopsis</a></h1>
<p><code>nix store add-path</code> [<em>option</em>...] <em>path</em></p>
<h1 id="options-111"><a class="header" href="#options-111">Options</a></h1>
<ul>
<li>
<p><span id="opt-dry-run"><a href="command-ref/new-cli/nix3-store-add-path.html#opt-dry-run"><code>--dry-run</code></a></span></p>
<p>Show what this command would do without doing it.</p>
</li>
<li>
<p><span id="opt-hash-algo"><a href="command-ref/new-cli/nix3-store-add-path.html#opt-hash-algo"><code>--hash-algo</code></a></span> <em>hash-algo</em></p>
<p>Hash algorithm (<code>blake3</code>, <code>md5</code>, <code>sha1</code>, <code>sha256</code>, or <code>sha512</code>).</p>
</li>
<li>
<p><span id="opt-mode"><a href="command-ref/new-cli/nix3-store-add-path.html#opt-mode"><code>--mode</code></a></span> <em>content-address-method</em></p>
<p>How to compute the content-address of the store object.
One of:</p>
<ul>
<li>
<p><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-nix-archive"><code>nar</code></a>
(the default):
Serialises the input as a
<a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive</a>
and passes that to the hash function.</p>
</li>
<li>
<p><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-flat"><code>flat</code></a>:
Assumes that the input is a single file and
<a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-flat">directly passes</a>
it to the hash function.</p>
</li>
<li>
<p><a href="command-ref/new-cli/../../store/store-object/content-address.html#method-text"><code>text</code></a>:
Like <code>flat</code>, but used for
<a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">derivations</a> serialized in store object and
<a href="command-ref/new-cli/../../language/builtins.html#builtins-toFile"><code>builtins.toFile</code></a>.
For advanced use-cases only;
for regular usage prefer <code>nar</code> and <code>flat</code>.</p>
</li>
</ul>
</li>
<li>
<p><span id="opt-name"><a href="command-ref/new-cli/nix3-store-add-path.html#opt-name"><code>--name</code></a></span> / <code>-n</code> <em>name</em></p>
<p>Override the name component of the store path. It defaults to the base name of <em>path</em>.</p>
</li>
</ul>
<h2 id="logging-related-options-72"><a class="header" href="#logging-related-options-72">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-add-path.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-add-path.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-add-path.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-add-path.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-add-path.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-72"><a class="header" href="#miscellaneous-global-options-72">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-add-path.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-add-path.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-add-path.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-add-path.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-add-path.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-115"><a class="header" href="#name-115">Name</a></h1>
<p><code>nix store cat</code> - print the contents of a file in the Nix store on stdout</p>
<h1 id="synopsis-115"><a class="header" href="#synopsis-115">Synopsis</a></h1>
<p><code>nix store cat</code> [<em>option</em>...] <em>path</em></p>
<h1 id="examples-79"><a class="header" href="#examples-79">Examples</a></h1>
<ul>
<li>
<p>Show the contents of a file in a binary cache:</p>
<pre><code class="language-console"># nix store cat --store https://cache.nixos.org/ \
    /nix/store/0i2jd68mp5g6h2sa5k9c85rb80sn8hi9-hello-2.10/bin/hello | hexdump -C | head -n1
00000000  7f 45 4c 46 02 01 01 00  00 00 00 00 00 00 00 00  |.ELF............|
</code></pre>
</li>
</ul>
<h1 id="description-96"><a class="header" href="#description-96">Description</a></h1>
<p>This command prints on standard output the contents of the regular
file <em>path</em> in a Nix store. <em>path</em> can be a top-level store path or
any file inside a store path.</p>
<h1 id="options-112"><a class="header" href="#options-112">Options</a></h1>
<h2 id="logging-related-options-73"><a class="header" href="#logging-related-options-73">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-cat.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-cat.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-cat.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-cat.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-cat.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-73"><a class="header" href="#miscellaneous-global-options-73">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-cat.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-cat.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-cat.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-cat.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-cat.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-116"><a class="header" href="#name-116">Name</a></h1>
<p><code>nix store copy-log</code> - copy build logs between Nix stores</p>
<h1 id="synopsis-116"><a class="header" href="#synopsis-116">Synopsis</a></h1>
<p><code>nix store copy-log</code> [<em>option</em>...] <em>installables</em>...</p>
<h1 id="examples-80"><a class="header" href="#examples-80">Examples</a></h1>
<ul>
<li>
<p>To copy the build log of the <code>hello</code> package from
https://cache.nixos.org to the local store:</p>
<pre><code class="language-console"># nix store copy-log --from https://cache.nixos.org --eval-store auto nixpkgs#hello
</code></pre>
<p>You can verify that the log is available locally:</p>
<pre><code class="language-console"># nix log --substituters '' nixpkgs#hello
</code></pre>
<p>(The flag <code>--substituters ''</code> avoids querying
<code>https://cache.nixos.org</code> for the log.)</p>
</li>
<li>
<p>To copy the log for a specific <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> via SSH:</p>
<pre><code class="language-console"># nix store copy-log --to ssh-ng://machine /nix/store/ilgm50plpmcgjhcp33z6n4qbnpqfhxym-glibc-2.33-59.drv
</code></pre>
</li>
</ul>
<h1 id="description-97"><a class="header" href="#description-97">Description</a></h1>
<p><code>nix store copy-log</code> copies build logs between two Nix stores. The
source store is specified using <code>--from</code> and the destination using
<code>--to</code>. If one of these is omitted, it defaults to the local store.</p>
<h1 id="options-113"><a class="header" href="#options-113">Options</a></h1>
<ul>
<li>
<p><span id="opt-from"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-from"><code>--from</code></a></span> <em>store-uri</em></p>
<p>URL of the source Nix store.</p>
</li>
<li>
<p><span id="opt-stdin"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-stdin"><code>--stdin</code></a></span></p>
<p>Read installables from the standard input. No default installable applied.</p>
</li>
<li>
<p><span id="opt-to"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-to"><code>--to</code></a></span> <em>store-uri</em></p>
<p>URL of the destination Nix store.</p>
</li>
</ul>
<h2 id="common-evaluation-options-34"><a class="header" href="#common-evaluation-options-34">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-27"><a class="header" href="#common-flake-related-options-27">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-74"><a class="header" href="#logging-related-options-74">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-74"><a class="header" href="#miscellaneous-global-options-74">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-18"><a class="header" href="#options-that-change-the-interpretation-of-installables-18">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-store-copy-log.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-117"><a class="header" href="#name-117">Name</a></h1>
<p><code>nix store copy-sigs</code> - copy store path signatures from substituters</p>
<h1 id="synopsis-117"><a class="header" href="#synopsis-117">Synopsis</a></h1>
<p><code>nix store copy-sigs</code> [<em>option</em>...] <em>installables</em>...</p>
<h1 id="options-114"><a class="header" href="#options-114">Options</a></h1>
<ul>
<li>
<p><span id="opt-stdin"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-stdin"><code>--stdin</code></a></span></p>
<p>Read installables from the standard input. No default installable applied.</p>
</li>
<li>
<p><span id="opt-substituter"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-substituter"><code>--substituter</code></a></span> / <code>-s</code> <em>store-uri</em></p>
<p>Copy signatures from the specified store.</p>
</li>
</ul>
<h2 id="common-evaluation-options-35"><a class="header" href="#common-evaluation-options-35">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-28"><a class="header" href="#common-flake-related-options-28">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-75"><a class="header" href="#logging-related-options-75">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-75"><a class="header" href="#miscellaneous-global-options-75">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-19"><a class="header" href="#options-that-change-the-interpretation-of-installables-19">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-all"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-all"><code>--all</code></a></span></p>
<p>Apply the operation to every store path.</p>
</li>
<li>
<p><span id="opt-derivation"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-derivation"><code>--derivation</code></a></span></p>
<p>Operate on the <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> rather than its outputs.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
<li>
<p><span id="opt-recursive"><a href="command-ref/new-cli/nix3-store-copy-sigs.html#opt-recursive"><code>--recursive</code></a></span> / <code>-r</code></p>
<p>Apply operation to closure of the specified paths.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-118"><a class="header" href="#name-118">Name</a></h1>
<p><code>nix store delete</code> - delete paths from the Nix store</p>
<h1 id="synopsis-118"><a class="header" href="#synopsis-118">Synopsis</a></h1>
<p><code>nix store delete</code> [<em>option</em>...] <em>installables</em>...</p>
<h1 id="examples-81"><a class="header" href="#examples-81">Examples</a></h1>
<ul>
<li>
<p>Delete a specific store path:</p>
<pre><code class="language-console"># nix store delete /nix/store/yb5q57zxv6hgqql42d5r8b5k5mcq6kay-hello-2.10
</code></pre>
</li>
</ul>
<h1 id="description-98"><a class="header" href="#description-98">Description</a></h1>
<p>This command deletes the store paths specified by <a href="command-ref/new-cli/./nix.html#installables"><em>installables</em></a>,
but only if it is safe to do so; that is, when the path is not
reachable from a root of the garbage collector. This means that you
can only delete paths that would also be deleted by <code>nix store gc</code>. Thus, <code>nix store delete</code> is a more targeted version of <code>nix store gc</code>.</p>
<p>With the option <code>--ignore-liveness</code>, reachability from the roots is
ignored. However, the path still won't be deleted if there are other
paths in the store that refer to it (i.e., depend on it).</p>
<h1 id="options-115"><a class="header" href="#options-115">Options</a></h1>
<ul>
<li>
<p><span id="opt-ignore-liveness"><a href="command-ref/new-cli/nix3-store-delete.html#opt-ignore-liveness"><code>--ignore-liveness</code></a></span></p>
<p>Do not check whether the paths are reachable from a root.</p>
</li>
<li>
<p><span id="opt-stdin"><a href="command-ref/new-cli/nix3-store-delete.html#opt-stdin"><code>--stdin</code></a></span></p>
<p>Read installables from the standard input. No default installable applied.</p>
</li>
</ul>
<h2 id="common-evaluation-options-36"><a class="header" href="#common-evaluation-options-36">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-store-delete.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-store-delete.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-store-delete.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-store-delete.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-store-delete.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-store-delete.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-store-delete.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-store-delete.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-store-delete.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-29"><a class="header" href="#common-flake-related-options-29">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-store-delete.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-store-delete.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-store-delete.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-store-delete.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-store-delete.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-store-delete.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-store-delete.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-store-delete.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-store-delete.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-store-delete.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-76"><a class="header" href="#logging-related-options-76">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-delete.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-delete.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-delete.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-delete.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-delete.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-76"><a class="header" href="#miscellaneous-global-options-76">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-delete.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-delete.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-delete.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-delete.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-store-delete.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-delete.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-20"><a class="header" href="#options-that-change-the-interpretation-of-installables-20">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-all"><a href="command-ref/new-cli/nix3-store-delete.html#opt-all"><code>--all</code></a></span></p>
<p>Apply the operation to every store path.</p>
</li>
<li>
<p><span id="opt-derivation"><a href="command-ref/new-cli/nix3-store-delete.html#opt-derivation"><code>--derivation</code></a></span></p>
<p>Operate on the <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> rather than its outputs.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-store-delete.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-store-delete.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
<li>
<p><span id="opt-recursive"><a href="command-ref/new-cli/nix3-store-delete.html#opt-recursive"><code>--recursive</code></a></span> / <code>-r</code></p>
<p>Apply operation to closure of the specified paths.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-119"><a class="header" href="#name-119">Name</a></h1>
<p><code>nix store diff-closures</code> - show what packages and versions were added and removed between two closures</p>
<h1 id="synopsis-119"><a class="header" href="#synopsis-119">Synopsis</a></h1>
<p><code>nix store diff-closures</code> [<em>option</em>...] <em>before</em> <em>after</em></p>
<h1 id="examples-82"><a class="header" href="#examples-82">Examples</a></h1>
<ul>
<li>
<p>Show what got added and removed between two versions of the NixOS
system profile:</p>
<pre><code class="language-console"># nix store diff-closures /nix/var/nix/profiles/system-655-link /nix/var/nix/profiles/system-658-link
acpi-call: 2020-04-07-5.8.16 → 2020-04-07-5.8.18
baloo-widgets: 20.08.1 → 20.08.2
bluez-qt: +12.6 KiB
dolphin: 20.08.1 → 20.08.2, +13.9 KiB
kdeconnect: 20.08.2 → ∅, -6597.8 KiB
kdeconnect-kde: ∅ → 20.08.2, +6599.7 KiB
…
</code></pre>
</li>
</ul>
<h1 id="description-99"><a class="header" href="#description-99">Description</a></h1>
<p>This command shows the differences between the two closures <em>before</em>
and <em>after</em> with respect to the addition, removal, or version change
of packages, as well as changes in store path sizes.</p>
<p>For each package name in the two closures (where a package name is
defined as the name component of a store path excluding the version),
if there is a change in the set of versions of the package, or a
change in the size of the store paths of more than 8 KiB, it prints a
line like this:</p>
<pre><code class="language-console">dolphin: 20.08.1 → 20.08.2, +13.9 KiB
</code></pre>
<p>No size change is shown if it's below the threshold. If the package
does not exist in either the <em>before</em> or <em>after</em> closures, it is
represented using <code>∅</code> (empty set) on the appropriate side of the
arrow. If a package has an empty version string, the version is
rendered as <code>ε</code> (epsilon).</p>
<p>There may be multiple versions of a package in each closure. In that
case, only the changed versions are shown. Thus,</p>
<pre><code class="language-console">libfoo: 1.2, 1.3 → 1.4
</code></pre>
<p>leaves open the possibility that there are other versions (e.g. <code>1.1</code>)
that exist in both closures.</p>
<h1 id="options-116"><a class="header" href="#options-116">Options</a></h1>
<h2 id="common-evaluation-options-37"><a class="header" href="#common-evaluation-options-37">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-30"><a class="header" href="#common-flake-related-options-30">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-77"><a class="header" href="#logging-related-options-77">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-77"><a class="header" href="#miscellaneous-global-options-77">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-21"><a class="header" href="#options-that-change-the-interpretation-of-installables-21">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-derivation"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-derivation"><code>--derivation</code></a></span></p>
<p>Operate on the <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> rather than its outputs.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-store-diff-closures.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-120"><a class="header" href="#name-120">Name</a></h1>
<p><code>nix store dump-path</code> - serialise a store path to stdout in NAR format</p>
<h1 id="synopsis-120"><a class="header" href="#synopsis-120">Synopsis</a></h1>
<p><code>nix store dump-path</code> [<em>option</em>...] <em>installables</em>...</p>
<h1 id="examples-83"><a class="header" href="#examples-83">Examples</a></h1>
<ul>
<li>
<p>To get a NAR containing the GNU Hello package:</p>
<pre><code class="language-console"># nix store dump-path nixpkgs#hello &gt; hello.nar
</code></pre>
</li>
<li>
<p>To get a NAR from the binary cache https://cache.nixos.org/:</p>
<pre><code class="language-console"># nix store dump-path --store https://cache.nixos.org/ \
    /nix/store/7crrmih8c52r8fbnqb933dxrsp44md93-glibc-2.25 &gt; glibc.nar
</code></pre>
</li>
</ul>
<h1 id="description-100"><a class="header" href="#description-100">Description</a></h1>
<p>This command generates a <a href="command-ref/new-cli/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive (NAR)</a> file containing the serialisation of the
store path <a href="command-ref/new-cli/./nix.html#installables"><em>installable</em></a>. The NAR is written to standard output.</p>
<h1 id="options-117"><a class="header" href="#options-117">Options</a></h1>
<ul>
<li>
<p><span id="opt-stdin"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-stdin"><code>--stdin</code></a></span></p>
<p>Read installables from the standard input. No default installable applied.</p>
</li>
</ul>
<h2 id="common-evaluation-options-38"><a class="header" href="#common-evaluation-options-38">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-31"><a class="header" href="#common-flake-related-options-31">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-78"><a class="header" href="#logging-related-options-78">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-78"><a class="header" href="#miscellaneous-global-options-78">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-22"><a class="header" href="#options-that-change-the-interpretation-of-installables-22">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-all"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-all"><code>--all</code></a></span></p>
<p>Apply the operation to every store path.</p>
</li>
<li>
<p><span id="opt-derivation"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-derivation"><code>--derivation</code></a></span></p>
<p>Operate on the <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> rather than its outputs.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
<li>
<p><span id="opt-recursive"><a href="command-ref/new-cli/nix3-store-dump-path.html#opt-recursive"><code>--recursive</code></a></span> / <code>-r</code></p>
<p>Apply operation to closure of the specified paths.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-121"><a class="header" href="#name-121">Name</a></h1>
<p><code>nix store gc</code> - perform garbage collection on a Nix store</p>
<h1 id="synopsis-121"><a class="header" href="#synopsis-121">Synopsis</a></h1>
<p><code>nix store gc</code> [<em>option</em>...]</p>
<h1 id="examples-84"><a class="header" href="#examples-84">Examples</a></h1>
<ul>
<li>
<p>Delete unreachable paths in the Nix store:</p>
<pre><code class="language-console"># nix store gc
</code></pre>
</li>
<li>
<p>Delete up to 1 gigabyte of garbage:</p>
<pre><code class="language-console"># nix store gc --max 1G
</code></pre>
</li>
</ul>
<h1 id="description-101"><a class="header" href="#description-101">Description</a></h1>
<p>This command deletes unreachable paths in the Nix store.</p>
<h1 id="options-118"><a class="header" href="#options-118">Options</a></h1>
<ul>
<li>
<p><span id="opt-dry-run"><a href="command-ref/new-cli/nix3-store-gc.html#opt-dry-run"><code>--dry-run</code></a></span></p>
<p>Show what this command would do without doing it.</p>
</li>
<li>
<p><span id="opt-max"><a href="command-ref/new-cli/nix3-store-gc.html#opt-max"><code>--max</code></a></span> <em>n</em></p>
<p>Stop after freeing <em>n</em> bytes of disk space.</p>
</li>
</ul>
<h2 id="logging-related-options-79"><a class="header" href="#logging-related-options-79">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-gc.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-gc.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-gc.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-gc.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-gc.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-79"><a class="header" href="#miscellaneous-global-options-79">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-gc.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-gc.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-gc.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-gc.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-gc.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-122"><a class="header" href="#name-122">Name</a></h1>
<p><code>nix store info</code> - test whether a store can be accessed</p>
<h1 id="synopsis-122"><a class="header" href="#synopsis-122">Synopsis</a></h1>
<p><code>nix store info</code> [<em>option</em>...]</p>
<h1 id="examples-85"><a class="header" href="#examples-85">Examples</a></h1>
<ul>
<li>
<p>Test whether connecting to a remote Nix store via SSH works:</p>
<pre><code class="language-console"># nix store info --store ssh://mac1
</code></pre>
</li>
<li>
<p>Test whether a URL is a valid binary cache:</p>
<pre><code class="language-console"># nix store info --store https://cache.nixos.org
</code></pre>
</li>
<li>
<p>Test whether the Nix daemon is up and running:</p>
<pre><code class="language-console"># nix store info --store daemon
</code></pre>
</li>
</ul>
<h1 id="description-102"><a class="header" href="#description-102">Description</a></h1>
<p>This command tests whether a particular Nix store (specified by the
argument <code>--store</code> <em>url</em>) can be accessed. What this means is
dependent on the type of the store. For instance, for an SSH store it
means that Nix can connect to the specified machine.</p>
<p>If the command succeeds, Nix returns a exit code of 0 and does not
print any output.</p>
<h1 id="options-119"><a class="header" href="#options-119">Options</a></h1>
<ul>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-store-info.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
</ul>
<h2 id="logging-related-options-80"><a class="header" href="#logging-related-options-80">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-info.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-info.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-info.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-info.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-info.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-80"><a class="header" href="#miscellaneous-global-options-80">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-info.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-info.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-info.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-info.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-info.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-123"><a class="header" href="#name-123">Name</a></h1>
<p><code>nix store ls</code> - show information about a path in the Nix store</p>
<h1 id="synopsis-123"><a class="header" href="#synopsis-123">Synopsis</a></h1>
<p><code>nix store ls</code> [<em>option</em>...] <em>path</em></p>
<h1 id="examples-86"><a class="header" href="#examples-86">Examples</a></h1>
<ul>
<li>
<p>To list the contents of a store path in a binary cache:</p>
<pre><code class="language-console"># nix store ls --store https://cache.nixos.org/ --long --recursive /nix/store/0i2jd68mp5g6h2sa5k9c85rb80sn8hi9-hello-2.10
dr-xr-xr-x                    0 ./bin
-r-xr-xr-x                38184 ./bin/hello
dr-xr-xr-x                    0 ./share
…
</code></pre>
</li>
<li>
<p>To show information about a specific file in a binary cache:</p>
<pre><code class="language-console"># nix store ls --store https://cache.nixos.org/ --long /nix/store/0i2jd68mp5g6h2sa5k9c85rb80sn8hi9-hello-2.10/bin/hello
-r-xr-xr-x                38184 hello
</code></pre>
</li>
</ul>
<h1 id="description-103"><a class="header" href="#description-103">Description</a></h1>
<p>This command shows information about <em>path</em> in a Nix store. <em>path</em> can
be a top-level store path or any file inside a store path.</p>
<h1 id="options-120"><a class="header" href="#options-120">Options</a></h1>
<ul>
<li>
<p><span id="opt-directory"><a href="command-ref/new-cli/nix3-store-ls.html#opt-directory"><code>--directory</code></a></span> / <code>-d</code></p>
<p>Show directories rather than their contents.</p>
</li>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-store-ls.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
<li>
<p><span id="opt-long"><a href="command-ref/new-cli/nix3-store-ls.html#opt-long"><code>--long</code></a></span> / <code>-l</code></p>
<p>Show detailed file information.</p>
</li>
<li>
<p><span id="opt-recursive"><a href="command-ref/new-cli/nix3-store-ls.html#opt-recursive"><code>--recursive</code></a></span> / <code>-R</code></p>
<p>List subdirectories recursively.</p>
</li>
</ul>
<h2 id="logging-related-options-81"><a class="header" href="#logging-related-options-81">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-ls.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-ls.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-ls.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-ls.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-ls.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-81"><a class="header" href="#miscellaneous-global-options-81">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-ls.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-ls.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-ls.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-ls.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-ls.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-124"><a class="header" href="#name-124">Name</a></h1>
<p><code>nix store make-content-addressed</code> - rewrite a path or closure to content-addressed form</p>
<h1 id="synopsis-124"><a class="header" href="#synopsis-124">Synopsis</a></h1>
<p><code>nix store make-content-addressed</code> [<em>option</em>...] <em>installables</em>...</p>
<h1 id="examples-87"><a class="header" href="#examples-87">Examples</a></h1>
<ul>
<li>
<p>Create a content-addressed representation of the closure of GNU Hello:</p>
<pre><code class="language-console"># nix store make-content-addressed nixpkgs#hello
…
rewrote '/nix/store/v5sv61sszx301i0x6xysaqzla09nksnd-hello-2.10' to '/nix/store/5skmmcb9svys5lj3kbsrjg7vf2irid63-hello-2.10'
</code></pre>
<p>Since the resulting paths are content-addressed, they are always
trusted and don't need signatures to copied to another store:</p>
<pre><code class="language-console"># nix copy --to /tmp/nix --trusted-public-keys '' /nix/store/5skmmcb9svys5lj3kbsrjg7vf2irid63-hello-2.10
</code></pre>
<p>By contrast, the original closure is input-addressed, so it does
need signatures to be trusted:</p>
<pre><code class="language-console"># nix copy --to /tmp/nix --trusted-public-keys '' nixpkgs#hello
cannot add path '/nix/store/zy9wbxwcygrwnh8n2w9qbbcr6zk87m26-libunistring-0.9.10' because it lacks a signature by a trusted key
</code></pre>
</li>
<li>
<p>Create a content-addressed representation of the current NixOS
system closure:</p>
<pre><code class="language-console"># nix store make-content-addressed /run/current-system
</code></pre>
</li>
</ul>
<h1 id="description-104"><a class="header" href="#description-104">Description</a></h1>
<p>This command converts the closure of the store paths specified by
<a href="command-ref/new-cli/./nix.html#installables"><em>installables</em></a> to content-addressed form.</p>
<p>Nix store paths are usually
<em>input-addressed</em>, meaning that the hash part of the store path is
computed from the contents of the derivation (i.e., the build-time
dependency graph). Input-addressed paths need to be signed by a
trusted key if you want to import them into a store, because we need
to trust that the contents of the path were actually built by the
derivation.</p>
<p>By contrast, in a <em>content-addressed</em> path, the hash part is computed
from the contents of the path. This allows the contents of the path to
be verified without any additional information such as
signatures. This means that a command like</p>
<pre><code class="language-console"># nix store build /nix/store/5skmmcb9svys5lj3kbsrjg7vf2irid63-hello-2.10 \
    --substituters https://my-cache.example.org
</code></pre>
<p>will succeed even if the binary cache <code>https://my-cache.example.org</code>
doesn't present any signatures.</p>
<h1 id="options-121"><a class="header" href="#options-121">Options</a></h1>
<ul>
<li>
<p><span id="opt-from"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-from"><code>--from</code></a></span> <em>store-uri</em></p>
<p>URL of the source Nix store.</p>
</li>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
<li>
<p><span id="opt-stdin"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-stdin"><code>--stdin</code></a></span></p>
<p>Read installables from the standard input. No default installable applied.</p>
</li>
<li>
<p><span id="opt-to"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-to"><code>--to</code></a></span> <em>store-uri</em></p>
<p>URL of the destination Nix store.</p>
</li>
</ul>
<h2 id="common-evaluation-options-39"><a class="header" href="#common-evaluation-options-39">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-32"><a class="header" href="#common-flake-related-options-32">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-82"><a class="header" href="#logging-related-options-82">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-82"><a class="header" href="#miscellaneous-global-options-82">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-23"><a class="header" href="#options-that-change-the-interpretation-of-installables-23">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-all"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-all"><code>--all</code></a></span></p>
<p>Apply the operation to every store path.</p>
</li>
<li>
<p><span id="opt-derivation"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-derivation"><code>--derivation</code></a></span></p>
<p>Operate on the <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> rather than its outputs.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
<li>
<p><span id="opt-recursive"><a href="command-ref/new-cli/nix3-store-make-content-addressed.html#opt-recursive"><code>--recursive</code></a></span> / <code>-r</code></p>
<p>Apply operation to closure of the specified paths.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-125"><a class="header" href="#name-125">Name</a></h1>
<p><code>nix store optimise</code> - replace identical files in the store by hard links</p>
<h1 id="synopsis-125"><a class="header" href="#synopsis-125">Synopsis</a></h1>
<p><code>nix store optimise</code> [<em>option</em>...]</p>
<h1 id="examples-88"><a class="header" href="#examples-88">Examples</a></h1>
<ul>
<li>
<p>Optimise the Nix store:</p>
<pre><code class="language-console">nix store optimise
</code></pre>
</li>
</ul>
<h1 id="description-105"><a class="header" href="#description-105">Description</a></h1>
<p>This command deduplicates the Nix store: it scans the store for
regular files with identical contents, and replaces them with hard
links to a single instance.</p>
<p>Note that you can also set <code>auto-optimise-store</code> to <code>true</code> in
<code>nix.conf</code> to perform this optimisation incrementally whenever a new
path is added to the Nix store. To make this efficient, Nix maintains
a content-addressed index of all the files in the Nix store in the
directory <code>/nix/store/.links/</code>.</p>
<h1 id="options-122"><a class="header" href="#options-122">Options</a></h1>
<h2 id="logging-related-options-83"><a class="header" href="#logging-related-options-83">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-optimise.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-optimise.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-optimise.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-optimise.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-optimise.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-83"><a class="header" href="#miscellaneous-global-options-83">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-optimise.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-optimise.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-optimise.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-optimise.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-optimise.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-126"><a class="header" href="#name-126">Name</a></h1>
<p><code>nix store path-from-hash-part</code> - get a store path from its hash part</p>
<h1 id="synopsis-126"><a class="header" href="#synopsis-126">Synopsis</a></h1>
<p><code>nix store path-from-hash-part</code> [<em>option</em>...] <em>hash-part</em></p>
<h1 id="examples-89"><a class="header" href="#examples-89">Examples</a></h1>
<ul>
<li>
<p>Return the full store path with the given hash part:</p>
<pre><code class="language-console"># nix store path-from-hash-part --store https://cache.nixos.org/ 0i2jd68mp5g6h2sa5k9c85rb80sn8hi9
/nix/store/0i2jd68mp5g6h2sa5k9c85rb80sn8hi9-hello-2.10
</code></pre>
</li>
</ul>
<h1 id="description-106"><a class="header" href="#description-106">Description</a></h1>
<p>Given the hash part of a store path (that is, the 32 characters
following <code>/nix/store/</code>), return the full store path. This is
primarily useful in the implementation of binary caches, where a
request for a <code>.narinfo</code> file only supplies the hash part
(e.g. <code>https://cache.nixos.org/0i2jd68mp5g6h2sa5k9c85rb80sn8hi9.narinfo</code>).</p>
<h1 id="options-123"><a class="header" href="#options-123">Options</a></h1>
<h2 id="logging-related-options-84"><a class="header" href="#logging-related-options-84">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-path-from-hash-part.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-path-from-hash-part.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-path-from-hash-part.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-path-from-hash-part.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-path-from-hash-part.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-84"><a class="header" href="#miscellaneous-global-options-84">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-path-from-hash-part.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-path-from-hash-part.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-path-from-hash-part.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-path-from-hash-part.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-path-from-hash-part.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-127"><a class="header" href="#name-127">Name</a></h1>
<p><code>nix store ping</code> - test whether a store can be accessed</p>
<h1 id="synopsis-127"><a class="header" href="#synopsis-127">Synopsis</a></h1>
<p><code>nix store ping</code> [<em>option</em>...]</p>
<h1 id="examples-90"><a class="header" href="#examples-90">Examples</a></h1>
<ul>
<li>
<p>Test whether connecting to a remote Nix store via SSH works:</p>
<pre><code class="language-console"># nix store info --store ssh://mac1
</code></pre>
</li>
<li>
<p>Test whether a URL is a valid binary cache:</p>
<pre><code class="language-console"># nix store info --store https://cache.nixos.org
</code></pre>
</li>
<li>
<p>Test whether the Nix daemon is up and running:</p>
<pre><code class="language-console"># nix store info --store daemon
</code></pre>
</li>
</ul>
<h1 id="description-107"><a class="header" href="#description-107">Description</a></h1>
<p>This command tests whether a particular Nix store (specified by the
argument <code>--store</code> <em>url</em>) can be accessed. What this means is
dependent on the type of the store. For instance, for an SSH store it
means that Nix can connect to the specified machine.</p>
<p>If the command succeeds, Nix returns a exit code of 0 and does not
print any output.</p>
<h1 id="options-124"><a class="header" href="#options-124">Options</a></h1>
<ul>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-store-ping.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
</ul>
<h2 id="logging-related-options-85"><a class="header" href="#logging-related-options-85">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-ping.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-ping.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-ping.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-ping.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-ping.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-85"><a class="header" href="#miscellaneous-global-options-85">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-ping.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-ping.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-ping.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-ping.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-ping.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-128"><a class="header" href="#name-128">Name</a></h1>
<p><code>nix store prefetch-file</code> - download a file into the Nix store</p>
<h1 id="synopsis-128"><a class="header" href="#synopsis-128">Synopsis</a></h1>
<p><code>nix store prefetch-file</code> [<em>option</em>...] <em>url</em></p>
<h1 id="examples-91"><a class="header" href="#examples-91">Examples</a></h1>
<ul>
<li>
<p>Download a file to the Nix store:</p>
<pre><code class="language-console"># nix store prefetch-file https://releases.nixos.org/nix/nix-2.3.10/nix-2.3.10.tar.xz
Downloaded 'https://releases.nixos.org/nix/nix-2.3.10/nix-2.3.10.tar.xz' to
'/nix/store/vbdbi42hgnc4h7pyqzp6h2yf77kw93aw-source' (hash
'sha256-qKheVd5D0BervxMDbt+1hnTKE2aRWC8XCAwc0SeHt6s=').
</code></pre>
</li>
<li>
<p>Download a file and get the SHA-512 hash:</p>
<pre><code class="language-console"># nix store prefetch-file --json --hash-type sha512 \
    https://releases.nixos.org/nix/nix-2.3.10/nix-2.3.10.tar.xz \
  | jq -r .hash
sha512-6XJxfym0TNH9knxeH4ZOvns6wElFy3uahunl2hJgovACCMEMXSy42s69zWVyGJALXTI+86tpDJGlIcAySEKBbA==
</code></pre>
</li>
</ul>
<h1 id="description-108"><a class="header" href="#description-108">Description</a></h1>
<p>This command downloads the file <em>url</em> to the Nix store. It prints out
the resulting store path and the cryptographic hash of the contents of
the file.</p>
<p>The name component of the store path defaults to the last component of
<em>url</em>, but this can be overridden using <code>--name</code>.</p>
<h1 id="options-125"><a class="header" href="#options-125">Options</a></h1>
<ul>
<li>
<p><span id="opt-executable"><a href="command-ref/new-cli/nix3-store-prefetch-file.html#opt-executable"><code>--executable</code></a></span></p>
<p>Make the resulting file executable. Note that this causes the resulting hash to be a NAR hash rather than a flat file hash.</p>
</li>
<li>
<p><span id="opt-expected-hash"><a href="command-ref/new-cli/nix3-store-prefetch-file.html#opt-expected-hash"><code>--expected-hash</code></a></span> <em>hash</em></p>
<p>The expected hash of the file.</p>
</li>
<li>
<p><span id="opt-hash-type"><a href="command-ref/new-cli/nix3-store-prefetch-file.html#opt-hash-type"><code>--hash-type</code></a></span> <em>hash-algo</em></p>
<p>Hash algorithm (<code>blake3</code>, <code>md5</code>, <code>sha1</code>, <code>sha256</code>, or <code>sha512</code>).</p>
</li>
<li>
<p><span id="opt-json"><a href="command-ref/new-cli/nix3-store-prefetch-file.html#opt-json"><code>--json</code></a></span></p>
<p>Produce output in JSON format, suitable for consumption by another program.</p>
</li>
<li>
<p><span id="opt-name"><a href="command-ref/new-cli/nix3-store-prefetch-file.html#opt-name"><code>--name</code></a></span> <em>name</em></p>
<p>Override the name component of the resulting store path. It defaults to the base name of <em>url</em>.</p>
</li>
<li>
<p><span id="opt-unpack"><a href="command-ref/new-cli/nix3-store-prefetch-file.html#opt-unpack"><code>--unpack</code></a></span></p>
<p>Unpack the archive (which must be a tarball or zip file) and add the result to the Nix store.</p>
</li>
</ul>
<h2 id="logging-related-options-86"><a class="header" href="#logging-related-options-86">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-prefetch-file.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-prefetch-file.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-prefetch-file.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-prefetch-file.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-prefetch-file.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-86"><a class="header" href="#miscellaneous-global-options-86">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-prefetch-file.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-prefetch-file.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-prefetch-file.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-prefetch-file.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-prefetch-file.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-129"><a class="header" href="#name-129">Name</a></h1>
<p><code>nix store repair</code> - repair store paths</p>
<h1 id="synopsis-129"><a class="header" href="#synopsis-129">Synopsis</a></h1>
<p><code>nix store repair</code> [<em>option</em>...] <em>installables</em>...</p>
<h1 id="examples-92"><a class="header" href="#examples-92">Examples</a></h1>
<ul>
<li>
<p>Repair a store path, after determining that it is corrupt:</p>
<pre><code class="language-console"># nix store verify /nix/store/yb5q57zxv6hgqql42d5r8b5k5mcq6kay-hello-2.10
path '/nix/store/yb5q57zxv6hgqql42d5r8b5k5mcq6kay-hello-2.10' was
modified! expected hash
'sha256:1hd5vnh6xjk388gdk841vflicy8qv7qzj2hb7xlyh8lpb43j921l', got
'sha256:1a25lf78x5wi6pfkrxalf0n13kdaca0bqmjqnp7wfjza2qz5ssgl'

# nix store repair /nix/store/yb5q57zxv6hgqql42d5r8b5k5mcq6kay-hello-2.10
</code></pre>
</li>
</ul>
<h1 id="description-109"><a class="header" href="#description-109">Description</a></h1>
<p>This command attempts to "repair" the store paths specified by
<a href="command-ref/new-cli/./nix.html#installables"><em>installables</em></a> by redownloading them using the available
substituters. If no substitutes are available, then repair is not
possible.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>During repair, there is a very small time window during which the old
path (if it exists) is moved out of the way and replaced with the new
path. If repair is interrupted in between, then the system may be left
in a broken state (e.g., if the path contains a critical system
component like the GNU C Library).</p>
</blockquote>
<h1 id="options-126"><a class="header" href="#options-126">Options</a></h1>
<ul>
<li>
<p><span id="opt-stdin"><a href="command-ref/new-cli/nix3-store-repair.html#opt-stdin"><code>--stdin</code></a></span></p>
<p>Read installables from the standard input. No default installable applied.</p>
</li>
</ul>
<h2 id="common-evaluation-options-40"><a class="header" href="#common-evaluation-options-40">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-store-repair.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-store-repair.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-store-repair.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-store-repair.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-store-repair.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-store-repair.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-store-repair.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-store-repair.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-store-repair.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-33"><a class="header" href="#common-flake-related-options-33">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-store-repair.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-store-repair.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-store-repair.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-store-repair.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-store-repair.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-store-repair.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-store-repair.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-store-repair.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-store-repair.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-store-repair.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-87"><a class="header" href="#logging-related-options-87">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-repair.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-repair.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-repair.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-repair.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-repair.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-87"><a class="header" href="#miscellaneous-global-options-87">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-repair.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-repair.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-repair.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-repair.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-store-repair.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-repair.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-24"><a class="header" href="#options-that-change-the-interpretation-of-installables-24">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-all"><a href="command-ref/new-cli/nix3-store-repair.html#opt-all"><code>--all</code></a></span></p>
<p>Apply the operation to every store path.</p>
</li>
<li>
<p><span id="opt-derivation"><a href="command-ref/new-cli/nix3-store-repair.html#opt-derivation"><code>--derivation</code></a></span></p>
<p>Operate on the <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> rather than its outputs.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-store-repair.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-store-repair.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
<li>
<p><span id="opt-recursive"><a href="command-ref/new-cli/nix3-store-repair.html#opt-recursive"><code>--recursive</code></a></span> / <code>-r</code></p>
<p>Apply operation to closure of the specified paths.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-130"><a class="header" href="#name-130">Name</a></h1>
<p><code>nix store sign</code> - sign store paths with a local key</p>
<h1 id="synopsis-130"><a class="header" href="#synopsis-130">Synopsis</a></h1>
<p><code>nix store sign</code> [<em>option</em>...] <em>installables</em>...</p>
<h1 id="options-127"><a class="header" href="#options-127">Options</a></h1>
<ul>
<li>
<p><span id="opt-key-file"><a href="command-ref/new-cli/nix3-store-sign.html#opt-key-file"><code>--key-file</code></a></span> / <code>-k</code> <em>file</em></p>
<p>File containing the secret signing key.</p>
</li>
<li>
<p><span id="opt-stdin"><a href="command-ref/new-cli/nix3-store-sign.html#opt-stdin"><code>--stdin</code></a></span></p>
<p>Read installables from the standard input. No default installable applied.</p>
</li>
</ul>
<h2 id="common-evaluation-options-41"><a class="header" href="#common-evaluation-options-41">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-store-sign.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-store-sign.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-store-sign.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-store-sign.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-store-sign.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-store-sign.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-store-sign.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-store-sign.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-store-sign.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-34"><a class="header" href="#common-flake-related-options-34">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-store-sign.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-store-sign.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-store-sign.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-store-sign.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-store-sign.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-store-sign.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-store-sign.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-store-sign.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-store-sign.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-store-sign.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-88"><a class="header" href="#logging-related-options-88">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-sign.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-sign.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-sign.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-sign.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-sign.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-88"><a class="header" href="#miscellaneous-global-options-88">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-sign.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-sign.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-sign.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-sign.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-store-sign.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-sign.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-25"><a class="header" href="#options-that-change-the-interpretation-of-installables-25">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-all"><a href="command-ref/new-cli/nix3-store-sign.html#opt-all"><code>--all</code></a></span></p>
<p>Apply the operation to every store path.</p>
</li>
<li>
<p><span id="opt-derivation"><a href="command-ref/new-cli/nix3-store-sign.html#opt-derivation"><code>--derivation</code></a></span></p>
<p>Operate on the <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> rather than its outputs.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-store-sign.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-store-sign.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
<li>
<p><span id="opt-recursive"><a href="command-ref/new-cli/nix3-store-sign.html#opt-recursive"><code>--recursive</code></a></span> / <code>-r</code></p>
<p>Apply operation to closure of the specified paths.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-131"><a class="header" href="#name-131">Name</a></h1>
<p><code>nix store verify</code> - verify the integrity of store paths</p>
<h1 id="synopsis-131"><a class="header" href="#synopsis-131">Synopsis</a></h1>
<p><code>nix store verify</code> [<em>option</em>...] <em>installables</em>...</p>
<h1 id="examples-93"><a class="header" href="#examples-93">Examples</a></h1>
<ul>
<li>
<p>Verify the entire Nix store:</p>
<pre><code class="language-console"># nix store verify --all
</code></pre>
</li>
<li>
<p>Check whether each path in the closure of Firefox has at least 2
signatures:</p>
<pre><code class="language-console"># nix store verify --recursive --sigs-needed 2 --no-contents $(type -p firefox)
</code></pre>
</li>
<li>
<p>Verify a store path in the binary cache <code>https://cache.nixos.org/</code>:</p>
<pre><code class="language-console"># nix store verify --store https://cache.nixos.org/ \
    /nix/store/v5sv61sszx301i0x6xysaqzla09nksnd-hello-2.10
</code></pre>
</li>
</ul>
<h1 id="description-110"><a class="header" href="#description-110">Description</a></h1>
<p>This command verifies the integrity of the store paths <a href="command-ref/new-cli/./nix.html#installables"><em>installables</em></a>,
or, if <code>--all</code> is given, the entire Nix store. For each path, it
checks that</p>
<ul>
<li>
<p>its contents match the NAR hash recorded in the Nix database; and</p>
</li>
<li>
<p>it is <em>trusted</em>, that is, it is signed by at least one trusted
signing key, is content-addressed, or is built locally ("ultimately
trusted").</p>
</li>
</ul>
<h1 id="exit-status"><a class="header" href="#exit-status">Exit status</a></h1>
<p>The exit status of this command is the sum of the following values:</p>
<ul>
<li>
<p><strong>1</strong> if any path is corrupted (i.e. its contents don't match the
recorded NAR hash).</p>
</li>
<li>
<p><strong>2</strong> if any path is untrusted.</p>
</li>
<li>
<p><strong>4</strong> if any path couldn't be verified for any other reason (such as
an I/O error).</p>
</li>
</ul>
<h1 id="options-128"><a class="header" href="#options-128">Options</a></h1>
<ul>
<li>
<p><span id="opt-no-contents"><a href="command-ref/new-cli/nix3-store-verify.html#opt-no-contents"><code>--no-contents</code></a></span></p>
<p>Do not verify the contents of each store path.</p>
</li>
<li>
<p><span id="opt-no-trust"><a href="command-ref/new-cli/nix3-store-verify.html#opt-no-trust"><code>--no-trust</code></a></span></p>
<p>Do not verify whether each store path is trusted.</p>
</li>
<li>
<p><span id="opt-sigs-needed"><a href="command-ref/new-cli/nix3-store-verify.html#opt-sigs-needed"><code>--sigs-needed</code></a></span> / <code>-n</code> <em>n</em></p>
<p>Require that each path is signed by at least <em>n</em> different keys.</p>
</li>
<li>
<p><span id="opt-stdin"><a href="command-ref/new-cli/nix3-store-verify.html#opt-stdin"><code>--stdin</code></a></span></p>
<p>Read installables from the standard input. No default installable applied.</p>
</li>
<li>
<p><span id="opt-substituter"><a href="command-ref/new-cli/nix3-store-verify.html#opt-substituter"><code>--substituter</code></a></span> / <code>-s</code> <em>store-uri</em></p>
<p>Use signatures from the specified store.</p>
</li>
</ul>
<h2 id="common-evaluation-options-42"><a class="header" href="#common-evaluation-options-42">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-store-verify.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-store-verify.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-store-verify.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-store-verify.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-store-verify.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-store-verify.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-store-verify.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-store-verify.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-store-verify.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-35"><a class="header" href="#common-flake-related-options-35">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-store-verify.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-store-verify.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-store-verify.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-store-verify.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-store-verify.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-store-verify.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-store-verify.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-store-verify.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-store-verify.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-store-verify.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-89"><a class="header" href="#logging-related-options-89">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-store-verify.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-store-verify.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-store-verify.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-store-verify.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-store-verify.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-89"><a class="header" href="#miscellaneous-global-options-89">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-store-verify.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-store-verify.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-store-verify.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-store-verify.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-store-verify.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-store-verify.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-26"><a class="header" href="#options-that-change-the-interpretation-of-installables-26">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-all"><a href="command-ref/new-cli/nix3-store-verify.html#opt-all"><code>--all</code></a></span></p>
<p>Apply the operation to every store path.</p>
</li>
<li>
<p><span id="opt-derivation"><a href="command-ref/new-cli/nix3-store-verify.html#opt-derivation"><code>--derivation</code></a></span></p>
<p>Operate on the <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> rather than its outputs.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-store-verify.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-store-verify.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
<li>
<p><span id="opt-recursive"><a href="command-ref/new-cli/nix3-store-verify.html#opt-recursive"><code>--recursive</code></a></span> / <code>-r</code></p>
<p>Apply operation to closure of the specified paths.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-132"><a class="header" href="#name-132">Name</a></h1>
<p><code>nix upgrade-nix</code> - upgrade Nix to the latest stable version</p>
<h1 id="synopsis-132"><a class="header" href="#synopsis-132">Synopsis</a></h1>
<p><code>nix upgrade-nix</code> [<em>option</em>...]</p>
<h1 id="examples-94"><a class="header" href="#examples-94">Examples</a></h1>
<ul>
<li>
<p>Upgrade Nix to the stable version declared in Nixpkgs:</p>
<pre><code class="language-console"># nix upgrade-nix
</code></pre>
</li>
<li>
<p>Upgrade Nix in a specific profile:</p>
<pre><code class="language-console"># nix upgrade-nix --profile ~alice/.local/state/nix/profiles/profile
</code></pre>
</li>
</ul>
<h1 id="description-111"><a class="header" href="#description-111">Description</a></h1>
<p>This command upgrades Nix to the stable version.</p>
<p>By default, the latest stable version is defined by Nixpkgs, in
<a href="https://github.com/NixOS/nixpkgs/raw/master/nixos/modules/installer/tools/nix-fallback-paths.nix">nix-fallback-paths.nix</a>
and updated manually. It may not always be the latest tagged release.</p>
<p>By default, it locates the directory containing the <code>nix</code> binary in the <code>$PATH</code>
environment variable. If that directory is a Nix profile, it will
upgrade the <code>nix</code> package in that profile to the latest stable binary
release.</p>
<p>You cannot use this command to upgrade Nix in the system profile of a
NixOS system (that is, if <code>nix</code> is found in <code>/run/current-system</code>).</p>
<h1 id="options-129"><a class="header" href="#options-129">Options</a></h1>
<ul>
<li>
<p><span id="opt-dry-run"><a href="command-ref/new-cli/nix3-upgrade-nix.html#opt-dry-run"><code>--dry-run</code></a></span></p>
<p>Show what this command would do without doing it.</p>
</li>
<li>
<p><span id="opt-nix-store-paths-url"><a href="command-ref/new-cli/nix3-upgrade-nix.html#opt-nix-store-paths-url"><code>--nix-store-paths-url</code></a></span> <em>url</em></p>
<p>The URL of the file that contains the store paths of the latest Nix release.</p>
</li>
<li>
<p><span id="opt-profile"><a href="command-ref/new-cli/nix3-upgrade-nix.html#opt-profile"><code>--profile</code></a></span> / <code>-p</code> <em>profile-dir</em></p>
<p>The path to the Nix profile to upgrade.</p>
</li>
</ul>
<h2 id="logging-related-options-90"><a class="header" href="#logging-related-options-90">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-upgrade-nix.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-upgrade-nix.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-upgrade-nix.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-upgrade-nix.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-upgrade-nix.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-90"><a class="header" href="#miscellaneous-global-options-90">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-upgrade-nix.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-upgrade-nix.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-upgrade-nix.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-upgrade-nix.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-upgrade-nix.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p><strong>Warning</strong> <br />
This program is
<a href="command-ref/new-cli/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and its interface is subject to change.</p>
</blockquote>
<h1 id="name-133"><a class="header" href="#name-133">Name</a></h1>
<p><code>nix why-depends</code> - show why a package has another package in its closure</p>
<h1 id="synopsis-133"><a class="header" href="#synopsis-133">Synopsis</a></h1>
<p><code>nix why-depends</code> [<em>option</em>...] <em>package</em> <em>dependency</em></p>
<h1 id="examples-95"><a class="header" href="#examples-95">Examples</a></h1>
<ul>
<li>
<p>Show one path through the dependency graph leading from Hello to
Glibc:</p>
<pre><code class="language-console"># nix why-depends nixpkgs#hello nixpkgs#glibc
/nix/store/v5sv61sszx301i0x6xysaqzla09nksnd-hello-2.10
└───bin/hello: …...................../nix/store/9l06v7fc38c1x3r2iydl15ksgz0ysb82-glibc-2.32/lib/ld-linux-x86-64.…
    → /nix/store/9l06v7fc38c1x3r2iydl15ksgz0ysb82-glibc-2.32
</code></pre>
</li>
<li>
<p>Show all files and paths in the dependency graph leading from
Thunderbird to libX11:</p>
<pre><code class="language-console"># nix why-depends --all nixpkgs#thunderbird nixpkgs#xorg.libX11
/nix/store/qfc8729nzpdln1h0hvi1ziclsl3m84sr-thunderbird-78.5.1
├───lib/thunderbird/libxul.so: …6wrw-libxcb-1.14/lib:/nix/store/adzfjjh8w25vdr0xdx9x16ah4f5rqrw5-libX11-1.7.0/lib:/nix/store/ssf…
│   → /nix/store/adzfjjh8w25vdr0xdx9x16ah4f5rqrw5-libX11-1.7.0
├───lib/thunderbird/libxul.so: …pxyc-libXt-1.2.0/lib:/nix/store/1qj29ipxl2fyi2b13l39hdircq17gnk0-libXdamage-1.1.5/lib:/nix/store…
│   → /nix/store/1qj29ipxl2fyi2b13l39hdircq17gnk0-libXdamage-1.1.5
│   ├───lib/libXdamage.so.1.1.0: …-libXfixes-5.0.3/lib:/nix/store/adzfjjh8w25vdr0xdx9x16ah4f5rqrw5-libX11-1.7.0/lib:/nix/store/9l0…
│   │   → /nix/store/adzfjjh8w25vdr0xdx9x16ah4f5rqrw5-libX11-1.7.0
…
</code></pre>
</li>
<li>
<p>Show why Glibc depends on itself:</p>
<pre><code class="language-console"># nix why-depends nixpkgs#glibc nixpkgs#glibc
/nix/store/9df65igwjmf2wbw0gbrrgair6piqjgmi-glibc-2.31
└───lib/ld-2.31.so: …che       Do not use /nix/store/9df65igwjmf2wbw0gbrrgair6piqjgmi-glibc-2.31/etc/ld.so.cache.  --…
    → /nix/store/9df65igwjmf2wbw0gbrrgair6piqjgmi-glibc-2.31
</code></pre>
</li>
<li>
<p>Show why Geeqie has a build-time dependency on <code>systemd</code>:</p>
<pre><code class="language-console"># nix why-depends --derivation nixpkgs#geeqie nixpkgs#systemd
/nix/store/drrpq2fqlrbj98bmazrnww7hm1in3wgj-geeqie-1.4.drv
└───/: …atch.drv",["out"]),("/nix/store/qzh8dyq3lfbk3i1acbp7x9wh3il2imiv-gtk+3-3.24.21.drv",["dev"]),("/…
    → /nix/store/qzh8dyq3lfbk3i1acbp7x9wh3il2imiv-gtk+3-3.24.21.drv
    └───/: …16.0.drv",["dev"]),("/nix/store/8kp79fyslf3z4m3dpvlh6w46iaadz5c2-cups-2.3.3.drv",["dev"]),("/nix…
        → /nix/store/8kp79fyslf3z4m3dpvlh6w46iaadz5c2-cups-2.3.3.drv
        └───/: ….3.1.drv",["out"]),("/nix/store/yd3ihapyi5wbz1kjacq9dbkaq5v5hqjg-systemd-246.4.drv",["dev"]),("/…
            → /nix/store/yd3ihapyi5wbz1kjacq9dbkaq5v5hqjg-systemd-246.4.drv
</code></pre>
</li>
</ul>
<h1 id="description-112"><a class="header" href="#description-112">Description</a></h1>
<p>Nix automatically determines potential runtime dependencies between
store paths by scanning for the <em>hash parts</em> of store paths. For
instance, if there exists a store path
<code>/nix/store/9df65igwjmf2wbw0gbrrgair6piqjgmi-glibc-2.31</code>, and a file
inside another store path contains the string <code>9df65igw…</code>, then the
latter store path <em>refers</em> to the former, and thus might need it at
runtime. Nix always maintains the existence of the transitive closure
of a store path under the references relationship; it is therefore not
possible to install a store path without having all of its references
present.</p>
<p>Sometimes Nix packages end up with unexpected runtime dependencies;
for instance, a reference to a compiler might accidentally end up in a
binary, causing the former to be in the latter's closure. This kind of
<em>closure size bloat</em> is undesirable.</p>
<p><code>nix why-depends</code> allows you to diagnose the cause of such issues. It
shows why the store path <em>package</em> depends on the store path
<em>dependency</em>, by showing a shortest sequence in the references graph
from the former to the latter. Also, for each node along this path, it
shows a file fragment containing a reference to the next store path in
the sequence.</p>
<p>To show why derivation <em>package</em> has a build-time rather than runtime
dependency on derivation <em>dependency</em>, use <code>--derivation</code>.</p>
<h1 id="options-130"><a class="header" href="#options-130">Options</a></h1>
<ul>
<li>
<p><span id="opt-all"><a href="command-ref/new-cli/nix3-why-depends.html#opt-all"><code>--all</code></a></span> / <code>-a</code></p>
<p>Show all edges in the dependency graph leading from <em>package</em> to <em>dependency</em>, rather than just a shortest path.</p>
</li>
<li>
<p><span id="opt-precise"><a href="command-ref/new-cli/nix3-why-depends.html#opt-precise"><code>--precise</code></a></span></p>
<p>For each edge in the dependency graph, show the files in the parent that cause the dependency.</p>
</li>
</ul>
<h2 id="common-evaluation-options-43"><a class="header" href="#common-evaluation-options-43">Common evaluation options</a></h2>
<ul>
<li>
<p><span id="opt-arg"><a href="command-ref/new-cli/nix3-why-depends.html#opt-arg"><code>--arg</code></a></span> <em>name</em> <em>expr</em></p>
<p>Pass the value <em>expr</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-file"><a href="command-ref/new-cli/nix3-why-depends.html#opt-arg-from-file"><code>--arg-from-file</code></a></span> <em>name</em> <em>path</em></p>
<p>Pass the contents of file <em>path</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-arg-from-stdin"><a href="command-ref/new-cli/nix3-why-depends.html#opt-arg-from-stdin"><code>--arg-from-stdin</code></a></span> <em>name</em></p>
<p>Pass the contents of stdin as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-argstr"><a href="command-ref/new-cli/nix3-why-depends.html#opt-argstr"><code>--argstr</code></a></span> <em>name</em> <em>string</em></p>
<p>Pass the string <em>string</em> as the argument <em>name</em> to Nix functions.</p>
</li>
<li>
<p><span id="opt-debugger"><a href="command-ref/new-cli/nix3-why-depends.html#opt-debugger"><code>--debugger</code></a></span></p>
<p>Start an interactive environment if evaluation fails.</p>
</li>
<li>
<p><span id="opt-eval-store"><a href="command-ref/new-cli/nix3-why-depends.html#opt-eval-store"><code>--eval-store</code></a></span> <em>store-url</em></p>
<p>The <a href="command-ref/new-cli/../../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for evaluation, i.e. to store derivations (<code>.drv</code> files) and inputs referenced by them.</p>
</li>
<li>
<p><span id="opt-impure"><a href="command-ref/new-cli/nix3-why-depends.html#opt-impure"><code>--impure</code></a></span></p>
<p>Allow access to mutable paths and repositories.</p>
</li>
<li>
<p><span id="opt-include"><a href="command-ref/new-cli/nix3-why-depends.html#opt-include"><code>--include</code></a></span> / <code>-I</code> <em>path</em></p>
<p>Add <em>path</em> to search path entries used to resolve <a href="command-ref/new-cli/../../language/constructs/lookup-path.html">lookup paths</a></p>
<p>This option may be given multiple times.</p>
<p>Paths added through <code>-I</code> take precedence over the <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-nix-path"><code>nix-path</code> configuration setting</a> and the <a href="command-ref/new-cli/../../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code> environment variable</a>.</p>
</li>
<li>
<p><span id="opt-override-flake"><a href="command-ref/new-cli/nix3-why-depends.html#opt-override-flake"><code>--override-flake</code></a></span> <em>original-ref</em> <em>resolved-ref</em></p>
<p>Override the flake registries, redirecting <em>original-ref</em> to <em>resolved-ref</em>.</p>
</li>
</ul>
<h2 id="common-flake-related-options-36"><a class="header" href="#common-flake-related-options-36">Common flake-related options</a></h2>
<ul>
<li>
<p><span id="opt-commit-lock-file"><a href="command-ref/new-cli/nix3-why-depends.html#opt-commit-lock-file"><code>--commit-lock-file</code></a></span></p>
<p>Commit changes to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-inputs-from"><a href="command-ref/new-cli/nix3-why-depends.html#opt-inputs-from"><code>--inputs-from</code></a></span> <em>flake-url</em></p>
<p>Use the inputs of the specified flake as registry entries.</p>
</li>
<li>
<p><span id="opt-no-registries"><a href="command-ref/new-cli/nix3-why-depends.html#opt-no-registries"><code>--no-registries</code></a></span></p>
<p>Don't allow lookups in the flake registries.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/conf-file.html#conf-use-registries"><code>--no-use-registries</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-no-update-lock-file"><a href="command-ref/new-cli/nix3-why-depends.html#opt-no-update-lock-file"><code>--no-update-lock-file</code></a></span></p>
<p>Do not allow any updates to the flake's lock file.</p>
</li>
<li>
<p><span id="opt-no-write-lock-file"><a href="command-ref/new-cli/nix3-why-depends.html#opt-no-write-lock-file"><code>--no-write-lock-file</code></a></span></p>
<p>Do not write the flake's newly generated lock file.</p>
</li>
<li>
<p><span id="opt-output-lock-file"><a href="command-ref/new-cli/nix3-why-depends.html#opt-output-lock-file"><code>--output-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Write the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-override-input"><a href="command-ref/new-cli/nix3-why-depends.html#opt-override-input"><code>--override-input</code></a></span> <em>input-path</em> <em>flake-url</em></p>
<p>Override a specific flake input (e.g. <code>dwarffs/nixpkgs</code>). This implies <code>--no-write-lock-file</code>.</p>
</li>
<li>
<p><span id="opt-recreate-lock-file"><a href="command-ref/new-cli/nix3-why-depends.html#opt-recreate-lock-file"><code>--recreate-lock-file</code></a></span></p>
<p>Recreate the flake's lock file from scratch.</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
<li>
<p><span id="opt-reference-lock-file"><a href="command-ref/new-cli/nix3-why-depends.html#opt-reference-lock-file"><code>--reference-lock-file</code></a></span> <em>flake-lock-path</em></p>
<p>Read the given lock file instead of <code>flake.lock</code> within the top-level flake.</p>
</li>
<li>
<p><span id="opt-update-input"><a href="command-ref/new-cli/nix3-why-depends.html#opt-update-input"><code>--update-input</code></a></span> <em>input-path</em></p>
<p>Update a specific flake input (ignoring its previous entry in the lock file).</p>
<blockquote>
<p><strong>DEPRECATED</strong></p>
<p>Use <a href="command-ref/new-cli/../../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> instead.</p>
</blockquote>
</li>
</ul>
<h2 id="logging-related-options-91"><a class="header" href="#logging-related-options-91">Logging-related options</a></h2>
<ul>
<li>
<p><span id="opt-debug"><a href="command-ref/new-cli/nix3-why-depends.html#opt-debug"><code>--debug</code></a></span></p>
<p>Set the logging verbosity level to 'debug'.</p>
</li>
<li>
<p><span id="opt-log-format"><a href="command-ref/new-cli/nix3-why-depends.html#opt-log-format"><code>--log-format</code></a></span> <em>format</em></p>
<p>Set the format of log output; one of <code>raw</code>, <code>internal-json</code>, <code>bar</code> or <code>bar-with-logs</code>.</p>
</li>
<li>
<p><span id="opt-print-build-logs"><a href="command-ref/new-cli/nix3-why-depends.html#opt-print-build-logs"><code>--print-build-logs</code></a></span> / <code>-L</code></p>
<p>Print full build logs on standard error.</p>
</li>
<li>
<p><span id="opt-quiet"><a href="command-ref/new-cli/nix3-why-depends.html#opt-quiet"><code>--quiet</code></a></span></p>
<p>Decrease the logging verbosity level.</p>
</li>
<li>
<p><span id="opt-verbose"><a href="command-ref/new-cli/nix3-why-depends.html#opt-verbose"><code>--verbose</code></a></span> / <code>-v</code></p>
<p>Increase the logging verbosity level.</p>
</li>
</ul>
<h2 id="miscellaneous-global-options-91"><a class="header" href="#miscellaneous-global-options-91">Miscellaneous global options</a></h2>
<ul>
<li>
<p><span id="opt-help"><a href="command-ref/new-cli/nix3-why-depends.html#opt-help"><code>--help</code></a></span></p>
<p>Show usage information.</p>
</li>
<li>
<p><span id="opt-offline"><a href="command-ref/new-cli/nix3-why-depends.html#opt-offline"><code>--offline</code></a></span></p>
<p>Disable substituters and consider all previously downloaded files up-to-date.</p>
</li>
<li>
<p><span id="opt-option"><a href="command-ref/new-cli/nix3-why-depends.html#opt-option"><code>--option</code></a></span> <em>name</em> <em>value</em></p>
<p>Set the Nix configuration setting <em>name</em> to <em>value</em> (overriding <code>nix.conf</code>).</p>
</li>
<li>
<p><span id="opt-refresh"><a href="command-ref/new-cli/nix3-why-depends.html#opt-refresh"><code>--refresh</code></a></span></p>
<p>Consider all previously downloaded files out-of-date.</p>
</li>
<li>
<p><span id="opt-repair"><a href="command-ref/new-cli/nix3-why-depends.html#opt-repair"><code>--repair</code></a></span></p>
<p>During evaluation, rewrite missing or corrupted files in the Nix store. During building, rebuild missing or corrupted store paths.</p>
</li>
<li>
<p><span id="opt-version"><a href="command-ref/new-cli/nix3-why-depends.html#opt-version"><code>--version</code></a></span></p>
<p>Show version information.</p>
</li>
</ul>
<h2 id="options-that-change-the-interpretation-of-installables-27"><a class="header" href="#options-that-change-the-interpretation-of-installables-27">Options that change the interpretation of <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables">installables</a></a></h2>
<ul>
<li>
<p><span id="opt-derivation"><a href="command-ref/new-cli/nix3-why-depends.html#opt-derivation"><code>--derivation</code></a></span></p>
<p>Operate on the <a href="command-ref/new-cli/../../glossary.html#gloss-store-derivation">store derivation</a> rather than its outputs.</p>
</li>
<li>
<p><span id="opt-expr"><a href="command-ref/new-cli/nix3-why-depends.html#opt-expr"><code>--expr</code></a></span> <em>expr</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression <em>expr</em>.</p>
</li>
<li>
<p><span id="opt-file"><a href="command-ref/new-cli/nix3-why-depends.html#opt-file"><code>--file</code></a></span> / <code>-f</code> <em>file</em></p>
<p>Interpret <a href="command-ref/new-cli/../../command-ref/new-cli/nix.html#installables"><em>installables</em></a> as attribute paths relative to the Nix expression stored in <em>file</em>. If <em>file</em> is the character -, then a Nix expression will be read from standard input. Implies <code>--impure</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>See <a href="command-ref/new-cli/../../command-ref/conf-file.html#command-line-flags"><code>man nix.conf</code></a> for overriding configuration settings with command line flags.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="files-3"><a class="header" href="#files-3">Files</a></h1>
<p>This section lists configuration files that you can use when you work
with Nix.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="name-134"><a class="header" href="#name-134">Name</a></h1>
<p><code>nix.conf</code> - Nix configuration file</p>
<h1 id="description-113"><a class="header" href="#description-113">Description</a></h1>
<p>Nix supports a variety of configuration settings, which are read from configuration files or taken as command line flags.</p>
<h2 id="configuration-file"><a class="header" href="#configuration-file">Configuration file</a></h2>
<p>By default Nix reads settings from the following places, in that order:</p>
<ol>
<li>
<p>The system-wide configuration file <code>sysconfdir/nix/nix.conf</code> (i.e. <code>/etc/nix/nix.conf</code> on most systems), or <code>$NIX_CONF_DIR/nix.conf</code> if <a href="command-ref/./env-common.html#env-NIX_CONF_DIR"><code>NIX_CONF_DIR</code></a> is set.</p>
<p>Values loaded in this file are not forwarded to the Nix daemon.
The client assumes that the daemon has already loaded them.</p>
</li>
<li>
<p>If <a href="command-ref/./env-common.html#env-NIX_USER_CONF_FILES"><code>NIX_USER_CONF_FILES</code></a> is set, then each path separated by <code>:</code> will be loaded in reverse order.</p>
<p>Otherwise it will look for <code>nix/nix.conf</code> files in <code>XDG_CONFIG_DIRS</code> and <a href="command-ref/./env-common.html#env-XDG_CONFIG_HOME"><code>XDG_CONFIG_HOME</code></a>.
If unset, <code>XDG_CONFIG_DIRS</code> defaults to <code>/etc/xdg</code>, and <code>XDG_CONFIG_HOME</code> defaults to <code>$HOME/.config</code> as per <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
</li>
<li>
<p>If <a href="command-ref/./env-common.html#env-NIX_CONFIG"><code>NIX_CONFIG</code></a> is set, its contents are treated as the contents of a configuration file.</p>
</li>
</ol>
<h3 id="file-format-1"><a class="header" href="#file-format-1">File format</a></h3>
<p>Configuration files consist of <code>name = value</code> pairs, one per line.
Comments start with a <code>#</code> character.</p>
<p>Example:</p>
<pre><code>keep-outputs = true       # Nice for developers
keep-derivations = true   # Idem
</code></pre>
<p>Other files can be included with a line like <code>include &lt;path&gt;</code>, where <code>&lt;path&gt;</code> is interpreted relative to the current configuration file.
A missing file is an error unless <code>!include</code> is used instead.</p>
<p>A configuration setting usually overrides any previous value.
However, for settings that take a list of items, you can prefix the name of the setting by <code>extra-</code> to <em>append</em> to the previous value.</p>
<p>For instance,</p>
<pre><code>substituters = a b
extra-substituters = c d
</code></pre>
<p>defines the <code>substituters</code> setting to be <code>a b c d</code>.</p>
<p>Unknown option names are not an error, and are simply ignored with a warning.</p>
<h2 id="command-line-flags"><a class="header" href="#command-line-flags">Command line flags</a></h2>
<p>Configuration options can be set on the command line, overriding the values set in the <a href="command-ref/conf-file.html#configuration-file">configuration file</a>:</p>
<ul>
<li>
<p>Every configuration setting has corresponding command line flag (e.g. <code>--max-jobs 16</code>).
Boolean settings do not need an argument, and can be explicitly disabled with the <code>no-</code> prefix (e.g. <code>--keep-failed</code> and <code>--no-keep-failed</code>).</p>
<p>Unknown option names are invalid flags (unless there is already a flag with that name), and are rejected with an error.</p>
</li>
<li>
<p>The flag <code>--option &lt;name&gt; &lt;value&gt;</code> is interpreted exactly like a <code>&lt;name&gt; = &lt;value&gt;</code> in a setting file.</p>
<p>Unknown option names are ignored with a warning.</p>
</li>
</ul>
<p>The <code>extra-</code> prefix is supported for settings that take a list of items (e.g. <code>--extra-trusted users alice</code> or <code>--option extra-trusted-users alice</code>).</p>
<h2 id="integer-settings"><a class="header" href="#integer-settings">Integer settings</a></h2>
<p>Settings that have an integer type support the suffixes <code>K</code>, <code>M</code>, <code>G</code>
and <code>T</code>. These cause the specified value to be multiplied by 2^10,
2^20, 2^30 and 2^40, respectively. For instance, <code>--min-free 1M</code> is
equivalent to <code>--min-free 1048576</code>.</p>
<h1 id="available-settings"><a class="header" href="#available-settings">Available settings</a></h1>
<ul>
<li>
<p><span id="conf-abort-on-warn"><a href="command-ref/conf-file.html#conf-abort-on-warn"><code>abort-on-warn</code></a></span></p>
<p>If set to true, <a href="command-ref/../language/builtins.html#builtins-warn"><code>builtins.warn</code></a> will throw an error when logging a warning.</p>
<p>This will give you a stack trace that leads to the location of the warning.</p>
<p>This is useful for finding information about warnings in third-party Nix code when you can not start the interactive debugger, such as when Nix is called from a non-interactive script. See <a href="command-ref/conf-file.html#conf-debugger-on-warn"><code>debugger-on-warn</code></a>.</p>
<p>Currently, a stack trace can only be produced when the debugger is enabled, or when evaluation is aborted.</p>
<p>This option can be enabled by setting <code>NIX_ABORT_ON_WARN=1</code> in the environment.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-accept-flake-config"><a href="command-ref/conf-file.html#conf-accept-flake-config"><code>accept-flake-config</code></a></span></p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This setting is part of an
<a href="command-ref/../development/experimental-features.html">experimental feature</a>.</p>
<p>To change this setting, make sure the
<a href="command-ref/../development/experimental-features.html#xp-feature-flakes"><code>flakes</code> experimental feature</a>
is enabled.
For example, include the following in <a href="command-ref/../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = flakes
accept-flake-config = ...
</code></pre>
</blockquote>
<p>Whether to accept Nix configuration settings from a flake without prompting.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-access-tokens"><a href="command-ref/conf-file.html#conf-access-tokens"><code>access-tokens</code></a></span></p>
<p>Access tokens used to access protected GitHub, GitLab, or
other locations requiring token-based authentication.</p>
<p>Access tokens are specified as a string made up of
space-separated <code>host=token</code> values.  The specific token
used is selected by matching the <code>host</code> portion against the
"host" specification of the input. The <code>host</code> portion may
contain a path element which will match against the prefix
URL for the input. (eg: <code>github.com/org=token</code>). The actual use
of the <code>token</code> value is determined by the type of resource
being accessed:</p>
<ul>
<li>
<p>Github: the token value is the OAUTH-TOKEN string obtained
as the Personal Access Token from the Github server (see
https://docs.github.com/en/developers/apps/building-oauth-apps/authorizing-oauth-apps).</p>
</li>
<li>
<p>Gitlab: the token value is either the OAuth2 token or the
Personal Access Token (these are different types tokens
for gitlab, see
https://docs.gitlab.com/12.10/ee/api/README.html#authentication).
The <code>token</code> value should be <code>type:tokenstring</code> where
<code>type</code> is either <code>OAuth2</code> or <code>PAT</code> to indicate which type
of token is being specified.</p>
</li>
</ul>
<p>Example <code>~/.config/nix/nix.conf</code>:</p>
<pre><code>access-tokens = github.com=23ac...b289 gitlab.mycompany.com=PAT:A123Bp_Cd..EfG gitlab.com=OAuth2:1jklw3jk
</code></pre>
<p>Example <code>~/code/flake.nix</code>:</p>
<pre><code class="language-nix">input.foo = {
  type = "gitlab";
  host = "gitlab.mycompany.com";
  owner = "mycompany";
  repo = "pro";
};
</code></pre>
<p>This example specifies three tokens, one each for accessing
github.com, gitlab.mycompany.com, and gitlab.com.</p>
<p>The <code>input.foo</code> uses the "gitlab" fetcher, which might
requires specifying the token type along with the token
value.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="conf-allow-dirty"><a href="command-ref/conf-file.html#conf-allow-dirty"><code>allow-dirty</code></a></span></p>
<p>Whether to allow dirty Git/Mercurial trees.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="conf-allow-dirty-locks"><a href="command-ref/conf-file.html#conf-allow-dirty-locks"><code>allow-dirty-locks</code></a></span></p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This setting is part of an
<a href="command-ref/../development/experimental-features.html">experimental feature</a>.</p>
<p>To change this setting, make sure the
<a href="command-ref/../development/experimental-features.html#xp-feature-flakes"><code>flakes</code> experimental feature</a>
is enabled.
For example, include the following in <a href="command-ref/../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = flakes
allow-dirty-locks = ...
</code></pre>
</blockquote>
<p>Whether to allow dirty inputs (such as dirty Git workdirs)
to be locked via their NAR hash. This is generally bad
practice since Nix has no way to obtain such inputs if they
are subsequently modified. Therefore lock files with dirty
locks should generally only be used for local testing, and
should not be pushed to other users.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-allow-import-from-derivation"><a href="command-ref/conf-file.html#conf-allow-import-from-derivation"><code>allow-import-from-derivation</code></a></span></p>
<p>By default, Nix allows <a href="command-ref/../language/import-from-derivation.html">Import from Derivation</a>.</p>
<p>With this option set to <code>false</code>, Nix will throw an error when evaluating an expression that uses this feature,
even when the required store object is readily available.
This ensures that evaluation will not require any builds to take place,
regardless of the state of the store.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="conf-allow-new-privileges"><a href="command-ref/conf-file.html#conf-allow-new-privileges"><code>allow-new-privileges</code></a></span></p>
<p>(Linux-specific.) By default, builders on Linux cannot acquire new
privileges by calling setuid/setgid programs or programs that have
file capabilities. For example, programs such as <code>sudo</code> or <code>ping</code>
will fail. (Note that in sandbox builds, no such programs are
available unless you bind-mount them into the sandbox via the
<code>sandbox-paths</code> option.) You can allow the use of such programs by
enabling this option. This is impure and usually undesirable, but
may be useful in certain scenarios (e.g. to spin up containers or
set up userspace network interfaces in tests).</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-allow-symlinked-store"><a href="command-ref/conf-file.html#conf-allow-symlinked-store"><code>allow-symlinked-store</code></a></span></p>
<p>If set to <code>true</code>, Nix will stop complaining if the store directory
(typically /nix/store) contains symlink components.</p>
<p>This risks making some builds "impure" because builders sometimes
"canonicalise" paths by resolving all symlink components. Problems
occur if those builds are then deployed to machines where /nix/store
resolves to a different location from that of the build machine. You
can enable this setting if you are sure you're not going to do that.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-allow-unsafe-native-code-during-evaluation"><a href="command-ref/conf-file.html#conf-allow-unsafe-native-code-during-evaluation"><code>allow-unsafe-native-code-during-evaluation</code></a></span></p>
<p>Enable built-in functions that allow executing native code.</p>
<p>In particular, this adds:</p>
<ul>
<li>
<p><code>builtins.importNative</code> <em>path</em> <em>symbol</em></p>
<p>Opens dynamic shared object (DSO) at <em>path</em>, loads the function with the symbol name <em>symbol</em> from it and runs it.
The loaded function must have the following signature:</p>
<pre><code class="language-cpp">extern "C" typedef void (*ValueInitialiser) (EvalState &amp; state, Value &amp; v);
</code></pre>
<p>The <a href="command-ref/../development/documentation.html#api-documentation">Nix C++ API documentation</a> has more details on evaluator internals.</p>
</li>
<li>
<p><code>builtins.exec</code> <em>arguments</em></p>
<p>Execute a program, where <em>arguments</em> are specified as a list of strings, and parse its output as a Nix expression.</p>
</li>
</ul>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-allowed-impure-host-deps"><a href="command-ref/conf-file.html#conf-allowed-impure-host-deps"><code>allowed-impure-host-deps</code></a></span></p>
<p>Which prefixes to allow derivations to ask for access to (primarily for Darwin).</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="conf-allowed-uris"><a href="command-ref/conf-file.html#conf-allowed-uris"><code>allowed-uris</code></a></span></p>
<p>A list of URI prefixes to which access is allowed in restricted
evaluation mode. For example, when set to
<code>https://github.com/NixOS</code>, builtin functions such as <code>fetchGit</code> are
allowed to access <code>https://github.com/NixOS/patchelf.git</code>.</p>
<p>Access is granted when</p>
<ul>
<li>the URI is equal to the prefix,</li>
<li>or the URI is a subpath of the prefix,</li>
<li>or the prefix is a URI scheme ended by a colon <code>:</code> and the URI has the same scheme.</li>
</ul>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="conf-allowed-users"><a href="command-ref/conf-file.html#conf-allowed-users"><code>allowed-users</code></a></span></p>
<p>A list user names, separated by whitespace.
These users are allowed to connect to the Nix daemon.</p>
<p>You can specify groups by prefixing names with <code>@</code>.
For instance, <code>@wheel</code> means all users in the <code>wheel</code> group.
Also, you can allow all users by specifying <code>*</code>.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>Trusted users (set in <a href="command-ref/conf-file.html#conf-trusted-users"><code>trusted-users</code></a>) can always connect to the Nix daemon.</p>
</blockquote>
<p><strong>Default:</strong> <code>*</code></p>
</li>
<li>
<p><span id="conf-always-allow-substitutes"><a href="command-ref/conf-file.html#conf-always-allow-substitutes"><code>always-allow-substitutes</code></a></span></p>
<p>If set to <code>true</code>, Nix will ignore the <a href="command-ref/../language/advanced-attributes.html"><code>allowSubstitutes</code></a> attribute in derivations and always attempt to use <a href="command-ref/conf-file.html#conf-substituters">available substituters</a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-auto-allocate-uids"><a href="command-ref/conf-file.html#conf-auto-allocate-uids"><code>auto-allocate-uids</code></a></span></p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This setting is part of an
<a href="command-ref/../development/experimental-features.html">experimental feature</a>.</p>
<p>To change this setting, make sure the
<a href="command-ref/../development/experimental-features.html#xp-feature-auto-allocate-uids"><code>auto-allocate-uids</code> experimental feature</a>
is enabled.
For example, include the following in <a href="command-ref/../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = auto-allocate-uids
auto-allocate-uids = ...
</code></pre>
</blockquote>
<p>Whether to select UIDs for builds automatically, instead of using the
users in <code>build-users-group</code>.</p>
<p>UIDs are allocated starting at 872415232 (0x34000000) on Linux and 56930 on macOS.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-auto-optimise-store"><a href="command-ref/conf-file.html#conf-auto-optimise-store"><code>auto-optimise-store</code></a></span></p>
<p>If set to <code>true</code>, Nix automatically detects files in the store
that have identical contents, and replaces them with hard links to
a single copy. This saves disk space. If set to <code>false</code> (the
default), you can still run <code>nix-store --optimise</code> to get rid of
duplicate files.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-bash-prompt"><a href="command-ref/conf-file.html#conf-bash-prompt"><code>bash-prompt</code></a></span></p>
<p>The bash prompt (<code>PS1</code>) in <code>nix develop</code> shells.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="conf-bash-prompt-prefix"><a href="command-ref/conf-file.html#conf-bash-prompt-prefix"><code>bash-prompt-prefix</code></a></span></p>
<p>Prefix prepended to the <code>PS1</code> environment variable in <code>nix develop</code> shells.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="conf-bash-prompt-suffix"><a href="command-ref/conf-file.html#conf-bash-prompt-suffix"><code>bash-prompt-suffix</code></a></span></p>
<p>Suffix appended to the <code>PS1</code> environment variable in <code>nix develop</code> shells.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="conf-build-dir"><a href="command-ref/conf-file.html#conf-build-dir"><code>build-dir</code></a></span></p>
<p>The directory on the host, in which derivations' temporary build directories are created.</p>
<p>If not set, Nix will use the system temporary directory indicated by the <code>TMPDIR</code> environment variable.
Note that builds are often performed by the Nix daemon, so its <code>TMPDIR</code> is used, and not that of the Nix command line interface.</p>
<p>This is also the location where <a href="command-ref/../command-ref/opt-common.html#opt-keep-failed"><code>--keep-failed</code></a> leaves its files.</p>
<p>If Nix runs without sandbox, or if the platform does not support sandboxing with bind mounts (e.g. macOS), then the <a href="command-ref/../language/derivations.html#attr-builder"><code>builder</code></a>'s environment will contain this directory, instead of the virtual location <a href="command-ref/conf-file.html#conf-sandbox-build-dir"><code>sandbox-build-dir</code></a>.</p>
<p><strong>Default:</strong> ``</p>
</li>
<li>
<p><span id="conf-build-hook"><a href="command-ref/conf-file.html#conf-build-hook"><code>build-hook</code></a></span></p>
<p>The path to the helper program that executes remote builds.</p>
<p>Nix communicates with the build hook over <code>stdio</code> using a custom protocol to request builds that cannot be performed directly by the Nix daemon.
The default value is the internal Nix binary that implements remote building.</p>
<blockquote>
<p><strong>Important</strong></p>
<p>Change this setting only if you really know what you’re doing.</p>
</blockquote>
<p><strong>Default:</strong> <code>nix __build-remote</code></p>
</li>
<li>
<p><span id="conf-build-poll-interval"><a href="command-ref/conf-file.html#conf-build-poll-interval"><code>build-poll-interval</code></a></span></p>
<p>How often (in seconds) to poll for locks.</p>
<p><strong>Default:</strong> <code>5</code></p>
</li>
<li>
<p><span id="conf-build-users-group"><a href="command-ref/conf-file.html#conf-build-users-group"><code>build-users-group</code></a></span></p>
<p>This options specifies the Unix group containing the Nix build user
accounts. In multi-user Nix installations, builds should not be
performed by the Nix account since that would allow users to
arbitrarily modify the Nix store and database by supplying specially
crafted builders; and they cannot be performed by the calling user
since that would allow him/her to influence the build result.</p>
<p>Therefore, if this option is non-empty and specifies a valid group,
builds will be performed under the user accounts that are a member
of the group specified here (as listed in <code>/etc/group</code>). Those user
accounts should not be used for any other purpose!</p>
<p>Nix will never run two builds under the same user account at the
same time. This is to prevent an obvious security hole: a malicious
user writing a Nix expression that modifies the build result of a
legitimate Nix expression being built by another user. Therefore it
is good to have as many Nix build user accounts as you can spare.
(Remember: uids are cheap.)</p>
<p>The build users should have permission to create files in the Nix
store, but not delete them. Therefore, <code>/nix/store</code> should be owned
by the Nix account, its group should be the group specified here,
and its mode should be <code>1775</code>.</p>
<p>If the build users group is empty, builds will be performed under
the uid of the Nix process (that is, the uid of the caller if
<code>NIX_REMOTE</code> is empty, the uid under which the Nix daemon runs if
<code>NIX_REMOTE</code> is <code>daemon</code>). Obviously, this should not be used
with a nix daemon accessible to untrusted clients.</p>
<p>Defaults to <code>nixbld</code> when running as root, <em>empty</em> otherwise.</p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="conf-builders"><a href="command-ref/conf-file.html#conf-builders"><code>builders</code></a></span></p>
<p>A semicolon- or newline-separated list of build machines.</p>
<p>In addition to the <a href="command-ref/../command-ref/conf-file.html">usual ways of setting configuration options</a>, the value can be read from a file by prefixing its absolute path with <code>@</code>.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>This is the default setting:</p>
<pre><code>builders = @/etc/nix/machines
</code></pre>
</blockquote>
<p>Each machine specification consists of the following elements, separated by spaces.
Only the first element is required.
To leave a field at its default, set it to <code>-</code>.</p>
<ol>
<li>
<p>The URI of the remote store in the format <code>ssh://[username@]hostname</code>.</p>
<blockquote>
<p><strong>Example</strong></p>
<p><code>ssh://nix@mac</code></p>
</blockquote>
<p>For backward compatibility, <code>ssh://</code> may be omitted.
The hostname may be an alias defined in <code>~/.ssh/config</code>.</p>
</li>
<li>
<p>A comma-separated list of <a href="command-ref/../development/building.html#system-type">Nix system types</a>.
If omitted, this defaults to the local platform type.</p>
<blockquote>
<p><strong>Example</strong></p>
<p><code>aarch64-darwin</code></p>
</blockquote>
<p>It is possible for a machine to support multiple platform types.</p>
<blockquote>
<p><strong>Example</strong></p>
<p><code>i686-linux,x86_64-linux</code></p>
</blockquote>
</li>
<li>
<p>The SSH identity file to be used to log in to the remote machine.
If omitted, SSH will use its regular identities.</p>
<blockquote>
<p><strong>Example</strong></p>
<p><code>/home/user/.ssh/id_mac</code></p>
</blockquote>
</li>
<li>
<p>The maximum number of builds that Nix will execute in parallel on the machine.
Typically this should be equal to the number of CPU cores.</p>
</li>
<li>
<p>The “speed factor”, indicating the relative speed of the machine as a positive integer.
If there are multiple machines of the right type, Nix will prefer the fastest, taking load into account.</p>
</li>
<li>
<p>A comma-separated list of supported <a href="command-ref/conf-file.html#conf-system-features">system features</a>.</p>
<p>A machine will only be used to build a derivation if all the features in the derivation's <a href="command-ref/../language/advanced-attributes.html#adv-attr-requiredSystemFeatures"><code>requiredSystemFeatures</code></a> attribute are supported by that machine.</p>
</li>
<li>
<p>A comma-separated list of required <a href="command-ref/conf-file.html#conf-system-features">system features</a>.</p>
<p>A machine will only be used to build a derivation if all of the machine’s required features appear in the derivation’s <a href="command-ref/../language/advanced-attributes.html#adv-attr-requiredSystemFeatures"><code>requiredSystemFeatures</code></a> attribute.</p>
</li>
<li>
<p>The (base64-encoded) public host key of the remote machine.
If omitted, SSH will use its regular <code>known_hosts</code> file.</p>
<p>The value for this field can be obtained via <code>base64 -w0</code>.</p>
</li>
</ol>
<blockquote>
<p><strong>Example</strong></p>
<p>Multiple builders specified on the command line:</p>
<pre><code class="language-console">--builders 'ssh://mac x86_64-darwin ; ssh://beastie x86_64-freebsd'
</code></pre>
</blockquote>
<blockquote>
<p><strong>Example</strong></p>
<p>This specifies several machines that can perform <code>i686-linux</code> builds:</p>
<pre><code>nix@scratchy.labs.cs.uu.nl i686-linux /home/nix/.ssh/id_scratchy 8 1 kvm
nix@itchy.labs.cs.uu.nl    i686-linux /home/nix/.ssh/id_scratchy 8 2
nix@poochie.labs.cs.uu.nl  i686-linux /home/nix/.ssh/id_scratchy 1 2 kvm benchmark
</code></pre>
<p>However, <code>poochie</code> will only build derivations that have the attribute</p>
<pre><code class="language-nix">requiredSystemFeatures = [ "benchmark" ];
</code></pre>
<p>or</p>
<pre><code class="language-nix">requiredSystemFeatures = [ "benchmark" "kvm" ];
</code></pre>
<p><code>itchy</code> cannot do builds that require <code>kvm</code>, but <code>scratchy</code> does support such builds.
For regular builds, <code>itchy</code> will be preferred over <code>scratchy</code> because it has a higher speed factor.</p>
</blockquote>
<p>For Nix to use substituters, the calling user must be in the <a href="command-ref/conf-file.html#conf-trusted-users"><code>trusted-users</code></a> list.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>A build machine must be accessible via SSH and have Nix installed.
<code>nix</code> must be available in <code>$PATH</code> for the user connecting over SSH.</p>
</blockquote>
<blockquote>
<p><strong>Warning</strong></p>
<p>If you are building via the Nix daemon (default), the Nix daemon user account on the local machine (that is, <code>root</code>) requires access to a user account on the remote machine (not necessarily <code>root</code>).</p>
<p>If you can’t or don’t want to configure <code>root</code> to be able to access the remote machine, set <a href="command-ref/conf-file.html#conf-store"><code>store</code></a> to any <a href="command-ref/../store/types/local-store.html">local store</a>, e.g. by passing <code>--store /tmp</code> to the command on the local machine.</p>
</blockquote>
<p>To build only on remote machines and disable local builds, set <a href="command-ref/conf-file.html#conf-max-jobs"><code>max-jobs</code></a> to 0.</p>
<p>If you want the remote machines to use substituters, set <a href="command-ref/conf-file.html#conf-builders-use-substituters"><code>builders-use-substitutes</code></a> to <code>true</code>.</p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="conf-builders-use-substitutes"><a href="command-ref/conf-file.html#conf-builders-use-substitutes"><code>builders-use-substitutes</code></a></span></p>
<p>If set to <code>true</code>, Nix will instruct <a href="command-ref/conf-file.html#conf-builders">remote build machines</a> to use their own <a href="command-ref/conf-file.html#conf-substituters"><code>substituters</code></a> if available.</p>
<p>It means that remote build hosts will fetch as many dependencies as possible from their own substituters (e.g, from <code>cache.nixos.org</code>) instead of waiting for the local machine to upload them all.
This can drastically reduce build times if the network connection between the local machine and the remote build host is slow.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-commit-lock-file-summary"><a href="command-ref/conf-file.html#conf-commit-lock-file-summary"><code>commit-lock-file-summary</code></a></span></p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This setting is part of an
<a href="command-ref/../development/experimental-features.html">experimental feature</a>.</p>
<p>To change this setting, make sure the
<a href="command-ref/../development/experimental-features.html#xp-feature-flakes"><code>flakes</code> experimental feature</a>
is enabled.
For example, include the following in <a href="command-ref/../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = flakes
commit-lock-file-summary = ...
</code></pre>
</blockquote>
<p>The commit summary to use when committing changed flake lock files. If
empty, the summary is generated based on the action performed.</p>
<p><strong>Default:</strong> <em>empty</em></p>
<p><strong>Deprecated alias:</strong> <code>commit-lockfile-summary</code></p>
</li>
<li>
<p><span id="conf-compress-build-log"><a href="command-ref/conf-file.html#conf-compress-build-log"><code>compress-build-log</code></a></span></p>
<p>If set to <code>true</code> (the default), build logs written to
<code>/nix/var/log/nix/drvs</code> will be compressed on the fly using bzip2.
Otherwise, they will not be compressed.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Deprecated alias:</strong> <code>build-compress-log</code></p>
</li>
<li>
<p><span id="conf-connect-timeout"><a href="command-ref/conf-file.html#conf-connect-timeout"><code>connect-timeout</code></a></span></p>
<p>The timeout (in seconds) for establishing connections in the
binary cache substituter. It corresponds to <code>curl</code>’s
<code>--connect-timeout</code> option. A value of 0 means no limit.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="conf-cores"><a href="command-ref/conf-file.html#conf-cores"><code>cores</code></a></span></p>
<p>Sets the value of the <code>NIX_BUILD_CORES</code> environment variable in the <a href="command-ref/../language/derivations.html#builder-execution">invocation of the <code>builder</code> executable</a> of a derivation.
The <code>builder</code> executable can use this variable to control its own maximum amount of parallelism.</p>
<!--
FIXME(@fricklerhandwerk): I don't think this should even be mentioned here.
A very generic example using `derivation` and `xargs` may be more appropriate to explain the mechanism.
Using `mkDerivation` as an example requires being aware of that there are multiple independent layers that are completely opaque here.
-->
<p>For instance, in Nixpkgs, if the attribute <code>enableParallelBuilding</code> for the <code>mkDerivation</code> build helper is set to <code>true</code>, it will pass the <code>-j${NIX_BUILD_CORES}</code> flag to GNU Make.</p>
<p>The value <code>0</code> means that the <code>builder</code> should use all available CPU cores in the system.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>The number of parallel local Nix build jobs is independently controlled with the <a href="command-ref/conf-file.html#conf-max-jobs"><code>max-jobs</code></a> setting.</p>
</blockquote>
<p><strong>Default:</strong> <em>machine-specific</em></p>
<p><strong>Deprecated alias:</strong> <code>build-cores</code></p>
</li>
<li>
<p><span id="conf-debugger-on-trace"><a href="command-ref/conf-file.html#conf-debugger-on-trace"><code>debugger-on-trace</code></a></span></p>
<p>If set to true and the <code>--debugger</code> flag is given, the following functions
will enter the debugger like <a href="command-ref/../language/builtins.html#builtins-break"><code>builtins.break</code></a>.</p>
<ul>
<li><a href="command-ref/../language/builtins.html#builtins-trace"><code>builtins.trace</code></a></li>
<li><a href="command-ref/../language/builtins.html#builtins-traceVerbose"><code>builtins.traceVerbose</code></a>
if <a href="command-ref/conf-file.html#conf-trace-verbose"><code>trace-verbose</code></a> is set to true.</li>
<li><a href="command-ref/../language/builtins.html#builtins-warn"><code>builtins.warn</code></a></li>
</ul>
<p>This is useful for debugging warnings in third-party Nix code.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-debugger-on-warn"><a href="command-ref/conf-file.html#conf-debugger-on-warn"><code>debugger-on-warn</code></a></span></p>
<p>If set to true and the <code>--debugger</code> flag is given, <a href="command-ref/../language/builtins.html#builtins-warn"><code>builtins.warn</code></a>
will enter the debugger like <a href="command-ref/../language/builtins.html#builtins-break"><code>builtins.break</code></a>.</p>
<p>This is useful for debugging warnings in third-party Nix code.</p>
<p>Use <a href="command-ref/conf-file.html#conf-debugger-on-trace"><code>debugger-on-trace</code></a> to also enter the debugger on legacy warnings that are logged with <a href="command-ref/../language/builtins.html#builtins-trace"><code>builtins.trace</code></a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-diff-hook"><a href="command-ref/conf-file.html#conf-diff-hook"><code>diff-hook</code></a></span></p>
<p>Absolute path to an executable capable of diffing build
results. The hook is executed if <code>run-diff-hook</code> is true, and the
output of a build is known to not be the same. This program is not
executed to determine if two results are the same.</p>
<p>The diff hook is executed by the same user and group who ran the
build. However, the diff hook does not have write access to the
store path just built.</p>
<p>The diff hook program receives three parameters:</p>
<ol>
<li>
<p>A path to the previous build's results</p>
</li>
<li>
<p>A path to the current build's results</p>
</li>
<li>
<p>The path to the build's derivation</p>
</li>
<li>
<p>The path to the build's scratch directory. This directory will
exist only if the build was run with <code>--keep-failed</code>.</p>
</li>
</ol>
<p>The stderr and stdout output from the diff hook will not be
displayed to the user. Instead, it will print to the nix-daemon's
log.</p>
<p>When using the Nix daemon, <code>diff-hook</code> must be set in the <code>nix.conf</code>
configuration file, and cannot be passed at the command line.</p>
<p><strong>Default:</strong> ``</p>
</li>
<li>
<p><span id="conf-download-attempts"><a href="command-ref/conf-file.html#conf-download-attempts"><code>download-attempts</code></a></span></p>
<p>How often Nix will attempt to download a file before giving up.</p>
<p><strong>Default:</strong> <code>5</code></p>
</li>
<li>
<p><span id="conf-download-buffer-size"><a href="command-ref/conf-file.html#conf-download-buffer-size"><code>download-buffer-size</code></a></span></p>
<p>The size of Nix's internal download buffer in bytes during <code>curl</code> transfers. If data is
not processed quickly enough to exceed the size of this buffer, downloads may stall.
The default is 67108864 (64 MiB).</p>
<p><strong>Default:</strong> <code>67108864</code></p>
</li>
<li>
<p><span id="conf-download-speed"><a href="command-ref/conf-file.html#conf-download-speed"><code>download-speed</code></a></span></p>
<p>Specify the maximum transfer rate in kilobytes per second you want
Nix to use for downloads.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="conf-eval-cache"><a href="command-ref/conf-file.html#conf-eval-cache"><code>eval-cache</code></a></span></p>
<p>Whether to use the flake evaluation cache.
Certain commands won't have to evaluate when invoked for the second time with a particular version of a flake.
Intermediate results are not cached.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="conf-eval-system"><a href="command-ref/conf-file.html#conf-eval-system"><code>eval-system</code></a></span></p>
<p>This option defines
<a href="command-ref/../language/builtins.html#builtins-currentSystem"><code>builtins.currentSystem</code></a>
in the Nix language if it is set as a non-empty string.
Otherwise, if it is defined as the empty string (the default), the value of the
<a href="command-ref/conf-file.html#conf-system"><code>system</code> </a>
configuration setting is used instead.</p>
<p>Unlike <code>system</code>, this setting does not change what kind of derivations can be built locally.
This is useful for evaluating Nix code on one system to produce derivations to be built on another type of system.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="conf-experimental-features"><a href="command-ref/conf-file.html#conf-experimental-features"><code>experimental-features</code></a></span></p>
<p>Experimental features that are enabled.</p>
<p>Example:</p>
<pre><code>experimental-features = nix-command flakes
</code></pre>
<p>The following experimental features are available:</p>
<ul>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-auto-allocate-uids"><code>auto-allocate-uids</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-blake3-hashes"><code>blake3-hashes</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-ca-derivations"><code>ca-derivations</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-cgroups"><code>cgroups</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-configurable-impure-env"><code>configurable-impure-env</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-daemon-trust-override"><code>daemon-trust-override</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-dynamic-derivations"><code>dynamic-derivations</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-fetch-closure"><code>fetch-closure</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-fetch-tree"><code>fetch-tree</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-flakes"><code>flakes</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-git-hashing"><code>git-hashing</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-impure-derivations"><code>impure-derivations</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-local-overlay-store"><code>local-overlay-store</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-mounted-ssh-store"><code>mounted-ssh-store</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-nix-command"><code>nix-command</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-no-url-literals"><code>no-url-literals</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-parse-toml-timestamps"><code>parse-toml-timestamps</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-pipe-operators"><code>pipe-operators</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-read-only-local-store"><code>read-only-local-store</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-recursive-nix"><code>recursive-nix</code></a></li>
<li><a href="command-ref/../development/experimental-features.html#xp-feature-verified-fetches"><code>verified-fetches</code></a></li>
</ul>
<p>Experimental features are <a href="command-ref/../development/experimental-features.html">further documented in the manual</a>.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="conf-extra-platforms"><a href="command-ref/conf-file.html#conf-extra-platforms"><code>extra-platforms</code></a></span></p>
<p>System types of executables that can be run on this machine.</p>
<p>Nix will only build a given <a href="command-ref/../glossary.html#gloss-store-derivation">store derivation</a> locally when its <code>system</code> attribute equals any of the values specified here or in the <a href="command-ref/conf-file.html#conf-system"><code>system</code> option</a>.</p>
<p>Setting this can be useful to build derivations locally on compatible machines:</p>
<ul>
<li><code>i686-linux</code> executables can be run on <code>x86_64-linux</code> machines (set by default)</li>
<li><code>x86_64-darwin</code> executables can be run on macOS <code>aarch64-darwin</code> with Rosetta 2 (set by default where applicable)</li>
<li><code>armv6</code> and <code>armv5tel</code> executables can be run on <code>armv7</code></li>
<li>some <code>aarch64</code> machines can also natively run 32-bit ARM code</li>
<li><code>qemu-user</code> may be used to support non-native platforms (though this
may be slow and buggy)</li>
</ul>
<p>Build systems will usually detect the target platform to be the current physical system and therefore produce machine code incompatible with what may be intended in the derivation.
You should design your derivation's <code>builder</code> accordingly and cross-check the results when using this option against natively-built versions of your derivation.</p>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="conf-fallback"><a href="command-ref/conf-file.html#conf-fallback"><code>fallback</code></a></span></p>
<p>If set to <code>true</code>, Nix will fall back to building from source if a
binary substitute fails. This is equivalent to the <code>--fallback</code>
flag. The default is <code>false</code>.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Deprecated alias:</strong> <code>build-fallback</code></p>
</li>
<li>
<p><span id="conf-filter-syscalls"><a href="command-ref/conf-file.html#conf-filter-syscalls"><code>filter-syscalls</code></a></span></p>
<p>Whether to prevent certain dangerous system calls, such as
creation of setuid/setgid files or adding ACLs or extended
attributes. Only disable this if you're aware of the
security implications.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="conf-flake-registry"><a href="command-ref/conf-file.html#conf-flake-registry"><code>flake-registry</code></a></span></p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This setting is part of an
<a href="command-ref/../development/experimental-features.html">experimental feature</a>.</p>
<p>To change this setting, make sure the
<a href="command-ref/../development/experimental-features.html#xp-feature-flakes"><code>flakes</code> experimental feature</a>
is enabled.
For example, include the following in <a href="command-ref/../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = flakes
flake-registry = ...
</code></pre>
</blockquote>
<p>Path or URI of the global flake registry.</p>
<p>When empty, disables the global flake registry.</p>
<p><strong>Default:</strong> <code>https://channels.nixos.org/flake-registry.json</code></p>
</li>
<li>
<p><span id="conf-fsync-metadata"><a href="command-ref/conf-file.html#conf-fsync-metadata"><code>fsync-metadata</code></a></span></p>
<p>If set to <code>true</code>, changes to the Nix store metadata (in
<code>/nix/var/nix/db</code>) are synchronously flushed to disk. This improves
robustness in case of system crashes, but reduces performance. The
default is <code>true</code>.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="conf-fsync-store-paths"><a href="command-ref/conf-file.html#conf-fsync-store-paths"><code>fsync-store-paths</code></a></span></p>
<p>Whether to call <code>fsync()</code> on store paths before registering them, to
flush them to disk. This improves robustness in case of system crashes,
but reduces performance. The default is <code>false</code>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-gc-reserved-space"><a href="command-ref/conf-file.html#conf-gc-reserved-space"><code>gc-reserved-space</code></a></span></p>
<p>Amount of reserved disk space for the garbage collector.</p>
<p><strong>Default:</strong> <code>8388608</code></p>
</li>
<li>
<p><span id="conf-hashed-mirrors"><a href="command-ref/conf-file.html#conf-hashed-mirrors"><code>hashed-mirrors</code></a></span></p>
<p>A list of web servers used by <code>builtins.fetchurl</code> to obtain files by
hash. Given a hash algorithm <em>ha</em> and a base-16 hash <em>h</em>, Nix will try to
download the file from <em>hashed-mirror</em>/<em>ha</em>/<em>h</em>. This allows files to
be downloaded even if they have disappeared from their original URI.
For example, given an example mirror <code>http://tarballs.nixos.org/</code>,
when building the derivation</p>
<pre><code class="language-nix">builtins.fetchurl {
  url = "https://example.org/foo-1.2.3.tar.xz";
  sha256 = "2c26b46b68ffc68ff99b453c1d30413413422d706483bfa0f98a5e886266e7ae";
}
</code></pre>
<p>Nix will attempt to download this file from
<code>http://tarballs.nixos.org/sha256/2c26b46b68ffc68ff99b453c1d30413413422d706483bfa0f98a5e886266e7ae</code>
first. If it is not available there, if will try the original URI.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="conf-http-connections"><a href="command-ref/conf-file.html#conf-http-connections"><code>http-connections</code></a></span></p>
<p>The maximum number of parallel TCP connections used to fetch
files from binary caches and by other downloads. It defaults
to 25. 0 means no limit.</p>
<p><strong>Default:</strong> <code>25</code></p>
<p><strong>Deprecated alias:</strong> <code>binary-caches-parallel-connections</code></p>
</li>
<li>
<p><span id="conf-http2"><a href="command-ref/conf-file.html#conf-http2"><code>http2</code></a></span></p>
<p>Whether to enable HTTP/2 support.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="conf-id-count"><a href="command-ref/conf-file.html#conf-id-count"><code>id-count</code></a></span></p>
<p>The number of UIDs/GIDs to use for dynamic ID allocation.</p>
<p><strong>Default:</strong> <code>8388608</code></p>
</li>
<li>
<p><span id="conf-ignore-try"><a href="command-ref/conf-file.html#conf-ignore-try"><code>ignore-try</code></a></span></p>
<p>If set to true, ignore exceptions inside 'tryEval' calls when evaluating nix expressions in
debug mode (using the --debugger flag). By default the debugger will pause on all exceptions.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-ignored-acls"><a href="command-ref/conf-file.html#conf-ignored-acls"><code>ignored-acls</code></a></span></p>
<p>A list of ACLs that should be ignored, normally Nix attempts to
remove all ACLs from files and directories in the Nix store, but
some ACLs like <code>security.selinux</code> or <code>system.nfs4_acl</code> can't be
removed even by root. Therefore it's best to just ignore them.</p>
<p><strong>Default:</strong> <code>security.csm security.selinux system.nfs4_acl</code></p>
</li>
<li>
<p><span id="conf-impersonate-linux-26"><a href="command-ref/conf-file.html#conf-impersonate-linux-26"><code>impersonate-linux-26</code></a></span></p>
<p>Whether to impersonate a Linux 2.6 machine on newer kernels.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Deprecated alias:</strong> <code>build-impersonate-linux-26</code></p>
</li>
<li>
<p><span id="conf-impure-env"><a href="command-ref/conf-file.html#conf-impure-env"><code>impure-env</code></a></span></p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This setting is part of an
<a href="command-ref/../development/experimental-features.html">experimental feature</a>.</p>
<p>To change this setting, make sure the
<a href="command-ref/../development/experimental-features.html#xp-feature-configurable-impure-env"><code>configurable-impure-env</code> experimental feature</a>
is enabled.
For example, include the following in <a href="command-ref/../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = configurable-impure-env
impure-env = ...
</code></pre>
</blockquote>
<p>A list of items, each in the format of:</p>
<ul>
<li><code>name=value</code>: Set environment variable <code>name</code> to <code>value</code>.</li>
</ul>
<p>If the user is trusted (see <code>trusted-users</code> option), when building
a fixed-output derivation, environment variables set in this option
will be passed to the builder if they are listed in <a href="command-ref/../language/advanced-attributes.html#adv-attr-impureEnvVars"><code>impureEnvVars</code></a>.</p>
<p>This option is useful for, e.g., setting <code>https_proxy</code> for
fixed-output derivations and in a multi-user Nix installation, or
setting private access tokens when fetching a private repository.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="conf-keep-build-log"><a href="command-ref/conf-file.html#conf-keep-build-log"><code>keep-build-log</code></a></span></p>
<p>If set to <code>true</code> (the default), Nix will write the build log of a
derivation (i.e. the standard output and error of its builder) to
the directory <code>/nix/var/log/nix/drvs</code>. The build log can be
retrieved using the command <code>nix-store -l path</code>.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Deprecated alias:</strong> <code>build-keep-log</code></p>
</li>
<li>
<p><span id="conf-keep-derivations"><a href="command-ref/conf-file.html#conf-keep-derivations"><code>keep-derivations</code></a></span></p>
<p>If <code>true</code> (default), the garbage collector will keep the derivations
from which non-garbage store paths were built. If <code>false</code>, they will
be deleted unless explicitly registered as a root (or reachable from
other roots).</p>
<p>Keeping derivation around is useful for querying and traceability
(e.g., it allows you to ask with what dependencies or options a
store path was built), so by default this option is on. Turn it off
to save a bit of disk space (or a lot if <code>keep-outputs</code> is also
turned on).</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Deprecated alias:</strong> <code>gc-keep-derivations</code></p>
</li>
<li>
<p><span id="conf-keep-env-derivations"><a href="command-ref/conf-file.html#conf-keep-env-derivations"><code>keep-env-derivations</code></a></span></p>
<p>If <code>false</code> (default), derivations are not stored in Nix user
environments. That is, the derivations of any build-time-only
dependencies may be garbage-collected.</p>
<p>If <code>true</code>, when you add a Nix derivation to a user environment, the
path of the derivation is stored in the user environment. Thus, the
derivation will not be garbage-collected until the user environment
generation is deleted (<code>nix-env --delete-generations</code>). To prevent
build-time-only dependencies from being collected, you should also
turn on <code>keep-outputs</code>.</p>
<p>The difference between this option and <code>keep-derivations</code> is that
this one is “sticky”: it applies to any user environment created
while this option was enabled, while <code>keep-derivations</code> only applies
at the moment the garbage collector is run.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Deprecated alias:</strong> <code>env-keep-derivations</code></p>
</li>
<li>
<p><span id="conf-keep-failed"><a href="command-ref/conf-file.html#conf-keep-failed"><code>keep-failed</code></a></span></p>
<p>Whether to keep temporary directories of failed builds.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-keep-going"><a href="command-ref/conf-file.html#conf-keep-going"><code>keep-going</code></a></span></p>
<p>Whether to keep building derivations when another build fails.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-keep-outputs"><a href="command-ref/conf-file.html#conf-keep-outputs"><code>keep-outputs</code></a></span></p>
<p>If <code>true</code>, the garbage collector will keep the outputs of
non-garbage derivations. If <code>false</code> (default), outputs will be
deleted unless they are GC roots themselves (or reachable from other
roots).</p>
<p>In general, outputs must be registered as roots separately. However,
even if the output of a derivation is registered as a root, the
collector will still delete store paths that are used only at build
time (e.g., the C compiler, or source tarballs downloaded from the
network). To prevent it from doing so, set this option to <code>true</code>.</p>
<p><strong>Default:</strong> <code>false</code></p>
<p><strong>Deprecated alias:</strong> <code>gc-keep-outputs</code></p>
</li>
<li>
<p><span id="conf-log-lines"><a href="command-ref/conf-file.html#conf-log-lines"><code>log-lines</code></a></span></p>
<p>The number of lines of the tail of the log to show if a build fails.</p>
<p><strong>Default:</strong> <code>25</code></p>
</li>
<li>
<p><span id="conf-max-build-log-size"><a href="command-ref/conf-file.html#conf-max-build-log-size"><code>max-build-log-size</code></a></span></p>
<p>This option defines the maximum number of bytes that a builder can
write to its stdout/stderr. If the builder exceeds this limit, it’s
killed. A value of <code>0</code> (the default) means that there is no limit.</p>
<p><strong>Default:</strong> <code>0</code></p>
<p><strong>Deprecated alias:</strong> <code>build-max-log-size</code></p>
</li>
<li>
<p><span id="conf-max-call-depth"><a href="command-ref/conf-file.html#conf-max-call-depth"><code>max-call-depth</code></a></span></p>
<p>The maximum function call depth to allow before erroring.</p>
<p><strong>Default:</strong> <code>10000</code></p>
</li>
<li>
<p><span id="conf-max-free"><a href="command-ref/conf-file.html#conf-max-free"><code>max-free</code></a></span></p>
<p>When a garbage collection is triggered by the <code>min-free</code> option, it
stops as soon as <code>max-free</code> bytes are available. The default is
infinity (i.e. delete all garbage).</p>
<p><strong>Default:</strong> <code>9223372036854775807</code></p>
</li>
<li>
<p><span id="conf-max-jobs"><a href="command-ref/conf-file.html#conf-max-jobs"><code>max-jobs</code></a></span></p>
<p>Maximum number of jobs that Nix will try to build locally in parallel.</p>
<p>The special value <code>auto</code> causes Nix to use the number of CPUs in your system.
Use <code>0</code> to disable local builds and directly use the remote machines specified in <a href="command-ref/conf-file.html#conf-builders"><code>builders</code></a>.
This will not affect derivations that have <a href="command-ref/../language/advanced-attributes.html#adv-attr-preferLocalBuild"><code>preferLocalBuild = true</code></a>, which are always built locally.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>The number of CPU cores to use for each build job is independently determined by the <a href="command-ref/conf-file.html#conf-cores"><code>cores</code></a> setting.</p>
</blockquote>
<!-- TODO(@fricklerhandwerk): would be good to have those shorthands for common options as part of the specification -->
<p>The setting can be overridden using the <code>--max-jobs</code> (<code>-j</code>) command line switch.</p>
<p><strong>Default:</strong> <code>1</code></p>
<p><strong>Deprecated alias:</strong> <code>build-max-jobs</code></p>
</li>
<li>
<p><span id="conf-max-silent-time"><a href="command-ref/conf-file.html#conf-max-silent-time"><code>max-silent-time</code></a></span></p>
<p>This option defines the maximum number of seconds that a builder can
go without producing any data on standard output or standard error.
This is useful (for instance in an automated build system) to catch
builds that are stuck in an infinite loop, or to catch remote builds
that are hanging due to network problems. It can be overridden using
the <code>--max-silent-time</code> command line switch.</p>
<p>The value <code>0</code> means that there is no timeout. This is also the
default.</p>
<p><strong>Default:</strong> <code>0</code></p>
<p><strong>Deprecated alias:</strong> <code>build-max-silent-time</code></p>
</li>
<li>
<p><span id="conf-max-substitution-jobs"><a href="command-ref/conf-file.html#conf-max-substitution-jobs"><code>max-substitution-jobs</code></a></span></p>
<p>This option defines the maximum number of substitution jobs that Nix
will try to run in parallel. The default is <code>16</code>. The minimum value
one can choose is <code>1</code> and lower values will be interpreted as <code>1</code>.</p>
<p><strong>Default:</strong> <code>16</code></p>
<p><strong>Deprecated alias:</strong> <code>substitution-max-jobs</code></p>
</li>
<li>
<p><span id="conf-min-free"><a href="command-ref/conf-file.html#conf-min-free"><code>min-free</code></a></span></p>
<p>When free disk space in <code>/nix/store</code> drops below <code>min-free</code> during a
build, Nix performs a garbage-collection until <code>max-free</code> bytes are
available or there is no more garbage. A value of <code>0</code> (the default)
disables this feature.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
<li>
<p><span id="conf-min-free-check-interval"><a href="command-ref/conf-file.html#conf-min-free-check-interval"><code>min-free-check-interval</code></a></span></p>
<p>Number of seconds between checking free disk space.</p>
<p><strong>Default:</strong> <code>5</code></p>
</li>
<li>
<p><span id="conf-nar-buffer-size"><a href="command-ref/conf-file.html#conf-nar-buffer-size"><code>nar-buffer-size</code></a></span></p>
<p>Maximum size of NARs before spilling them to disk.</p>
<p><strong>Default:</strong> <code>33554432</code></p>
</li>
<li>
<p><span id="conf-narinfo-cache-negative-ttl"><a href="command-ref/conf-file.html#conf-narinfo-cache-negative-ttl"><code>narinfo-cache-negative-ttl</code></a></span></p>
<p>The TTL in seconds for negative lookups.
If a store path is queried from a <a href="command-ref/conf-file.html#conf-substituters">substituter</a> but was not found, there will be a negative lookup cached in the local disk cache database for the specified duration.</p>
<p>Set to <code>0</code> to force updating the lookup cache.</p>
<p>To wipe the lookup cache completely:</p>
<pre><code class="language-shell-session">$ rm $HOME/.cache/nix/binary-cache-v*.sqlite*
# rm /root/.cache/nix/binary-cache-v*.sqlite*
</code></pre>
<p><strong>Default:</strong> <code>3600</code></p>
</li>
<li>
<p><span id="conf-narinfo-cache-positive-ttl"><a href="command-ref/conf-file.html#conf-narinfo-cache-positive-ttl"><code>narinfo-cache-positive-ttl</code></a></span></p>
<p>The TTL in seconds for positive lookups. If a store path is queried
from a substituter, the result of the query will be cached in the
local disk cache database including some of the NAR metadata. The
default TTL is a month, setting a shorter TTL for positive lookups
can be useful for binary caches that have frequent garbage
collection, in which case having a more frequent cache invalidation
would prevent trying to pull the path again and failing with a hash
mismatch if the build isn't reproducible.</p>
<p><strong>Default:</strong> <code>2592000</code></p>
</li>
<li>
<p><span id="conf-netrc-file"><a href="command-ref/conf-file.html#conf-netrc-file"><code>netrc-file</code></a></span></p>
<p>If set to an absolute path to a <code>netrc</code> file, Nix will use the HTTP
authentication credentials in this file when trying to download from
a remote host through HTTP or HTTPS. Defaults to
<code>$NIX_CONF_DIR/netrc</code>.</p>
<p>The <code>netrc</code> file consists of a list of accounts in the following
format:</p>
<pre><code>machine my-machine
login my-username
password my-password
</code></pre>
<p>For the exact syntax, see <a href="https://ec.haxx.se/usingcurl-netrc.html">the <code>curl</code>
documentation</a>.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>This must be an absolute path, and <code>~</code> is not resolved. For
example, <code>~/.netrc</code> won't resolve to your home directory's
<code>.netrc</code>.</p>
</blockquote>
<p><strong>Default:</strong> <code>/dummy/netrc</code></p>
</li>
<li>
<p><span id="conf-nix-path"><a href="command-ref/conf-file.html#conf-nix-path"><code>nix-path</code></a></span></p>
<p>List of search paths to use for <a href="command-ref/../language/constructs/lookup-path.html">lookup path</a> resolution.
This setting determines the value of
<a href="command-ref/../language/builtins.html#builtins-nixPath"><code>builtins.nixPath</code></a> and can be used with <a href="command-ref/../language/builtins.html#builtins-findFile"><code>builtins.findFile</code></a>.</p>
<ul>
<li>The configuration setting is overridden by the <a href="command-ref/../command-ref/env-common.html#env-NIX_PATH"><code>NIX_PATH</code></a>
environment variable.</li>
<li><code>NIX_PATH</code> is overridden by <a href="command-ref/../command-ref/conf-file.html#command-line-flags">specifying the setting as the command line flag</a> <code>--nix-path</code>.</li>
<li>Any current value is extended by the <a href="command-ref/../command-ref/opt-common.html#opt-I"><code>-I</code> option</a> or <code>--extra-nix-path</code>.</li>
</ul>
<p>If the respective paths are accessible, the default values are:</p>
<ul>
<li>
<p><code>$HOME/.nix-defexpr/channels</code></p>
<p>The <a href="command-ref/../command-ref/files/default-nix-expression.html#user-channel-link">user channel link</a>, pointing to the current state of <a href="command-ref/../command-ref/files/channels.html">channels</a> for the current user.</p>
</li>
<li>
<p><code>nixpkgs=$NIX_STATE_DIR/profiles/per-user/root/channels/nixpkgs</code></p>
<p>The current state of the <code>nixpkgs</code> channel for the <code>root</code> user.</p>
</li>
<li>
<p><code>$NIX_STATE_DIR/profiles/per-user/root/channels</code></p>
<p>The current state of all channels for the <code>root</code> user.</p>
</li>
</ul>
<p>These files are set up by the <a href="command-ref/../installation/installing-binary.html">Nix installer</a>.
See <a href="command-ref/../command-ref/env-common.html#env-NIX_STATE_DIR"><code>NIX_STATE_DIR</code></a> for details on the environment variable.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>If <a href="command-ref/../command-ref/conf-file.html#conf-restrict-eval">restricted evaluation</a> is enabled, the default value is empty.</p>
<p>If <a href="command-ref/conf-file.html#conf-pure-eval">pure evaluation</a> is enabled, <code>builtins.nixPath</code> <em>always</em> evaluates to the empty list <code>[ ]</code>.</p>
</blockquote>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="conf-nix-shell-always-looks-for-shell-nix"><a href="command-ref/conf-file.html#conf-nix-shell-always-looks-for-shell-nix"><code>nix-shell-always-looks-for-shell-nix</code></a></span></p>
<p>Before Nix 2.24, <a href="command-ref/../command-ref/nix-shell.html"><code>nix-shell</code></a> would only look at <code>shell.nix</code> if it was in the working directory - when no file was specified.</p>
<p>Since Nix 2.24, <code>nix-shell</code> always looks for a <code>shell.nix</code>, whether that's in the working directory, or in a directory that was passed as an argument.</p>
<p>You may set this to <code>false</code> to temporarily revert to the behavior of Nix 2.23 and older.</p>
<p>Using this setting is not recommended.
It will be deprecated and removed.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="conf-nix-shell-shebang-arguments-relative-to-script"><a href="command-ref/conf-file.html#conf-nix-shell-shebang-arguments-relative-to-script"><code>nix-shell-shebang-arguments-relative-to-script</code></a></span></p>
<p>Before Nix 2.24, relative file path expressions in arguments in a <code>nix-shell</code> shebang were resolved relative to the working directory.</p>
<p>Since Nix 2.24, <code>nix-shell</code> resolves these paths in a manner that is relative to the <a href="command-ref/../glossary.html#gloss-base-directory">base directory</a>, defined as the script's directory.</p>
<p>You may set this to <code>false</code> to temporarily revert to the behavior of Nix 2.23 and older.</p>
<p>Using this setting is not recommended.
It will be deprecated and removed.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="conf-plugin-files"><a href="command-ref/conf-file.html#conf-plugin-files"><code>plugin-files</code></a></span></p>
<p>A list of plugin files to be loaded by Nix. Each of these files will
be dlopened by Nix. If they contain the symbol <code>nix_plugin_entry()</code>,
this symbol will be called. Alternatively, they can affect execution
through static initialization. In particular, these plugins may construct
static instances of RegisterPrimOp to add new primops or constants to the
expression language, RegisterStoreImplementation to add new store
implementations, RegisterCommand to add new subcommands to the <code>nix</code>
command, and RegisterSetting to add new nix config settings. See the
constructors for those types for more details.</p>
<p>Warning! These APIs are inherently unstable and may change from
release to release.</p>
<p>Since these files are loaded into the same address space as Nix
itself, they must be DSOs compatible with the instance of Nix
running at the time (i.e. compiled against the same headers, not
linked to any incompatible libraries). They should not be linked to
any Nix libs directly, as those will be available already at load
time.</p>
<p>If an entry in the list is a directory, all files in the directory
are loaded as plugins (non-recursively).</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="conf-post-build-hook"><a href="command-ref/conf-file.html#conf-post-build-hook"><code>post-build-hook</code></a></span></p>
<p>Optional. The path to a program to execute after each build.</p>
<p>This option is only settable in the global <code>nix.conf</code>, or on the
command line by trusted users.</p>
<p>When using the nix-daemon, the daemon executes the hook as <code>root</code>.
If the nix-daemon is not involved, the hook runs as the user
executing the nix-build.</p>
<ul>
<li>
<p>The hook executes after an evaluation-time build.</p>
</li>
<li>
<p>The hook does not execute on substituted paths.</p>
</li>
<li>
<p>The hook's output always goes to the user's terminal.</p>
</li>
<li>
<p>If the hook fails, the build succeeds but no further builds
execute.</p>
</li>
<li>
<p>The hook executes synchronously, and blocks other builds from
progressing while it runs.</p>
</li>
</ul>
<p>The program executes with no arguments. The program's environment
contains the following environment variables:</p>
<ul>
<li>
<p><code>DRV_PATH</code>
The derivation for the built paths.</p>
<p>Example:
<code>/nix/store/5nihn1a7pa8b25l9zafqaqibznlvvp3f-bash-4.4-p23.drv</code></p>
</li>
<li>
<p><code>OUT_PATHS</code>
Output paths of the built derivation, separated by a space
character.</p>
<p>Example:
<code>/nix/store/zf5lbh336mnzf1nlswdn11g4n2m8zh3g-bash-4.4-p23-dev /nix/store/rjxwxwv1fpn9wa2x5ssk5phzwlcv4mna-bash-4.4-p23-doc /nix/store/6bqvbzjkcp9695dq0dpl5y43nvy37pq1-bash-4.4-p23-info /nix/store/r7fng3kk3vlpdlh2idnrbn37vh4imlj2-bash-4.4-p23-man /nix/store/xfghy8ixrhz3kyy6p724iv3cxji088dx-bash-4.4-p23</code>.</p>
</li>
</ul>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="conf-pre-build-hook"><a href="command-ref/conf-file.html#conf-pre-build-hook"><code>pre-build-hook</code></a></span></p>
<p>If set, the path to a program that can set extra derivation-specific
settings for this system. This is used for settings that can't be
captured by the derivation model itself and are too variable between
different versions of the same system to be hard-coded into nix.</p>
<p>The hook is passed the derivation path and, if sandboxes are
enabled, the sandbox directory. It can then modify the sandbox and
send a series of commands to modify various settings to stdout. The
currently recognized commands are:</p>
<ul>
<li><code>extra-sandbox-paths</code><br />
Pass a list of files and directories to be included in the
sandbox for this build. One entry per line, terminated by an
empty line. Entries have the same format as <code>sandbox-paths</code>.</li>
</ul>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="conf-preallocate-contents"><a href="command-ref/conf-file.html#conf-preallocate-contents"><code>preallocate-contents</code></a></span></p>
<p>Whether to preallocate files when writing objects with known size.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-print-missing"><a href="command-ref/conf-file.html#conf-print-missing"><code>print-missing</code></a></span></p>
<p>Whether to print what paths need to be built or downloaded.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="conf-pure-eval"><a href="command-ref/conf-file.html#conf-pure-eval"><code>pure-eval</code></a></span></p>
<p>Pure evaluation mode ensures that the result of Nix expressions is fully determined by explicitly declared inputs, and not influenced by external state:</p>
<ul>
<li>Restrict file system and network access to files specified by cryptographic hash</li>
<li>Disable impure constants:
<ul>
<li><a href="command-ref/../language/builtins.html#builtins-currentSystem"><code>builtins.currentSystem</code></a></li>
<li><a href="command-ref/../language/builtins.html#builtins-currentTime"><code>builtins.currentTime</code></a></li>
<li><a href="command-ref/../language/builtins.html#builtins-nixPath"><code>builtins.nixPath</code></a></li>
<li><a href="command-ref/../language/builtins.html#builtins-storePath"><code>builtins.storePath</code></a></li>
</ul>
</li>
</ul>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-require-drop-supplementary-groups"><a href="command-ref/conf-file.html#conf-require-drop-supplementary-groups"><code>require-drop-supplementary-groups</code></a></span></p>
<p>Following the principle of least privilege,
Nix will attempt to drop supplementary groups when building with sandboxing.</p>
<p>However this can fail under some circumstances.
For example, if the user lacks the <code>CAP_SETGID</code> capability.
Search <code>setgroups(2)</code> for <code>EPERM</code> to find more detailed information on this.</p>
<p>If you encounter such a failure, setting this option to <code>false</code> will let you ignore it and continue.
But before doing so, you should consider the security implications carefully.
Not dropping supplementary groups means the build sandbox will be less restricted than intended.</p>
<p>This option defaults to <code>true</code> when the user is root
(since <code>root</code> usually has permissions to call setgroups)
and <code>false</code> otherwise.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-require-sigs"><a href="command-ref/conf-file.html#conf-require-sigs"><code>require-sigs</code></a></span></p>
<p>If set to <code>true</code> (the default), any non-content-addressed path added
or copied to the Nix store (e.g. when substituting from a binary
cache) must have a signature by a trusted key. A trusted key is one
listed in <code>trusted-public-keys</code>, or a public key counterpart to a
private key stored in a file listed in <code>secret-key-files</code>.</p>
<p>Set to <code>false</code> to disable signature checking and trust all
non-content-addressed paths unconditionally.</p>
<p>(Content-addressed paths are inherently trustworthy and thus
unaffected by this configuration option.)</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="conf-restrict-eval"><a href="command-ref/conf-file.html#conf-restrict-eval"><code>restrict-eval</code></a></span></p>
<p>If set to <code>true</code>, the Nix evaluator will not allow access to any
files outside of
<a href="command-ref/../language/builtins.html#builtins-nixPath"><code>builtins.nixPath</code></a>,
or to URIs outside of
<a href="command-ref/../command-ref/conf-file.html#conf-allowed-uris"><code>allowed-uris</code></a>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-run-diff-hook"><a href="command-ref/conf-file.html#conf-run-diff-hook"><code>run-diff-hook</code></a></span></p>
<p>If true, enable the execution of the <code>diff-hook</code> program.</p>
<p>When using the Nix daemon, <code>run-diff-hook</code> must be set in the
<code>nix.conf</code> configuration file, and cannot be passed at the command
line.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-sandbox"><a href="command-ref/conf-file.html#conf-sandbox"><code>sandbox</code></a></span></p>
<p>If set to <code>true</code>, builds will be performed in a <em>sandboxed
environment</em>, i.e., they’re isolated from the normal file system
hierarchy and will only see their dependencies in the Nix store,
the temporary build directory, private versions of <code>/proc</code>,
<code>/dev</code>, <code>/dev/shm</code> and <code>/dev/pts</code> (on Linux), and the paths
configured with the <code>sandbox-paths</code> option. This is useful to
prevent undeclared dependencies on files in directories such as
<code>/usr/bin</code>. In addition, on Linux, builds run in private PID,
mount, network, IPC and UTS namespaces to isolate them from other
processes in the system (except that fixed-output derivations do
not run in private network namespace to ensure they can access the
network).</p>
<p>Currently, sandboxing only work on Linux and macOS. The use of a
sandbox requires that Nix is run as root (so you should use the
“build users” feature to perform the actual builds under different
users than root).</p>
<p>If this option is set to <code>relaxed</code>, then fixed-output derivations
and derivations that have the <code>__noChroot</code> attribute set to <code>true</code>
do not run in sandboxes.</p>
<p>The default is <code>true</code> on Linux and <code>false</code> on all other platforms.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Deprecated alias:</strong> <code>build-use-chroot</code>, <code>build-use-sandbox</code></p>
</li>
<li>
<p><span id="conf-sandbox-build-dir"><a href="command-ref/conf-file.html#conf-sandbox-build-dir"><code>sandbox-build-dir</code></a></span></p>
<p><em>Linux only</em></p>
<p>The build directory inside the sandbox.</p>
<p>This directory is backed by <a href="command-ref/conf-file.html#conf-build-dir"><code>build-dir</code></a> on the host.</p>
<p><strong>Default:</strong> <code>/build</code></p>
</li>
<li>
<p><span id="conf-sandbox-dev-shm-size"><a href="command-ref/conf-file.html#conf-sandbox-dev-shm-size"><code>sandbox-dev-shm-size</code></a></span></p>
<p><em>Linux only</em></p>
<p>This option determines the maximum size of the <code>tmpfs</code> filesystem
mounted on <code>/dev/shm</code> in Linux sandboxes. For the format, see the
description of the <code>size</code> option of <code>tmpfs</code> in mount(8). The default
is <code>50%</code>.</p>
<p><strong>Default:</strong> <code>50%</code></p>
</li>
<li>
<p><span id="conf-sandbox-fallback"><a href="command-ref/conf-file.html#conf-sandbox-fallback"><code>sandbox-fallback</code></a></span></p>
<p>Whether to disable sandboxing when the kernel doesn't allow it.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="conf-sandbox-paths"><a href="command-ref/conf-file.html#conf-sandbox-paths"><code>sandbox-paths</code></a></span></p>
<p>A list of paths bind-mounted into Nix sandbox environments. You can
use the syntax <code>target=source</code> to mount a path in a different
location in the sandbox; for instance, <code>/bin=/nix-bin</code> will mount
the path <code>/nix-bin</code> as <code>/bin</code> inside the sandbox. If <em>source</em> is
followed by <code>?</code>, then it is not an error if <em>source</em> does not exist;
for example, <code>/dev/nvidiactl?</code> specifies that <code>/dev/nvidiactl</code> will
only be mounted in the sandbox if it exists in the host filesystem.</p>
<p>If the source is in the Nix store, then its closure will be added to
the sandbox as well.</p>
<p>Depending on how Nix was built, the default value for this option
may be empty or provide <code>/bin/sh</code> as a bind-mount of <code>bash</code>.</p>
<p><strong>Default:</strong> <em>empty</em></p>
<p><strong>Deprecated alias:</strong> <code>build-chroot-dirs</code>, <code>build-sandbox-paths</code></p>
</li>
<li>
<p><span id="conf-secret-key-files"><a href="command-ref/conf-file.html#conf-secret-key-files"><code>secret-key-files</code></a></span></p>
<p>A whitespace-separated list of files containing secret (private)
keys. These are used to sign locally-built paths. They can be
generated using <code>nix-store --generate-binary-cache-key</code>. The
corresponding public key can be distributed to other users, who
can add it to <code>trusted-public-keys</code> in their <code>nix.conf</code>.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="conf-show-trace"><a href="command-ref/conf-file.html#conf-show-trace"><code>show-trace</code></a></span></p>
<p>Whether Nix should print out a stack trace in case of Nix
expression evaluation errors.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-ssl-cert-file"><a href="command-ref/conf-file.html#conf-ssl-cert-file"><code>ssl-cert-file</code></a></span></p>
<p>The path of a file containing CA certificates used to
authenticate <code>https://</code> downloads. Nix by default will use
the first of the following files that exists:</p>
<ol>
<li><code>/etc/ssl/certs/ca-certificates.crt</code></li>
<li><code>/nix/var/nix/profiles/default/etc/ssl/certs/ca-bundle.crt</code></li>
</ol>
<p>The path can be overridden by the following environment
variables, in order of precedence:</p>
<ol>
<li><code>NIX_SSL_CERT_FILE</code></li>
<li><code>SSL_CERT_FILE</code></li>
</ol>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="conf-stalled-download-timeout"><a href="command-ref/conf-file.html#conf-stalled-download-timeout"><code>stalled-download-timeout</code></a></span></p>
<p>The timeout (in seconds) for receiving data from servers
during download. Nix cancels idle downloads after this
timeout's duration.</p>
<p><strong>Default:</strong> <code>300</code></p>
</li>
<li>
<p><span id="conf-start-id"><a href="command-ref/conf-file.html#conf-start-id"><code>start-id</code></a></span></p>
<p>The first UID and GID to use for dynamic ID allocation.</p>
<p><strong>Default:</strong> <code>872415232</code></p>
</li>
<li>
<p><span id="conf-store"><a href="command-ref/conf-file.html#conf-store"><code>store</code></a></span></p>
<p>The <a href="command-ref/../store/types/index.html#store-url-format">URL of the Nix store</a>
to use for most operations.
See the
<a href="command-ref/../store/types/index.html">Store Types</a>
section of the manual for supported store types and settings.</p>
<p><strong>Default:</strong> <code>auto</code></p>
</li>
<li>
<p><span id="conf-substitute"><a href="command-ref/conf-file.html#conf-substitute"><code>substitute</code></a></span></p>
<p>If set to <code>true</code> (default), Nix will use binary substitutes if
available. This option can be disabled to force building from
source.</p>
<p><strong>Default:</strong> <code>true</code></p>
<p><strong>Deprecated alias:</strong> <code>build-use-substitutes</code></p>
</li>
<li>
<p><span id="conf-substituters"><a href="command-ref/conf-file.html#conf-substituters"><code>substituters</code></a></span></p>
<p>A list of <a href="command-ref/../store/types/index.html#store-url-format">URLs of Nix stores</a> to be used as substituters, separated by whitespace.
A substituter is an additional <a href="command-ref/../glossary.html#gloss-store">store</a> from which Nix can obtain <a href="command-ref/../store/store-object.html">store objects</a> instead of building them.</p>
<p>Substituters are tried based on their priority value, which each substituter can set independently.
Lower value means higher priority.
The default is <code>https://cache.nixos.org</code>, which has a priority of 40.</p>
<p>At least one of the following conditions must be met for Nix to use a substituter:</p>
<ul>
<li>The substituter is in the <a href="command-ref/conf-file.html#conf-trusted-substituters"><code>trusted-substituters</code></a> list</li>
<li>The user calling Nix is in the <a href="command-ref/conf-file.html#conf-trusted-users"><code>trusted-users</code></a> list</li>
</ul>
<p>In addition, each store path should be trusted as described in <a href="command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a></p>
<p><strong>Default:</strong> <code>https://cache.nixos.org/</code></p>
<p><strong>Deprecated alias:</strong> <code>binary-caches</code></p>
</li>
<li>
<p><span id="conf-sync-before-registering"><a href="command-ref/conf-file.html#conf-sync-before-registering"><code>sync-before-registering</code></a></span></p>
<p>Whether to call <code>sync()</code> before registering a path as valid.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-system"><a href="command-ref/conf-file.html#conf-system"><code>system</code></a></span></p>
<p>The system type of the current Nix installation.
Nix will only build a given <a href="command-ref/../glossary.html#gloss-store-derivation">store derivation</a> locally when its <code>system</code> attribute equals any of the values specified here or in <a href="command-ref/conf-file.html#conf-extra-platforms"><code>extra-platforms</code></a>.</p>
<p>The default value is set when Nix itself is compiled for the system it will run on.
The following system types are widely used, as Nix is actively supported on these platforms:</p>
<ul>
<li><code>x86_64-linux</code></li>
<li><code>x86_64-darwin</code></li>
<li><code>i686-linux</code></li>
<li><code>aarch64-linux</code></li>
<li><code>aarch64-darwin</code></li>
<li><code>armv6l-linux</code></li>
<li><code>armv7l-linux</code></li>
</ul>
<p>In general, you do not have to modify this setting.
While you can force Nix to run a Darwin-specific <code>builder</code> executable on a Linux machine, the result would obviously be wrong.</p>
<p>This value is available in the Nix language as
<a href="command-ref/../language/builtins.html#builtins-currentSystem"><code>builtins.currentSystem</code></a>
if the
<a href="command-ref/conf-file.html#conf-eval-system"><code>eval-system</code></a>
configuration option is set as the empty string.</p>
<p><strong>Default:</strong> <code>x86_64-linux</code></p>
</li>
<li>
<p><span id="conf-system-features"><a href="command-ref/conf-file.html#conf-system-features"><code>system-features</code></a></span></p>
<p>A set of system “features” supported by this machine.</p>
<p>This complements the <a href="command-ref/conf-file.html#conf-system"><code>system</code></a> and <a href="command-ref/conf-file.html#conf-extra-platforms"><code>extra-platforms</code></a> configuration options and the corresponding <a href="command-ref/../language/derivations.html#attr-system"><code>system</code></a> attribute on derivations.</p>
<p>A derivation can require system features in the <a href="command-ref/../language/advanced-attributes.html#adv-attr-requiredSystemFeatures"><code>requiredSystemFeatures</code> attribute</a>, and the machine to build the derivation must have them.</p>
<p>System features are user-defined, but Nix sets the following defaults:</p>
<ul>
<li>
<p><code>apple-virt</code></p>
<p>Included on Darwin if virtualization is available.</p>
</li>
<li>
<p><code>kvm</code></p>
<p>Included on Linux if <code>/dev/kvm</code> is accessible.</p>
</li>
<li>
<p><code>nixos-test</code>, <code>benchmark</code>, <code>big-parallel</code></p>
<p>These historical pseudo-features are always enabled for backwards compatibility, as they are used in Nixpkgs to route Hydra builds to specific machines.</p>
</li>
<li>
<p><code>ca-derivations</code></p>
<p>Included by default if the <a href="command-ref/../development/experimental-features.html#xp-feature-ca-derivations"><code>ca-derivations</code> experimental feature</a> is enabled.</p>
<p>This system feature is implicitly required by derivations with the <a href="command-ref/../language/advanced-attributes.html#adv-attr-__contentAddressed"><code>__contentAddressed</code> attribute</a>.</p>
</li>
<li>
<p><code>recursive-nix</code></p>
<p>Included by default if the <a href="command-ref/../development/experimental-features.html#xp-feature-recursive-nix"><code>recursive-nix</code> experimental feature</a> is enabled.</p>
</li>
<li>
<p><code>uid-range</code></p>
<p>On Linux, Nix can run builds in a user namespace where they run as root (UID 0) and have 65,536 UIDs available.
This is primarily useful for running containers such as <code>systemd-nspawn</code> inside a Nix build. For an example, see <a href="https://github.com/NixOS/nix/blob/67bcb99700a0da1395fa063d7c6586740b304598/tests/systemd-nspawn.nix."><code>tests/systemd-nspawn/nix</code></a>.</p>
<p>Included by default on Linux if the <a href="command-ref/conf-file.html#conf-auto-allocate-uids"><code>auto-allocate-uids</code></a> setting is enabled.</p>
</li>
</ul>
<p><strong>Default:</strong> <em>machine-specific</em></p>
</li>
<li>
<p><span id="conf-tarball-ttl"><a href="command-ref/conf-file.html#conf-tarball-ttl"><code>tarball-ttl</code></a></span></p>
<p>The number of seconds a downloaded tarball is considered fresh. If
the cached tarball is stale, Nix will check whether it is still up
to date using the ETag header. Nix will download a new version if
the ETag header is unsupported, or the cached ETag doesn't match.</p>
<p>Setting the TTL to <code>0</code> forces Nix to always check if the tarball is
up to date.</p>
<p>Nix caches tarballs in <code>$XDG_CACHE_HOME/nix/tarballs</code>.</p>
<p>Files fetched via <code>NIX_PATH</code>, <code>fetchGit</code>, <code>fetchMercurial</code>,
<code>fetchTarball</code>, and <code>fetchurl</code> respect this TTL.</p>
<p><strong>Default:</strong> <code>3600</code></p>
</li>
<li>
<p><span id="conf-timeout"><a href="command-ref/conf-file.html#conf-timeout"><code>timeout</code></a></span></p>
<p>This option defines the maximum number of seconds that a builder can
run. This is useful (for instance in an automated build system) to
catch builds that are stuck in an infinite loop but keep writing to
their standard output or standard error. It can be overridden using
the <code>--timeout</code> command line switch.</p>
<p>The value <code>0</code> means that there is no timeout. This is also the
default.</p>
<p><strong>Default:</strong> <code>0</code></p>
<p><strong>Deprecated alias:</strong> <code>build-timeout</code></p>
</li>
<li>
<p><span id="conf-trace-function-calls"><a href="command-ref/conf-file.html#conf-trace-function-calls"><code>trace-function-calls</code></a></span></p>
<p>If set to <code>true</code>, the Nix evaluator will trace every function call.
Nix will print a log message at the "vomit" level for every function
entrance and function exit.</p>
<pre><code>function-trace entered undefined position at 1565795816999559622
function-trace exited undefined position at 1565795816999581277
function-trace entered /nix/store/.../example.nix:226:41 at 1565795253249935150
function-trace exited /nix/store/.../example.nix:226:41 at 1565795253249941684
</code></pre>
<p>The <code>undefined position</code> means the function call is a builtin.</p>
<p>Use the <code>contrib/stack-collapse.py</code> script distributed with the Nix
source code to convert the trace logs in to a format suitable for
<code>flamegraph.pl</code>.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-trace-verbose"><a href="command-ref/conf-file.html#conf-trace-verbose"><code>trace-verbose</code></a></span></p>
<p>Whether <code>builtins.traceVerbose</code> should trace its first argument when evaluated.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-trust-tarballs-from-git-forges"><a href="command-ref/conf-file.html#conf-trust-tarballs-from-git-forges"><code>trust-tarballs-from-git-forges</code></a></span></p>
<p>If enabled (the default), Nix will consider tarballs from
GitHub and similar Git forges to be locked if a Git revision
is specified,
e.g. <code>github:NixOS/patchelf/7c2f768bf9601268a4e71c2ebe91e2011918a70f</code>.
This requires Nix to trust that the provider will return the
correct contents for the specified Git revision.</p>
<p>If disabled, such tarballs are only considered locked if a
<code>narHash</code> attribute is specified,
e.g. <code>github:NixOS/patchelf/7c2f768bf9601268a4e71c2ebe91e2011918a70f?narHash=sha256-PPXqKY2hJng4DBVE0I4xshv/vGLUskL7jl53roB8UdU%3D</code>.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="conf-trusted-public-keys"><a href="command-ref/conf-file.html#conf-trusted-public-keys"><code>trusted-public-keys</code></a></span></p>
<p>A whitespace-separated list of public keys.</p>
<p>At least one of the following condition must be met
for Nix to accept copying a store object from another
Nix store (such as a <a href="command-ref/conf-file.html#conf-substituters">substituter</a>):</p>
<ul>
<li>the store object has been signed using a key in the trusted keys list</li>
<li>the <a href="command-ref/conf-file.html#conf-require-sigs"><code>require-sigs</code></a> option has been set to <code>false</code></li>
<li>the store URL is configured with <code>trusted=true</code></li>
<li>the store object is <a href="command-ref/../glossary.html#gloss-content-addressed-store-object">content-addressed</a></li>
</ul>
<p><strong>Default:</strong> <code>cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY=</code></p>
<p><strong>Deprecated alias:</strong> <code>binary-cache-public-keys</code></p>
</li>
<li>
<p><span id="conf-trusted-substituters"><a href="command-ref/conf-file.html#conf-trusted-substituters"><code>trusted-substituters</code></a></span></p>
<p>A list of <a href="command-ref/../store/types/index.html#store-url-format">Nix store URLs</a>, separated by whitespace.
These are not used by default, but users of the Nix daemon can enable them by specifying <a href="command-ref/conf-file.html#conf-substituters"><code>substituters</code></a>.</p>
<p>Unprivileged users (those set in only <a href="command-ref/conf-file.html#conf-allowed-users"><code>allowed-users</code></a> but not <a href="command-ref/conf-file.html#conf-trusted-users"><code>trusted-users</code></a>) can pass as <code>substituters</code> only those URLs listed in <code>trusted-substituters</code>.</p>
<p><strong>Default:</strong> <em>empty</em></p>
<p><strong>Deprecated alias:</strong> <code>trusted-binary-caches</code></p>
</li>
<li>
<p><span id="conf-trusted-users"><a href="command-ref/conf-file.html#conf-trusted-users"><code>trusted-users</code></a></span></p>
<p>A list of user names, separated by whitespace.
These users will have additional rights when connecting to the Nix daemon, such as the ability to specify additional <a href="command-ref/conf-file.html#conf-substituters">substituters</a>, or to import unsigned realisations or unsigned input-addressed store objects.</p>
<p>You can also specify groups by prefixing names with <code>@</code>.
For instance, <code>@wheel</code> means all users in the <code>wheel</code> group.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Adding a user to <code>trusted-users</code> is essentially equivalent to giving that user root access to the system.
For example, the user can access or replace store path contents that are critical for system security.</p>
</blockquote>
<p><strong>Default:</strong> <code>root</code></p>
</li>
<li>
<p><span id="conf-upgrade-nix-store-path-url"><a href="command-ref/conf-file.html#conf-upgrade-nix-store-path-url"><code>upgrade-nix-store-path-url</code></a></span></p>
<p>Used by <code>nix upgrade-nix</code>, the URL of the file that contains the
store paths of the latest Nix release.</p>
<p><strong>Default:</strong> <code>https://github.com/NixOS/nixpkgs/raw/master/nixos/modules/installer/tools/nix-fallback-paths.nix</code></p>
</li>
<li>
<p><span id="conf-use-case-hack"><a href="command-ref/conf-file.html#conf-use-case-hack"><code>use-case-hack</code></a></span></p>
<p>Whether to enable a macOS-specific hack for dealing with file name case collisions.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-use-cgroups"><a href="command-ref/conf-file.html#conf-use-cgroups"><code>use-cgroups</code></a></span></p>
<p>Whether to execute builds inside cgroups.
This is only supported on Linux.</p>
<p>Cgroups are required and enabled automatically for derivations
that require the <code>uid-range</code> system feature.</p>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-use-registries"><a href="command-ref/conf-file.html#conf-use-registries"><code>use-registries</code></a></span></p>
<blockquote>
<p><strong>Warning</strong></p>
<p>This setting is part of an
<a href="command-ref/../development/experimental-features.html">experimental feature</a>.</p>
<p>To change this setting, make sure the
<a href="command-ref/../development/experimental-features.html#xp-feature-flakes"><code>flakes</code> experimental feature</a>
is enabled.
For example, include the following in <a href="command-ref/../command-ref/conf-file.html"><code>nix.conf</code></a>:</p>
<pre><code>extra-experimental-features = flakes
use-registries = ...
</code></pre>
</blockquote>
<p>Whether to use flake registries to resolve flake references.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="conf-use-sqlite-wal"><a href="command-ref/conf-file.html#conf-use-sqlite-wal"><code>use-sqlite-wal</code></a></span></p>
<p>Whether SQLite should use WAL mode.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="conf-use-xdg-base-directories"><a href="command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a></span></p>
<p>If set to <code>true</code>, Nix will conform to the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a> for files in <code>$HOME</code>.
The environment variables used to implement this are documented in the <a href="command-ref/../command-ref/env-common.html">Environment Variables section</a>.</p>
<blockquote>
<p><strong>Warning</strong>
This changes the location of some well-known symlinks that Nix creates, which might break tools that rely on the old, non-XDG-conformant locations.</p>
</blockquote>
<p>In particular, the following locations change:</p>
<div class="table-wrapper"><table><thead><tr><th>Old</th><th>New</th></tr></thead><tbody>
<tr><td><code>~/.nix-profile</code></td><td><code>$XDG_STATE_HOME/nix/profile</code></td></tr>
<tr><td><code>~/.nix-defexpr</code></td><td><code>$XDG_STATE_HOME/nix/defexpr</code></td></tr>
<tr><td><code>~/.nix-channels</code></td><td><code>$XDG_STATE_HOME/nix/channels</code></td></tr>
</tbody></table>
</div>
<p>If you already have Nix installed and are using <a href="command-ref/../package-management/profiles.html">profiles</a> or <a href="command-ref/../command-ref/nix-channel.html">channels</a>, you should migrate manually when you enable this option.
If <code>$XDG_STATE_HOME</code> is not set, use <code>$HOME/.local/state/nix</code> instead of <code>$XDG_STATE_HOME/nix</code>.
This can be achieved with the following shell commands:</p>
<pre><code class="language-sh">nix_state_home=${XDG_STATE_HOME-$HOME/.local/state}/nix
mkdir -p $nix_state_home
mv $HOME/.nix-profile $nix_state_home/profile
mv $HOME/.nix-defexpr $nix_state_home/defexpr
mv $HOME/.nix-channels $nix_state_home/channels
</code></pre>
<p><strong>Default:</strong> <code>false</code></p>
</li>
<li>
<p><span id="conf-user-agent-suffix"><a href="command-ref/conf-file.html#conf-user-agent-suffix"><code>user-agent-suffix</code></a></span></p>
<p>String appended to the user agent in HTTP requests.</p>
<p><strong>Default:</strong> <em>empty</em></p>
</li>
<li>
<p><span id="conf-warn-dirty"><a href="command-ref/conf-file.html#conf-warn-dirty"><code>warn-dirty</code></a></span></p>
<p>Whether to warn about dirty Git/Mercurial trees.</p>
<p><strong>Default:</strong> <code>true</code></p>
</li>
<li>
<p><span id="conf-warn-large-path-threshold"><a href="command-ref/conf-file.html#conf-warn-large-path-threshold"><code>warn-large-path-threshold</code></a></span></p>
<p>Warn when copying a path larger than this number of bytes to the Nix store
(as determined by its NAR serialisation).
Default is 0, which disables the warning.
Set it to 1 to warn on all paths.</p>
<p><strong>Default:</strong> <code>0</code></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="profiles-3"><a class="header" href="#profiles-3">Profiles</a></h2>
<p>A directory that contains links to profiles managed by <a href="command-ref/files/../../command-ref/nix-env.html"><code>nix-env</code></a> and <a href="command-ref/files/../../command-ref/new-cli/nix3-profile.html"><code>nix profile</code></a>:</p>
<ul>
<li><code>$XDG_STATE_HOME/nix/profiles</code> for regular users</li>
<li><code>$NIX_STATE_DIR/profiles/per-user/root</code> if the user is <code>root</code></li>
</ul>
<p>A profile is a directory of symlinks to files in the Nix store.</p>
<h3 id="filesystem-layout-2"><a class="header" href="#filesystem-layout-2">Filesystem layout</a></h3>
<p>Profiles are versioned as follows. When using a profile named <em>path</em>, <em>path</em> is a symlink to <em>path</em><code>-</code><em>N</em><code>-link</code>, where <em>N</em> is the version of the profile.
In turn, <em>path</em><code>-</code><em>N</em><code>-link</code> is a symlink to a path in the Nix store.
For example:</p>
<pre><code class="language-console">$ ls -l ~alice/.local/state/nix/profiles/profile*
lrwxrwxrwx 1 alice users 14 Nov 25 14:35 /home/alice/.local/state/nix/profiles/profile -&gt; profile-7-link
lrwxrwxrwx 1 alice users 51 Oct 28 16:18 /home/alice/.local/state/nix/profiles/profile-5-link -&gt; /nix/store/q69xad13ghpf7ir87h0b2gd28lafjj1j-profile
lrwxrwxrwx 1 alice users 51 Oct 29 13:20 /home/alice/.local/state/nix/profiles/profile-6-link -&gt; /nix/store/6bvhpysd7vwz7k3b0pndn7ifi5xr32dg-profile
lrwxrwxrwx 1 alice users 51 Nov 25 14:35 /home/alice/.local/state/nix/profiles/profile-7-link -&gt; /nix/store/mp0x6xnsg0b8qhswy6riqvimai4gm677-profile
</code></pre>
<p>Each of these symlinks is a root for the Nix garbage collector.</p>
<p>The contents of the store path corresponding to each version of the
profile is a tree of symlinks to the files of the installed packages,
e.g.</p>
<pre><code class="language-console">$ ll -R ~eelco/.local/state/nix/profiles/profile-7-link/
/home/eelco/.local/state/nix/profiles/profile-7-link/:
total 20
dr-xr-xr-x 2 root root 4096 Jan  1  1970 bin
-r--r--r-- 2 root root 1402 Jan  1  1970 manifest.nix
dr-xr-xr-x 4 root root 4096 Jan  1  1970 share

/home/eelco/.local/state/nix/profiles/profile-7-link/bin:
total 20
lrwxrwxrwx 5 root root 79 Jan  1  1970 chromium -&gt; /nix/store/ijm5k0zqisvkdwjkc77mb9qzb35xfi4m-chromium-86.0.4240.111/bin/chromium
lrwxrwxrwx 7 root root 87 Jan  1  1970 spotify -&gt; /nix/store/w9182874m1bl56smps3m5zjj36jhp3rn-spotify-1.1.26.501.gbe11e53b-15/bin/spotify
lrwxrwxrwx 3 root root 79 Jan  1  1970 zoom-us -&gt; /nix/store/wbhg2ga8f3h87s9h5k0slxk0m81m4cxl-zoom-us-5.3.469451.0927/bin/zoom-us

/home/eelco/.local/state/nix/profiles/profile-7-link/share/applications:
total 12
lrwxrwxrwx 4 root root 120 Jan  1  1970 chromium-browser.desktop -&gt; /nix/store/4cf803y4vzfm3gyk3vzhzb2327v0kl8a-chromium-unwrapped-86.0.4240.111/share/applications/chromium-browser.desktop
lrwxrwxrwx 7 root root 110 Jan  1  1970 spotify.desktop -&gt; /nix/store/w9182874m1bl56smps3m5zjj36jhp3rn-spotify-1.1.26.501.gbe11e53b-15/share/applications/spotify.desktop
lrwxrwxrwx 3 root root 107 Jan  1  1970 us.zoom.Zoom.desktop -&gt; /nix/store/wbhg2ga8f3h87s9h5k0slxk0m81m4cxl-zoom-us-5.3.469451.0927/share/applications/us.zoom.Zoom.desktop

…
</code></pre>
<p>Each profile version contains a manifest file:</p>
<ul>
<li><a href="command-ref/files/../../command-ref/files/manifest.nix.html"><code>manifest.nix</code></a> used by <a href="command-ref/files/../../command-ref/nix-env.html"><code>nix-env</code></a>.</li>
<li><a href="command-ref/files/../../command-ref/files/manifest.json.html"><code>manifest.json</code></a> used by <a href="command-ref/files/../../command-ref/new-cli/nix3-profile.html"><code>nix profile</code></a> (experimental).</li>
</ul>
<h2 id="user-profile-link-2"><a class="header" href="#user-profile-link-2">User profile link</a></h2>
<p>A symbolic link to the user's current profile:</p>
<ul>
<li><code>~/.nix-profile</code></li>
<li><code>$XDG_STATE_HOME/nix/profile</code> if <a href="command-ref/files/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is set to <code>true</code>.</li>
</ul>
<p>By default, this symlink points to:</p>
<ul>
<li><code>$XDG_STATE_HOME/nix/profiles/profile</code> for regular users</li>
<li><code>$NIX_STATE_DIR/profiles/per-user/root/profile</code> for <code>root</code></li>
</ul>
<p>The <code>PATH</code> environment variable should include <code>/bin</code> subdirectory of the profile link (e.g. <code>~/.nix-profile/bin</code>) for the user environment to be visible to the user.
The <a href="command-ref/files/../../installation/installing-binary.html">installer</a> sets this up by default, unless you enable <a href="command-ref/files/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="manifestnix"><a class="header" href="#manifestnix"><code>manifest.nix</code></a></h2>
<p>The manifest file records the provenance of the packages that are installed in a <a href="command-ref/files/./profiles.html">profile</a> managed by <a href="command-ref/files/../../command-ref/nix-env.html"><code>nix-env</code></a>.</p>
<p>Here is an example of how this file might look like after installing <code>hello</code> from Nixpkgs:</p>
<pre><code class="language-nix">[{
  meta = {
    available = true;
    broken = false;
    changelog =
      "https://git.savannah.gnu.org/cgit/hello.git/plain/NEWS?h=v2.12.1";
    description = "A program that produces a familiar, friendly greeting";
    homepage = "https://www.gnu.org/software/hello/manual/";
    insecure = false;
    license = {
      deprecated = false;
      free = true;
      fullName = "GNU General Public License v3.0 or later";
      redistributable = true;
      shortName = "gpl3Plus";
      spdxId = "GPL-3.0-or-later";
      url = "https://spdx.org/licenses/GPL-3.0-or-later.html";
    };
    longDescription = ''
      GNU Hello is a program that prints "Hello, world!" when you run it.
      It is fully customizable.
    '';
    maintainers = [{
      email = "edolstra+nixpkgs@gmail.com";
      github = "edolstra";
      githubId = 1148549;
      name = "Eelco Dolstra";
    }];
    name = "hello-2.12.1";
    outputsToInstall = [ "out" ];
    platforms = [
      "i686-cygwin"
      "x86_64-cygwin"
      "x86_64-darwin"
      "i686-darwin"
      "aarch64-darwin"
      "armv7a-darwin"
      "i686-freebsd13"
      "x86_64-freebsd13"
      "aarch64-genode"
      "i686-genode"
      "x86_64-genode"
      "x86_64-solaris"
      "js-ghcjs"
      "aarch64-linux"
      "armv5tel-linux"
      "armv6l-linux"
      "armv7a-linux"
      "armv7l-linux"
      "i686-linux"
      "m68k-linux"
      "microblaze-linux"
      "microblazeel-linux"
      "mipsel-linux"
      "mips64el-linux"
      "powerpc64-linux"
      "powerpc64le-linux"
      "riscv32-linux"
      "riscv64-linux"
      "s390-linux"
      "s390x-linux"
      "x86_64-linux"
      "mmix-mmixware"
      "aarch64-netbsd"
      "armv6l-netbsd"
      "armv7a-netbsd"
      "armv7l-netbsd"
      "i686-netbsd"
      "m68k-netbsd"
      "mipsel-netbsd"
      "powerpc-netbsd"
      "riscv32-netbsd"
      "riscv64-netbsd"
      "x86_64-netbsd"
      "aarch64_be-none"
      "aarch64-none"
      "arm-none"
      "armv6l-none"
      "avr-none"
      "i686-none"
      "microblaze-none"
      "microblazeel-none"
      "msp430-none"
      "or1k-none"
      "m68k-none"
      "powerpc-none"
      "powerpcle-none"
      "riscv32-none"
      "riscv64-none"
      "rx-none"
      "s390-none"
      "s390x-none"
      "vc4-none"
      "x86_64-none"
      "i686-openbsd"
      "x86_64-openbsd"
      "x86_64-redox"
      "wasm64-wasi"
      "wasm32-wasi"
      "x86_64-windows"
      "i686-windows"
    ];
    position =
      "/nix/store/7niq32w715567hbph0q13m5lqna64c1s-nixos-unstable.tar.gz/nixos-unstable.tar.gz/pkgs/applications/misc/hello/default.nix:34";
    unfree = false;
    unsupported = false;
  };
  name = "hello-2.12.1";
  out = {
    outPath = "/nix/store/260q5867crm1xjs4khgqpl6vr9kywql1-hello-2.12.1";
  };
  outPath = "/nix/store/260q5867crm1xjs4khgqpl6vr9kywql1-hello-2.12.1";
  outputs = [ "out" ];
  system = "x86_64-linux";
  type = "derivation";
}]
</code></pre>
<p>Each element in this list corresponds to an installed package.
It incorporates some attributes of the original derivation, including <code>meta</code>, <code>name</code>, <code>out</code>, <code>outPath</code>, <code>outputs</code>, <code>system</code>.
This information is used by Nix for querying and updating the package.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="manifestjson"><a class="header" href="#manifestjson"><code>manifest.json</code></a></h2>
<p>The manifest file records the provenance of the packages that are installed in a <a href="command-ref/files/./profiles.html">profile</a> managed by <a href="command-ref/files/../../command-ref/new-cli/nix3-profile.html"><code>nix profile</code></a> (experimental).</p>
<p>Here is an example of what the file might look like after installing <code>zoom-us</code> from Nixpkgs:</p>
<pre><code class="language-json">{
  "version": 1,
  "elements": [
    {
      "active": true,
      "attrPath": "legacyPackages.x86_64-linux.zoom-us",
      "originalUrl": "flake:nixpkgs",
      "storePaths": [
        "/nix/store/wbhg2ga8f3h87s9h5k0slxk0m81m4cxl-zoom-us-5.3.469451.0927"
      ],
      "uri": "github:NixOS/nixpkgs/13d0c311e3ae923a00f734b43fd1d35b47d8943a"
    },
    …
  ]
}
</code></pre>
<p>Each object in the array <code>elements</code> denotes an installed package and
has the following fields:</p>
<ul>
<li>
<p><code>originalUrl</code>: The <a href="command-ref/files/../../command-ref/new-cli/nix3-flake.html">flake reference</a> specified by
the user at the time of installation (e.g. <code>nixpkgs</code>). This is also
the flake reference that will be used by <code>nix profile upgrade</code>.</p>
</li>
<li>
<p><code>uri</code>: The locked flake reference to which <code>originalUrl</code> resolved.</p>
</li>
<li>
<p><code>attrPath</code>: The flake output attribute that provided this
package. Note that this is not necessarily the attribute that the
user specified, but the one resulting from applying the default
attribute paths and prefixes; for instance, <code>hello</code> might resolve to
<code>packages.x86_64-linux.hello</code> and the empty string to
<code>packages.x86_64-linux.default</code>.</p>
</li>
<li>
<p><code>storePath</code>: The paths in the Nix store containing the package.</p>
</li>
<li>
<p><code>active</code>: Whether the profile contains symlinks to the files of this
package. If set to false, the package is kept in the Nix store, but
is not "visible" in the profile's symlink tree.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="channels-1"><a class="header" href="#channels-1">Channels</a></h2>
<p>A directory containing symlinks to Nix channels, managed by <a href="command-ref/files/../../command-ref/nix-channel.html"><code>nix-channel</code></a>:</p>
<ul>
<li><code>$XDG_STATE_HOME/nix/profiles/channels</code> for regular users</li>
<li><code>$NIX_STATE_DIR/profiles/per-user/root/channels</code> for <code>root</code></li>
</ul>
<p><a href="command-ref/files/../../command-ref/nix-channel.html"><code>nix-channel</code></a> uses a <a href="command-ref/files/../../command-ref/files/profiles.html">profile</a> to store channels.
This profile contains symlinks to the contents of those channels.</p>
<h2 id="subscribed-channels-1"><a class="header" href="#subscribed-channels-1">Subscribed channels</a></h2>
<p>The list of subscribed channels is stored in</p>
<ul>
<li><code>~/.nix-channels</code></li>
<li><code>$XDG_STATE_HOME/nix/channels</code> if <a href="command-ref/files/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is set to <code>true</code></li>
</ul>
<p>in the following format:</p>
<pre><code>&lt;url&gt; &lt;name&gt;
...
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="default-nix-expression-1"><a class="header" href="#default-nix-expression-1">Default Nix expression</a></h2>
<p>The source for the <a href="command-ref/files/../../glossary.html#gloss-nix-expression">Nix expressions</a> used by <a href="command-ref/files/../../command-ref/nix-env.html"><code>nix-env</code></a> by default:</p>
<ul>
<li><code>~/.nix-defexpr</code></li>
<li><code>$XDG_STATE_HOME/nix/defexpr</code> if <a href="command-ref/files/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is set to <code>true</code>.</li>
</ul>
<p>It is loaded as follows:</p>
<ul>
<li>If the default expression is a file, it is loaded as a Nix expression.</li>
<li>If the default expression is a directory containing a <code>default.nix</code> file, that <code>default.nix</code> file is loaded as a Nix expression.</li>
<li>If the default expression is a directory without a <code>default.nix</code> file, then its contents (both files and subdirectories) are loaded as Nix expressions.
The expressions are combined into a single attribute set, each expression under an attribute with the same name as the original file or subdirectory.
Subdirectories without a <code>default.nix</code> file are traversed recursively in search of more Nix expressions, but the names of these intermediate directories are not added to the attribute paths of the default Nix expression.</li>
</ul>
<p>Then, the resulting expression is interpreted like this:</p>
<ul>
<li>If the expression is an attribute set, it is used as the default Nix expression.</li>
<li>If the expression is a function, an empty set is passed as argument and the return value is used as the default Nix expression.</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<p>If the default expression contains two files, <code>foo.nix</code> and <code>bar.nix</code>, then the default Nix expression will be equivalent to</p>
<pre><code class="language-nix">{
  foo = import ~/.nix-defexpr/foo.nix;
  bar = import ~/.nix-defexpr/bar.nix;
}
</code></pre>
</blockquote>
<p>The file <a href="command-ref/files/../../command-ref/files/manifest.nix.html"><code>manifest.nix</code></a> is always ignored.</p>
<p>The command <a href="command-ref/files/../../command-ref/nix-channel.html"><code>nix-channel</code></a> places a symlink to the current user's <a href="command-ref/files/../../command-ref/files/channels.html">channels</a> in this directory, the <a href="command-ref/files/default-nix-expression.html#user-channel-link">user channel link</a>.
This makes all subscribed channels available as attributes in the default expression.</p>
<h2 id="user-channel-link-1"><a class="header" href="#user-channel-link-1">User channel link</a></h2>
<p>A symlink that ensures that <a href="command-ref/files/../../command-ref/nix-env.html"><code>nix-env</code></a> can find the current user's <a href="command-ref/files/../../command-ref/files/channels.html">channels</a>:</p>
<ul>
<li><code>~/.nix-defexpr/channels</code></li>
<li><code>$XDG_STATE_HOME/defexpr/channels</code> if <a href="command-ref/files/../../command-ref/conf-file.html#conf-use-xdg-base-directories"><code>use-xdg-base-directories</code></a> is set to <code>true</code>.</li>
</ul>
<p>This symlink points to:</p>
<ul>
<li><code>$XDG_STATE_HOME/profiles/channels</code> for regular users</li>
<li><code>$NIX_STATE_DIR/profiles/per-user/root/channels</code> for <code>root</code></li>
</ul>
<p>In a multi-user installation, you may also have <code>~/.nix-defexpr/channels_root</code>, which links to the channels of the root user.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="architecture"><a class="header" href="#architecture">Architecture</a></h1>
<p>This chapter describes how Nix works.
It should help users understand why Nix behaves as it does, and it should help developers understand how to modify Nix and how to write similar tools.</p>
<h2 id="overview-1"><a class="header" href="#overview-1">Overview</a></h2>
<p>Nix consists of <a href="https://en.wikipedia.org/wiki/Multitier_architecture#Layers">hierarchical layers</a>.</p>
<p>The following <a href="https://en.wikipedia.org/wiki/Concept_map">concept map</a> shows its main components (rectangles), the objects they operate on (rounded rectangles), and their interactions (connecting phrases):</p>
<pre><code>
   .----------------.
   | Nix expression |----------.
   '----------------'          |
           |              passed to
           |                   |
+----------|-------------------|--------------------------------+
| Nix      |                   V                                |
|          |      +-------------------------+                   |
|          |      | commmand line interface |------.            |
|          |      +-------------------------+      |            |
|          |                   |                   |            |
|    evaluated by            calls              manages         |
|          |                   |                   |            |
|          |                   V                   |            |
|          |         +--------------------+        |            |
|          '--------&gt;| language evaluator |        |            |
|                    +--------------------+        |            |
|                              |                   |            |
|                           produces               |            |
|                              |                   V            |
| +----------------------------|------------------------------+ |
| | store                      |                              | |
| |            referenced by   V       builds                 | |
| | .-------------.      .------------.      .--------------. | |
| | | build input |-----&gt;| build plan |-----&gt;| build result | | |
| | '-------------'      '------------'      '--------------' | |
| +-------------------------------------------------|---------+ |
+---------------------------------------------------|-----------+
                                                    |
                                              represented as
                                                    |
                                                    V
                                            .---------------.
                                            |     file      |
                                            '---------------'
</code></pre>
<p>At the top is the <a href="architecture/../command-ref/index.html">command line interface</a> that drives the underlying layers.</p>
<p>The <a href="architecture/../language/index.html">Nix language</a> evaluator transforms Nix expressions into self-contained <em>build plans</em>, which are used to derive <em>build results</em> from referenced <em>build inputs</em>.</p>
<p>The command line interface and Nix expressions are what users deal with most.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>The Nix language itself does not have a notion of <em>packages</em> or <em>configurations</em>.
As far as we are concerned here, the inputs and results of a build plan are just data.</p>
</blockquote>
<p>Underlying the command line interface and the Nix language evaluator is the <a href="architecture/../store/index.html">Nix store</a>, a mechanism to keep track of build plans, data, and references between them.
It can also execute build plans to produce new data, which are made available to the operating system as files.</p>
<p>A build plan itself is a series of <em>build tasks</em>, together with their build inputs.</p>
<blockquote>
<p><strong>Important</strong>
A build task in Nix is called <a href="architecture/../glossary.html#gloss-store-derivation">store derivation</a>.</p>
</blockquote>
<p>Each build task has a special build input executed as <em>build instructions</em> in order to perform the build.
The result of a build task can be input to another build task.</p>
<p>The following <a href="https://en.wikipedia.org/wiki/Data-flow_diagram">data flow diagram</a> shows a build plan for illustration.
Build inputs used as instructions to a build task are marked accordingly:</p>
<pre><code>+--------------------------------------------------------------------+
| build plan                                                         |
|                                                                    |
| .-------------.                                                    |
| | build input |---------.                                          |
| '-------------'         |                                          |
|                    instructions                                    |
|                         |                                          |
|                         v                                          |
| .-------------.    .----------.                                    |
| | build input |--&gt;( build task )-------.                           |
| '-------------'    '----------'        |                           |
|                                  instructions                      |
|                                        |                           |
|                                        v                           |
| .-------------.                  .----------.     .--------------. |
| | build input |---------.       ( build task )---&gt;| build result | |
| '-------------'         |        '----------'     '--------------' |
|                    instructions        ^                           |
|                         |              |                           |
|                         v              |                           |
| .-------------.    .----------.        |                           |
| | build input |--&gt;( build task )-------'                           |
| '-------------'    '----------'                                    |
|                         ^                                          |
|                         |                                          |
|                         |                                          |
| .-------------.         |                                          |
| | build input |---------'                                          |
| '-------------'                                                    |
|                                                                    |
+--------------------------------------------------------------------+
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="protocols"><a class="header" href="#protocols">Protocols</a></h1>
<p>This chapter documents various developer-facing interfaces provided by
Nix.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="json-formats"><a class="header" href="#json-formats">JSON Formats</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="store-object-info-json-format"><a class="header" href="#store-object-info-json-format">Store object info JSON format</a></h1>
<blockquote>
<p><strong>Warning</strong></p>
<p>This JSON format is currently
<a href="protocols/json/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and subject to change.</p>
</blockquote>
<p>Info about a [store object].</p>
<ul>
<li>
<p><code>path</code>:</p>
<p><a href="protocols/json/../../store/store-path.html">Store path</a> to the given store object.</p>
</li>
<li>
<p><code>narHash</code>:</p>
<p>Hash of the <a href="protocols/json/../../store/file-system-object.html">file system object</a> part of the store object when serialized as a <a href="protocols/json/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive</a>.</p>
</li>
<li>
<p><code>narSize</code>:</p>
<p>Size of the <a href="protocols/json/../../store/file-system-object.html">file system object</a> part of the store object when serialized as a <a href="protocols/json/../../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive</a>.</p>
</li>
<li>
<p><code>references</code>:</p>
<p>An array of <a href="protocols/json/../../store/store-path.html">store paths</a>, possibly including this one.</p>
</li>
<li>
<p><code>ca</code>:</p>
<p>If the store object is <a href="protocols/json/../../store/store-object/content-address.html">content-addressed</a>,
this is the content address of this store object's file system object, used to compute its store path.
Otherwise (i.e. if it is <a href="protocols/json/../../glossary.html#gloss-input-addressed-store-object">input-addressed</a>), this is <code>null</code>.</p>
</li>
</ul>
<h2 id="impure-fields"><a class="header" href="#impure-fields">Impure fields</a></h2>
<p>These are not intrinsic properties of the store object.
In other words, the same store object residing in different store could have different values for these properties.</p>
<ul>
<li>
<p><code>deriver</code>:</p>
<p>If known, the path to the <a href="protocols/json/../../glossary.html#gloss-store-derivation">store derivation</a> from which this store object was produced.
Otherwise <code>null</code>.</p>
</li>
<li>
<p><code>registrationTime</code> (optional):</p>
<p>If known, when this derivation was added to the store.
Otherwise <code>null</code>.</p>
</li>
<li>
<p><code>ultimate</code>:</p>
<p>Whether this store object is trusted because we built it ourselves, rather than substituted a build product from elsewhere.</p>
</li>
<li>
<p><code>signatures</code>:</p>
<p>Signatures claiming that this store object is what it claims to be.
Not relevant for <a href="protocols/json/../../store/store-object/content-address.html">content-addressed</a> store objects,
but useful for <a href="protocols/json/../../glossary.html#gloss-input-addressed-store-object">input-addressed</a> store objects.</p>
</li>
</ul>
<h3 id="narinfo-extra-fields"><a class="header" href="#narinfo-extra-fields"><code>.narinfo</code> extra fields</a></h3>
<p>This meta data is specific to the "binary cache" family of Nix store types.
This information is not intrinsic to the store object, but about how it is stored.</p>
<ul>
<li>
<p><code>url</code>:</p>
<p>Where to download a compressed archive of the file system objects of this store object.</p>
</li>
<li>
<p><code>compression</code>:</p>
<p>The compression format that the archive is in.</p>
</li>
<li>
<p><code>fileHash</code>:</p>
<p>A digest for the compressed archive itself, as opposed to the data contained within.</p>
</li>
<li>
<p><code>fileSize</code>:</p>
<p>The size of the compressed archive itself.</p>
</li>
</ul>
<h2 id="computed-closure-fields"><a class="header" href="#computed-closure-fields">Computed closure fields</a></h2>
<p>These fields are not stored at all, but computed by traversing the other fields across all the store objects in a <a href="protocols/json/../../glossary.html#gloss-closure">closure</a>.</p>
<ul>
<li>
<p><code>closureSize</code>:</p>
<p>The total size of the compressed archive itself for this object, and the compressed archive of every object in this object's <a href="protocols/json/../../glossary.html#gloss-closure">closure</a>.</p>
</li>
</ul>
<h3 id="narinfo-extra-fields-1"><a class="header" href="#narinfo-extra-fields-1"><code>.narinfo</code> extra fields</a></h3>
<ul>
<li>
<p><code>closureSize</code>:</p>
<p>The total size of this store object and every other object in its <a href="protocols/json/../../glossary.html#gloss-closure">closure</a>.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="derivation-json-format-2"><a class="header" href="#derivation-json-format-2">Derivation JSON Format</a></h1>
<blockquote>
<p><strong>Warning</strong></p>
<p>This JSON format is currently
<a href="protocols/json/../../development/experimental-features.html#xp-feature-nix-command"><strong>experimental</strong></a>
and subject to change.</p>
</blockquote>
<p>The JSON serialization of a
<a href="protocols/json/../../glossary.html#gloss-store-derivation">derivations</a>
is a JSON object with the following fields:</p>
<ul>
<li>
<p><code>name</code>:
The name of the derivation.
This is used when calculating the store paths of the derivation's outputs.</p>
</li>
<li>
<p><code>outputs</code>:
Information about the output paths of the derivation.
This is a JSON object with one member per output, where the key is the output name and the value is a JSON object with these fields:</p>
<ul>
<li>
<p><code>path</code>:
The output path, if it is known in advanced.
Otherwise, <code>null</code>.</p>
</li>
<li>
<p><code>method</code>:
For an output which will be [content addresed], a string representing the <a href="protocols/json/../../store/store-object/content-address.html">method</a> of content addressing that is chosen.
Valid method strings are:</p>
<ul>
<li><a href="protocols/json/../../store/store-object/content-address.html#method-flat"><code>flat</code></a></li>
<li><a href="protocols/json/../../store/store-object/content-address.html#method-nix-archive"><code>nar</code></a></li>
<li><a href="protocols/json/../../store/store-object/content-address.html#method-text"><code>text</code></a></li>
<li><a href="protocols/json/../../store/store-object/content-address.html#method-git"><code>git</code></a></li>
</ul>
<p>Otherwise, <code>null</code>.</p>
</li>
<li>
<p><code>hashAlgo</code>:
For an output which will be [content addresed], the name of the hash algorithm used.
Valid algorithm strings are:</p>
<ul>
<li><code>blake3</code></li>
<li><code>md5</code></li>
<li><code>sha1</code></li>
<li><code>sha256</code></li>
<li><code>sha512</code></li>
</ul>
</li>
<li>
<p><code>hash</code>:
For fixed-output derivations, the expected content hash in base-16.</p>
</li>
</ul>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-json">"outputs": {
  "out": {
    "path": "/nix/store/2543j7c6jn75blc3drf4g5vhb1rhdq29-source",
    "method": "nar",
    "hashAlgo": "sha256",
    "hash": "6fc80dcc62179dbc12fc0b5881275898f93444833d21b89dfe5f7fbcbb1d0d62"
  }
}
</code></pre>
</blockquote>
</li>
<li>
<p><code>inputSrcs</code>:
A list of store paths on which this derivation depends.</p>
</li>
<li>
<p><code>inputDrvs</code>:
A JSON object specifying the derivations on which this derivation depends, and what outputs of those derivations.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-json">"inputDrvs": {
  "/nix/store/6lkh5yi7nlb7l6dr8fljlli5zfd9hq58-curl-7.73.0.drv": ["dev"],
  "/nix/store/fn3kgnfzl5dzym26j8g907gq3kbm8bfh-unzip-6.0.drv": ["out"]
}
</code></pre>
</blockquote>
<p>specifies that this derivation depends on the <code>dev</code> output of <code>curl</code>, and the <code>out</code> output of <code>unzip</code>.</p>
</li>
<li>
<p><code>system</code>:
The system type on which this derivation is to be built
(e.g. <code>x86_64-linux</code>).</p>
</li>
<li>
<p><code>builder</code>:
The absolute path of the program to be executed to run the build.
Typically this is the <code>bash</code> shell
(e.g. <code>/nix/store/r3j288vpmczbl500w6zz89gyfa4nr0b1-bash-4.4-p23/bin/bash</code>).</p>
</li>
<li>
<p><code>args</code>:
The command-line arguments passed to the <code>builder</code>.</p>
</li>
<li>
<p><code>env</code>:
The environment passed to the <code>builder</code>.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lockable-http-tarball-protocol"><a class="header" href="#lockable-http-tarball-protocol">Lockable HTTP Tarball Protocol</a></h1>
<p>Tarball flakes can be served as regular tarballs via HTTP or the file
system (for <code>file://</code> URLs). Unless the server implements the Lockable
HTTP Tarball protocol, it is the responsibility of the user to make sure that
the URL always produces the same tarball contents.</p>
<p>An HTTP server can return an "immutable" HTTP URL appropriate for lock
files. This allows users to specify a tarball flake input in
<code>flake.nix</code> that requests the latest version of a flake
(e.g. <code>https://example.org/hello/latest.tar.gz</code>), while <code>flake.lock</code>
will record a URL whose contents will not change
(e.g. <code>https://example.org/hello/&lt;revision&gt;.tar.gz</code>). To do so, the
server must return an <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Link">HTTP <code>Link</code> header</a> with the <code>rel</code> attribute set to
<code>immutable</code>, as follows:</p>
<pre><code>Link: &lt;flakeref&gt;; rel="immutable"
</code></pre>
<p>(Note the required <code>&lt;</code> and <code>&gt;</code> characters around <em>flakeref</em>.)</p>
<p><em>flakeref</em> must be a tarball flakeref. It can contain the tarball flake attributes
<code>narHash</code>, <code>rev</code>, <code>revCount</code> and <code>lastModified</code>. If <code>narHash</code> is included, its
value must be the [NAR hash][Nix Archive] of the unpacked tarball (as computed via
<code>nix hash path</code>). Nix checks the contents of the returned tarball
against the <code>narHash</code> attribute. The <code>rev</code> and <code>revCount</code> attributes
are useful when the tarball flake is a mirror of a fetcher type that
has those attributes, such as Git or GitHub. They are not checked by
Nix.</p>
<pre><code>Link: &lt;https://example.org/hello/442793d9ec0584f6a6e82fa253850c8085bb150a.tar.gz
  ?rev=442793d9ec0584f6a6e82fa253850c8085bb150a
  &amp;revCount=835
  &amp;narHash=sha256-GUm8Uh/U74zFCwkvt9Mri4DSM%2BmHj3tYhXUkYpiv31M%3D&gt;; rel="immutable"
</code></pre>
<p>(The linebreaks in this example are for clarity and must not be included in the actual response.)</p>
<p>For tarball flakes, the value of the <code>lastModified</code> flake attribute is
defined as the timestamp of the newest file inside the tarball.</p>
<h2 id="gitea-and-forgejo-support"><a class="header" href="#gitea-and-forgejo-support">Gitea and Forgejo support</a></h2>
<p>This protocol is supported by Gitea since v1.22.1 and by Forgejo since v7.0.4/v8.0.0 and can be used with the following flake URL schema:</p>
<pre><code>https://&lt;domain name&gt;/&lt;owner&gt;/&lt;repo&gt;/archive/&lt;reference or revison&gt;.tar.gz
</code></pre>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-nix"># flake.nix
{
   inputs = {
     foo.url = "https://gitea.example.org/some-person/some-flake/archive/main.tar.gz";
     bar.url = "https://gitea.example.org/some-other-person/other-flake/archive/442793d9ec0584f6a6e82fa253850c8085bb150a.tar.gz";
     qux = {
       url = "https://forgejo.example.org/another-person/some-non-flake-repo/archive/development.tar.gz";
       flake = false;
     };
   };
   outputs = { foo, bar, qux }: { /* ... */ };
}
</code></pre>
</blockquote>
<pre><code>
[Nix Archive]: ../store/file-system-object/content-address.md#serial-nix-archive
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="complete-store-path-calculation"><a class="header" href="#complete-store-path-calculation">Complete Store Path Calculation</a></h1>
<p>This is the complete specification for how <a href="protocols/../store/store-path.html">store path</a>s are calculated.</p>
<p>The format of this specification is close to <a href="https://en.wikipedia.org/wiki/Extended_Backus%E2%80%93Naur_form">Extended Backus–Naur form</a>, but must deviate for a few things such as hash functions which we treat as bidirectional for specification purposes.</p>
<p>Regular users do <em>not</em> need to know this information --- store paths can be treated as black boxes computed from the properties of the store objects they refer to.
But for those interested in exactly how Nix works, e.g. if they are reimplementing it, this information can be useful.</p>
<h2 id="store-path-proper"><a class="header" href="#store-path-proper">Store path proper</a></h2>
<pre><code class="language-ebnf">store-path = store-dir "/" digest "-" name
</code></pre>
<p>where</p>
<ul>
<li>
<p><code>name</code> = the name of the store object.</p>
</li>
<li>
<p><code>store-dir</code> = the <a href="protocols/../store/store-path.html#store-directory">store directory</a></p>
</li>
<li>
<p><code>digest</code> = base-32 representation of the compressed to 160 bits <a href="https://en.m.wikipedia.org/wiki/SHA-256">SHA-256</a> hash of <code>fingerprint</code></p>
</li>
</ul>
<p>For the definition of the hash compression algorithm, please refer to the section 5.1 of
the <a href="https://edolstra.github.io/pubs/phd-thesis.pdf">Nix thesis</a>, which also defines the
specifics of base-32 encoding. Note that base-32 encoding processes the hash bytestring from
the end, while base-16 processes in from the beginning.</p>
<h2 id="fingerprint"><a class="header" href="#fingerprint">Fingerprint</a></h2>
<ul>
<li>
<pre><code class="language-ebnf">fingerprint = type ":sha256:" inner-digest ":" store ":" name
</code></pre>
<p>Note that it includes the location of the store as well as the name to make sure that changes to either of those are reflected in the hash
(e.g. you won't get <code>/nix/store/&lt;digest&gt;-name1</code> and <code>/nix/store/&lt;digest&gt;-name2</code>, or <code>/gnu/store/&lt;digest&gt;-name1</code>, with equal hash parts).</p>
</li>
<li>
<p><code>type</code> = one of:</p>
<ul>
<li>
<pre><code class="language-ebnf">| "text" { ":" store-path }
</code></pre>
<p>This is for the
<a href="protocols/../store/store-object/content-address.html#method-text">"Text"</a>
method of content addressing store objects.
The optional trailing store paths are the references of the store object.</p>
</li>
<li>
<pre><code class="language-ebnf">| "source" { ":" store-path } [ ":self" ]
</code></pre>
<p>This is for the
<a href="protocols/../store/store-object/content-address.html#method-nix-archive">"Nix Archive"</a>
method of content addressing store objects,
if the hash algorithm is <a href="https://en.m.wikipedia.org/wiki/SHA-256">SHA-256</a>.
Just like in the "Text" case, we can have the store objects referenced by their paths.
Additionally, we can have an optional <code>:self</code> label to denote self-reference.</p>
</li>
<li>
<pre><code class="language-ebnf">| "output:" id
</code></pre>
<p>For either the outputs built from derivations,
or content-addressed store objects that are not using one of the two above cases.
To be explicit about the latter, that is currently these methods:</p>
<ul>
<li><a href="protocols/../store/store-object/content-address.html#method-flat">"Flat"</a></li>
<li><a href="protocols/../store/store-object/content-address.html#method-git">"Git"</a></li>
<li><a href="protocols/../store/store-object/content-address.html#method-nix-archive">"Nix Archive"</a> if the hash algorithm is not <a href="https://en.m.wikipedia.org/wiki/SHA-256">SHA-256</a>.</li>
</ul>
<p><code>id</code> is the name of the output (usually, "out").
For content-addressed store objects, <code>id</code>, is always "out".</p>
</li>
</ul>
</li>
<li>
<p><code>inner-digest</code> = base-16 representation of a SHA-256 hash of <code>inner-fingerprint</code>.
The base-16 encoding uses lower-cased hex digits.</p>
</li>
</ul>
<h2 id="inner-fingerprint"><a class="header" href="#inner-fingerprint">Inner fingerprint</a></h2>
<ul>
<li>
<p><code>inner-fingerprint</code> = one of the following based on <code>type</code>:</p>
<ul>
<li>
<p>if <code>type</code> = <code>"text:" ...</code>:</p>
<p>the string written to the resulting store path.</p>
</li>
<li>
<p>if <code>type</code> = <code>"source:" ...</code>:</p>
<p>the <a href="protocols/../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive (NAR)</a> serialization of the <a href="protocols/../store/file-system-object.html">file system object</a> of the store object.</p>
</li>
<li>
<p>if <code>type</code> = <code>"output:" id</code>:</p>
<ul>
<li>
<p>For input-addressed derivation outputs:</p>
<p>the <a href="protocols/../protocols/derivation-aterm.html">ATerm</a> serialization of the derivation modulo fixed output derivations.</p>
</li>
<li>
<p>For content-addressed store paths:</p>
<pre><code class="language-ebnf">"fixed:out:" rec algo ":" hash ":"
</code></pre>
<p>where</p>
<ul>
<li>
<p><code>rec</code> = one of:</p>
<ul>
<li>
<pre><code class="language-ebnf">| ""
</code></pre>
<p>(empty string) for hashes of the flat (single file) serialization</p>
</li>
<li>
<pre><code class="language-ebnf">| "r:"
</code></pre>
<p>hashes of the for <a href="protocols/../store/file-system-object/content-address.html#serial-nix-archive">Nix Archive (NAR)</a> (arbitrary file system object) serialization</p>
</li>
<li>
<pre><code class="language-ebnf">| "git:"
</code></pre>
<p>hashes of the <a href="https://git-scm.com/book/en/v2/Git-Internals-Git-Objects">Git blob/tree</a> <a href="https://en.wikipedia.org/wiki/Merkle_tree">Merkel tree</a> format</p>
</li>
</ul>
</li>
<li>
<pre><code class="language-ebnf">algo = "md5" | "sha1" | "sha256"
</code></pre>
</li>
<li>
<p><code>hash</code> = base-16 representation of the path or flat hash of the contents of the path (or expected contents of the path for fixed-output derivations).</p>
</li>
</ul>
<p>Note that <code>id</code> = <code>"out"</code>, regardless of the name part of the store path.
Also note that NAR + SHA-256 must not use this case, and instead must use the <code>type</code> = <code>"source:" ...</code> case.</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="historical-note"><a class="header" href="#historical-note">Historical Note</a></h3>
<p>The <code>type</code> = <code>"source:" ...</code> and <code>type</code> = <code>"output:out"</code> grammars technically overlap in purpose,
in that both can represent data hashed by its SHA-256 NAR serialization.</p>
<p>The original reason for this way of computing names was to prevent name collisions (for security).
For instance, the thinking was that it shouldn't be feasible to come up with a derivation whose output path collides with the path for a copied source.
The former would have an <code>inner-fingerprint</code> starting with <code>output:out:</code>, while the latter would have an <code>inner-fingerprint</code> starting with <code>source:</code>.</p>
<p>Since <code>64519cfd657d024ae6e2bb74cb21ad21b886fd2a</code> (2008), however, it was decided that separating derivation-produced vs manually-hashed content-addressed data like this was not useful.
Now, data that is content-addressed with SHA-256 + NAR-serialization always uses the <code>source:...</code> construction, regardless of how it was produced (manually or by derivation).
This allows freely switching between using <a href="protocols/../glossary.html#gloss-fixed-output-derivation">fixed-output derivations</a> for fetching, and fetching out-of-band and then manually adding.
It also removes the ambiguity from the grammar.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nix-archive-nar-format"><a class="header" href="#nix-archive-nar-format">Nix Archive (NAR) format</a></h1>
<p>This is the complete specification of the <a href="protocols/../store/file-system-object/content-address.html#nix-archive">Nix Archive</a> format.
The Nix Archive format closely follows the abstract specification of a <a href="protocols/../store/file-system-object.html">file system object</a> tree,
because it is designed to serialize exactly that data structure.</p>
<p>The format of this specification is close to <a href="https://en.wikipedia.org/wiki/Extended_Backus%E2%80%93Naur_form">Extended Backus–Naur form</a>, with the exception of the <code>str(..)</code> function / parameterized rule, which length-prefixes and pads strings.
This makes the resulting binary format easier to parse.</p>
<p>Regular users do <em>not</em> need to know this information.
But for those interested in exactly how Nix works, e.g. if they are reimplementing it, this information can be useful.</p>
<pre><code class="language-ebnf">nar = str("nix-archive-1"), nar-obj;

nar-obj = str("("), nar-obj-inner, str(")");

nar-obj-inner
  = str("type"), str("regular") regular
  | str("type"), str("symlink") symlink
  | str("type"), str("directory") directory
  ;

regular = [ str("executable"), str("") ], str("contents"), str(contents);

symlink = str("target"), str(target);

(* side condition: directory entries must be ordered by their names *)
directory = { directory-entry };

directory-entry = str("entry"), str("("), str("name"), str(name), str("node"), nar-obj, str(")");
</code></pre>
<p>The <code>str</code> function / parameterized rule is defined as follows:</p>
<ul>
<li>
<p><code>str(s)</code> = <code>int(|s|), pad(s);</code></p>
</li>
<li>
<p><code>int(n)</code> = the 64-bit little endian representation of the number <code>n</code></p>
</li>
<li>
<p><code>pad(s)</code> = the byte sequence <code>s</code>, padded with 0s to a multiple of 8 byte</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="derivation-aterm-file-format"><a class="header" href="#derivation-aterm-file-format">Derivation "ATerm" file format</a></h1>
<p>For historical reasons, <a href="protocols/../glossary.html#gloss-store-derivation">store derivations</a> are stored on-disk in <a href="https://homepages.cwi.nl/~daybuild/daily-books/technology/aterm-guide/aterm-guide.html">ATerm</a> format.</p>
<h2 id="the-aterm-format-used"><a class="header" href="#the-aterm-format-used">The ATerm format used</a></h2>
<p>Derivations are serialised in one of the following formats:</p>
<ul>
<li>
<pre><code>Derive(...)
</code></pre>
<p>For all stable derivations.</p>
</li>
<li>
<pre><code>DrvWithVersion(&lt;version-string&gt;, ...)
</code></pre>
<p>The only <code>version-string</code>s that are in use today are for <a href="protocols/../development/experimental-features.html">experimental features</a>:</p>
<ul>
<li><code>"xp-dyn-drv"</code> for the <a href="protocols/../development/experimental-features.html#xp-feature-dynamic-derivations"><code>dynamic-derivations</code></a> experimental feature.</li>
</ul>
</li>
</ul>
<h2 id="use-for-encoding-to-store-object"><a class="header" href="#use-for-encoding-to-store-object">Use for encoding to store object</a></h2>
<p>When derivation is encoded to a <a href="protocols/../glossary.html#gloss-store-object">store object</a> we make the following choices:</p>
<ul>
<li>
<p>The store path name is the derivation name with <code>.drv</code> suffixed at the end</p>
<p>Indeed, the ATerm format above does <em>not</em> contain the name of the derivation, on the assumption that a store path will also be provided out-of-band.</p>
</li>
<li>
<p>The derivation is content-addressed using the <a href="protocols/../store/store-object/content-address.html#method-text">"Text" method</a> of content-addressing derivations</p>
</li>
</ul>
<p>Currently we always encode derivations to store object using the ATerm format (and the previous two choices),
but we reserve the option to encode new sorts of derivations differently in the future.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="c-api"><a class="header" href="#c-api">C API</a></h1>
<p>Nix provides a C API with the intent of <a href="https://github.com/NixOS/nix/milestone/52"><em>becoming</em></a> a stable API, which it is currently not.
It is in development.</p>
<p>See:</p>
<ul>
<li>C API documentation for a recent build of master
<ul>
<li><a href="https://hydra.nixos.org/job/nix/master/external-api-docs/latest/download-by-type/doc/external-api-docs">Getting Started</a></li>
<li><a href="https://hydra.nixos.org/job/nix/master/external-api-docs/latest/download-by-type/doc/external-api-docs/globals.html">Index</a></li>
</ul>
</li>
<li><a href="https://matrix.to/#/#nix-bindings:nixos.org">Matrix Room <em>Nix Bindings</em></a> for discussion and questions.</li>
<li><a href="https://github.com/NixOS/nix/milestone/52">Stabilisation Milestone</a></li>
<li><a href="https://github.com/NixOS/nix/labels/c%20api">Other C API PRs and issues</a></li>
<li><a href="development/documentation.html#c-api-documentation">Contributing C API Documentation</a>, including how to build it locally.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="glossary"><a class="header" href="#glossary">Glossary</a></h1>
<ul>
<li>
<p><a href="glossary.html#gloss-build-system" id="gloss-build-system">build system</a></p>
<p>Generic term for software that facilitates the building of software by automating the invocation of compilers, linkers, and other tools.</p>
<p>Nix can be used as a generic build system.
It has no knowledge of any particular programming language or toolchain.
These details are specified in <a href="glossary.html#gloss-derivation-expression">derivation expressions</a>.</p>
</li>
<li>
<p><a href="glossary.html#gloss-content-address" id="gloss-content-address">content address</a></p>
<p>A
<a href="https://en.wikipedia.org/wiki/Content-addressable_storage"><em>content address</em></a>
is a secure way to reference immutable data.
The reference is calculated directly from the content of the data being referenced, which means the reference is
<a href="https://en.wikipedia.org/wiki/Tamperproofing"><em>tamper proof</em></a>
--- variations of the data should always calculate to distinct content addresses.</p>
<p>For how Nix uses content addresses, see:</p>
<ul>
<li><a href="./store/file-system-object/content-address.html">Content-Addressing File System Objects</a></li>
<li><a href="./store/store-object/content-address.html">Content-Addressing Store Objects</a></li>
<li><a href="glossary.html#gloss-content-addressing-derivation">content-addressing derivation</a></li>
</ul>
<p>Software Heritage's writing on <a href="https://www.softwareheritage.org/2020/07/09/intrinsic-vs-extrinsic-identifiers"><em>Intrinsic and Extrinsic identifiers</em></a> is also a good introduction to the value of content-addressing over other referencing schemes.</p>
<p>Besides content addressing, the Nix store also uses <a href="glossary.html#gloss-input-addressed-store-object">input addressing</a>.</p>
</li>
<li>
<p><a href="glossary.html#gloss-content-addressed-store" id="gloss-content-addressed-store">content-addressed storage</a></p>
<p>The industry term for storage and retrieval systems using <a href="glossary.html#gloss-content-address">content addressing</a>. A Nix store also has <a href="glossary.html#gloss-input-addressed-store-object">input addressing</a>, and metadata.</p>
</li>
<li>
<p><a href="glossary.html#gloss-store-derivation" id="gloss-store-derivation">store derivation</a></p>
<p>A single build task.
See <a href="./store/derivation/index.html#store-derivation">Store Derivation</a> for details.</p>
</li>
<li>
<p><a href="glossary.html#gloss-derivation-path" id="gloss-derivation-path">derivation path</a></p>
<p>A <a href="glossary.html#gloss-store-path">store path</a> which uniquely identifies a <a href="glossary.html#gloss-store-derivation">store derivation</a>.</p>
<p>See <a href="./store/derivation/index.html#derivation-path">Referencing Store Derivations</a> for details.</p>
<p>Not to be confused with [deriving path].</p>
</li>
<li>
<p><a href="glossary.html#gloss-derivation-expression" id="gloss-derivation-expression">derivation expression</a></p>
<p>A description of a <a href="glossary.html#gloss-store-derivation">store derivation</a> in the Nix language.
The output(s) of a derivation are store objects.
Derivations are typically specified in Nix expressions using the <a href="./language/derivations.html"><code>derivation</code> primitive</a>.
These are translated into store layer <em>derivations</em> (implicitly by <code>nix-env</code> and <code>nix-build</code>, or explicitly by <code>nix-instantiate</code>).</p>
</li>
<li>
<p><a href="glossary.html#gloss-instantiate" id="gloss-instantiate">instantiate</a>, instantiation</p>
<p>Translate a <a href="glossary.html#gloss-derivation-expression">derivation expression</a> into a <a href="glossary.html#gloss-store-derivation">store derivation</a>.</p>
<p>See <a href="./command-ref/nix-instantiate.html"><code>nix-instantiate</code></a>, which produces a store derivation from a Nix expression that evaluates to a derivation.</p>
</li>
<li>
<p><a href="glossary.html#gloss-realise" id="gloss-realise">realise</a>, realisation</p>
<p>Ensure a <a href="glossary.html#gloss-store-path">store path</a> is <a href="glossary.html#gloss-validity">valid</a>.</p>
<p>This can be achieved by:</p>
<ul>
<li>Fetching a pre-built <a href="glossary.html#gloss-store-object">store object</a> from a <a href="glossary.html#gloss-substituter">substituter</a></li>
<li>Running the <a href="./language/derivations.html#attr-builder"><code>builder</code></a> executable as specified in the corresponding <a href="glossary.html#gloss-store-derivation">store derivation</a></li>
<li>Delegating to a <a href="./command-ref/conf-file.html#conf-builders">remote machine</a> and retrieving the outputs</li>
</ul>
<!-- TODO: link [running] to build process page, #8888 -->
<p>See <a href="./command-ref/nix-store/realise.html"><code>nix-store --realise</code></a> for a detailed description of the algorithm.</p>
<p>See also <a href="./command-ref/nix-build.html"><code>nix-build</code></a> and <a href="./command-ref/new-cli/nix3-build.html"><code>nix build</code></a> (experimental).</p>
</li>
<li>
<p><a href="glossary.html#gloss-content-addressing-derivation" id="gloss-content-addressing-derivation">content-addressing derivation</a></p>
<p>A derivation which has the
<a href="./language/advanced-attributes.html#adv-attr-__contentAddressed"><code>__contentAddressed</code></a>
attribute set to <code>true</code>.</p>
</li>
<li>
<p><a href="glossary.html#gloss-fixed-output-derivation" id="gloss-fixed-output-derivation">fixed-output derivation</a> (FOD)</p>
<p>A <a href="glossary.html#gloss-store-derivation">store derivation</a> where a cryptographic hash of the <a href="glossary.html#gloss-output">output</a> is determined in advance using the <a href="./language/advanced-attributes.html#adv-attr-outputHash"><code>outputHash</code></a> attribute, and where the <a href="./language/derivations.html#attr-builder"><code>builder</code></a> executable has access to the network.</p>
</li>
<li>
<p><a href="glossary.html#gloss-store" id="gloss-store">store</a></p>
<p>A collection of <a href="glossary.html#gloss-store-object">store objects</a>, with operations to manipulate that collection.
See <a href="./store/index.html">Nix Store</a> for details.</p>
<p>There are many types of stores, see <a href="./store/types/index.html">Store Types</a> for details.</p>
</li>
<li>
<p><a href="glossary.html#gloss-nix-instance" id="gloss-nix-instance">Nix instance</a></p>
<!-- ambiguous -->
<ol>
<li>An installation of Nix, which includes the presence of a <a href="glossary.html#gloss-store">store</a>, and the Nix package manager which operates on that store.
A local Nix installation and a <a href="./advanced-topics/distributed-builds.html">remote builder</a> are two examples of Nix instances.</li>
<li>A running Nix process, such as the <code>nix</code> command.</li>
</ol>
</li>
<li>
<p><a href="glossary.html#gloss-binary-cache" id="gloss-binary-cache">binary cache</a></p>
<p>A <em>binary cache</em> is a Nix store which uses a different format: its
metadata and signatures are kept in <code>.narinfo</code> files rather than in a
<a href="glossary.html#gloss-nix-database">Nix database</a>. This different format simplifies serving store objects
over the network, but cannot host builds. Examples of binary caches
include S3 buckets and the <a href="https://cache.nixos.org">NixOS binary cache</a>.</p>
</li>
<li>
<p><a href="glossary.html#gloss-store-path" id="gloss-store-path">store path</a></p>
<p>The location of a <a href="glossary.html#gloss-store-object">store object</a> in the file system, i.e., an immediate child of the Nix store directory.</p>
<blockquote>
<p><strong>Example</strong></p>
<p><code>/nix/store/a040m110amc4h71lds2jmr8qrkj2jhxd-git-2.38.1</code></p>
</blockquote>
<p>See <a href="./store/store-path.html">Store Path</a> for details.</p>
</li>
<li>
<p><a href="glossary.html#gloss-file-system-object" id="gloss-file-system-object">file system object</a></p>
<p>The Nix data model for representing simplified file system data.</p>
<p>See <a href="./store/file-system-object.html">File System Object</a> for details.</p>
</li>
<li>
<p><a href="glossary.html#gloss-store-object" id="gloss-store-object">store object</a></p>
<p>Part of the contents of a <a href="glossary.html#gloss-store">store</a>.</p>
<p>A store object consists of a <a href="glossary.html#gloss-file-system-object">file system object</a>, <a href="glossary.html#gloss-reference">references</a> to other store objects, and other metadata.
It can be referred to by a <a href="glossary.html#gloss-store-path">store path</a>.</p>
<p>See <a href="./store/store-object.html">Store Object</a> for details.</p>
</li>
<li>
<p><a href="glossary.html#gloss-ifd" id="gloss-ifd">IFD</a></p>
<p><a href="./language/import-from-derivation.html">Import From Derivation</a></p>
</li>
<li>
<p><a href="glossary.html#gloss-input-addressed-store-object" id="gloss-input-addressed-store-object">input-addressed store object</a></p>
<p>A store object produced by building a
non-<a href="glossary.html#gloss-content-addressing-derivation">content-addressed</a>,
non-<a href="glossary.html#gloss-fixed-output-derivation">fixed-output</a>
derivation.</p>
</li>
<li>
<p><a href="glossary.html#gloss-content-addressed-store-object" id="gloss-content-addressed-store-object">content-addressed store object</a></p>
<p>A <a href="glossary.html#gloss-store-object">store object</a> which is <a href="glossary.html#gloss-content-address">content-addressed</a>,
i.e. whose <a href="glossary.html#gloss-store-path">store path</a> is determined by its contents.
This includes derivations, the outputs of <a href="glossary.html#gloss-content-addressing-derivation">content-addressing derivations</a>, and the outputs of <a href="glossary.html#gloss-fixed-output-derivation">fixed-output derivations</a>.</p>
<p>See <a href="./store/store-object/content-address.html">Content-Addressing Store Objects</a> for details.</p>
</li>
<li>
<p><a href="glossary.html#gloss-substitute" id="gloss-substitute">substitute</a></p>
<p>A substitute is a command invocation stored in the <a href="glossary.html#gloss-nix-database">Nix database</a> that
describes how to build a store object, bypassing the normal build
mechanism (i.e., derivations). Typically, the substitute builds the
store object by downloading a pre-built version of the store object
from some server.</p>
</li>
<li>
<p><a href="glossary.html#gloss-substituter" id="gloss-substituter">substituter</a></p>
<p>An additional <a href="glossary.html#gloss-store" id="gloss-store">store</a> from which Nix can obtain store objects instead of building them.
Often the substituter is a <a href="glossary.html#gloss-binary-cache">binary cache</a>, but any store can serve as substituter.</p>
<p>See the <a href="./command-ref/conf-file.html#conf-substituters"><code>substituters</code> configuration option</a> for details.</p>
</li>
<li>
<p><a href="glossary.html#gloss-purity" id="gloss-purity">purity</a></p>
<p>The assumption that equal Nix derivations when run always produce
the same output. This cannot be guaranteed in general (e.g., a
builder can rely on external inputs such as the network or the
system time) but the Nix model assumes it.</p>
</li>
<li>
<p><a href="glossary.html#gloss-impure-derivation" id="gloss-impure-derivation">impure derivation</a></p>
<p><a href="glossary.html#./development/experimental-features.md#xp-feature-impure-derivations">An experimental feature</a> that allows derivations to be explicitly marked as impure,
so that they are always rebuilt, and their outputs not reused by subsequent calls to realise them.</p>
</li>
<li>
<p><a href="glossary.html#gloss-nix-database" id="gloss-nix-database">Nix database</a></p>
<p>An SQlite database to track <a href="glossary.html#gloss-reference">reference</a>s between <a href="glossary.html#gloss-store-object">store object</a>s.
This is an implementation detail of the <a href="./store/types/local-store.html">local store</a>.</p>
<p>Default location: <code>/nix/var/nix/db</code>.</p>
</li>
<li>
<p><a href="glossary.html#gloss-nix-expression" id="gloss-nix-expression">Nix expression</a></p>
<p>A syntactically valid use of the <a href="./language/index.html">Nix language</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>The contents of a <code>.nix</code> file form a Nix expression.</p>
</blockquote>
<p>Nix expressions specify <a href="glossary.html#gloss-derivation-expression">derivation expressions</a>, which are <a href="glossary.html#gloss-instantiate">instantiated</a> into the Nix store as <a href="glossary.html#gloss-store-derivation">store derivations</a>.
These derivations can then be <a href="glossary.html#gloss-realise">realised</a> to produce <a href="glossary.html#gloss-output">outputs</a>.</p>
<blockquote>
<p><strong>Example</strong></p>
<p>Building and deploying software using Nix entails writing Nix expressions as a high-level description of packages and compositions thereof.</p>
</blockquote>
</li>
<li>
<p><a href="glossary.html#gloss-reference" id="gloss-reference">reference</a></p>
<p>A <a href="glossary.html#gloss-store-object">store object</a> <code>O</code> is said to have a <em>reference</em> to a store object <code>P</code> if a <a href="glossary.html#gloss-store-path">store path</a> to <code>P</code> appears in the contents of <code>O</code>.</p>
<p>Store objects can refer to both other store objects and themselves.
References from a store object to itself are called <em>self-references</em>.
References other than a self-reference must not form a cycle.</p>
</li>
<li>
<p><a href="glossary.html#gloss-reachable" id="gloss-reachable">reachable</a></p>
<p>A store path <code>Q</code> is reachable from another store path <code>P</code> if <code>Q</code>
is in the <em>closure</em> of the <em>references</em> relation.</p>
</li>
<li>
<p><a href="glossary.html#gloss-closure" id="gloss-closure">closure</a></p>
<p>The closure of a store path is the set of store paths that are
directly or indirectly “reachable” from that store path; that is,
it’s the closure of the path under the <em>references</em> relation. For
a package, the closure of its derivation is equivalent to the
build-time dependencies, while the closure of its <a href="glossary.html#gloss-output-path">output path</a> is
equivalent to its runtime dependencies. For correct deployment it
is necessary to deploy whole closures, since otherwise at runtime
files could be missing. The command <code>nix-store --query --requisites </code> prints out
closures of store paths.</p>
<p>As an example, if the <a href="glossary.html#gloss-store-object">store object</a> at path <code>P</code> contains a <a href="glossary.html#gloss-reference">reference</a>
to a store object at path <code>Q</code>, then <code>Q</code> is in the closure of <code>P</code>. Further, if <code>Q</code>
references <code>R</code> then <code>R</code> is also in the closure of <code>P</code>.</p>
</li>
<li>
<p><a href="glossary.html#gloss-output" id="gloss-output">output</a></p>
<p>A <a href="glossary.html#gloss-store-object">store object</a> produced by a <a href="glossary.html#gloss-store-derivation">store derivation</a>.
See <a href="./language/derivations.html#attr-outputs">the <code>outputs</code> argument to the <code>derivation</code> function</a> for details.</p>
</li>
<li>
<p><a href="glossary.html#gloss-output-path" id="gloss-output-path">output path</a></p>
<p>The <a href="glossary.html#gloss-store-path">store path</a> to the <a href="glossary.html#gloss-output">output</a> of a <a href="glossary.html#gloss-store-derivation">store derivation</a>.</p>
</li>
<li>
<p><a href="glossary.html#gloss-output-closure" id="gloss-output-closure">output closure</a><br />
The <a href="glossary.html#gloss-closure">closure</a> of an <a href="glossary.html#gloss-output-path">output path</a>. It only contains what is [reachable] from the output.</p>
</li>
<li>
<p><a href="glossary.html#gloss-deriving-path" id="gloss-deriving-path">deriving path</a></p>
<p>Deriving paths are a way to refer to <a href="glossary.html#gloss-store-object">store objects</a> that might not yet be <a href="glossary.html#gloss-realise">realised</a>.</p>
<p>See <a href="./store/derivation/index.html#deriving-path">Deriving Path</a> for details.</p>
<p>Not to be confused with <a href="glossary.html#gloss-derivation-path">derivation path</a>.</p>
</li>
<li>
<p><a href="glossary.html#gloss-deriver" id="gloss-deriver">deriver</a></p>
<p>The <a href="glossary.html#gloss-store-derivation">store derivation</a> that produced an <a href="glossary.html#gloss-output-path">output path</a>.</p>
<p>The deriver for an output path can be queried with the <code>--deriver</code> option to
<a href="./command-ref/nix-store/query.html"><code>nix-store --query</code></a>.</p>
</li>
<li>
<p><a href="glossary.html#gloss-validity" id="gloss-validity">validity</a></p>
<p>A store path is valid if all <a href="glossary.html#gloss-store-object">store object</a>s in its <a href="glossary.html#gloss-closure">closure</a> can be read from the <a href="glossary.html#gloss-store">store</a>.</p>
<p>For a <a href="./store/types/local-store.html">local store</a>, this means:</p>
<ul>
<li>The store path leads to an existing <a href="glossary.html#gloss-store-object">store object</a> in that <a href="glossary.html#gloss-store">store</a>.</li>
<li>The store path is listed in the <a href="glossary.html#gloss-nix-database">Nix database</a> as being valid.</li>
<li>All paths in the store path's <a href="glossary.html#gloss-closure">closure</a> are valid.</li>
</ul>
</li>
<li>
<p><a href="glossary.html#gloss-user-env" id="gloss-user-env">user environment</a></p>
<p>An automatically generated store object that consists of a set of
symlinks to “active” applications, i.e., other store paths. These
are generated automatically by
<a href="./command-ref/nix-env.html"><code>nix-env</code></a>. See <em>profiles</em>.</p>
</li>
<li>
<p><a href="glossary.html#gloss-profile" id="gloss-profile">profile</a></p>
<p>A symlink to the current <em>user environment</em> of a user, e.g.,
<code>/nix/var/nix/profiles/default</code>.</p>
</li>
<li>
<p><a href="glossary.html#gloss-installable" id="gloss-installable">installable</a></p>
<p>Something that can be realised in the Nix store.</p>
<p>See <a href="./command-ref/new-cli/nix.html#installables">installables</a> for <a href="./command-ref/new-cli/nix.html"><code>nix</code> commands</a> (experimental) for details.</p>
</li>
<li>
<p><a href="glossary.html#gloss-nar" id="gloss-nar">Nix Archive (NAR)</a></p>
<p>A <em>N</em>ix <em>AR</em>chive. This is a serialisation of a path in the Nix
store. It can contain regular files, directories and symbolic
links.  NARs are generated and unpacked using <code>nix-store --dump</code>
and <code>nix-store --restore</code>.</p>
<p>See <a href="store/file-system-object/content-address.html#serial-nix-archive">Nix Archive</a> for details.</p>
</li>
<li>
<p><a href="glossary.html#gloss-emtpy-set" id="gloss-emtpy-set"><code>∅</code></a></p>
<p>The empty set symbol. In the context of profile history, this denotes a package is not present in a particular version of the profile.</p>
</li>
<li>
<p><a href="glossary.html#gloss-epsilon" id="gloss-epsilon"><code>ε</code></a></p>
<p>The epsilon symbol. In the context of a package, this means the version is empty. More precisely, the derivation does not have a version attribute.</p>
</li>
<li>
<p><a href="glossary.html#package" id="package">package</a></p>
<ol>
<li>
<p>A software package; a collection of files and other data.</p>
</li>
<li>
<p>A <a href="glossary.html#package-attribute-set">package attribute set</a>.</p>
</li>
</ol>
</li>
<li>
<p><a href="glossary.html#package-attribute-set" id="package-attribute-set">package attribute set</a></p>
<p>An <a href="./language/types.html#attribute-set">attribute set</a> containing the attribute <code>type = "derivation";</code> (derivation for historical reasons), as well as other attributes, such as</p>
<ul>
<li>attributes that refer to the files of a [package], typically in the form of <a href="glossary.html#output">derivation outputs</a>,</li>
<li>attributes that declare something about how the package is supposed to be installed or used,</li>
<li>other metadata or arbitrary attributes.</li>
</ul>
</li>
<li>
<p><a href="glossary.html#gloss-string-interpolation" id="gloss-string-interpolation">string interpolation</a></p>
<p>Expanding expressions enclosed in <code>${ }</code> within a <a href="./language/types.html#type-string">string</a>, <a href="./language/types.html#type-path">path</a>, or <a href="./language/types.html#attribute-set">attribute name</a>.</p>
<p>See <a href="./language/string-interpolation.html">String interpolation</a> for details.</p>
</li>
<li>
<p><a href="glossary.html#gloss-base-directory" id="gloss-base-directory">base directory</a></p>
<p>The location from which relative paths are resolved.</p>
<ul>
<li>For expressions in a file, the base directory is the directory containing that file.
This is analogous to the directory of a <a href="https://datatracker.ietf.org/doc/html/rfc1808#section-3.3">base URL</a>.<!-- which is sufficient for resolving non-empty URLs -->
</li>
</ul>
<!--
  The wording here may look awkward, but it's for these reasons:
    * "with --expr": it's a flag, and not an option with an accompanying value
    * "written in": the expression itself must be written as an argument,
      whereas the more natural "passed as an argument" allows an interpretation
      where the expression could be passed by file name.
  -->
<ul>
<li>For expressions written in command line arguments with <a href="./command-ref/opt-common.html#opt-expr"><code>--expr</code></a>, the base directory is the current working directory.</li>
</ul>
</li>
<li>
<p><a href="glossary.html#gloss-experimental-feature" id="gloss-experimental-feature">experimental feature</a></p>
<p>Not yet stabilized functionality guarded by named experimental feature flags.
These flags are enabled or disabled with the <a href="./command-ref/conf-file.html#conf-experimental-features"><code>experimental-features</code></a> setting.</p>
<p>See the contribution guide on the <a href="./development/experimental-features.html">purpose and lifecycle of experimental feaures</a>.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="development"><a class="header" href="#development">Development</a></h1>
<p>Nix is developed on GitHub.
Check the <a href="https://github.com/NixOS/nix/blob/master/CONTRIBUTING.md">contributing guide</a> if you want to get involved.</p>
<p>This chapter is a collection of guides for making changes to the code and documentation.</p>
<p>If you're not sure where to start, try to <a href="development/./building.html">compile Nix from source</a> and consider <a href="development/./documentation.html">making improvements to documentation</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="building-nix"><a class="header" href="#building-nix">Building Nix</a></h1>
<p>This section provides some notes on how to start hacking on Nix.
To get the latest version of Nix from GitHub:</p>
<pre><code class="language-console">$ git clone https://github.com/NixOS/nix.git
$ cd nix
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>The following instructions assume you already have some version of Nix installed locally, so that you can use it to set up the development environment.
If you don't have it installed, follow the <a href="development/../installation/index.html">installation instructions</a>.</p>
</blockquote>
<p>To build all dependencies and start a shell in which all environment variables are set up so that those dependencies can be found:</p>
<pre><code class="language-console">$ nix-shell
</code></pre>
<p>To get a shell with one of the other <a href="development/building.html#compilation-environments">supported compilation environments</a>:</p>
<pre><code class="language-console">$ nix-shell --attr devShells.x86_64-linux.native-clangStdenvPackages
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>You can use <code>native-ccacheStdenv</code> to drastically improve rebuild time.
By default, <a href="https://ccache.dev">ccache</a> keeps artifacts in <code>~/.cache/ccache/</code>.</p>
</blockquote>
<p>To build Nix itself in this shell:</p>
<pre><code class="language-console">[nix-shell]$ mesonFlags+=" --prefix=$(pwd)/outputs/out"
[nix-shell]$ dontAddPrefix=1 configurePhase
[nix-shell]$ buildPhase
</code></pre>
<p>To test it:</p>
<pre><code class="language-console">[nix-shell]$ checkPhase
</code></pre>
<p>To install it in <code>$(pwd)/outputs</code>:</p>
<pre><code class="language-console">[nix-shell]$ installPhase
[nix-shell]$ ./outputs/out/bin/nix --version
nix (Nix) 2.12
</code></pre>
<p>To build a release version of Nix for the current operating system and CPU architecture:</p>
<pre><code class="language-console">$ nix-build
</code></pre>
<p>You can also build Nix for one of the <a href="development/building.html#platforms">supported platforms</a>.</p>
<h2 id="building-nix-with-flakes"><a class="header" href="#building-nix-with-flakes">Building Nix with flakes</a></h2>
<p>This section assumes you are using Nix with the <a href="development/../development/experimental-features.html#xp-feature-flakes"><code>flakes</code></a> and <a href="development/../development/experimental-features.html#xp-nix-command"><code>nix-command</code></a> experimental features enabled.</p>
<p>To build all dependencies and start a shell in which all environment variables are set up so that those dependencies can be found:</p>
<pre><code class="language-console">$ nix develop
</code></pre>
<p>This shell also adds <code>./outputs/bin/nix</code> to your <code>$PATH</code> so you can run <code>nix</code> immediately after building it.</p>
<p>To get a shell with one of the other <a href="development/building.html#compilation-environments">supported compilation environments</a>:</p>
<pre><code class="language-console">$ nix develop .#native-clangStdenv
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>Use <code>ccacheStdenv</code> to drastically improve rebuild time.
By default, <a href="https://ccache.dev">ccache</a> keeps artifacts in <code>~/.cache/ccache/</code>.</p>
</blockquote>
<p>To build Nix itself in this shell:</p>
<pre><code class="language-console">[nix-shell]$ configurePhase
[nix-shell]$ buildPhase
</code></pre>
<p>To test it:</p>
<pre><code class="language-console">[nix-shell]$ checkPhase
</code></pre>
<p>To install it in <code>$(pwd)/outputs</code>:</p>
<pre><code class="language-console">[nix-shell]$ installPhase
[nix-shell]$ nix --version
nix (Nix) 2.12
</code></pre>
<p>For more information on running and filtering tests, see
<a href="development/./testing.html"><code>testing.md</code></a>.</p>
<p>To build a release version of Nix for the current operating system and CPU architecture:</p>
<pre><code class="language-console">$ nix build
</code></pre>
<p>You can also build Nix for one of the <a href="development/building.html#platforms">supported platforms</a>.</p>
<h2 id="platforms"><a class="header" href="#platforms">Platforms</a></h2>
<p>Nix can be built for various platforms, as specified in <a href="https://github.com/nixos/nix/blob/master/flake.nix"><code>flake.nix</code></a>:</p>
<ul>
<li><code>x86_64-linux</code></li>
<li><code>x86_64-darwin</code></li>
<li><code>i686-linux</code></li>
<li><code>aarch64-linux</code></li>
<li><code>aarch64-darwin</code></li>
<li><code>armv6l-linux</code></li>
<li><code>armv7l-linux</code></li>
<li><code>riscv64-linux</code></li>
</ul>
<p>In order to build Nix for a different platform than the one you're currently
on, you need a way for your current Nix installation to build code for that
platform. Common solutions include [remote build machines] and <a href="https://nixos.org/manual/nixos/stable/options.html#opt-boot.binfmt.emulatedSystems">binary format emulation</a>
(only supported on NixOS).</p>
<p>Given such a setup, executing the build only requires selecting the respective attribute.
For example, to compile for <code>aarch64-linux</code>:</p>
<pre><code class="language-console">$ nix-build --attr packages.aarch64-linux.default
</code></pre>
<p>or for Nix with the <a href="development/../development/experimental-features.html#xp-feature-flakes"><code>flakes</code></a> and <a href="development/../development/experimental-features.html#xp-nix-command"><code>nix-command</code></a> experimental features enabled:</p>
<pre><code class="language-console">$ nix build .#packages.aarch64-linux.default
</code></pre>
<p>Cross-compiled builds are available for:</p>
<ul>
<li><code>armv6l-linux</code></li>
<li><code>armv7l-linux</code></li>
<li><code>riscv64-linux</code>
Add more <a href="development/building.html#system-type">system types</a> to <code>crossSystems</code> in <code>flake.nix</code> to bootstrap Nix on unsupported platforms.</li>
</ul>
<h3 id="building-for-multiple-platforms-at-once"><a class="header" href="#building-for-multiple-platforms-at-once">Building for multiple platforms at once</a></h3>
<p>It is useful to perform multiple cross and native builds on the same source tree,
for example to ensure that better support for one platform doesn't break the build for another.
Meson thankfully makes this very easy by confining all build products to the build directory --- one simple shares the source directory between multiple build directories, each of which contains the build for Nix to a different platform.</p>
<p>Here's how to do that:</p>
<ol>
<li>
<p>Instruct Nixpkgs's infra where we want Meson to put its build directory</p>
<pre><code class="language-bash">mesonBuildDir=build-my-variant-name
</code></pre>
</li>
<li>
<p>Configure as usual</p>
<pre><code class="language-bash">configurePhase
</code></pre>
</li>
<li>
<p>Build as usual</p>
<pre><code class="language-bash">buildPhase
</code></pre>
</li>
</ol>
<h2 id="system-type"><a class="header" href="#system-type">System type</a></h2>
<p>Nix uses a string with the following format to identify the <em>system type</em> or <em>platform</em> it runs on:</p>
<pre><code>&lt;cpu&gt;-&lt;os&gt;[-&lt;abi&gt;]
</code></pre>
<p>It is set when Nix is compiled for the given system, and based on the output of <a href="https://github.com/nixos/nix/blob/master/config/config.guess"><code>config.guess</code></a> (<a href="https://git.savannah.gnu.org/cgit/config.git/tree/config.guess">upstream</a>):</p>
<pre><code>&lt;cpu&gt;-&lt;vendor&gt;-&lt;os&gt;[&lt;version&gt;][-&lt;abi&gt;]
</code></pre>
<p>When Nix is built such that <code>./configure</code> is passed any of the <code>--host</code>, <code>--build</code>, <code>--target</code> options, the value is based on the output of <a href="https://github.com/nixos/nix/blob/master/config/config.sub"><code>config.sub</code></a> (<a href="https://git.savannah.gnu.org/cgit/config.git/tree/config.sub">upstream</a>):</p>
<pre><code>&lt;cpu&gt;-&lt;vendor&gt;[-&lt;kernel&gt;]-&lt;os&gt;
</code></pre>
<p>For historic reasons and backward-compatibility, some CPU and OS identifiers are translated from the GNU Autotools naming convention in <a href="https://github.com/nixos/nix/blob/master/configure.ac"><code>configure.ac</code></a> as follows:</p>
<div class="table-wrapper"><table><thead><tr><th><code>config.guess</code></th><th>Nix</th></tr></thead><tbody>
<tr><td><code>amd64</code></td><td><code>x86_64</code></td></tr>
<tr><td><code>i*86</code></td><td><code>i686</code></td></tr>
<tr><td><code>arm6</code></td><td><code>arm6l</code></td></tr>
<tr><td><code>arm7</code></td><td><code>arm7l</code></td></tr>
<tr><td><code>linux-gnu*</code></td><td><code>linux</code></td></tr>
<tr><td><code>linux-musl*</code></td><td><code>linux</code></td></tr>
</tbody></table>
</div>
<h2 id="compilation-environments"><a class="header" href="#compilation-environments">Compilation environments</a></h2>
<p>Nix can be compiled using multiple environments:</p>
<ul>
<li><code>stdenv</code>: default;</li>
<li><code>gccStdenv</code>: force the use of <code>gcc</code> compiler;</li>
<li><code>clangStdenv</code>: force the use of <code>clang</code> compiler;</li>
<li><code>ccacheStdenv</code>: enable [ccache], a compiler cache to speed up compilation.</li>
</ul>
<p>To build with one of those environments, you can use</p>
<pre><code class="language-console">$ nix build .#nix-ccacheStdenv
</code></pre>
<p>for flake-enabled Nix, or</p>
<pre><code class="language-console">$ nix-build --attr nix-ccacheStdenv
</code></pre>
<p>for classic Nix.</p>
<p>You can use any of the other supported environments in place of <code>nix-ccacheStdenv</code>.</p>
<h2 id="editor-integration"><a class="header" href="#editor-integration">Editor integration</a></h2>
<p>The <code>clangd</code> LSP server is installed by default on the <code>clang</code>-based <code>devShell</code>s.
See <a href="development/building.html#compilation-environments">supported compilation environments</a> and instructions how to set up a shell <a href="development/building.html#nix-with-flakes">with flakes</a> or in <a href="development/building.html#classic-nix">classic Nix</a>.</p>
<p>To use the LSP with your editor, you will want a <code>compile_commands.json</code> file telling <code>clangd</code> how we are compiling the code.
Meson's configure always produces this inside the build directory.</p>
<p>Configure your editor to use the <code>clangd</code> from the <code>.#native-clangStdenv</code> shell.
You can do that either by running it inside the development shell, or by using <a href="https://github.com/nix-community/nix-direnv">nix-direnv</a> and <a href="https://github.com/direnv/direnv/wiki#editor-integration">the appropriate editor plugin</a>.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>For some editors (e.g. Visual Studio Code), you may need to install a <a href="https://open-vsx.org/extension/llvm-vs-code-extensions/vscode-clangd">special extension</a> for the editor to interact with <code>clangd</code>.
Some other editors (e.g. Emacs, Vim) need a plugin to support LSP servers in general (e.g. <a href="https://github.com/emacs-lsp/lsp-mode">lsp-mode</a> for Emacs and <a href="https://github.com/prabirshrestha/vim-lsp">vim-lsp</a> for vim).
Editor-specific setup is typically opinionated, so we will not cover it here in more detail.</p>
</blockquote>
<h2 id="formatting-and-pre-commit-hooks"><a class="header" href="#formatting-and-pre-commit-hooks">Formatting and pre-commit hooks</a></h2>
<p>You may run the formatters as a one-off using:</p>
<pre><code class="language-console">./maintainers/format.sh
</code></pre>
<h3 id="pre-commit-hooks"><a class="header" href="#pre-commit-hooks">Pre-commit hooks</a></h3>
<p>If you'd like to run the formatters before every commit, install the hooks:</p>
<pre><code>pre-commit-hooks-install
</code></pre>
<p>This installs <a href="https://pre-commit.com">pre-commit</a> using <a href="https://github.com/cachix/git-hooks.nix">cachix/git-hooks.nix</a>.</p>
<p>When making a commit, pay attention to the console output.
If it fails, run <code>git add --patch</code> to approve the suggestions <em>and commit again</em>.</p>
<p>To refresh pre-commit hook's config file, do the following:</p>
<ol>
<li>Exit the development shell and start it again by running <code>nix develop</code>.</li>
<li>If you also use the pre-commit hook, also run <code>pre-commit-hooks-install</code> again.</li>
</ol>
<h3 id="vscode"><a class="header" href="#vscode">VSCode</a></h3>
<p>Insert the following json into your <code>.vscode/settings.json</code> file to configure <code>nixfmt</code>.
This will be picked up by the <em>Format Document</em> command, <code>"editor.formatOnSave"</code>, etc.</p>
<pre><code class="language-json">{
  "nix.formatterPath": "nixfmt",
  "nix.serverSettings": {
    "nixd": {
      "formatting": {
        "command": [
          "nixfmt"
        ],
      },
    },
    "nil": {
      "formatting": {
        "command": [
          "nixfmt"
        ],
      },
    },
  },
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-tests"><a class="header" href="#running-tests">Running tests</a></h1>
<h2 id="coverage-analysis"><a class="header" href="#coverage-analysis">Coverage analysis</a></h2>
<p>A <a href="https://hydra.nixos.org/job/nix/master/coverage/latest/download-by-type/report/coverage">coverage analysis report</a> is available online
You can build it yourself:</p>
<pre><code># nix build .#hydraJobs.coverage
# xdg-open ./result/coverage/index.html
</code></pre>
<p><a href="https://hydra.nixos.org/job/nix/master/coverage#tabs-charts">Extensive records of build metrics</a>, such as test coverage over time, are also available online.</p>
<h2 id="unit-tests"><a class="header" href="#unit-tests">Unit-tests</a></h2>
<p>The unit tests are defined using the <a href="https://google.github.io/googletest/">googletest</a> and <a href="https://github.com/emil-e/rapidcheck">rapidcheck</a> frameworks.</p>
<h3 id="source-and-header-layout"><a class="header" href="#source-and-header-layout">Source and header layout</a></h3>
<blockquote>
<p>An example of some files, demonstrating much of what is described below</p>
<pre><code>src
├── libexpr
│   ├── meson.build
│   ├── include/nix/expr/value/context.hh
│   ├── value/context.cc
│   …
│
├── tests
│   │
│   …
│   ├── libutil-tests
│   │   ├── meson.build
│   │   …
│   │   └── data
│   │       ├── git/tree.txt
│   │       …
│   │
│   ├── libexpr-test-support
│   │   ├── meson.build
│   │   ├── include/nix/expr
│   │   │   ├── meson.build
│   │   │   └── tests
│   │   │       ├── value/context.hh
│   │   │       …
│   │   └── tests
│   │       ├── value/context.cc
│   │       …
│   │
│   ├── libexpr-tests
│   …   ├── meson.build
│       ├── value/context.cc
│       …
…
</code></pre>
</blockquote>
<p>The tests for each Nix library (<code>libnixexpr</code>, <code>libnixstore</code>, etc..) live inside a directory <code>src/${library_name_without-nix}-test</code>.
Given an interface (header) and implementation pair in the original library, say, <code>src/libexpr/include/nix/expr/value/context.hh</code> and <code>src/libexpr/value/context.cc</code>, we write tests for it in <code>src/libexpr-tests/value/context.cc</code>, and (possibly) declare/define additional interfaces for testing purposes in <code>src/libexpr-test-support/include/nix/expr/tests/value/context.hh</code> and <code>src/libexpr-test-support/tests/value/context.cc</code>.</p>
<p>Data for unit tests is stored in a <code>data</code> subdir of the directory for each unit test executable.
For example, <code>libnixstore</code> code is in <code>src/libstore</code>, and its test data is in <code>src/libstore-tests/data</code>.
The path to the <code>src/${library_name_without-nix}-test/data</code> directory is passed to the unit test executable with the environment variable <code>_NIX_TEST_UNIT_DATA</code>.
Note that each executable only gets the data for its tests.</p>
<p>The unit test libraries are in <code>src/${library_name_without-nix}-test-support</code>.
All headers are in a <code>tests</code> subdirectory so they are included with <code>#include "nix/tests/"</code>.</p>
<p>The use of all these separate directories for the unit tests might seem inconvenient, as for example the tests are not "right next to" the part of the code they are testing.
But organizing the tests this way has one big benefit:
there is no risk of any build-system wildcards for the library accidentally picking up test code that should not built and installed as part of the library.</p>
<h3 id="running-tests-1"><a class="header" href="#running-tests-1">Running tests</a></h3>
<p>You can run the whole testsuite with <code>meson test</code> from the Meson build directory, or the tests for a specific component with <code>meson test nix-store-tests</code>.
A environment variables that Google Test accepts are also worth knowing:</p>
<ol>
<li>
<p><a href="https://google.github.io/googletest/advanced.html#running-a-subset-of-the-tests"><code>GTEST_FILTER</code></a></p>
<p>This is used for finer-grained filtering of which tests to run.</p>
</li>
<li>
<p><a href="https://google.github.io/googletest/advanced.html#suppressing-test-passes"><code>GTEST_BRIEF</code></a></p>
<p>This is used to avoid logging passing tests.</p>
</li>
<li>
<p><a href="https://google.github.io/googletest/advanced.html#turning-assertion-failures-into-break-points"><code>GTEST_BREAK_ON_FAILURE</code></a></p>
<p>This is used to create a debugger breakpoint when an assertion failure occurs.</p>
</li>
</ol>
<p>Putting the first two together, one might run</p>
<pre><code class="language-bash">GTEST_BRIEF=1 GTEST_FILTER='ErrorTraceTest.*' meson test nix-expr-tests -v
</code></pre>
<p>for short but comprensive output.</p>
<h3 id="debugging-tests"><a class="header" href="#debugging-tests">Debugging tests</a></h3>
<p>For debugging, it is useful to combine the third option above with Meson's <a href="https://mesonbuild.com/Unit-tests.html#other-test-options"><code>--gdb</code></a> flag:</p>
<pre><code class="language-bash">GTEST_BRIEF=1 GTEST_FILTER='Group.my-failing-test' meson test nix-expr-tests --gdb
</code></pre>
<p>This will:</p>
<ol>
<li>
<p>Run the unit test with GDB</p>
</li>
<li>
<p>Run just <code>Group.my-failing-test</code></p>
</li>
<li>
<p>Stop the program when the test fails, allowing the user to then issue arbitrary commands to GDB.</p>
</li>
</ol>
<h3 id="characaterisation-testing-unit"><a class="header" href="#characaterisation-testing-unit">Characterisation testing</a></h3>
<p>See <a href="development/testing.html#characterisation-testing-functional">functional characterisation testing</a> for a broader discussion of characterisation testing.</p>
<p>Like with the functional characterisation, <code>_NIX_TEST_ACCEPT=1</code> is also used.
For example:</p>
<pre><code class="language-shell-session">$ _NIX_TEST_ACCEPT=1 meson test nix-store-tests -v
...
[  SKIPPED ] WorkerProtoTest.string_read
[  SKIPPED ] WorkerProtoTest.string_write
[  SKIPPED ] WorkerProtoTest.storePath_read
[  SKIPPED ] WorkerProtoTest.storePath_write
...
</code></pre>
<p>will regenerate the "golden master" expected result for the <code>libnixstore</code> characterisation tests.
The characterisation tests will mark themselves "skipped" since they regenerated the expected result instead of actually testing anything.</p>
<h3 id="unit-test-support-libraries"><a class="header" href="#unit-test-support-libraries">Unit test support libraries</a></h3>
<p>There are headers and code which are not just used to test the library in question, but also downstream libraries.
For example, we do <a href="https://en.wikipedia.org/wiki/Property_testing">property testing</a> with the <a href="https://github.com/emil-e/rapidcheck">rapidcheck</a> library.
This requires writing <code>Arbitrary</code> "instances", which are used to describe how to generate values of a given type for the sake of running property tests.
Because types contain other types, <code>Arbitrary</code> "instances" for some type are not just useful for testing that type, but also any other type that contains it.
Downstream types frequently contain upstream types, so it is very important that we share arbitrary instances so that downstream libraries' property tests can also use them.</p>
<p>It is important that these testing libraries don't contain any actual tests themselves.
On some platforms they would be run as part of every test executable that uses them, which is redundant.
On other platforms they wouldn't be run at all.</p>
<h2 id="functional-tests"><a class="header" href="#functional-tests">Functional tests</a></h2>
<p>The functional tests reside under the <code>tests/functional</code> directory and are listed in <code>tests/functional/meson.build</code>.
Each test is a bash script.</p>
<p>Functional tests are run during <code>installCheck</code> in the <code>nix</code> package build, as well as separately from the build, in VM tests.</p>
<h3 id="running-the-whole-test-suite"><a class="header" href="#running-the-whole-test-suite">Running the whole test suite</a></h3>
<p>The whole test suite (functional and unit tests) can be run with:</p>
<pre><code class="language-shell-session">$ checkPhase
</code></pre>
<h3 id="grouping-tests"><a class="header" href="#grouping-tests">Grouping tests</a></h3>
<p>Sometimes it is useful to group related tests so they can be easily run together without running the entire test suite.
Each test group is in a subdirectory of <code>tests</code>.
For example, <code>tests/functional/ca/meson.build</code> defines a <code>ca</code> test group for content-addressing derivation outputs.</p>
<p>That test group can be run like this:</p>
<pre><code class="language-shell-session">$ meson test --suite ca
ninja: Entering directory `/home/jcericson/src/nix/master/build'
ninja: no work to do.
[1-20/20] 🌑 nix-functional-tests:ca / ca/why-depends                                1/20 nix-functional-tests:ca / ca/nix-run                                  OK               0.16s
[2-20/20] 🌒 nix-functional-tests:ca / ca/why-depends                                2/20 nix-functional-tests:ca / ca/import-derivation                        OK               0.17s
</code></pre>
<h3 id="running-individual-tests"><a class="header" href="#running-individual-tests">Running individual tests</a></h3>
<p>Individual tests can be run with <code>meson</code>:</p>
<pre><code class="language-shell-session">$ meson test --verbose ${testName}
ninja: Entering directory `/home/jcericson/src/nix/master/build'
ninja: no work to do.
1/1 nix-functional-tests:main / ${testName}        OK               0.41s

Ok:                 1
Expected Fail:      0
Fail:               0
Unexpected Pass:    0
Skipped:            0
Timeout:            0

Full log written to /home/jcericson/src/nix/master/build/meson-logs/testlog.txt
</code></pre>
<p>The <code>--verbose</code> flag will make Meson also show the console output of each test for easier debugging.
The test script will then be traced with <code>set -x</code> and the output displayed as it happens,
regardless of whether the test succeeds or fails.</p>
<p>Tests can be also run directly without <code>meson</code>:</p>
<pre><code class="language-shell-session">$ TEST_NAME=${testName} NIX_REMOTE='' PS4='+(${BASH_SOURCE[0]-$0}:$LINENO) tests/functional/${testName}.sh
+(${testName}.sh:1) foo
output from foo
+(${testName}.sh:2) bar
output from bar
...
</code></pre>
<h3 id="debugging-failing-functional-tests"><a class="header" href="#debugging-failing-functional-tests">Debugging failing functional tests</a></h3>
<p>When a functional test fails, it usually does so somewhere in the middle of the script.</p>
<p>To figure out what's wrong, it is convenient to run the test regularly up to the failing <code>nix</code> command, and then run that command with a debugger like GDB.</p>
<p>For example, if the script looks like:</p>
<pre><code class="language-bash">foo
nix blah blub
bar
</code></pre>
<p>edit it like so:</p>
<pre><code class="language-diff"> foo
-nix blah blub
+gdb --args nix blah blub
 bar
</code></pre>
<p>Then, running the test with <a href="https://mesonbuild.com/Unit-tests.html#other-test-options"><code>--interactive</code></a> will prevent Meson from hijacking the terminal so you can drop you into GDB once the script reaches that point:</p>
<pre><code class="language-shell-session">$ meson test ${testName} --interactive
...
+ gdb blash blub
GNU gdb (GDB) 12.1
...
(gdb)
</code></pre>
<p>One can debug the Nix invocation in all the usual ways.
For example, enter <code>run</code> to start the Nix invocation.</p>
<h3 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h3>
<p>Sometimes running tests in the development shell may leave artefacts in the local repository.
To remove any traces of that:</p>
<pre><code class="language-console">git clean -x --force tests
</code></pre>
<h3 id="characterisation-testing-functional"><a class="header" href="#characterisation-testing-functional">Characterisation testing</a></h3>
<p>Occasionally, Nix utilizes a technique called <a href="https://en.wikipedia.org/wiki/Characterization_test">Characterisation Testing</a> as part of the functional tests.
This technique is to include the exact output/behavior of a former version of Nix in a test in order to check that Nix continues to produce the same behavior going forward.</p>
<p>For example, this technique is used for the language tests, to check both the printed final value if evaluation was successful, and any errors and warnings encountered.</p>
<p>It is frequently useful to regenerate the expected output.
To do that, rerun the failed test(s) with <code>_NIX_TEST_ACCEPT=1</code>.
For example:</p>
<pre><code class="language-bash">_NIX_TEST_ACCEPT=1 meson test lang
</code></pre>
<p>This convention is shared with the <a href="development/testing.html#characterisation-testing-unit">characterisation unit tests</a> too.</p>
<p>An interesting situation to document is the case when these tests are "overfitted".
The language tests are, again, an example of this.
The expected successful output of evaluation is supposed to be highly stable – we do not intend to make breaking changes to (the stable parts of) the Nix language.
However, the errors and warnings during evaluation (successful or not) are not stable in this way.
We are free to change how they are displayed at any time.</p>
<p>It may be surprising that we would test non-normative behavior like diagnostic outputs.
Diagnostic outputs are indeed not a stable interface, but they still are important to users.
By recording the expected output, the test suite guards against accidental changes, and ensure the <em>result</em> (not just the code that implements it) of the diagnostic code paths are under code review.
Regressions are caught, and improvements always show up in code review.</p>
<p>To ensure that characterisation testing doesn't make it harder to intentionally change these interfaces, there always must be an easy way to regenerate the expected output, as we do with <code>_NIX_TEST_ACCEPT=1</code>.</p>
<h3 id="running-functional-tests-on-nixos"><a class="header" href="#running-functional-tests-on-nixos">Running functional tests on NixOS</a></h3>
<p>We run the functional tests not just in the build, but also in VM tests.
This helps us ensure that Nix works correctly on NixOS, and environments that have similar characteristics that are hard to reproduce in a build environment.</p>
<p>These can be run with:</p>
<pre><code class="language-shell">nix build .#hydraJobs.tests.functional_user
</code></pre>
<p>Generally, this build is sufficient, but in nightly or CI we also test the attributes <code>functional_root</code> and <code>functional_trusted</code>, in which the test suite is run with different levels of authorization.</p>
<h2 id="integration-tests"><a class="header" href="#integration-tests">Integration tests</a></h2>
<p>The integration tests are defined in the Nix flake under the <code>hydraJobs.tests</code> attribute.
These tests include everything that needs to interact with external services or run Nix in a non-trivial distributed setup.
Because these tests are expensive and require more than what the standard github-actions setup provides, they only run on the master branch (on <a href="https://hydra.nixos.org/jobset/nix/master">https://hydra.nixos.org/jobset/nix/master</a>).</p>
<p>You can run them manually with <code>nix build .#hydraJobs.tests.{testName}</code> or <code>nix-build -A hydraJobs.tests.{testName}</code>.</p>
<h2 id="installer-tests"><a class="header" href="#installer-tests">Installer tests</a></h2>
<p>After a one-time setup, the Nix repository's GitHub Actions continuous integration (CI) workflow can test the installer each time you push to a branch.</p>
<p>Creating a Cachix cache for your installer tests and adding its authorisation token to GitHub enables <a href="https://github.com/NixOS/nix/blob/88a45d6149c0e304f6eb2efcc2d7a4d0d569f8af/.github/workflows/ci.yml#L50-L91">two installer-specific jobs in the CI workflow</a>:</p>
<ul>
<li>
<p>The <code>installer</code> job generates installers for the platforms below and uploads them to your Cachix cache:</p>
<ul>
<li><code>x86_64-linux</code></li>
<li><code>armv6l-linux</code></li>
<li><code>armv7l-linux</code></li>
<li><code>x86_64-darwin</code></li>
</ul>
</li>
<li>
<p>The <code>installer_test</code> job (which runs on <code>ubuntu-24.04</code> and <code>macos-14</code>) will try to install Nix with the cached installer and run a trivial Nix command.</p>
</li>
</ul>
<h3 id="one-time-setup"><a class="header" href="#one-time-setup">One-time setup</a></h3>
<ol>
<li>Have a GitHub account with a fork of the <a href="https://github.com/NixOS/nix">Nix repository</a>.</li>
<li>At cachix.org:
<ul>
<li>Create or log in to an account.</li>
<li>Create a Cachix cache using the format <code>&lt;github-username&gt;-nix-install-tests</code>.</li>
<li>Navigate to the new cache &gt; Settings &gt; Auth Tokens.</li>
<li>Generate a new Cachix auth token and copy the generated value.</li>
</ul>
</li>
<li>At github.com:
<ul>
<li>Navigate to your Nix fork &gt; Settings &gt; Secrets &gt; Actions &gt; New repository secret.</li>
<li>Name the secret <code>CACHIX_AUTH_TOKEN</code>.</li>
<li>Paste the copied value of the Cachix cache auth token.</li>
</ul>
</li>
</ol>
<h2 id="working-on-documentation"><a class="header" href="#working-on-documentation">Working on documentation</a></h2>
<h3 id="using-the-ci-generated-installer-for-manual-testing"><a class="header" href="#using-the-ci-generated-installer-for-manual-testing">Using the CI-generated installer for manual testing</a></h3>
<p>After the CI run completes, you can check the output to extract the installer URL:</p>
<ol>
<li>
<p>Click into the detailed view of the CI run.</p>
</li>
<li>
<p>Click into any <code>installer_test</code> run (the URL you're here to extract will be the same in all of them).</p>
</li>
<li>
<p>Click into the <code>Run cachix/install-nix-action@v...</code> step and click the detail triangle next to the first log line (it will also be <code>Run cachix/install-nix-action@v...</code>)</p>
</li>
<li>
<p>Copy the value of <code>install_url</code></p>
</li>
<li>
<p>To generate an install command, plug this <code>install_url</code> and your GitHub username into this template:</p>
<pre><code class="language-console">curl -L &lt;install_url&gt; | sh -s -- --tarball-url-prefix https://&lt;github-username&gt;-nix-install-tests.cachix.org/serve
</code></pre>
</li>
</ol>
<!-- #### Manually generating test installers

There's obviously a manual way to do this, and it's still the only way for
platforms that lack GA runners.

I did do this back in Fall 2020 (before the GA approach encouraged here). I'll
sketch what I recall in case it encourages someone to fill in detail, but: I
didn't know what I was doing at the time and had to fumble/ask around a lot--
so I don't want to uphold any of it as "right". It may have been dumb or
the _hard_ way from the getgo. Fundamentals may have changed since.

Here's the build command I used to do this on and for x86_64-darwin:
nix build --out-link /tmp/foo ".#checks.x86_64-darwin.binaryTarball"

I used the stable out-link to make it easier to script the next steps:
link=$(readlink /tmp/foo)
cp $link/*-darwin.tar.xz ~/somewheres

I've lost the last steps and am just going from memory:

From here, I think I had to extract and modify the `install` script to point
it at this tarball (which I scped to my own site, but it might make more sense
to just share them locally). I extracted this script once and then just
search/replaced in it for each new build.

The installer now supports a `--tarball-url-prefix` flag which _may_ have
solved this need?
-->
<div style="break-before: page; page-break-before: always;"></div><h1 id="debugging-nix"><a class="header" href="#debugging-nix">Debugging Nix</a></h1>
<p>This section shows how to build and debug Nix with debug symbols enabled.</p>
<p>Additionally, see <a href="development/./testing.html">Testing Nix</a> for further instructions on how to debug Nix in the context of a unit test or functional test.</p>
<h2 id="building-nix-with-debug-symbols"><a class="header" href="#building-nix-with-debug-symbols">Building Nix with Debug Symbols</a></h2>
<p>In the development shell, set the <code>mesonBuildType</code> environment variable to <code>debug</code> before configuring the build:</p>
<pre><code class="language-console">[nix-shell]$ export mesonBuildType=debugoptimized
</code></pre>
<p>Then, proceed to build Nix as described in <a href="development/./building.html">Building Nix</a>.
This will build Nix with debug symbols, which are essential for effective debugging.</p>
<p>It is also possible to build without debugging for faster build:</p>
<pre><code class="language-console">[nix-shell]$ NIX_HARDENING_ENABLE=$(printLines $NIX_HARDENING_ENABLE | grep -v fortify)
[nix-shell]$ export mesonBuildType=debug
</code></pre>
<p>(The first line is needed because <code>fortify</code> hardening requires at least some optimization.)</p>
<h2 id="debugging-the-nix-binary"><a class="header" href="#debugging-the-nix-binary">Debugging the Nix Binary</a></h2>
<p>Obtain your preferred debugger within the development shell:</p>
<pre><code class="language-console">[nix-shell]$ nix-shell -p gdb
</code></pre>
<p>On macOS, use <code>lldb</code>:</p>
<pre><code class="language-console">[nix-shell]$ nix-shell -p lldb
</code></pre>
<h3 id="launching-the-debugger"><a class="header" href="#launching-the-debugger">Launching the Debugger</a></h3>
<p>To debug the Nix binary, run:</p>
<pre><code class="language-console">[nix-shell]$ gdb --args ../outputs/out/bin/nix
</code></pre>
<p>On macOS, use <code>lldb</code>:</p>
<pre><code class="language-console">[nix-shell]$ lldb -- ../outputs/out/bin/nix
</code></pre>
<h3 id="using-the-debugger"><a class="header" href="#using-the-debugger">Using the Debugger</a></h3>
<p>Inside the debugger, you can set breakpoints, run the program, and inspect variables.</p>
<pre><code class="language-gdb">(gdb) break main
(gdb) run &lt;arguments&gt;
</code></pre>
<p>Refer to the <a href="https://www.gnu.org/software/gdb/documentation/">GDB Documentation</a> for comprehensive usage instructions.</p>
<p>On macOS, use <code>lldb</code>:</p>
<pre><code class="language-lldb">(lldb) breakpoint set --name main
(lldb) process launch -- &lt;arguments&gt;
</code></pre>
<p>Refer to the <a href="https://lldb.llvm.org/use/tutorial.html">LLDB Tutorial</a> for comprehensive usage instructions.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contributing-documentation"><a class="header" href="#contributing-documentation">Contributing documentation</a></h1>
<p>Improvements to documentation are very much appreciated, and a good way to start out with contributing to Nix.</p>
<p>This is how you can help:</p>
<ul>
<li>Address <a href="https://github.com/NixOS/nix/issues?q=is%3Aissue+is%3Aopen+label%3Adocumentation">open issues with documentation</a></li>
<li>Review <a href="https://github.com/NixOS/nix/pulls?q=is%3Apr+is%3Aopen+label%3Adocumentation">pull requests concerning documentation</a></li>
</ul>
<p>Incremental refactorings of the documentation build setup to make it faster or easier to understand and maintain are also welcome.</p>
<h2 id="building-the-manual"><a class="header" href="#building-the-manual">Building the manual</a></h2>
<p>Build the manual from scratch:</p>
<pre><code class="language-console">nix-build -E '(import ./.).packages.${builtins.currentSystem}.nix.doc'
</code></pre>
<p>or</p>
<pre><code class="language-console">nix build .#nix-manual
</code></pre>
<p>and open <code>./result/share/doc/nix/manual/index.html</code>.</p>
<p>To build the manual incrementally, <a href="development/./building.html">enter the development shell</a> and run:</p>
<pre><code class="language-console">make manual-html-open -j $NIX_BUILD_CORES
</code></pre>
<p>In order to reflect changes to the <a href="https://github.com/NixOS/nix/blob/master/doc/manual/local.mk">Makefile for the manual</a>, clear all generated files before re-building:</p>
<pre><code class="language-console">rm $(git ls-files doc/manual/ -o | grep -F '.md') &amp;&amp; rmdir doc/manual/source/command-ref/new-cli &amp;&amp; make manual-html -j $NIX_BUILD_CORES
</code></pre>
<h2 id="style-guide"><a class="header" href="#style-guide">Style guide</a></h2>
<p>The goal of this style guide is to make it such that</p>
<ul>
<li>The manual is easy to search and skim for relevant information</li>
<li>Documentation sources are easy to edit</li>
<li>Changes to documentation are easy to review</li>
</ul>
<p>You will notice that this is not implemented consistently yet.
Please follow the guide when making additions or changes to existing documentation.
Do not make sweeping changes, unless they are programmatic and can be validated easily.</p>
<h3 id="language"><a class="header" href="#language">Language</a></h3>
<p>This manual is <a href="https://diataxis.fr/reference/">reference documentation</a>.
The typical usage pattern is to look up isolated pieces of information.
It should therefore aim to be correct, consistent, complete, and easy to navigate at a glance.</p>
<ul>
<li>
<p>Aim for clarity and brevity.</p>
<p>Please take the time to read the <a href="https://www.plainlanguage.gov/guidelines/">plain language guidelines</a> for details.</p>
</li>
<li>
<p>Describe the subject factually.</p>
<p>In particular, do not make value judgements or recommendations.
Check the code or add tests if in doubt.</p>
</li>
<li>
<p>Provide complete, minimal examples, and explain them.</p>
<p>Readers should be able to try examples verbatim and get the same results as shown in the manual.
Always describe in words what a given example does.</p>
<p>Non-trivial examples may need additional explanation, especially if they use concepts from outside the given context.</p>
</li>
<li>
<p>Always explain code examples in the text.</p>
<p>Use comments in code samples very sparingly, for instance to highlight a particular aspect.
Readers tend to glance over large amounts of code when scanning for information.</p>
<p>Especially beginners will likely find reading more complex-looking code strenuous and may therefore avoid it altogether.</p>
<p>If a code sample appears to require a lot of inline explanation, consider replacing it with a simpler one.
If that's not possible, break the example down into multiple parts, explain them separately, and then show the combined result at the end.
This should be a last resort, as that would amount to writing a <a href="https://diataxis.fr/tutorials/">tutorial</a> on the given subject.</p>
</li>
<li>
<p>Use British English.</p>
<p>This is a somewhat arbitrary choice to force consistency, and accounts for the fact that a majority of Nix users and developers are from Europe.</p>
</li>
</ul>
<h3 id="links-and-anchors"><a class="header" href="#links-and-anchors">Links and anchors</a></h3>
<p>Reference documentation must be readable in arbitrary order.
Readers cannot be expected to have any particular prerequisite knowledge about Nix.
While the table of contents can provide guidance and full-text search can help, they are most likely to find what they need by following sensible cross-references.</p>
<ul>
<li>
<p>Link to technical terms</p>
<p>When mentioning Nix-specific concepts, commands, options, settings, etc., link to appropriate documentation.
Also link to external tools or concepts, especially if their meaning may be ambiguous.
You may also want to link to definitions of less common technical terms.</p>
<p>Then readers won't have to actively search for definitions and are more likely to discover relevant information on their own.</p>
<blockquote>
<p><strong>Note</strong></p>
<p><code>man</code> and <code>--help</code> pages don't display links.
Use appropriate link texts such that readers of terminal output can infer search terms.</p>
</blockquote>
</li>
<li>
<p>Do not break existing URLs between releases.</p>
<p>There are countless links in the wild pointing to old versions of the manual.
We want people to find up-to-date documentation when following popular advice.</p>
<ul>
<li>
<p>When moving files, update <a href="https://github.com/NixOS/nixos-homepage/blob/master/netlify.toml">redirects on nixos.org</a>.</p>
<p>This is especially important when moving information out of the Nix manual to other resources.</p>
</li>
<li>
<p>When changing anchors, update <a href="https://github.com/NixOS/nix/blob/master/doc/manual/redirects.js">client-side redirects</a></p>
</li>
</ul>
<p>The current setup is cumbersome, and help making better automation is appreciated.</p>
</li>
</ul>
<p>The build checks for broken internal links with.
This happens late in the process, so <a href="development/documentation.html#building-the-manual">building the whole manual</a> is not suitable for iterating quickly.
<a href="https://github.com/Michael-F-Bryan/mdbook-linkcheck"><code>mdbook-linkcheck</code></a> does not implement checking <a href="https://en.wikipedia.org/wiki/URI_fragment">URI fragments</a> yet.</p>
<h3 id="markdown-conventions"><a class="header" href="#markdown-conventions">Markdown conventions</a></h3>
<p>The manual is written in markdown, and rendered with <a href="https://github.com/rust-lang/mdBook">mdBook</a> for the web and with <a href="https://github.com/kristapsdz/lowdown">lowdown</a> for <code>man</code> pages and <code>--help</code> output.</p>
<p>For supported markdown features, refer to:</p>
<ul>
<li><a href="https://rust-lang.github.io/mdBook/format/markdown.html">mdBook documentation</a></li>
<li><a href="https://kristaps.bsd.lv/lowdown/">lowdown documentation</a></li>
</ul>
<p>Please observe these guidelines to ease reviews:</p>
<ul>
<li>
<p>Write one sentence per line.</p>
<p>This makes long sentences immediately visible, and makes it easier to review changes and make direct suggestions.</p>
</li>
<li>
<p>Use reference links – sparingly – to ease source readability.
Put definitions close to their first use.</p>
<p>Example:</p>
<pre><code>A [store object] contains a [file system object] and [references] to other store objects.

[store object]: ../store/store-object.md
[file system object]: ../architecture/file-system-object.md
[references]: ../glossary.md#gloss-reference
</code></pre>
</li>
<li>
<p>Use admonitions of the following form:</p>
<pre><code>&gt; **Note**
&gt;
&gt; This is a note.
</code></pre>
<p>Highlight examples as such:</p>
<pre><code>&gt; **Example**
&gt;
&gt; ```console
&gt; $ nix --version
&gt; ```
</code></pre>
<p>Highlight syntax definitions as such, using <a href="https://en.wikipedia.org/wiki/Extended_Backus%E2%80%93Naur_form">EBNF</a> notation:</p>
<pre><code>&gt; **Syntax**
&gt;
&gt; *attribute-set* = `{` [ *attribute-name* `=` *expression* `;` ... ] `}`
</code></pre>
</li>
</ul>
<h3 id="the--variable"><a class="header" href="#the--variable">The <code>..</code> variable</a></h3>
<p><code>..</code> provides a base path for links that occur in reusable snippets or other documentation that doesn't have a base path of its own.</p>
<p>If a broken link occurs in a snippet that was inserted into multiple generated files in different directories, use <code>..</code> to reference the <code>doc/manual/source</code> directory.</p>
<p>If the <code>..</code> literal appears in an error message from the <a href="https://github.com/Michael-F-Bryan/mdbook-linkcheck"><code>mdbook-linkcheck</code></a> tool, the <code>..</code> replacement needs to be applied to the generated source file that mentions it.
See existing <code>..</code> logic in the <a href="https://github.com/NixOS/nix/blob/master/doc/manual/local.mk">Makefile for the manual</a>.
Regular markdown files used for the manual have a base path of their own and they can use relative paths instead of <code>..</code>.</p>
<h2 id="api-documentation"><a class="header" href="#api-documentation">API documentation</a></h2>
<p><a href="https://hydra.nixos.org/job/nix/master/internal-api-docs/latest/download-by-type/doc/internal-api-docs">Doxygen API documentation</a> is available online.
You can also build and view it yourself:</p>
<pre><code class="language-console">$ nix build .#hydraJobs.internal-api-docs
$ xdg-open ./result/share/doc/nix/internal-api/html/index.html
</code></pre>
<p>or inside <code>nix-shell</code> or <code>nix develop</code>:</p>
<pre><code class="language-console">$ configurePhase
$ ninja src/internal-api-docs/html
$ xdg-open src/internal-api-docs/html/index.html
</code></pre>
<h2 id="c-api-documentation"><a class="header" href="#c-api-documentation">C API documentation</a></h2>
<p>Note that the C API is not yet stable.
<a href="https://hydra.nixos.org/job/nix/master/external-api-docs/latest/download-by-type/doc/external-api-docs">C API documentation</a> is available online.
You can also build and view it yourself:</p>
<pre><code class="language-console">$ nix build .#hydraJobs.external-api-docs
$ xdg-open ./result/share/doc/nix/external-api/html/index.html
</code></pre>
<p>or inside <code>nix-shell</code> or <code>nix develop</code>:</p>
<pre><code>$ configurePhase
$ ninja src/external-api-docs/html
$ xdg-open src/external-api-docs/html/index.html
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cli-guideline"><a class="header" href="#cli-guideline">CLI guideline</a></h1>
<h2 id="goals"><a class="header" href="#goals">Goals</a></h2>
<p>Purpose of this document is to provide a clear direction to <strong>help design
delightful command line</strong> experience. This document contains guidelines to
follow to ensure a consistent and approachable user experience.</p>
<h2 id="overview-2"><a class="header" href="#overview-2">Overview</a></h2>
<p><code>nix</code> command provides a single entry to a number of sub-commands that help
<strong>developers and system administrators</strong> in the life-cycle of a software
project. We particularly need to pay special attention to help and assist new
users of Nix.</p>
<h1 id="naming-the-commands"><a class="header" href="#naming-the-commands">Naming the <code>COMMANDS</code></a></h1>
<p>Words matter. Naming is an important part of the usability. Users will be
interacting with Nix on a regular basis so we should <strong>name things for ease of
understanding</strong>.</p>
<p>We recommend following the <a href="https://en.wikipedia.org/wiki/Principle_of_least_astonishment">Principle of Least
Astonishment</a>.
This means that you should <strong>never use acronyms or abbreviations</strong> unless they
are commonly used in other tools (e.g. <code>nix init</code>). And if the command name is
too long (&gt; 10-12 characters) then shortening it makes sense (e.g.
“prioritization” → “priority”).</p>
<p>Commands should <strong>follow a noun-verb dialogue</strong>. Although noun-verb formatting
seems backwards from a speaking perspective (i.e. <code>nix store copy</code> vs. <code>nix copy store</code>) it allows us to organize commands the same way users think about
completing an action (the group first, then the command).</p>
<h2 id="naming-rules"><a class="header" href="#naming-rules">Naming rules</a></h2>
<p>Rules are there to guide you by limiting your options. But not everything can
fit the rules all the time. In those cases document the exceptions in <a href="development/cli-guideline.html#appendix-1-commands-naming-exceptions">Appendix
1: Commands naming exceptions</a> and
provide reason. The rules want to force a Nix developer to look, not just at
the command at hand, but also the command in a full context alongside other
<code>nix</code> commands.</p>
<pre><code class="language-shell">$ nix [&lt;GROUP&gt;] &lt;COMMAND&gt; [&lt;ARGUMENTS&gt;] [&lt;OPTIONS&gt;]
</code></pre>
<ul>
<li><code>GROUP</code>, <code>COMMAND</code>, <code>ARGUMENTS</code> and <code>OPTIONS</code> should be lowercase and in a
singular form.</li>
<li><code>GROUP</code> should be a  <strong>NOUN</strong>.</li>
<li><code>COMMAND</code> should be a <strong>VERB</strong>.</li>
<li><code>ARGUMENTS</code> and <code>OPTIONS</code> are discussed in <a href="development/cli-guideline.html#input"><em>Input</em> section</a>.</li>
</ul>
<h2 id="classification"><a class="header" href="#classification">Classification</a></h2>
<p>Some commands are more important, some less. While we want all of our commands
to be perfect we can only spend limited amount of time testing and improving
them.</p>
<p>This classification tries to separate commands in 3 categories in terms of
their importance in regards to the new users. Users who are likely to be
impacted the most by bad user experience.</p>
<ul>
<li>
<p><strong>Main commands</strong></p>
<p>Commands used for our main use cases and most likely used by new users. We
expect attention to details, such as:</p>
<ul>
<li>Proper use of <a href="development/cli-guideline.html#colors">colors</a>, <a href="development/cli-guideline.html#special-unicode-characters">emojis</a>
and <a href="development/cli-guideline.html#text-alignment">aligning of text</a>.</li>
<li><a href="development/cli-guideline.html#shell-completion">Autocomplete</a> of options.</li>
<li>Show <a href="development/cli-guideline.html#next-steps">next possible steps</a>.</li>
<li>Showing some <a href="development/cli-guideline.html#educate-the-user">“tips”</a> when running logs running tasks
(eg. building / downloading) in order to teach users interesting bits of
Nix ecosystem.</li>
<li><a href="development/cli-guideline.html#help-is-essential">Help pages</a> to be as good as we can write them
pointing to external documentation and tutorials for more.</li>
</ul>
<p>Examples of such commands: <code>nix init</code>, <code>nix develop</code>, <code>nix build</code>, <code>nix run</code>,
...</p>
</li>
<li>
<p><strong>Infrequently used commands</strong></p>
<p>From infrequently used commands we expect less attention to details, but
still some:</p>
<ul>
<li>Proper use of <a href="development/cli-guideline.html#colors">colors</a>, <a href="development/cli-guideline.html#special-unicode-characters">emojis</a>
and <a href="development/cli-guideline.html#text-alignment">aligning of text</a>.</li>
<li><a href="development/cli-guideline.html#shell-completion">Autocomplete</a> of options.</li>
</ul>
<p>Examples of such commands: <code>nix edit</code>, <code>nix eval</code>, ...</p>
</li>
<li>
<p><strong>Utility and scripting commands</strong></p>
<p>Commands that expose certain internal functionality of <code>nix</code>, mostly used by
other scripts.</p>
<ul>
<li><a href="development/cli-guideline.html#shell-completion">Autocomplete</a> of options.</li>
</ul>
<p>Examples of such commands: <code>nix store copy</code>, <code>nix hash base16</code>, <code>nix store ping</code>, ...</p>
</li>
</ul>
<h1 id="help-is-essential"><a class="header" href="#help-is-essential">Help is essential</a></h1>
<p>Help should be built into your command line so that new users can gradually
discover new features when they need them.</p>
<h2 id="looking-for-help"><a class="header" href="#looking-for-help">Looking for help</a></h2>
<p>Since there is no standard way how user will look for help we rely on ways help
is provided by commonly used tools. As a guide for this we took <code>git</code> and
whenever in doubt look at it as a preferred direction.</p>
<p>The rules are:</p>
<ul>
<li>Help is shown by using <code>--help</code> or <code>help</code> command (eg <code>nix</code> <code>--``help</code> or
<code>nix help</code>).</li>
<li>For non-COMMANDs (eg. <code>nix</code> <code>--``help</code> and <code>nix store</code> <code>--``help</code>) we <strong>show
a summary</strong> of most common use cases. Summary is presented on the STDOUT
without any use of PAGER.</li>
<li>For COMMANDs (eg. <code>nix init</code> <code>--``help</code> or <code>nix help init</code>) we display the
man page of that command. By default the PAGER is used (as in <code>git</code>).</li>
<li>At the end of either summary or man page there should be an URL pointing to
an online version of more detailed documentation.</li>
<li>The structure of summaries and man pages should be the same as in <code>git</code>.</li>
</ul>
<h2 id="anticipate-where-help-is-needed"><a class="header" href="#anticipate-where-help-is-needed">Anticipate where help is needed</a></h2>
<p>Even better then requiring the user to search for help is to anticipate and
predict when user might need it. Either because the lack of discoverability,
typo in the input or simply taking the opportunity to teach the user of
interesting - but less visible - details.</p>
<h3 id="shell-completion"><a class="header" href="#shell-completion">Shell completion</a></h3>
<p>This type of help is most common and almost expected by users. We need to
<strong>provide the best shell completion</strong> for <code>bash</code>, <code>zsh</code> and <code>fish</code>.</p>
<p>Completion needs to be <strong>context aware</strong>, this mean when a user types:</p>
<pre><code class="language-shell">$ nix build n&lt;TAB&gt;
</code></pre>
<p>we need to display a list of flakes starting with <code>n</code>.</p>
<h3 id="wrong-input"><a class="header" href="#wrong-input">Wrong input</a></h3>
<p>As we all know we humans make mistakes, all the time. When a typo - intentional
or unintentional - is made, we should prompt for closest possible options or
point to the documentation which would educate user to not make the same
errors. Here are few examples:</p>
<p>In first example we prompt the user for typing wrong command name:</p>
<pre><code class="language-shell">$ nix int
------------------------------------------------------------------------
  Error! Command `int` not found.
------------------------------------------------------------------------
  Did you mean:
    |&gt; nix init
    |&gt; nix input
</code></pre>
<p>Sometimes users will make mistake either because of a typo or simply because of
lack of discoverability. Our handling of this cases needs to be context
sensitive.</p>
<pre><code class="language-shell">$ nix init --template=template#pyton
------------------------------------------------------------------------
  Error! Template `template#pyton` not found.
------------------------------------------------------------------------
Initializing Nix project at `/path/to/here`.
      Select a template for you new project:
          |&gt; template#python
             template#python-pip
             template#python-poetry
</code></pre>
<h3 id="next-steps"><a class="header" href="#next-steps">Next steps</a></h3>
<p>It can be invaluable to newcomers to show what a possible next steps and what
is the usual development workflow with Nix. For example:</p>
<pre><code class="language-shell">$ nix init --template=template#python
Initializing project `template#python`
          in `/home/USER/dev/new-project`

  Next steps
    |&gt; nix develop   -- to enter development environment
    |&gt; nix build     -- to build your project
</code></pre>
<h3 id="educate-the-user"><a class="header" href="#educate-the-user">Educate the user</a></h3>
<p>We should take any opportunity to <strong>educate users</strong>, but at the same time we
must <strong>be very very careful to not annoy users</strong>. There is a thin line between
being helpful and being annoying.</p>
<p>An example of educating users might be to provide <em>Tips</em> in places where they
are waiting.</p>
<pre><code class="language-shell">$ nix build
    Started building my-project 1.2.3
 Downloaded python3.8-poetry 1.2.3 in 5.3 seconds
 Downloaded python3.8-requests 1.2.3 in 5.3 seconds
------------------------------------------------------------------------
      Press `v` to increase logs verbosity
         |&gt; `?` to see other options
------------------------------------------------------------------------
      Learn something new with every build...
         |&gt; See last logs of a build with `nix log --last` command.
------------------------------------------------------------------------
  Evaluated my-project 1.2.3 in 14.43 seconds
Downloading [12 / 200]
         |&gt; firefox 1.2.3 [#########&gt;       ] 10Mb/s | 2min left
   Building [2 / 20]
         |&gt; glibc 1.2.3 -&gt; buildPhase: &lt;last log line&gt;
------------------------------------------------------------------------
</code></pre>
<p>Now <strong>Learn</strong> part of the output is where you educate users. You should only
show it when you know that a build will take some time and not annoy users of
the builds that take only few seconds.</p>
<p>Every feature like this should go through an intensive review and testing to
collect as much feedback as possible and to fine tune every little detail. If
done right this can be an awesome features beginners and advance users will
love, but if not done perfectly it will annoy users and leave bad impression.</p>
<h1 id="input"><a class="header" href="#input">Input</a></h1>
<p>Input to a command is provided via <code>ARGUMENTS</code> and <code>OPTIONS</code>.</p>
<p><code>ARGUMENTS</code> represent a required input for a function. When choosing to use
<code>ARGUMENTS</code> over <code>OPTIONS</code> please be aware of the downsides that come with it:</p>
<ul>
<li>User will need to remember the order of <code>ARGUMENTS</code>. This is not a problem if
there is only one <code>ARGUMENT</code>.</li>
<li>With <code>OPTIONS</code> it is possible to provide much better auto completion.</li>
<li>With <code>OPTIONS</code> it is possible to provide much better error message.</li>
<li>Using <code>OPTIONS</code> it will mean there is a little bit more typing.</li>
</ul>
<p>We don’t discourage the use of <code>ARGUMENTS</code>, but simply want to make every
developer consider the downsides and choose wisely.</p>
<h2 id="naming-the-options"><a class="header" href="#naming-the-options">Naming the <code>OPTIONS</code></a></h2>
<p>The only naming convention - apart from the ones mentioned in Naming the
<code>COMMANDS</code> section is how flags are named.</p>
<p>Flags are a type of <code>OPTION</code> that represent an option that can be turned ON of
OFF. We can say <strong>flags are boolean type of</strong> <code>**OPTION**</code>.</p>
<p>Here are few examples of flag <code>OPTIONS</code>:</p>
<ul>
<li><code>--colors</code> vs. <code>--no-colors</code> (showing colors in the output)</li>
<li><code>--emojis</code> vs. <code>--no-emojis</code> (showing emojis in the output)</li>
</ul>
<h2 id="prompt-when-input-not-provided"><a class="header" href="#prompt-when-input-not-provided">Prompt when input not provided</a></h2>
<p>For <em>main commands</em> (as <a href="development/cli-guideline.html#classification">per classification</a>) we want command
to improve the discoverability of possible input. A new user will most likely
not know which <code>ARGUMENTS</code> and <code>OPTIONS</code> are required or which values are
possible for those options.</p>
<p>In case the user does not provide the input or they provide wrong input,
rather than show the error, prompt a user with an option to find and select
correct input (see examples).</p>
<p>Prompting is of course not required when TTY is not attached to STDIN. This
would mean that scripts won't need to handle prompt, but rather handle errors.</p>
<p>A place to use prompt and provide user with interactive select</p>
<pre><code class="language-shell">$ nix init
Initializing Nix project at `/path/to/here`.
      Select a template for you new project:
          |&gt; py
             template#python-pip
             template#python-poetry
             [ Showing 2 templates from 1345 templates ]
</code></pre>
<p>Another great place to add prompts are <strong>confirmation dialogues for dangerous
actions</strong>. For example when adding new substitutor via <code>OPTIONS</code> or via
<code>flake.nix</code> we should prompt - for the first time - and let user review what is
going to happen.</p>
<pre><code class="language-shell">$ nix build --option substitutors https://cache.example.org
------------------------------------------------------------------------
  Warning! A security related question needs to be answered.
------------------------------------------------------------------------
  The following substitutors will be used to in `my-project`:
    - https://cache.example.org

  Do you allow `my-project` to use above mentioned substitutors?
    [y/N] |&gt; y
</code></pre>
<h1 id="output"><a class="header" href="#output">Output</a></h1>
<p>Terminal output can be quite limiting in many ways. Which should force us to
think about the experience even more. As with every design the output is a
compromise between being terse and being verbose, between showing help to
beginners and annoying advance users. For this it is important that we know
what are the priorities.</p>
<p>Nix command line should be first and foremost written with beginners in mind.
But users won't stay beginners for long and what was once useful might quickly
become annoying. There is no golden rule that we can give in this guideline
that would make it easier how to draw a line and find best compromise.</p>
<p>What we would encourage is to <strong>build prototypes</strong>, do some <strong>user testing</strong>
and collect <strong>feedback</strong>. Then repeat the cycle few times.</p>
<p>First design the <em>happy path</em> and only after your iron it out, continue to work
on <strong>edge cases</strong> (handling and displaying errors, changes of the output by
certain <code>OPTIONS</code>, etc…)</p>
<h2 id="follow-best-practices"><a class="header" href="#follow-best-practices">Follow best practices</a></h2>
<p>Needless to say we Nix must be a good citizen and follow best practices in
command line.</p>
<p>In short: <strong>STDOUT is for output, STDERR is for (human) messaging.</strong></p>
<p>STDOUT and STDERR provide a way for you to output messages to the user while
also allowing them to redirect content to a file. For example:</p>
<pre><code class="language-shell">$ nix build &gt; build.txt
------------------------------------------------------------------------
  Error! Attribute `bin` missing at (1:94) from string.
------------------------------------------------------------------------

  1| with import &lt;nixpkgs&gt; { }; (pkgs.runCommandCC or pkgs.runCommand) "shell" { buildInputs = [ (surge.bin) ]; } ""
</code></pre>
<p>Because this warning is on STDERR, it doesn’t end up in the file.</p>
<p>But not everything on STDERR is an error though. For example, you can run <code>nix build</code> and collect logs in a file while still seeing the progress.</p>
<pre><code>$ nix build &gt; build.txt
  Evaluated 1234 files in 1.2 seconds
 Downloaded python3.8-poetry 1.2.3 in 5.3 seconds
 Downloaded python3.8-requests 1.2.3 in 5.3 seconds
------------------------------------------------------------------------
      Press `v` to increase logs verbosity
         |&gt; `?` to see other options
------------------------------------------------------------------------
      Learn something new with every build...
         |&gt; See last logs of a build with `nix log --last` command.
------------------------------------------------------------------------
  Evaluated my-project 1.2.3 in 14.43 seconds
Downloading [12 / 200]
         |&gt; firefox 1.2.3 [#########&gt;       ] 10Mb/s | 2min left
   Building [2 / 20]
         |&gt; glibc 1.2.3 -&gt; buildPhase: &lt;last log line&gt;
------------------------------------------------------------------------
</code></pre>
<h2 id="errors-wip"><a class="header" href="#errors-wip">Errors (WIP)</a></h2>
<p><strong>TODO</strong>: Once we have implementation for the <em>happy path</em> then we will think
how to present errors.</p>
<h2 id="not-only-for-humans"><a class="header" href="#not-only-for-humans">Not only for humans</a></h2>
<p>Terse, machine-readable output formats can also be useful but shouldn’t get in
the way of making beautiful CLI output. When needed, commands should offer a
<code>--json</code> flag to allow users to easily parse and script the CLI.</p>
<p>When TTY is not detected on STDOUT we should remove all design elements (no
colors, no emojis and using ASCII instead of Unicode symbols). The same should
happen when TTY is not detected on STDERR. We should not display progress /
status section, but only print warnings and errors.</p>
<h2 id="dialog-with-the-user"><a class="header" href="#dialog-with-the-user">Dialog with the user</a></h2>
<p>CLIs don't always make it clear when an action has taken place. For every
action a user performs, your CLI should provide an equal and appropriate
reaction, clearly highlighting the what just happened. For example:</p>
<pre><code class="language-shell">$ nix build
 Downloaded python3.8-poetry 1.2.3 in 5.3 seconds
 Downloaded python3.8-requests 1.2.3 in 5.3 seconds
...
   Success! You have successfully built my-project.
$
</code></pre>
<p>Above command clearly states that command successfully completed. And in case
of <code>nix build</code>, which is a command that might take some time to complete, it is
equally important to also show that a command started.</p>
<h2 id="text-alignment"><a class="header" href="#text-alignment">Text alignment</a></h2>
<p>Text alignment is the number one design element that will present all of the
Nix commands as a family and not as separate tools glued together.</p>
<p>The format we should follow is:</p>
<pre><code class="language-shell">$ nix COMMAND
   VERB_1 NOUN and other words
  VERB__1 NOUN and other words
       |&gt; Some details
</code></pre>
<p>Few rules that we can extract from above example:</p>
<ul>
<li>Each line should start at least with one space.</li>
<li>First word should be a VERB and must be aligned to the right.</li>
<li>Second word should be a NOUN and must be aligned to the left.</li>
<li>If you can not find a good VERB / NOUN pair, don’t worry make it as
understandable to the user as possible.</li>
<li>More details of each line can be provided by <code>|&gt;</code> character which is serving
as the first word when aligning the text</li>
</ul>
<p>Don’t forget you should also test your terminal output with colors and emojis
off (<code>--no-colors --no-emojis</code>).</p>
<h2 id="dim--bright"><a class="header" href="#dim--bright">Dim / Bright</a></h2>
<p>After comparing few terminals with different color schemes we would <strong>recommend
to avoid using dimmed text</strong>. The difference from the rest of the text is very
little in many terminal and color scheme combinations. Sometimes the difference
is not even notable, therefore relying on it wouldn’t make much sense.</p>
<p><strong>The bright text is much better supported</strong> across terminals and color
schemes. Most of the time the difference is perceived as if the bright text
would be bold.</p>
<h2 id="colors"><a class="header" href="#colors">Colors</a></h2>
<p>Humans are already conditioned by society to attach certain meaning to certain
colors. While the meaning is not universal, a simple collection of colors is
used to represent basic emotions.</p>
<p>Colors that can be used in output</p>
<ul>
<li>Red = error, danger, stop</li>
<li>Green = success, good</li>
<li>Yellow/Orange = proceed with caution, warning, in progress</li>
<li>Blue/Magenta = stability, calm</li>
</ul>
<p>While colors are nice, when command line is used by machines (in automation
scripts) you want to remove the colors. There should be a global <code>--no-colors</code>
option that would remove the colors.</p>
<h2 id="special-unicode-characters"><a class="header" href="#special-unicode-characters">Special (Unicode) characters</a></h2>
<p>Most of the terminal have good support for Unicode characters and you should
use them in your output by default. But always have a backup solution that is
implemented only with ASCII characters and will be used when <code>--ascii</code> option
is going to be passed in. Please make sure that you test your output also
without Unicode characters</p>
<p>More they showing all the different Unicode characters it is important to
<strong>establish common set of characters</strong> that we use for certain situations.</p>
<h2 id="emojis"><a class="header" href="#emojis">Emojis</a></h2>
<p>Emojis help channel emotions even better than text, colors and special
characters.</p>
<p>We recommend <strong>keeping the set of emojis to a minimum</strong>. This will enable each
emoji to stand out more.</p>
<p>As not everybody is happy about emojis we should provide an <code>--no-emojis</code>
option to disable them. Please make sure that you test your output also without
emojis.</p>
<h2 id="tables"><a class="header" href="#tables">Tables</a></h2>
<p>All commands that are listing certain data can be implemented in some sort of a
table. It’s important that each row of your output is a single ‘entry’ of data.
Never output table borders. It’s noisy and a huge pain for parsing using other
tools such as <code>grep</code>.</p>
<p>Be mindful of the screen width. Only show a few columns by default with the
table header, for more the table can be manipulated by the following options:</p>
<ul>
<li><code>--no-headers</code>: Show column headers by default but allow to hide them.</li>
<li><code>--columns</code>: Comma-separated list of column names to add.</li>
<li><code>--sort</code>: Allow sorting by column. Allow inverse and multi-column sort as well.</li>
</ul>
<h2 id="interactive-output"><a class="header" href="#interactive-output">Interactive output</a></h2>
<p>Interactive output was selected to be able to strike the balance between
beginners and advance users. While the default output will target beginners it
can, with a few key strokes, be changed into and advance introspection tool.</p>
<h3 id="progress"><a class="header" href="#progress">Progress</a></h3>
<p>For longer running commands we should provide and overview the progress.
This is shown best in <code>nix build</code> example:</p>
<pre><code class="language-shell">$ nix build
    Started building my-project 1.2.3
 Downloaded python3.8-poetry 1.2.3 in 5.3 seconds
 Downloaded python3.8-requests 1.2.3 in 5.3 seconds
------------------------------------------------------------------------
      Press `v` to increase logs verbosity
         |&gt; `?` to see other options
------------------------------------------------------------------------
      Learn something new with every build...
         |&gt; See last logs of a build with `nix log --last` command.
------------------------------------------------------------------------
  Evaluated my-project 1.2.3 in 14.43 seconds
Downloading [12 / 200]
         |&gt; firefox 1.2.3 [#########&gt;       ] 10Mb/s | 2min left
   Building [2 / 20]
         |&gt; glibc 1.2.3 -&gt; buildPhase: &lt;last log line&gt;
------------------------------------------------------------------------
</code></pre>
<h3 id="search"><a class="header" href="#search">Search</a></h3>
<p>Use a <code>fzf</code> like fuzzy search when there are multiple options to choose from.</p>
<pre><code class="language-shell">$ nix init
Initializing Nix project at `/path/to/here`.
      Select a template for you new project:
          |&gt; py
             template#python-pip
             template#python-poetry
             [ Showing 2 templates from 1345 templates ]
</code></pre>
<h3 id="prompt"><a class="header" href="#prompt">Prompt</a></h3>
<p>In some situations we need to prompt the user and inform the user about what is
going to happen.</p>
<pre><code class="language-shell">$ nix build --option substitutors https://cache.example.org
------------------------------------------------------------------------
  Warning! A security related question needs to be answered.
------------------------------------------------------------------------
  The following substitutors will be used to in `my-project`:
    - https://cache.example.org

  Do you allow `my-project` to use above mentioned substitutors?
    [y/N] |&gt; y
</code></pre>
<h2 id="verbosity"><a class="header" href="#verbosity">Verbosity</a></h2>
<p>There are many ways that you can control verbosity.</p>
<p>Verbosity levels are:</p>
<ul>
<li><code>ERROR</code> (level 0)</li>
<li><code>WARN</code> (level 1)</li>
<li><code>NOTICE</code> (level 2)</li>
<li><code>INFO</code> (level 3)</li>
<li><code>TALKATIVE</code> (level 4)</li>
<li><code>CHATTY</code> (level 5)</li>
<li><code>DEBUG</code> (level 6)</li>
<li><code>VOMIT</code> (level 7)</li>
</ul>
<p>The default level that the command starts is <code>ERROR</code>. The simplest way to
increase the verbosity by stacking <code>-v</code> option (eg: <code>-vvv == level 3 == INFO</code>).
There are also two shortcuts, <code>--debug</code> to run in <code>DEBUG</code> verbosity level and
<code>--quiet</code> to run in <code>ERROR</code> verbosity level.</p>
<hr />
<h1 id="appendix-1-commands-naming-exceptions"><a class="header" href="#appendix-1-commands-naming-exceptions">Appendix 1: Commands naming exceptions</a></h1>
<p><code>nix init</code> and <code>nix repl</code> are well established</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="json-guideline"><a class="header" href="#json-guideline">JSON guideline</a></h1>
<p>Nix consumes and produces JSON in a variety of contexts.
These guidelines ensure consistent practices for all our JSON interfaces, for ease of use, and so that experience in one part carries over to another.</p>
<h2 id="extensibility"><a class="header" href="#extensibility">Extensibility</a></h2>
<p>The schema of JSON input and output should allow for backwards compatible extension.
This section explains how to achieve this.</p>
<p>Two definitions are helpful here, because while JSON only defines one "key-value" object type, we use it to cover two use cases:</p>
<ul>
<li>
<p><strong>dictionary</strong>: a map from names to value that all have the same type.
In C++ this would be a <code>std::map</code> with string keys.</p>
</li>
<li>
<p><strong>record</strong>: a fixed set of attributes each with their own type.
In C++, this would be represented by a <code>struct</code>.</p>
</li>
</ul>
<p>It is best not to mix these use cases, as that may lead to incompatibilities when the schema changes.
For example, adding a record field to a dictionary breaks consumers that assume all JSON object fields to have the same meaning and type, and dictionary items with a colliding name can not be represented anymore.</p>
<p>This leads to the following guidelines:</p>
<ul>
<li>
<p>The top-level (root) value must be a record.</p>
<p>Otherwise, one can not change the structure of a command's output.</p>
</li>
<li>
<p>The value of a dictionary item must be a record.</p>
<p>Otherwise, the item type can not be extended.</p>
</li>
<li>
<p>List items should be records.</p>
<p>Otherwise, one can not change the structure of the list items.</p>
<p>If the order of the items does not matter, and each item has a unique key that is a string, consider representing the list as a dictionary instead.
If the order of the items needs to be preserved, return a list of records.</p>
</li>
<li>
<p>Streaming JSON should return records.</p>
<p>An example of a streaming JSON format is <a href="https://jsonlines.org/">JSON lines</a>, where each line represents a JSON value.
These JSON values can be considered top-level values or list items, and they must be records.</p>
</li>
</ul>
<h3 id="examples-96"><a class="header" href="#examples-96">Examples</a></h3>
<p>This is bad, because all keys must be assumed to be store types:</p>
<pre><code class="language-json">{
  "local": { ... },
  "remote": { ... },
  "http": { ... }
}
</code></pre>
<p>This is good, because the it is extensible at the root, and is somewhat self-documenting:</p>
<pre><code class="language-json">{
  "storeTypes": { "local": { ... }, ... },
  "pluginSupport": true
}
</code></pre>
<p>While the dictionary of store types seems like a very complete response at first, a use case may arise that warrants returning additional information.
For example, the presence of plugin support may be crucial information for a client to proceed when their desired store type is missing.</p>
<p>The following representation is bad because it is not extensible:</p>
<pre><code class="language-json">{ "outputs": [ "out" "bin" ] }
</code></pre>
<p>However, simply converting everything to records is not enough, because the order of outputs must be preserved:</p>
<pre><code class="language-json">{ "outputs": { "bin": {}, "out": {} } }
</code></pre>
<p>The first item is the default output. Deriving this information from the outputs ordering is not great, but this is how Nix currently happens to work.
While it is possible for a JSON parser to preserve the order of fields, we can not rely on this capability to be present in all JSON libraries.</p>
<p>This representation is extensible and preserves the ordering:</p>
<pre><code class="language-json">{ "outputs": [ { "outputName": "out" }, { "outputName": "bin" } ] }
</code></pre>
<h2 id="self-describing-values"><a class="header" href="#self-describing-values">Self-describing values</a></h2>
<p>As described in the previous section, it's crucial that schemas can be extended with new fields without breaking compatibility.
However, that should <em>not</em> mean we use the presence/absence of fields to indicate optional information <em>within</em> a version of the schema.
Instead, always include the field, and use <code>null</code> to indicate the "nothing" case.</p>
<h3 id="examples-97"><a class="header" href="#examples-97">Examples</a></h3>
<p>Here are two JSON objects:</p>
<pre><code class="language-json">{
  "foo": {}
}
</code></pre>
<pre><code class="language-json">{
  "foo": {},
  "bar": {}
}
</code></pre>
<p>Since they differ in which fields they contain, they should <em>not</em> both be valid values of the same schema.
At most, they can match two different schemas where the second (with <code>foo</code> and <code>bar</code>) is considered a newer version of the first (with just <code>foo</code>).
Within each version, all fields are mandatory (always <code>foo</code>, and always <code>foo</code> and <code>bar</code>).
Only <em>between</em> each version, <code>bar</code> gets added as a new mandatory field.</p>
<p>Here are another two JSON objects:</p>
<pre><code class="language-json">{ "foo": null }
</code></pre>
<pre><code class="language-json">{ "foo": { "bar": 1 } }
</code></pre>
<p>Since they both contain a <code>foo</code> field, they could be valid values of the same schema.
The schema would have <code>foo</code> has an optional field, which is either <code>null</code> or an object where <code>bar</code> is an integer.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="c-style-guide"><a class="header" href="#c-style-guide">C++ style guide</a></h1>
<p>Some miscellaneous notes on how we write C++.
Formatting we hope to eventually normalize automatically, so this section is free to just discuss higher-level concerns.</p>
<h2 id="the--implhh-pattern"><a class="header" href="#the--implhh-pattern">The <code>*-impl.hh</code> pattern</a></h2>
<p>Let's start with some background info first.
Headers, are supposed to contain declarations, not definitions.
This allows us to change a definition without changing the declaration, and have a very small rebuild during development.
Templates, however, need to be specialized to use-sites.
Absent fancier techniques, templates require that the definition, not just mere declaration, must be available at use-sites in order to make that specialization on the fly as part of compiling those use-sites.
Making definitions available like that means putting them in headers, but that is unfortunately means we get all the extra rebuilds we want to avoid by just putting declarations there as described above.</p>
<p>The <code>*-impl.hh</code> pattern is a ham-fisted partial solution to this problem.
It constitutes:</p>
<ul>
<li>
<p>Declaring items only in the main <code>foo.hh</code>, including templates.</p>
</li>
<li>
<p>Putting template definitions in a companion <code>foo-impl.hh</code> header.</p>
</li>
</ul>
<p>Most C++ developers would accompany this by having <code>foo.hh</code> include <code>foo-impl.hh</code>, to ensure any file getting the template declarations also got the template definitions.
But we've found not doing this has some benefits and fewer than imagined downsides.
The fact remains that headers are rarely as minimal as they could be;
there is often code that needs declarations from the headers but not the templates within them.
With our pattern where <code>foo.hh</code> doesn't include <code>foo-impl.hh</code>, that means they can just include <code>foo.hh</code>
Code that needs both just includes <code>foo.hh</code> and <code>foo-impl.hh</code>.
This does make linking error possible where something forgets to include <code>foo-impl.hh</code> that needs it, but those are build-time only as easy to fix.</p>
<div style="break-before: page; page-break-before: always;"></div><p>This section describes the notion of <em>experimental features</em>, and how it fits into the big picture of the development of Nix.</p>
<h1 id="what-are-experimental-features"><a class="header" href="#what-are-experimental-features">What are experimental features?</a></h1>
<p>Experimental features are considered unstable, which means that they can be changed or removed at any time.
Users must explicitly enable them by toggling the associated <a href="development/../command-ref/conf-file.html#conf-experimental-features">experimental feature flags</a>.
This allows accessing unstable functionality without unwittingly relying on it.</p>
<p>Experimental feature flags were first introduced in <a href="development/../release-notes/rl-2.4.html">Nix 2.4</a>.
Before that, Nix did have experimental features, but they were not guarded by flags and were merely documented as unstable.
This was a source of confusion and controversy.</p>
<h1 id="when-should-a-new-feature-be-marked-experimental"><a class="header" href="#when-should-a-new-feature-be-marked-experimental">When should a new feature be marked experimental?</a></h1>
<p>A change in the Nix codebase should be guarded by an experimental feature flag if it is considered likely to be reverted or adapted in a backwards-incompatible manner after gathering more experience with it in practice.</p>
<p>Examples:</p>
<ul>
<li>Changes to the Nix language, such as new built-ins, syntactic or semantic changes, etc.</li>
<li>Changes to the command-line interface</li>
</ul>
<h1 id="lifecycle-of-an-experimental-feature"><a class="header" href="#lifecycle-of-an-experimental-feature">Lifecycle of an experimental feature</a></h1>
<p>Experimental features have to be treated on a case-by-case basis.
However, the standard workflow for an experimental feature is as follows:</p>
<ul>
<li>A new feature is implemented in a <em>pull request</em>
<ul>
<li>It is guarded by an experimental feature flag that is disabled by default</li>
</ul>
</li>
<li>The pull request is merged, the <em>experimental</em> feature ends up in a release
<ul>
<li>Using the feature requires explicitly enabling it, signifying awareness of the potential risks</li>
<li>Being experimental, the feature can still be changed arbitrarily</li>
</ul>
</li>
<li>The feature can be <em>removed</em>
<ul>
<li>The associated experimental feature flag is also removed</li>
</ul>
</li>
<li>The feature can be declared <em>stable</em>
<ul>
<li>The associated experimental feature flag is removed</li>
<li>There should be enough evidence of users having tried the feature, such as feedback, fixed bugs, demonstrations of how it is put to use</li>
<li>Maintainers must feel confident that:
<ul>
<li>The feature is designed and implemented sensibly, that it is fit for purpose</li>
<li>Potential interactions are well-understood</li>
<li>Stabilising the feature will not incur an outsized maintenance burden in the future</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The following diagram illustrates the process:</p>
<pre><code>                  .------.
                  | idea |
                  '------'
                      |
       discussion, design, implementation
                      |
                      |     .-------.
                      |     |       |
                      v     v       |
               .--------------.  review
               | pull request |     |
               '--------------'     |
                   |     ^  |       |
                   |     |  '-------'
               .---'     '----.
               |              |
             merge       user feedback,
               |       (breaking) changes
               |              |
               '---.     .----'
                   |     |
                   v     |
               +--------------+
           .---| experimental |----.
           |   +--------------+    |
           |                       |
decision to stabilise      decision against
           |              keeping the feature
           |                       |
           v                       v
       +--------+             +---------+
       | stable |             | removed |
       +--------+             +---------+
</code></pre>
<h1 id="relation-to-the-rfc-process"><a class="header" href="#relation-to-the-rfc-process">Relation to the RFC process</a></h1>
<p>Experimental features and <a href="https://github.com/NixOS/rfcs/">RFCs</a> both allow approaching substantial changes while minimizing the risk.
However they serve different purposes:</p>
<ul>
<li>An experimental feature enables developers to iterate on and deliver a new idea without committing to it or requiring a costly long-running fork.
It is primarily an issue of <em>implementation</em>, targeting Nix developers and early testers.</li>
<li>The goal of an RFC is to make explicit all the implications of a change:
Explain why it is wanted, which new use-cases it enables, which interface changes it requires, etc.
It is primarily an issue of <em>design</em> and <em>communication</em>, targeting the broader community.</li>
</ul>
<p>This means that experimental features and RFCs are orthogonal mechanisms, and can be used independently or together as needed.</p>
<h1 id="currently-available-experimental-features"><a class="header" href="#currently-available-experimental-features">Currently available experimental features</a></h1>
<h2 id="auto-allocate-uids"><a class="header" href="#auto-allocate-uids"><a href="development/experimental-features.html#xp-feature-auto-allocate-uids" id="xp-feature-auto-allocate-uids"><code>auto-allocate-uids</code></a></a></h2>
<p>Allows Nix to automatically pick UIDs for builds, rather than creating
<code>nixbld*</code> user accounts. See the <a href="development/../command-ref/conf-file.html#conf-auto-allocate-uids"><code>auto-allocate-uids</code></a> setting for details.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/34">auto-allocate-uids tracking issue</a> for feature tracking.</p>
<h2 id="blake3-hashes"><a class="header" href="#blake3-hashes"><a href="development/experimental-features.html#xp-feature-blake3-hashes" id="xp-feature-blake3-hashes"><code>blake3-hashes</code></a></a></h2>
<p>Enables support for BLAKE3 hashes.</p>
<p>Refer to <a href="development/">blake3-hashes tracking issue</a> for feature tracking.</p>
<h2 id="ca-derivations"><a class="header" href="#ca-derivations"><a href="development/experimental-features.html#xp-feature-ca-derivations" id="xp-feature-ca-derivations"><code>ca-derivations</code></a></a></h2>
<p>Allow derivations to be content-addressed in order to prevent
rebuilds when changes to the derivation do not result in changes to
the derivation's output. See
<a href="development/../language/advanced-attributes.html#adv-attr-__contentAddressed">__contentAddressed</a>
for details.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/35">ca-derivations tracking issue</a> for feature tracking.</p>
<h2 id="cgroups"><a class="header" href="#cgroups"><a href="development/experimental-features.html#xp-feature-cgroups" id="xp-feature-cgroups"><code>cgroups</code></a></a></h2>
<p>Allows Nix to execute builds inside cgroups. See
the <a href="development/../command-ref/conf-file.html#conf-use-cgroups"><code>use-cgroups</code></a> setting for details.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/36">cgroups tracking issue</a> for feature tracking.</p>
<h2 id="configurable-impure-env"><a class="header" href="#configurable-impure-env"><a href="development/experimental-features.html#xp-feature-configurable-impure-env" id="xp-feature-configurable-impure-env"><code>configurable-impure-env</code></a></a></h2>
<p>Allow the use of the <a href="development/../command-ref/conf-file.html#conf-impure-env">impure-env</a> setting.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/37">configurable-impure-env tracking issue</a> for feature tracking.</p>
<h2 id="daemon-trust-override"><a class="header" href="#daemon-trust-override"><a href="development/experimental-features.html#xp-feature-daemon-trust-override" id="xp-feature-daemon-trust-override"><code>daemon-trust-override</code></a></a></h2>
<p>Allow forcing trusting or not trusting clients with
<code>nix-daemon</code>. This is useful for testing, but possibly also
useful for various experiments with <code>nix-daemon --stdio</code>
networking.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/38">daemon-trust-override tracking issue</a> for feature tracking.</p>
<h2 id="dynamic-derivations"><a class="header" href="#dynamic-derivations"><a href="development/experimental-features.html#xp-feature-dynamic-derivations" id="xp-feature-dynamic-derivations"><code>dynamic-derivations</code></a></a></h2>
<p>Allow the use of a few things related to dynamic derivations:</p>
<ul>
<li>
<p>"text hashing" derivation outputs, so we can build .drv
files.</p>
</li>
<li>
<p>dependencies in derivations on the outputs of
derivations that are themselves derivations outputs.</p>
</li>
</ul>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/39">dynamic-derivations tracking issue</a> for feature tracking.</p>
<h2 id="fetch-closure"><a class="header" href="#fetch-closure"><a href="development/experimental-features.html#xp-feature-fetch-closure" id="xp-feature-fetch-closure"><code>fetch-closure</code></a></a></h2>
<p>Enable the use of the <a href="development/../language/builtins.html#builtins-fetchClosure"><code>fetchClosure</code></a> built-in function in the Nix language.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/40">fetch-closure tracking issue</a> for feature tracking.</p>
<h2 id="fetch-tree"><a class="header" href="#fetch-tree"><a href="development/experimental-features.html#xp-feature-fetch-tree" id="xp-feature-fetch-tree"><code>fetch-tree</code></a></a></h2>
<p>Enable the use of the <a href="development/../language/builtins.html#builtins-fetchTree"><code>fetchTree</code></a> built-in function in the Nix language.</p>
<p><code>fetchTree</code> exposes a generic interface for fetching remote file system trees from different types of remote sources.
The <a href="development/experimental-features.html#xp-feature-flakes"><code>flakes</code></a> feature flag always enables <code>fetch-tree</code>.
This built-in was previously guarded by the <code>flakes</code> experimental feature because of that overlap.</p>
<p>Enabling just this feature serves as a "release candidate", allowing users to try it out in isolation.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/31">fetch-tree tracking issue</a> for feature tracking.</p>
<h2 id="flakes"><a class="header" href="#flakes"><a href="development/experimental-features.html#xp-feature-flakes" id="xp-feature-flakes"><code>flakes</code></a></a></h2>
<p>Enable flakes. See the manual entry for <a href="development/../command-ref/new-cli/nix3-flake.html"><code>nix flake</code></a> for details.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/27">flakes tracking issue</a> for feature tracking.</p>
<h2 id="git-hashing"><a class="header" href="#git-hashing"><a href="development/experimental-features.html#xp-feature-git-hashing" id="xp-feature-git-hashing"><code>git-hashing</code></a></a></h2>
<p>Allow creating (content-addressed) store objects which are hashed via Git's hashing algorithm.
These store objects will not be understandable by older versions of Nix.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/41">git-hashing tracking issue</a> for feature tracking.</p>
<h2 id="impure-derivations"><a class="header" href="#impure-derivations"><a href="development/experimental-features.html#xp-feature-impure-derivations" id="xp-feature-impure-derivations"><code>impure-derivations</code></a></a></h2>
<p>Allow derivations to produce non-fixed outputs by setting the
<code>__impure</code> derivation attribute to <code>true</code>. An impure derivation can
have differing outputs each time it is built.</p>
<p>Example:</p>
<pre><code>derivation {
  name = "impure";
  builder = /bin/sh;
  __impure = true; # mark this derivation as impure
  args = [ "-c" "read -n 10 random &lt; /dev/random; echo $random &gt; $out" ];
  system = builtins.currentSystem;
}
</code></pre>
<p>Each time this derivation is built, it can produce a different
output (as the builder outputs random bytes to <code>$out</code>).  Impure
derivations also have access to the network, and only fixed-output
or other impure derivations can rely on impure derivations. Finally,
an impure derivation cannot also be
<a href="development/experimental-features.html#xp-feature-ca-derivations">content-addressed</a>.</p>
<p>This is a more explicit alternative to using <a href="development/../language/builtins.html#builtins-currentTime"><code>builtins.currentTime</code></a>.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/42">impure-derivations tracking issue</a> for feature tracking.</p>
<h2 id="local-overlay-store"><a class="header" href="#local-overlay-store"><a href="development/experimental-features.html#xp-feature-local-overlay-store" id="xp-feature-local-overlay-store"><code>local-overlay-store</code></a></a></h2>
<p>Allow the use of <a href="development/../command-ref/new-cli/nix3-help-stores.html#local-overlay-store">local overlay store</a>.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/50">local-overlay-store tracking issue</a> for feature tracking.</p>
<h2 id="mounted-ssh-store"><a class="header" href="#mounted-ssh-store"><a href="development/experimental-features.html#xp-feature-mounted-ssh-store" id="xp-feature-mounted-ssh-store"><code>mounted-ssh-store</code></a></a></h2>
<p>Allow the use of the <a href="development/../command-ref/new-cli/nix3-help-stores.html#experimental-ssh-store-with-filesystem-mounted"><code>mounted SSH store</code></a>.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/43">mounted-ssh-store tracking issue</a> for feature tracking.</p>
<h2 id="nix-command"><a class="header" href="#nix-command"><a href="development/experimental-features.html#xp-feature-nix-command" id="xp-feature-nix-command"><code>nix-command</code></a></a></h2>
<p>Enable the new <code>nix</code> subcommands. See the manual on
<a href="development/../command-ref/new-cli/nix.html"><code>nix</code></a> for details.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/28">nix-command tracking issue</a> for feature tracking.</p>
<h2 id="no-url-literals"><a class="header" href="#no-url-literals"><a href="development/experimental-features.html#xp-feature-no-url-literals" id="xp-feature-no-url-literals"><code>no-url-literals</code></a></a></h2>
<p>Disallow unquoted URLs as part of the Nix language syntax. The Nix
language allows for URL literals, like so:</p>
<pre><code>$ nix repl
Welcome to Nix 2.15.0. Type :? for help.

nix-repl&gt; http://foo
"http://foo"
</code></pre>
<p>But enabling this experimental feature will cause the Nix parser to
throw an error when encountering a URL literal:</p>
<pre><code>$ nix repl --extra-experimental-features 'no-url-literals'
Welcome to Nix 2.15.0. Type :? for help.

nix-repl&gt; http://foo
error: URL literals are disabled

at «string»:1:1:

1| http://foo
 | ^

</code></pre>
<p>While this is currently an experimental feature, unquoted URLs are
being deprecated and their usage is discouraged.</p>
<p>The reason is that, as opposed to path literals, URLs have no
special properties that distinguish them from regular strings, URLs
containing parameters have to be quoted anyway, and unquoted URLs
may confuse external tooling.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/44">no-url-literals tracking issue</a> for feature tracking.</p>
<h2 id="parse-toml-timestamps"><a class="header" href="#parse-toml-timestamps"><a href="development/experimental-features.html#xp-feature-parse-toml-timestamps" id="xp-feature-parse-toml-timestamps"><code>parse-toml-timestamps</code></a></a></h2>
<p>Allow parsing of timestamps in builtins.fromTOML.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/45">parse-toml-timestamps tracking issue</a> for feature tracking.</p>
<h2 id="pipe-operators-1"><a class="header" href="#pipe-operators-1"><a href="development/experimental-features.html#xp-feature-pipe-operators" id="xp-feature-pipe-operators"><code>pipe-operators</code></a></a></h2>
<p>Add <code>|&gt;</code> and <code>&lt;|</code> operators to the Nix language.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/55">pipe-operators tracking issue</a> for feature tracking.</p>
<h2 id="read-only-local-store"><a class="header" href="#read-only-local-store"><a href="development/experimental-features.html#xp-feature-read-only-local-store" id="xp-feature-read-only-local-store"><code>read-only-local-store</code></a></a></h2>
<p>Allow the use of the <code>read-only</code> parameter in <a href="development/../store/types/local-store.html">local store</a> URIs.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/46">read-only-local-store tracking issue</a> for feature tracking.</p>
<h2 id="recursive-nix"><a class="header" href="#recursive-nix"><a href="development/experimental-features.html#xp-feature-recursive-nix" id="xp-feature-recursive-nix"><code>recursive-nix</code></a></a></h2>
<p>Allow derivation builders to call Nix, and thus build derivations
recursively.</p>
<p>Example:</p>
<pre><code>with import &lt;nixpkgs&gt; {};

runCommand "foo"
  {
     # Optional: let Nix know "foo" requires the experimental feature
     requiredSystemFeatures = [ "recursive-nix" ];
     buildInputs = [ nix jq ];
     NIX_PATH = "nixpkgs=${&lt;nixpkgs&gt;}";
  }
  ''
    hello=$(nix-build -E '(import &lt;nixpkgs&gt; {}).hello.overrideDerivation (args: { name = "recursive-hello"; })')

    mkdir -p $out/bin
    ln -s $hello/bin/hello $out/bin/hello
  ''
</code></pre>
<p>An important restriction on recursive builders is disallowing
arbitrary substitutions. For example, running</p>
<pre><code>nix-store -r /nix/store/kmwd1hq55akdb9sc7l3finr175dajlby-hello-2.10
</code></pre>
<p>in the above <code>runCommand</code> script would be disallowed, as this could
lead to derivations with hidden dependencies or breaking
reproducibility by relying on the current state of the Nix store. An
exception would be if
<code>/nix/store/kmwd1hq55akdb9sc7l3finr175dajlby-hello-2.10</code> were
already in the build inputs or built by a previous recursive Nix
call.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/47">recursive-nix tracking issue</a> for feature tracking.</p>
<h2 id="verified-fetches"><a class="header" href="#verified-fetches"><a href="development/experimental-features.html#xp-feature-verified-fetches" id="xp-feature-verified-fetches"><code>verified-fetches</code></a></a></h2>
<p>Enables verification of git commit signatures through the <a href="development/../language/builtins.html#builtins-fetchGit"><code>fetchGit</code></a> built-in.</p>
<p>Refer to <a href="https://github.com/NixOS/nix/milestone/48">verified-fetches tracking issue</a> for feature tracking.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contributing"><a class="header" href="#contributing">Contributing</a></h1>
<h2 id="add-a-release-note"><a class="header" href="#add-a-release-note">Add a release note</a></h2>
<p><code>doc/manual/rl-next</code> contains release notes entries for all unreleased changes.</p>
<p>User-visible changes should come with a release note.</p>
<h3 id="add-an-entry"><a class="header" href="#add-an-entry">Add an entry</a></h3>
<p>Here's what a complete entry looks like. The file name is not incorporated in the document.</p>
<pre><code>---
synopsis: Basically a title
issues: 1234
prs: 1238
---

Here's one or more paragraphs that describe the change.

- It's markdown
- Add references to the manual using ..
</code></pre>
<p>Significant changes should add the following header, which moves them to the top.</p>
<pre><code>significance: significant
</code></pre>
<!-- Keep an eye on https://codeberg.org/fgaz/changelog-d/issues/1 -->
<p>See also the <a href="https://github.com/haskell/cabal/blob/master/CONTRIBUTING.md#changelog">format documentation</a>.</p>
<h3 id="build-process"><a class="header" href="#build-process">Build process</a></h3>
<p>Releases have a precomputed <code>rl-MAJOR.MINOR.md</code>, and no <code>rl-next.md</code>.</p>
<h2 id="branches"><a class="header" href="#branches">Branches</a></h2>
<ul>
<li>
<p><a href="https://github.com/NixOS/nix/commits/master"><code>master</code></a></p>
<p>The main development branch. All changes are approved and merged here.
When developing a change, create a branch based on the latest <code>master</code>.</p>
<p>Maintainers try to <a href="development/contributing.html#reverting">keep it in a release-worthy state</a>.</p>
</li>
<li>
<p><a href="https://github.com/NixOS/nix/branches/all?query=maintenance"><code>maintenance-*.*</code></a></p>
<p>These branches are the subject of backports only, and are
also <a href="development/contributing.html#reverting">kept</a> in a release-worthy state.</p>
<p>See <a href="https://github.com/NixOS/nix/blob/master/maintainers/backporting.md"><code>maintainers/backporting.md</code></a></p>
</li>
<li>
<p><a href="https://github.com/NixOS/nix/tree/latest-release"><code>latest-release</code></a></p>
<p>The latest patch release of the latest minor version.</p>
<p>See <a href="https://github.com/NixOS/nix/blob/master/maintainers/release-process.md"><code>maintainers/release-process.md</code></a></p>
</li>
<li>
<p><a href="https://github.com/NixOS/nix/branches/all?query=backport"><code>backport-*-to-*</code></a></p>
<p>Generally branches created by the backport action.</p>
<p>See <a href="https://github.com/NixOS/nix/blob/master/maintainers/backporting.md"><code>maintainers/backporting.md</code></a></p>
</li>
<li>
<p><a href="https://github.com/NixOS/nix/branches/all"><em>other</em></a></p>
<p>Branches that do not conform to the above patterns should be feature branches.</p>
</li>
</ul>
<h2 id="reverting"><a class="header" href="#reverting">Reverting</a></h2>
<p>If a change turns out to be merged by mistake, or contain a regression, it may be reverted.
A revert is not a rejection of the contribution, but merely part of an effective development process.
It makes sure that development keeps running smoothly, with minimal uncertainty, and less overhead.
If maintainers have to worry too much about avoiding reverts, they would not be able to merge as much.
By embracing reverts as a good part of the development process, everyone wins.</p>
<p>However, taking a step back may be frustrating, so maintainers will be extra supportive on the next try.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nix-release-notes"><a class="header" href="#nix-release-notes">Nix Release Notes</a></h1>
<p>The Nix release cycle is calendar-based as follows:</p>
<p>Nix has a release cycle of roughly 6 weeks.
Notable changes and additions are announced in the release notes for each version.</p>
<p>The supported Nix versions are:</p>
<ul>
<li>The latest release</li>
<li>The version used in the stable NixOS release, which is announced in the <a href="https://nixos.org/manual/nixos/stable/release-notes.html#ch-release-notes">NixOS release notes</a>.</li>
</ul>
<p>Bugfixes and security issues are backported to every supported version.
Patch releases are published as needed.</p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="release-2280-2025-04-02"><a class="header" href="#release-2280-2025-04-02">Release 2.28.0 (2025-04-02)</a></h1>
<p>This is an atypical release, and for almost all intents and purposes, it is just a continuation of 2.27; not a feature release.</p>
<p>We had originally set the goal of making 2.27 the Nixpkgs default for NixOS 25.05, but dependents that link to Nix need certain <em>interface breaking</em> changes in the C++ headers. This is not something we should do in a patch release, so this is why we branched 2.28 right off 2.27 instead of <code>master</code>.</p>
<p>This completes the infrastructure overhaul for the <a href="https://github.com/NixOS/rfcs/blob/master/rfcs/0132-meson-builds-nix.md">RFC 132</a> switchover to meson as our build system.</p>
<h2 id="major-changes"><a class="header" href="#major-changes">Major changes</a></h2>
<ul>
<li>
<p>Unstable C++ API reworked
<a href="https://github.com/NixOS/nix/pull/12836">#12836</a>
<a href="https://github.com/NixOS/nix/pull/12798">#12798</a>
<a href="https://github.com/NixOS/nix/pull/12773">#12773</a></p>
<p>Now the C++ interface confirms to common conventions much better than before:</p>
<ul>
<li>
<p>All headers are expected to be included with the initial <code>nix/</code>, e.g. as <code>#include "nix/....hh"</code> (what Nix's headers now do) or <code>#include &lt;nix/....hh&gt;</code> (what downstream projects may choose to do).
Likewise, the pkg-config files have <code>-I${includedir}</code> not <code>-I${includedir}/nix</code> or similar.</p>
<p>Including without the <code>nix/</code> like before sometimes worked because of how for <code>#include</code> C pre-process checks the directory containing the current file, not just the lookup path, but this was not reliable.</p>
</li>
<li>
<p>All configuration headers are included explicitly by the (regular) headers that need them.
There is no more need to pass <code>-include</code> to force additional files to be included.</p>
</li>
<li>
<p>The public, installed configuration headers no longer contain implementation-specific details that are not relevant to the API.
The vast majority of definitions that were previously in there are now moved to new headers that are not installed, but used during Nix's own compilation only.
The remaining macro definitions are renamed to have <code>NIX_</code> as a prefix.</p>
</li>
<li>
<p>The name of the Nix component the header comes from
(e.g. <code>util</code>, <code>store</code>, <code>expr</code>, <code>flake</code>, etc.)
is now part of the path to the header, coming after <code>nix</code> and before the header name
(or rest of the header path, if it is already in a directory).</p>
</li>
</ul>
<p>Here is a contrived diff showing a few of these changes at once:</p>
<pre><code class="language-diff">@@ @@
-#include "derived-path.hh"
+#include "nix/store/derived-path.hh"
@@ @@
+// Would include for the variables used before. But when other headers
+// need these variables. those will include these config themselves.
+#include "nix/store/config.hh"
+#include "nix/expr/config.hh"
@@ @@
-#include "config.hh"
+// Additionally renamed to distinguish from components' config headers.
+#include "nix/util/configuration.hh"
@@ @@
-#if HAVE_ACL_SUPPORT
+#if NIX_SUPPORT_ACL
@@ @@
-#if HAVE_BOEHMGC
+#if NIX_USE_BOEHMGC
@@ @@
 #endif
 #endif
@@ @@
-const char *s = "hi from " SYSTEM;
+const char *s = "hi from " NIX_LOCAL_SYSTEM;
</code></pre>
</li>
<li>
<p>C API <code>nix_flake_init_global</code> removed <a href="https://github.com/NixOS/nix/issues/5638">#5638</a> <a href="https://github.com/NixOS/nix/pull/12759">#12759</a></p>
<p>In order to improve the modularity of the code base, we are removing a use of global state, and therefore the <code>nix_flake_init_global</code> function.</p>
<p>Instead, use <code>nix_flake_settings_add_to_eval_state_builder</code>.
For example:</p>
<pre><code class="language-diff">-    nix_flake_init_global(ctx, settings);
-    HANDLE_ERROR(ctx);
-
     nix_eval_state_builder * builder = nix_eval_state_builder_new(ctx, store);
     HANDLE_ERROR(ctx);

+    nix_flake_settings_add_to_eval_state_builder(ctx, settings, builder);
+    HANDLE_ERROR(ctx);
</code></pre>
<p>Although this change is not as critical, we figured it would be good to do this API change at the same time, also.
Also note that we try to keep the C API compatible, but we decided to break this function because it was young and likely not in widespread use yet. This frees up time to make important progress on the rest of the C API.</p>
</li>
</ul>
<h1 id="contributors"><a class="header" href="#contributors">Contributors</a></h1>
<p>This earlier-than-usual release was made possible by the following 16 contributors:</p>
<ul>
<li>Farid Zakaria <a href="https://github.com/fzakaria"><strong>(@fzakaria)</strong></a></li>
<li>Jörg Thalheim <a href="https://github.com/Mic92"><strong>(@Mic92)</strong></a></li>
<li>Eelco Dolstra <a href="https://github.com/edolstra"><strong>(@edolstra)</strong></a></li>
<li>Graham Christensen <a href="https://github.com/grahamc"><strong>(@grahamc)</strong></a></li>
<li>Thomas Miedema <a href="https://github.com/thomie"><strong>(@thomie)</strong></a></li>
<li>Brian McKenna <a href="https://github.com/puffnfresh"><strong>(@puffnfresh)</strong></a></li>
<li>Sergei Trofimovich <a href="https://github.com/trofi"><strong>(@trofi)</strong></a></li>
<li>Dmitry Bogatov <a href="https://github.com/KAction"><strong>(@KAction)</strong></a></li>
<li>Erik Nygren <a href="https://github.com/Kirens"><strong>(@Kirens)</strong></a></li>
<li>John Ericson <a href="https://github.com/Ericson2314"><strong>(@Ericson2314)</strong></a></li>
<li>Sergei Zimmerman <a href="https://github.com/xokdvium"><strong>(@xokdvium)</strong></a></li>
<li>Ruby Rose <a href="https://github.com/oldshensheep"><strong>(@oldshensheep)</strong></a></li>
<li>Robert Hensing <a href="https://github.com/roberth"><strong>(@roberth)</strong></a></li>
<li>jade <a href="https://github.com/lf-"><strong>(@lf-)</strong></a></li>
<li>Félix <a href="https://github.com/picnoir"><strong>(@picnoir)</strong></a></li>
<li>Valentin Gagarin <a href="https://github.com/fricklerhandwerk"><strong>(@fricklerhandwerk)</strong></a></li>
<li>Dmitry Bogatov</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-2270-2025-03-03"><a class="header" href="#release-2270-2025-03-03">Release 2.27.0 (2025-03-03)</a></h1>
<ul>
<li>
<p><code>inputs.self.submodules</code> flake attribute <a href="https://github.com/NixOS/nix/pull/12421">#12421</a></p>
<p>Flakes in Git repositories can now declare that they need Git submodules to be enabled:</p>
<pre><code>{
  inputs.self.submodules = true;
}
</code></pre>
<p>Thus, it's no longer needed for the caller of the flake to pass <code>submodules = true</code>.</p>
</li>
<li>
<p>Git LFS support <a href="https://github.com/NixOS/nix/pull/10153">#10153</a> <a href="https://github.com/NixOS/nix/pull/12468">#12468</a></p>
<p>The Git fetcher now supports Large File Storage (LFS). This can be enabled by passing the attribute <code>lfs = true</code> to the fetcher, e.g.</p>
<pre><code class="language-console">nix flake prefetch 'git+ssh://git@github.com/Apress/repo-with-large-file-storage.git?lfs=1'
</code></pre>
<p>A flake can also declare that it requires LFS to be enabled:</p>
<pre><code>{
  inputs.self.lfs = true;
}
</code></pre>
<p>Author: <a href="https://github.com/b-camacho"><strong>@b-camacho</strong></a>, <a href="https://github.com/kip93"><strong>@kip93</strong></a></p>
</li>
<li>
<p>Handle the case where a chroot store is used and some inputs are in the "host" <code>/nix/store</code> <a href="https://github.com/NixOS/nix/pull/12512">#12512</a></p>
<p>The evaluator now presents a "union" filesystem view of the <code>/nix/store</code> in the host and the chroot.</p>
<p>This change also removes some hacks that broke <code>builtins.{path,filterSource}</code> in chroot stores <a href="https://github.com/NixOS/nix/issues/11503">#11503</a>.</p>
</li>
<li>
<p><code>nix flake prefetch</code> now has a <code>--out-link</code> option <a href="https://github.com/NixOS/nix/pull/12443">#12443</a></p>
</li>
<li>
<p>Set <code>FD_CLOEXEC</code> on sockets created by curl <a href="https://github.com/NixOS/nix/pull/12439">#12439</a></p>
<p>Curl created sockets without setting <code>FD_CLOEXEC</code>/<code>SOCK_CLOEXEC</code>. This could previously cause connections to remain open forever when using commands like <code>nix shell</code>. This change sets the <code>FD_CLOEXEC</code> flag using a <code>CURLOPT_SOCKOPTFUNCTION</code> callback.</p>
</li>
<li>
<p>Add BLAKE3 hash algorithm <a href="https://github.com/NixOS/nix/pull/12379">#12379</a></p>
<p>Nix now supports the BLAKE3 hash algorithm as an experimental feature (<code>blake3-hashes</code>):</p>
<pre><code class="language-console"># nix hash file ./file --type blake3 --extra-experimental-features blake3-hashes
blake3-34P4p+iZXcbbyB1i4uoF7eWCGcZHjmaRn6Y7QdynLwU=
</code></pre>
</li>
</ul>
<h1 id="contributors-1"><a class="header" href="#contributors-1">Contributors</a></h1>
<p>This release was made possible by the following 21 contributors:</p>
<ul>
<li>Aiden Fox Ivey <a href="https://github.com/aidenfoxivey"><strong>(@aidenfoxivey)</strong></a></li>
<li>Ben Millwood <a href="https://github.com/bmillwood"><strong>(@bmillwood)</strong></a></li>
<li>Brian Camacho <a href="https://github.com/b-camacho"><strong>(@b-camacho)</strong></a></li>
<li>Brian McKenna <a href="https://github.com/puffnfresh"><strong>(@puffnfresh)</strong></a></li>
<li>Eelco Dolstra <a href="https://github.com/edolstra"><strong>(@edolstra)</strong></a></li>
<li>Fabian Möller <a href="https://github.com/B4dM4n"><strong>(@B4dM4n)</strong></a></li>
<li>Illia Bobyr <a href="https://github.com/ilya-bobyr"><strong>(@ilya-bobyr)</strong></a></li>
<li>Ivan Trubach <a href="https://github.com/tie"><strong>(@tie)</strong></a></li>
<li>John Ericson <a href="https://github.com/Ericson2314"><strong>(@Ericson2314)</strong></a></li>
<li>Jörg Thalheim <a href="https://github.com/Mic92"><strong>(@Mic92)</strong></a></li>
<li>Leandro Emmanuel Reina Kiperman <a href="https://github.com/kip93"><strong>(@kip93)</strong></a></li>
<li>MaxHearnden <a href="https://github.com/MaxHearnden"><strong>(@MaxHearnden)</strong></a></li>
<li>Philipp Otterbein</li>
<li>Robert Hensing <a href="https://github.com/roberth"><strong>(@roberth)</strong></a></li>
<li>Sandro <a href="https://github.com/SuperSandro2000"><strong>(@SuperSandro2000)</strong></a></li>
<li>Sergei Zimmerman <a href="https://github.com/xokdvium"><strong>(@xokdvium)</strong></a></li>
<li>Silvan Mosberger <a href="https://github.com/infinisil"><strong>(@infinisil)</strong></a></li>
<li>Someone <a href="https://github.com/SomeoneSerge"><strong>(@SomeoneSerge)</strong></a></li>
<li>Steve Walker <a href="https://github.com/stevalkr"><strong>(@stevalkr)</strong></a></li>
<li>bcamacho2 <a href="https://github.com/bcamacho2"><strong>(@bcamacho2)</strong></a></li>
<li>silvanshade <a href="https://github.com/silvanshade"><strong>(@silvanshade)</strong></a></li>
<li>tomberek <a href="https://github.com/tomberek"><strong>(@tomberek)</strong></a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-2260-2025-01-22"><a class="header" href="#release-2260-2025-01-22">Release 2.26.0 (2025-01-22)</a></h1>
<ul>
<li>
<p>Support for relative path inputs <a href="https://github.com/NixOS/nix/pull/10089">#10089</a></p>
<p>Flakes can now refer to other flakes in the same repository using relative paths, e.g.</p>
<pre><code class="language-nix">inputs.foo.url = "path:./foo";
</code></pre>
<p>uses the flake in the <code>foo</code> subdirectory of the referring flake. For more information, see the documentation on <a href="release-notes/../command-ref/new-cli/nix3-flake.html#path-fetcher">the <code>path</code> flake input type</a>.</p>
<p>This feature required a change to the lock file format. Previous Nix versions will not be able to use lock files that have locks for relative path inputs in them.</p>
</li>
<li>
<p>Flake lock file generation now ignores local registries <a href="https://github.com/NixOS/nix/pull/12019">#12019</a></p>
<p>When resolving indirect flake references like <code>nixpkgs</code> in <code>flake.nix</code> files, Nix will no longer use the system and user flake registries. It will only use the global flake registry and overrides given on the command line via <code>--override-flake</code>.</p>
<p>This avoids accidents where users have local registry overrides that map <code>nixpkgs</code> to a <code>path:</code> flake in the local file system, which then end up in committed lock files pushed to other users.</p>
<p>In the future, we may remove the use of the registry during lock file generation altogether. It's better to explicitly specify the URL of a flake input. For example, instead of</p>
<pre><code class="language-nix">{
  outputs = { self, nixpkgs }: { ... };
}
</code></pre>
<p>write</p>
<pre><code class="language-nix">{
  inputs.nixpkgs.url = "github:NixOS/nixpkgs/nixos-24.11";
  outputs = { self, nixpkgs }: { ... };
}
</code></pre>
</li>
<li>
<p><code>nix copy</code> supports <code>--profile</code> and <code>--out-link</code> <a href="https://github.com/NixOS/nix/pull/11657">#11657</a></p>
<p>The <code>nix copy</code> command now has flags <code>--profile</code> and <code>--out-link</code>, similar to <code>nix build</code>. <code>--profile</code> makes a profile point to the
top-level store path, while <code>--out-link</code> create symlinks to the top-level store paths.</p>
<p>For example, when updating the local NixOS system profile from a NixOS system closure on a remote machine, instead of</p>
<pre><code># nix copy --from ssh://server $path
# nix build --profile /nix/var/nix/profiles/system $path
</code></pre>
<p>you can now do</p>
<pre><code># nix copy --from ssh://server --profile /nix/var/nix/profiles/system $path
</code></pre>
<p>The advantage is that this avoids a time window where <em>path</em> is not a garbage collector root, and so could be deleted by a concurrent <code>nix store gc</code> process.</p>
</li>
<li>
<p><code>nix-instantiate --eval</code> now supports <code>--raw</code> <a href="https://github.com/NixOS/nix/pull/12119">#12119</a></p>
<p>The <code>nix-instantiate --eval</code> command now supports a <code>--raw</code> flag, when used
the evaluation result must be a string, which is printed verbatim without
quotation marks or escaping.</p>
</li>
<li>
<p>Improved <code>NIX_SSHOPTS</code> parsing for better SSH option handling <a href="https://github.com/NixOS/nix/issues/5181">#5181</a> <a href="https://github.com/NixOS/nix/pull/12020">#12020</a></p>
<p>The parsing of the <code>NIX_SSHOPTS</code> environment variable has been improved to handle spaces and quotes correctly.
Previously, incorrectly split SSH options could cause failures in commands like <code>nix-copy-closure</code>,
especially when using complex SSH invocations such as <code>-o ProxyCommand="ssh -W %h:%p ..."</code>.</p>
<p>This change introduces a <code>shellSplitString</code> function to ensure
that <code>NIX_SSHOPTS</code> is parsed in a manner consistent with shell
behavior, addressing common parsing errors.</p>
<p>For example, the following now works as expected:</p>
<pre><code class="language-bash">export NIX_SSHOPTS='-o ProxyCommand="ssh -W %h:%p ..."'
</code></pre>
<p>This update improves the reliability of SSH-related operations using <code>NIX_SSHOPTS</code> across Nix CLIs.</p>
</li>
<li>
<p>Nix is now built using Meson</p>
<p>As proposed in <a href="https://github.com/NixOS/rfcs/pull/132">RFC 132</a>, Nix's build system now uses Meson/Ninja. The old Make-based build system has been removed.</p>
</li>
<li>
<p>Evaluation caching now works for dirty Git workdirs <a href="https://github.com/NixOS/nix/pull/11992">#11992</a></p>
</li>
</ul>
<h1 id="contributors-2"><a class="header" href="#contributors-2">Contributors</a></h1>
<p>This release was made possible by the following 45 contributors:</p>
<ul>
<li>Anatoli Babenia <a href="https://github.com/abitrolly"><strong>(@abitrolly)</strong></a></li>
<li>Domagoj Mišković <a href="https://github.com/allrealmsoflife"><strong>(@allrealmsoflife)</strong></a></li>
<li>Yaroslav Bolyukin <a href="https://github.com/CertainLach"><strong>(@CertainLach)</strong></a></li>
<li>bryango <a href="https://github.com/bryango"><strong>(@bryango)</strong></a></li>
<li>tomberek <a href="https://github.com/tomberek"><strong>(@tomberek)</strong></a></li>
<li>Matej Urbas <a href="https://github.com/mupdt"><strong>(@mupdt)</strong></a></li>
<li>elikoga <a href="https://github.com/elikoga"><strong>(@elikoga)</strong></a></li>
<li>wh0 <a href="https://github.com/wh0"><strong>(@wh0)</strong></a></li>
<li>Félix <a href="https://github.com/picnoir"><strong>(@picnoir)</strong></a></li>
<li>Valentin Gagarin <a href="https://github.com/fricklerhandwerk"><strong>(@fricklerhandwerk)</strong></a></li>
<li>Gavin John <a href="https://github.com/Pandapip1"><strong>(@Pandapip1)</strong></a></li>
<li>Travis A. Everett <a href="https://github.com/abathur"><strong>(@abathur)</strong></a></li>
<li>Vladimir Panteleev <a href="https://github.com/CyberShadow"><strong>(@CyberShadow)</strong></a></li>
<li>Ilja <a href="https://github.com/suruaku"><strong>(@suruaku)</strong></a></li>
<li>Jason Yundt <a href="https://github.com/Jayman2000"><strong>(@Jayman2000)</strong></a></li>
<li>Mike Kusold <a href="https://github.com/kusold"><strong>(@kusold)</strong></a></li>
<li>Andy Hamon <a href="https://github.com/andrewhamon"><strong>(@andrewhamon)</strong></a></li>
<li>Brian McKenna <a href="https://github.com/puffnfresh"><strong>(@puffnfresh)</strong></a></li>
<li>Greg Curtis <a href="https://github.com/gcurtis"><strong>(@gcurtis)</strong></a></li>
<li>Andrew Poelstra <a href="https://github.com/apoelstra"><strong>(@apoelstra)</strong></a></li>
<li>Linus Heckemann <a href="https://github.com/lheckemann"><strong>(@lheckemann)</strong></a></li>
<li>Tristan Ross <a href="https://github.com/RossComputerGuy"><strong>(@RossComputerGuy)</strong></a></li>
<li>Dominique Martinet <a href="https://github.com/martinetd"><strong>(@martinetd)</strong></a></li>
<li>h0nIg <a href="https://github.com/h0nIg"><strong>(@h0nIg)</strong></a></li>
<li>Eelco Dolstra <a href="https://github.com/edolstra"><strong>(@edolstra)</strong></a></li>
<li>Shahar "Dawn" Or <a href="https://github.com/mightyiam"><strong>(@mightyiam)</strong></a></li>
<li>NAHO <a href="https://github.com/trueNAHO"><strong>(@trueNAHO)</strong></a></li>
<li>Ryan Hendrickson <a href="https://github.com/rhendric"><strong>(@rhendric)</strong></a></li>
<li>the-sun-will-rise-tomorrow <a href="https://github.com/the-sun-will-rise-tomorrow"><strong>(@the-sun-will-rise-tomorrow)</strong></a></li>
<li>Connor Baker <a href="https://github.com/ConnorBaker"><strong>(@ConnorBaker)</strong></a></li>
<li>Cole Helbling <a href="https://github.com/cole-h"><strong>(@cole-h)</strong></a></li>
<li>Jack Wilsdon <a href="https://github.com/jackwilsdon"><strong>(@jackwilsdon)</strong></a></li>
<li>‮rekcäH nitraM‮ <a href="https://github.com/dwt"><strong>(@dwt)</strong></a></li>
<li>Martin Fischer <a href="https://github.com/not-my-profile"><strong>(@not-my-profile)</strong></a></li>
<li>John Ericson <a href="https://github.com/Ericson2314"><strong>(@Ericson2314)</strong></a></li>
<li>Graham Christensen <a href="https://github.com/grahamc"><strong>(@grahamc)</strong></a></li>
<li>Sergei Zimmerman <a href="https://github.com/xokdvium"><strong>(@xokdvium)</strong></a></li>
<li>Siddarth Kumar <a href="https://github.com/siddarthkay"><strong>(@siddarthkay)</strong></a></li>
<li>Sergei Trofimovich <a href="https://github.com/trofi"><strong>(@trofi)</strong></a></li>
<li>Robert Hensing <a href="https://github.com/roberth"><strong>(@roberth)</strong></a></li>
<li>Mutsuha Asada <a href="https://github.com/momeemt"><strong>(@momeemt)</strong></a></li>
<li>Parker Jones <a href="https://github.com/knotapun"><strong>(@knotapun)</strong></a></li>
<li>Jörg Thalheim <a href="https://github.com/Mic92"><strong>(@Mic92)</strong></a></li>
<li>dbdr <a href="https://github.com/dbdr"><strong>(@dbdr)</strong></a></li>
<li>myclevorname <a href="https://github.com/myclevorname"><strong>(@myclevorname)</strong></a></li>
<li>Philipp Otterbein</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-2250-2024-11-07"><a class="header" href="#release-2250-2024-11-07">Release 2.25.0 (2024-11-07)</a></h1>
<ul>
<li>
<p>New environment variables to override XDG locations <a href="https://github.com/NixOS/nix/pull/11351">#11351</a></p>
<p>Added new environment variables:</p>
<ul>
<li><code>NIX_CACHE_HOME</code></li>
<li><code>NIX_CONFIG_HOME</code></li>
<li><code>NIX_DATA_HOME</code></li>
<li><code>NIX_STATE_HOME</code></li>
</ul>
<p>Each, if defined, takes precedence over the corresponding <a href="release-notes/../command-ref/env-common.html#xdg-base-directories">XDG environment variable</a>.
This provides more fine-grained control over where Nix looks for files. It allows having a stand-alone Nix environment that only uses files in a specific directory and that doesn't interfere with the user environment.</p>
</li>
<li>
<p>Define integer overflow in the Nix language as an error <a href="https://github.com/NixOS/nix/issues/10968">#10968</a> <a href="https://github.com/NixOS/nix/pull/11188">#11188</a></p>
<p>Previously, integer overflow in the Nix language invoked C++ level signed overflow, which manifested as wrapping around on overflow. It now looks like this:</p>
<pre><code>$ nix eval --expr '9223372036854775807 + 1'
error: integer overflow in adding 9223372036854775807 + 1
</code></pre>
<p>Some other overflows were fixed:</p>
<ul>
<li><code>builtins.fromJSON</code> of values greater than the maximum representable value in a signed 64-bit integer will generate an error.</li>
<li><code>nixConfig</code> in flakes will no longer accept negative values for configuration options.</li>
</ul>
</li>
<li>
<p>The <code>build-hook</code> setting no longer has a useful default when using <code>libnixstore</code> as a library <a href="https://github.com/NixOS/nix/pull/11178">#11178</a></p>
<p><em>This is an obscure issue that only affects usage of the <code>libnixstore</code> library outside of the Nix executable. It is unrelated to the <code>post-build-hook</code> settings, which is often used for pushing to a cache.</em></p>
<p>As part the ongoing <a href="https://github.com/NixOS/nix/issues/2503">rewrite of the build system</a> to use <a href="https://mesonbuild.com/">Meson</a>, we are also switching to packaging individual Nix components separately (and building them in separate derivations).
This means that when building <code>libnixstore</code> we do not know where the Nix binaries will be installed --- <code>libnixstore</code> doesn't know about downstream consumers like the Nix binaries at all.</p>
<p>This has a small adverse affect on remote building --- the <code>build-remote</code> executable that is specified from the <a href="release-notes/../command-ref/conf-file.html#conf-build-hook"><code>build-hook</code></a> setting will not be gotten from the (presumed) installation location, but instead looked up on the <code>PATH</code>.
This means that other applications linking <code>libnixstore</code> that wish to use remote building must arrange for the <code>nix</code> command to be on the PATH (or manually overriding <code>build-hook</code>) in order for that to work.</p>
<p>Long term we don't envision this being a downside, because we plan to <a href="https://github.com/NixOS/nix/issues/1221">get rid of <code>build-remote</code> and the build hook setting entirely</a>.
There should simply be no need to have an extra, intermediate layer of remote-procedure-calling when we want to connect to a remote builder.
The build hook protocol did in principle support custom ways of remote building, but that can also be accomplished with a custom service for the ssh or daemon/ssh-ng protocols, or with a custom <a href="release-notes/../store/types/index.html">store type</a> i.e. <code>Store</code> subclass. <!-- we normally don't mention classes, but consider that this release note is about a library use case --></p>
<p>The Perl bindings no longer expose <code>getBinDir</code> either, since the underlying C++ libraries those bindings wrap no longer know the location of installed binaries as described above.</p>
</li>
<li>
<p>Wrap filesystem exceptions more correctly <a href="https://github.com/NixOS/nix/pull/11378">#11378</a></p>
<p>With the switch to <code>std::filesystem</code> in different places, Nix started to throw <code>std::filesystem::filesystem_error</code> in many places instead of its own exceptions.
As a result, Nix no longer generated error traces when (for example) listing a non-existing directory. It could also lead to crashes inside the Nix REPL.</p>
<p>This version catches these types of exception correctly and wraps them into Nix's own exception type.</p>
<p>Author: <a href="https://github.com/Mic92"><strong>@Mic92</strong></a></p>
</li>
<li>
<p>Add setting <code>fsync-store-paths</code> <a href="https://github.com/NixOS/nix/issues/1218">#1218</a> <a href="https://github.com/NixOS/nix/pull/7126">#7126</a></p>
<p>Nix now has a setting <code>fsync-store-paths</code> that ensures that new store paths are durably written to disk before they are registered as "valid" in Nix's database. This can prevent Nix store corruption if the system crashes or there is a power loss. This setting defaults to <code>false</code>.</p>
<p>Author: <a href="https://github.com/squalus"><strong>@squalus</strong></a></p>
</li>
<li>
<p>Removing the default argument passed to the <code>nix fmt</code> formatter <a href="https://github.com/NixOS/nix/pull/11438">#11438</a></p>
<p>The underlying formatter no longer receives the "." default argument when <code>nix fmt</code> is called with no arguments.</p>
<p>This change was necessary as the formatter wasn't able to distinguish between
a user wanting to format the current folder with <code>nix fmt .</code> or the generic
<code>nix fmt</code>.</p>
<p>The default behavior is now the responsibility of the formatter itself, and
allows tools such as <code>treefmt</code> to format the whole tree instead of only the
current directory and below.</p>
<p>Author: <a href="https://github.com/zimbatm"><strong>@zimbatm</strong></a></p>
</li>
<li>
<p><code>&lt;nix/fetchurl.nix&gt;</code> uses TLS verification <a href="https://github.com/NixOS/nix/pull/11585">#11585</a></p>
<p>Previously <code>&lt;nix/fetchurl.nix&gt;</code> did not do TLS verification. This was because the Nix sandbox in the past did not have access to TLS certificates, and Nix checks the hash of the fetched file anyway. However, this can expose authentication data from <code>netrc</code> and URLs to man-in-the-middle attackers. In addition, Nix now in some cases (such as when using impure derivations) does <em>not</em> check the hash. Therefore we have now enabled TLS verification. This means that downloads by <code>&lt;nix/fetchurl.nix&gt;</code> will now fail if you're fetching from a HTTPS server that does not have a valid certificate.</p>
<p><code>&lt;nix/fetchurl.nix&gt;</code> is also known as the builtin derivation builder <code>builtin:fetchurl</code>. It's not to be confused with the evaluation-time function <code>builtins.fetchurl</code>, which was not affected by this issue.</p>
</li>
</ul>
<h1 id="contributors-3"><a class="header" href="#contributors-3">Contributors</a></h1>
<p>This release was made possible by the following 58 contributors:</p>
<ul>
<li>1444 <a href="https://github.com/0x5a4"><strong>(@0x5a4)</strong></a></li>
<li>Adrian Hesketh <a href="https://github.com/a-h"><strong>(@a-h)</strong></a></li>
<li>Aleksana <a href="https://github.com/Aleksanaa"><strong>(@Aleksanaa)</strong></a></li>
<li>Alyssa Ross <a href="https://github.com/alyssais"><strong>(@alyssais)</strong></a></li>
<li>Andrew Marshall <a href="https://github.com/amarshall"><strong>(@amarshall)</strong></a></li>
<li>Artemis Tosini <a href="https://github.com/artemist"><strong>(@artemist)</strong></a></li>
<li>Artturin <a href="https://github.com/Artturin"><strong>(@Artturin)</strong></a></li>
<li>Bjørn Forsman <a href="https://github.com/bjornfor"><strong>(@bjornfor)</strong></a></li>
<li>Brian McGee <a href="https://github.com/brianmcgee"><strong>(@brianmcgee)</strong></a></li>
<li>Brian McKenna <a href="https://github.com/puffnfresh"><strong>(@puffnfresh)</strong></a></li>
<li>Bryan Honof <a href="https://github.com/bryanhonof"><strong>(@bryanhonof)</strong></a></li>
<li>Cole Helbling <a href="https://github.com/cole-h"><strong>(@cole-h)</strong></a></li>
<li>Eelco Dolstra <a href="https://github.com/edolstra"><strong>(@edolstra)</strong></a></li>
<li>Eman Resu <a href="https://github.com/llakala"><strong>(@llakala)</strong></a></li>
<li>Emery Hemingway <a href="https://github.com/ehmry"><strong>(@ehmry)</strong></a></li>
<li>Emil Petersen <a href="https://github.com/leetemil"><strong>(@leetemil)</strong></a></li>
<li>Emily <a href="https://github.com/emilazy"><strong>(@emilazy)</strong></a></li>
<li>Geoffrey Thomas <a href="https://github.com/geofft"><strong>(@geofft)</strong></a></li>
<li>Gerg-L <a href="https://github.com/Gerg-L"><strong>(@Gerg-L)</strong></a></li>
<li>Ivan Tkachev</li>
<li>Jacek Galowicz <a href="https://github.com/tfc"><strong>(@tfc)</strong></a></li>
<li>Jan Hrcek <a href="https://github.com/jhrcek"><strong>(@jhrcek)</strong></a></li>
<li>Jason Yundt <a href="https://github.com/Jayman2000"><strong>(@Jayman2000)</strong></a></li>
<li>Jeremy Kerfs <a href="https://github.com/jkerfs"><strong>(@jkerfs)</strong></a></li>
<li>Jeremy Kolb <a href="https://github.com/kjeremy"><strong>(@kjeremy)</strong></a></li>
<li>John Ericson <a href="https://github.com/Ericson2314"><strong>(@Ericson2314)</strong></a></li>
<li>Jonas Chevalier <a href="https://github.com/zimbatm"><strong>(@zimbatm)</strong></a></li>
<li>Jordan Justen <a href="https://github.com/jljusten"><strong>(@jljusten)</strong></a></li>
<li>Josh Heinrichs <a href="https://github.com/joshheinrichs-shopify"><strong>(@joshheinrichs-shopify)</strong></a></li>
<li>Jörg Thalheim <a href="https://github.com/Mic92"><strong>(@Mic92)</strong></a></li>
<li>Kevin Cox <a href="https://github.com/kevincox"><strong>(@kevincox)</strong></a></li>
<li>Michael Gallagher <a href="https://github.com/mjgallag"><strong>(@mjgallag)</strong></a></li>
<li>Michael <a href="https://github.com/michaelvanstraten"><strong>(@michaelvanstraten)</strong></a></li>
<li>Nikodem Rabuliński <a href="https://github.com/nrabulinski"><strong>(@nrabulinski)</strong></a></li>
<li>Noam Yorav-Raphael <a href="https://github.com/noamraph"><strong>(@noamraph)</strong></a></li>
<li>Onni Hakala <a href="https://github.com/onnimonni"><strong>(@onnimonni)</strong></a></li>
<li>Parker Hoyes <a href="https://github.com/parkerhoyes"><strong>(@parkerhoyes)</strong></a></li>
<li>Philipp Otterbein</li>
<li>Pol Dellaiera <a href="https://github.com/drupol"><strong>(@drupol)</strong></a></li>
<li>Robert Hensing <a href="https://github.com/roberth"><strong>(@roberth)</strong></a></li>
<li>Ryan Hendrickson <a href="https://github.com/rhendric"><strong>(@rhendric)</strong></a></li>
<li>Sandro <a href="https://github.com/SuperSandro2000"><strong>(@SuperSandro2000)</strong></a></li>
<li>Seggy Umboh <a href="https://github.com/secobarbital"><strong>(@secobarbital)</strong></a></li>
<li>Sergei Zimmerman <a href="https://github.com/xokdvium"><strong>(@xokdvium)</strong></a></li>
<li>Shivaraj B H <a href="https://github.com/shivaraj-bh"><strong>(@shivaraj-bh)</strong></a></li>
<li>Siddhant Kumar <a href="https://github.com/siddhantk232"><strong>(@siddhantk232)</strong></a></li>
<li>Tim <a href="https://github.com/Jaculabilis"><strong>(@Jaculabilis)</strong></a></li>
<li>Tom Bereknyei</li>
<li>Travis A. Everett <a href="https://github.com/abathur"><strong>(@abathur)</strong></a></li>
<li>Valentin Gagarin <a href="https://github.com/fricklerhandwerk"><strong>(@fricklerhandwerk)</strong></a></li>
<li>Vinayak Kaushik <a href="https://github.com/VinayakKaushikDH"><strong>(@VinayakKaushikDH)</strong></a></li>
<li>Yann Hamdaoui <a href="https://github.com/yannham"><strong>(@yannham)</strong></a></li>
<li>Yuriy Taraday <a href="https://github.com/YorikSar"><strong>(@YorikSar)</strong></a></li>
<li>bryango <a href="https://github.com/bryango"><strong>(@bryango)</strong></a></li>
<li>emhamm <a href="https://github.com/emhamm"><strong>(@emhamm)</strong></a></li>
<li>jade <a href="https://github.com/lf-"><strong>(@lf-)</strong></a></li>
<li>kenji <a href="https://github.com/a-kenji"><strong>(@a-kenji)</strong></a></li>
<li>pennae <a href="https://github.com/pennae"><strong>(@pennae)</strong></a></li>
<li>puckipedia <a href="https://github.com/puckipedia"><strong>(@puckipedia)</strong></a></li>
<li>squalus <a href="https://github.com/squalus"><strong>(@squalus)</strong></a></li>
<li>tomberek <a href="https://github.com/tomberek"><strong>(@tomberek)</strong></a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-2240-2024-07-31"><a class="header" href="#release-2240-2024-07-31">Release 2.24.0 (2024-07-31)</a></h1>
<h3 id="significant-changes"><a class="header" href="#significant-changes">Significant changes</a></h3>
<ul>
<li>
<p>Harden user sandboxing</p>
<p>The build directory has been hardened against interference with the outside world by nesting it inside another directory owned by (and only readable by) the daemon user.</p>
<p>This is a low severity security fix, <a href="https://www.cve.org/CVERecord?id=CVE-2024-38531">CVE-2024-38531</a>.</p>
<p>Credit: <a href="https://github.com/alois31"><strong>@alois31</strong></a>, <a href="https://github.com/lheckemann"><strong>Linus Heckemann (@lheckemann)</strong></a>
Co-authors: <a href="https://github.com/edolstra"><strong>@edolstra</strong></a></p>
</li>
<li>
<p><code>nix-shell &lt;directory&gt;</code> looks for <code>shell.nix</code> <a href="https://github.com/NixOS/nix/issues/496">#496</a> <a href="https://github.com/NixOS/nix/issues/2279">#2279</a> <a href="https://github.com/NixOS/nix/issues/4529">#4529</a> <a href="https://github.com/NixOS/nix/issues/5431">#5431</a> <a href="https://github.com/NixOS/nix/issues/11053">#11053</a> <a href="https://github.com/NixOS/nix/pull/11057">#11057</a></p>
<p><code>nix-shell $x</code> now looks for <code>$x/shell.nix</code> when <code>$x</code> resolves to a directory.</p>
<p>Although this might be seen as a breaking change, its primarily interactive usage makes it a minor issue.
This adjustment addresses a commonly reported problem.</p>
<p>This also applies to <code>nix-shell</code> shebang scripts. Consider the following example:</p>
<pre><code class="language-shell">#!/usr/bin/env nix-shell
#!nix-shell -i bash
</code></pre>
<p>This will now load <code>shell.nix</code> from the script's directory, if it exists; <code>default.nix</code> otherwise.</p>
<p>The old behavior can be opted into by setting the option <a href="release-notes/../command-ref/conf-file.html#conf-nix-shell-always-looks-for-shell-nix"><code>nix-shell-always-looks-for-shell-nix</code></a> to <code>false</code>.</p>
<p>Author: <a href="https://github.com/roberth"><strong>Robert Hensing (@roberth)</strong></a></p>
</li>
<li>
<p><code>nix-repl</code>'s <code>:doc</code> shows documentation comments <a href="https://github.com/NixOS/nix/issues/3904">#3904</a> <a href="https://github.com/NixOS/nix/issues/10771">#10771</a> <a href="https://github.com/NixOS/nix/pull/1652">#1652</a> <a href="https://github.com/NixOS/nix/pull/9054">#9054</a> <a href="https://github.com/NixOS/nix/pull/11072">#11072</a></p>
<p><code>nix repl</code> has a <code>:doc</code> command that previously only rendered documentation for internally defined functions.
This feature has been extended to also render function documentation comments, in accordance with <a href="https://github.com/NixOS/rfcs/pull/145">RFC 145</a>.</p>
<p>Example:</p>
<pre><code>nix-repl&gt; :doc lib.toFunction
Function toFunction
    … defined at /home/user/h/nixpkgs/lib/trivial.nix:1072:5

    Turns any non-callable values into constant functions. Returns
    callable values as is.

Inputs

    v

      : Any value

Examples

    :::{.example}

## lib.trivial.toFunction usage example

      | nix-repl&gt; lib.toFunction 1 2
      | 1
      |
      | nix-repl&gt; lib.toFunction (x: x + 1) 2
      | 3

    :::
</code></pre>
<p>Known limitations:</p>
<ul>
<li>It does not render documentation for "formals", such as <code>{ /** the value to return */ x, ... }: x</code>.</li>
<li>Some extensions to markdown are not yet supported, as you can see in the example above.</li>
</ul>
<p>We'd like to acknowledge <a href="https://github.com/inclyc">Yingchi Long (@inclyc)</a> for proposing a proof of concept for this functionality in <a href="https://github.com/NixOS/nix/pull/9054">#9054</a>, as well as <a href="https://github.com/sternenseemann">@sternenseemann</a> and <a href="https://github.com/hsjobeki">Johannes Kirschbauer (@hsjobeki)</a> for their contributions, proposals, and their work on <a href="https://github.com/NixOS/rfcs/pull/145">RFC 145</a>.</p>
<p>Author: <a href="https://github.com/roberth"><strong>Robert Hensing (@roberth)</strong></a></p>
</li>
</ul>
<h3 id="other-changes"><a class="header" href="#other-changes">Other changes</a></h3>
<ul>
<li>
<p>Solve <code>cached failure of attribute X</code> <a href="https://github.com/NixOS/nix/issues/9165">#9165</a> <a href="https://github.com/NixOS/nix/issues/10513">#10513</a> <a href="https://github.com/NixOS/nix/pull/10564">#10564</a></p>
<p>This eliminates all "cached failure of attribute X" messages by forcing evaluation of the original value when needed to show the exception to the user. This enhancement improves error reporting by providing the underlying message and stack trace.</p>
<p>Author: <a href="https://github.com/edolstra"><strong>Eelco Dolstra (@edolstra)</strong></a></p>
</li>
<li>
<p>Run the flake regressions test suite <a href="https://github.com/NixOS/nix/pull/10603">#10603</a></p>
<p>This update introduces a GitHub action to run a subset of the <a href="https://github.com/NixOS/flake-regressions">flake regressions test suite</a>, which includes 259 flakes with their expected evaluation results. Currently, the action runs the first 25 flakes due to the full test suite's extensive runtime. A manually triggered action may be implemented later to run the entire test suite.</p>
<p>Author: <a href="https://github.com/edolstra"><strong>Eelco Dolstra (@edolstra)</strong></a></p>
</li>
<li>
<p>Support unit prefixes in configuration settings <a href="https://github.com/NixOS/nix/pull/10668">#10668</a></p>
<p>Configuration settings in Nix now support unit prefixes, allowing for more intuitive and readable configurations. For example, you can now specify <a href="release-notes/../command-ref/opt-common.html#opt-min-free"><code>--min-free 1G</code></a> to set the minimum free space to 1 gigabyte.</p>
<p>This enhancement was extracted from <a href="https://github.com/NixOS/nix/pull/7851">#7851</a> and is also useful for PR <a href="https://github.com/NixOS/nix/pull/10661">#10661</a>.</p>
<p>Author: <a href="https://github.com/edolstra"><strong>Eelco Dolstra (@edolstra)</strong></a></p>
</li>
<li>
<p><code>nix build</code>: show all FOD errors with <code>--keep-going</code> <a href="https://github.com/NixOS/nix/pull/10734">#10734</a></p>
<p>The <a href="release-notes/../command-ref/new-cli/nix3-build.html"><code>nix build</code></a> command has been updated to improve the behavior of the [<code>--keep-going</code>] flag. Now, when <code>--keep-going</code> is used, all hash-mismatch errors of failing fixed-output derivations (FODs) are displayed, similar to the behavior for other build failures. This enhancement ensures that all relevant build errors are shown, making it easier for users to update multiple derivations at once or to diagnose and fix issues.</p>
<p>Author: <a href="https://github.com/Mic92"><strong>Jörg Thalheim (@Mic92)</strong></a>, <a href="https://github.com/Ma27"><strong>Maximilian Bosch (@Ma27)</strong></a></p>
<p><a href="release-notes/../command-ref/opt-common.html#opt-keep-going"><code>--keep-going</code></a></p>
</li>
<li>
<p>Build with Meson <a href="https://github.com/NixOS/nix/issues/2503">#2503</a> <a href="https://github.com/NixOS/nix/pull/10378">#10378</a> <a href="https://github.com/NixOS/nix/pull/10855">#10855</a> <a href="https://github.com/NixOS/nix/pull/10904">#10904</a> <a href="https://github.com/NixOS/nix/pull/10908">#10908</a> <a href="https://github.com/NixOS/nix/pull/10914">#10914</a> <a href="https://github.com/NixOS/nix/pull/10933">#10933</a> <a href="https://github.com/NixOS/nix/pull/10936">#10936</a> <a href="https://github.com/NixOS/nix/pull/10954">#10954</a> <a href="https://github.com/NixOS/nix/pull/10955">#10955</a> <a href="https://github.com/NixOS/nix/pull/10963">#10963</a> <a href="https://github.com/NixOS/nix/pull/10967">#10967</a> <a href="https://github.com/NixOS/nix/pull/10973">#10973</a> <a href="https://github.com/NixOS/nix/pull/11034">#11034</a> <a href="https://github.com/NixOS/nix/pull/11054">#11054</a> <a href="https://github.com/NixOS/nix/pull/11055">#11055</a> <a href="https://github.com/NixOS/nix/pull/11060">#11060</a> <a href="https://github.com/NixOS/nix/pull/11064">#11064</a> <a href="https://github.com/NixOS/nix/pull/11155">#11155</a></p>
<p>These changes aim to replace the use of autotools and <code>make</code> with Meson for building various components of Nix. Additionally, each library is built in its own derivation, leveraging Meson's "subprojects" feature to allow a single development shell for building all libraries while also supporting separate builds. This approach aims to improve productivity and build modularity, compared to both make and a monolithic Meson-based derivation.</p>
<p>Special thanks to everyone who has contributed to the Meson port, particularly <a href="https://github.com/p01arst0rm"><strong>@p01arst0rm</strong></a> and <a href="https://github.com/Qyriad"><strong>@Qyriad</strong></a>.</p>
<p>Authors: <a href="https://github.com/Ericson2314"><strong>John Ericson (@Ericson2314)</strong></a>, <a href="https://github.com/tomberek"><strong>Tom Bereknyei</strong></a>, <a href="https://github.com/thufschmitt"><strong>Théophane Hufschmitt (@thufschmitt)</strong></a>, <a href="https://github.com/fricklerhandwerk"><strong>Valentin Gagarin (@fricklerhandwerk)</strong></a>, <a href="https://github.com/roberth"><strong>Robert Hensing (@roberth)</strong></a>
Co-authors: <a href="https://github.com/p01arst0rm"><strong>@p01arst0rm</strong></a>, <a href="https://github.com/Qyriad"><strong>@Qyriad</strong></a></p>
</li>
<li>
<p>Evaluation cache: fix cache regressions <a href="https://github.com/NixOS/nix/issues/10570">#10570</a> <a href="https://github.com/NixOS/nix/pull/11086">#11086</a></p>
<p>This update addresses two bugs in the evaluation cache system:</p>
<ol>
<li>Regression in #10570: The evaluation cache was not being persisted in <code>nix develop</code>.</li>
<li>Nix could sometimes try to commit the evaluation cache SQLite transaction without there being an active transaction, resulting in non-error errors being printed.</li>
</ol>
<p>Author: <a href="https://github.com/kognise"><strong>Lexi Mattick (@kognise)</strong></a></p>
</li>
<li>
<p>Introduce <code>libnixflake</code> <a href="https://github.com/NixOS/nix/pull/9063">#9063</a></p>
<p>A new library, <code>libnixflake</code>, has been introduced to better separate the Flakes layer within Nix. This change refactors the codebase to encapsulate Flakes-specific functionality within its own library.</p>
<p>See the commits in the pull request for detailed changes, with the only significant code modifications happening in the initial commit.</p>
<p>This change was alluded to in <a href="https://github.com/nixos/rfcs/blob/master/rfcs/0134-nix-store-layer.md">RFC 134</a> and is a step towards a more modular and maintainable codebase.</p>
<p>Author: <a href="https://github.com/Ericson2314"><strong>John Ericson (@Ericson2314)</strong></a></p>
</li>
<li>
<p>CLI options <code>--arg-from-file</code> and <code>--arg-from-stdin</code> <a href="https://github.com/NixOS/nix/pull/9913">#9913</a></p>
</li>
<li>
<p>The <code>--debugger</code> now prints source location information, instead of the
pointers of source location information. Before:</p>
<pre><code>nix-repl&gt; :bt
0: while evaluating the attribute 'python311.pythonForBuild.pkgs'
0x600001522598
</code></pre>
<p>After:</p>
<pre><code>0: while evaluating the attribute 'python311.pythonForBuild.pkgs'
/nix/store/hg65h51xnp74ikahns9hyf3py5mlbbqq-source/overrides/default.nix:132:27

   131|
   132|       bootstrappingBase = pkgs.${self.python.pythonAttr}.pythonForBuild.pkgs;
      |                           ^
   133|     in
</code></pre>
</li>
<li>
<p>Stop vendoring <code>toml11</code></p>
<p>We don't apply any patches to it, and vendoring it locks users into
bugs (it hasn't been updated since its introduction in late 2021).</p>
<p>Author: <a href="https://github.com/winterqt"><strong>Winter (@winterqt)</strong></a></p>
</li>
<li>
<p>Rename hash format <code>base32</code> to <code>nix32</code> <a href="https://github.com/NixOS/nix/pull/8678">#8678</a></p>
<p>Hash format <code>base32</code> was renamed to <code>nix32</code> since it used a special nix-specific character set for
<a href="https://en.wikipedia.org/wiki/Base32">Base32</a>.</p>
<p><strong>Deprecation</strong>: Use <code>nix32</code> instead of <code>base32</code> as <code>toHashFormat</code></p>
<p>For the builtin <code>convertHash</code>, the <code>toHashFormat</code> parameter now accepts the same hash formats as the <code>--to</code>/<code>--from</code>
parameters of the <code>nix hash conert</code> command: <code>"base16"</code>, <code>"nix32"</code>, <code>"base64"</code>, and <code>"sri"</code>. The former <code>"base32"</code> value
remains as a deprecated alias for <code>"nix32"</code>. Please convert your code from:</p>
<pre><code class="language-nix">builtins.convertHash { inherit hash hashAlgo; toHashFormat = "base32";}
</code></pre>
<p>to</p>
<pre><code class="language-nix">builtins.convertHash { inherit hash hashAlgo; toHashFormat = "nix32";}
</code></pre>
</li>
<li>
<p>Add <code>pipe-operators</code> experimental feature <a href="https://github.com/NixOS/nix/pull/11131">#11131</a></p>
<p>This is a draft implementation of <a href="https://github.com/NixOS/rfcs/pull/148">RFC 0148</a>.</p>
<p>The <code>pipe-operators</code> experimental feature adds <a href="release-notes/../language/operators.html#pipe-operators"><code>&lt;|</code> and <code>|&gt;</code> operators</a> to the Nix language.
<em>a</em> <code>|&gt;</code> <em>b</em> is equivalent to the function application <em>b</em> <em>a</em>, and
<em>a</em> <code>&lt;|</code> <em>b</em> is equivalent to the function application <em>a</em> <em>b</em>.</p>
<p>For example:</p>
<pre><code>nix-repl&gt; 1 |&gt; builtins.add 2 |&gt; builtins.mul 3
9

nix-repl&gt; builtins.add 1 &lt;| builtins.mul 2 &lt;| 3
7
</code></pre>
<p><code>&lt;|</code> and <code>|&gt;</code> are right and left associative, respectively, and have lower precedence than any other operator.
These properties may change in future releases.</p>
<p>See <a href="https://github.com/NixOS/rfcs/pull/148">the RFC</a> for more examples and rationale.</p>
</li>
<li>
<p><code>nix-shell</code> shebang uses relative path <a href="https://github.com/NixOS/nix/issues/4232">#4232</a> <a href="https://github.com/NixOS/nix/pull/5088">#5088</a> <a href="https://github.com/NixOS/nix/pull/11058">#11058</a></p>
<!-- unfortunately no link target for the specific syntax -->
<p>Relative <a href="release-notes/../language/types.html#type-path">path</a> literals in <code>nix-shell</code> shebang scripts' options are now resolved relative to the <a href="release-notes/../glossary.html">script's location</a>.
Previously they were resolved relative to the current working directory.</p>
<p>For example, consider the following script in <code>~/myproject/say-hi</code>:</p>
<pre><code class="language-shell">#!/usr/bin/env nix-shell
#!nix-shell --expr 'import ./shell.nix'
#!nix-shell --arg toolset './greeting-tools.nix'
#!nix-shell -i bash
hello
</code></pre>
<p>Older versions of <code>nix-shell</code> would resolve <code>shell.nix</code> relative to the current working directory, such as the user's home directory in this example:</p>
<pre><code class="language-console">[hostname:~]$ ./myproject/say-hi
error:
       … while calling the 'import' builtin
         at «string»:1:2:
            1| (import ./shell.nix)
             |  ^

       error: path '/home/user/shell.nix' does not exist
</code></pre>
<p>Since this release, <code>nix-shell</code> resolves <code>shell.nix</code> relative to the script's location, and <code>~/myproject/shell.nix</code> is used.</p>
<pre><code class="language-console">$ ./myproject/say-hi
Hello, world!
</code></pre>
<p><strong>Opt-out</strong></p>
<p>This is technically a breaking change, so we have added an option so you can adapt independently of your Nix update.
The old behavior can be opted into by setting the option <a href="release-notes/../command-ref/conf-file.html#conf-nix-shell-shebang-arguments-relative-to-script"><code>nix-shell-shebang-arguments-relative-to-script</code></a> to <code>false</code>.
This option will be removed in a future release.</p>
<p>Author: <a href="https://github.com/roberth"><strong>Robert Hensing (@roberth)</strong></a></p>
</li>
<li>
<p>Improve handling of tarballs that don't consist of a single top-level directory <a href="https://github.com/NixOS/nix/pull/11195">#11195</a></p>
<p>In previous Nix releases, the tarball fetcher (used by <code>builtins.fetchTarball</code>) erroneously merged top-level directories into a single directory, and silently discarded top-level files that are not directories. This is no longer the case. The new behaviour is that <em>only</em> if the tarball consists of a single directory, the top-level path component of the files in the tarball is removed (similar to <code>tar</code>'s <code>--strip-components=1</code>).</p>
<p>Author: <a href="https://github.com/edolstra"><strong>Eelco Dolstra (@edolstra)</strong></a></p>
</li>
<li>
<p>Setting to warn about large paths <a href="https://github.com/NixOS/nix/pull/10778">#10778</a></p>
<p>Nix can now warn when evaluation of a Nix expression causes a large
path to be copied to the Nix store. The threshold for this warning can
be configured using the <code>warn-large-path-threshold</code> setting,
e.g. <code>--warn-large-path-threshold 100M</code>.</p>
</li>
</ul>
<h1 id="contributors-4"><a class="header" href="#contributors-4">Contributors</a></h1>
<p>This release was made possible by the following 43 contributors:</p>
<ul>
<li>Andreas Rammhold <a href="https://github.com/andir"><strong>(@andir)</strong></a></li>
<li>Andrew Marshall <a href="https://github.com/amarshall"><strong>(@amarshall)</strong></a></li>
<li>Brian McKenna <a href="https://github.com/puffnfresh"><strong>(@puffnfresh)</strong></a></li>
<li>Cameron <a href="https://github.com/SkamDart"><strong>(@SkamDart)</strong></a></li>
<li>Cole Helbling <a href="https://github.com/cole-h"><strong>(@cole-h)</strong></a></li>
<li>Corbin Simpson <a href="https://github.com/MostAwesomeDude"><strong>(@MostAwesomeDude)</strong></a></li>
<li>Eelco Dolstra <a href="https://github.com/edolstra"><strong>(@edolstra)</strong></a></li>
<li>Emily <a href="https://github.com/emilazy"><strong>(@emilazy)</strong></a></li>
<li>Enno Richter <a href="https://github.com/elohmeier"><strong>(@elohmeier)</strong></a></li>
<li>Farid Zakaria <a href="https://github.com/fzakaria"><strong>(@fzakaria)</strong></a></li>
<li>HaeNoe <a href="https://github.com/haenoe"><strong>(@haenoe)</strong></a></li>
<li>Hamir Mahal <a href="https://github.com/hamirmahal"><strong>(@hamirmahal)</strong></a></li>
<li>Harmen <a href="https://github.com/alicebob"><strong>(@alicebob)</strong></a></li>
<li>Ivan Trubach <a href="https://github.com/tie"><strong>(@tie)</strong></a></li>
<li>Jared Baur <a href="https://github.com/jmbaur"><strong>(@jmbaur)</strong></a></li>
<li>John Ericson <a href="https://github.com/Ericson2314"><strong>(@Ericson2314)</strong></a></li>
<li>Jonathan De Troye <a href="https://github.com/detroyejr"><strong>(@detroyejr)</strong></a></li>
<li>Jörg Thalheim <a href="https://github.com/Mic92"><strong>(@Mic92)</strong></a></li>
<li>Klemens Nanni <a href="https://github.com/klemensn"><strong>(@klemensn)</strong></a></li>
<li>Las Safin <a href="https://github.com/L-as"><strong>(@L-as)</strong></a></li>
<li>Lexi Mattick <a href="https://github.com/kognise"><strong>(@kognise)</strong></a></li>
<li>Matthew Bauer <a href="https://github.com/matthewbauer"><strong>(@matthewbauer)</strong></a></li>
<li>Max “Goldstein” Siling <a href="https://github.com/GoldsteinE"><strong>(@GoldsteinE)</strong></a></li>
<li>Mingye Wang <a href="https://github.com/Artoria2e5"><strong>(@Artoria2e5)</strong></a></li>
<li>Philip Taron <a href="https://github.com/philiptaron"><strong>(@philiptaron)</strong></a></li>
<li>Pierre Bourdon <a href="https://github.com/delroth"><strong>(@delroth)</strong></a></li>
<li>Pino Toscano <a href="https://github.com/pinotree"><strong>(@pinotree)</strong></a></li>
<li>RTUnreal <a href="https://github.com/RTUnreal"><strong>(@RTUnreal)</strong></a></li>
<li>Robert Hensing <a href="https://github.com/roberth"><strong>(@roberth)</strong></a></li>
<li>Romain Neil <a href="https://github.com/romain-neil"><strong>(@romain-neil)</strong></a></li>
<li>Ryan Hendrickson <a href="https://github.com/rhendric"><strong>(@rhendric)</strong></a></li>
<li>Sergei Trofimovich <a href="https://github.com/trofi"><strong>(@trofi)</strong></a></li>
<li>Shogo Takata <a href="https://github.com/pineapplehunter"><strong>(@pineapplehunter)</strong></a></li>
<li>Siddhant Kumar <a href="https://github.com/siddhantk232"><strong>(@siddhantk232)</strong></a></li>
<li>Silvan Mosberger <a href="https://github.com/infinisil"><strong>(@infinisil)</strong></a></li>
<li>Théophane Hufschmitt <a href="https://github.com/thufschmitt"><strong>(@thufschmitt)</strong></a></li>
<li>Valentin Gagarin <a href="https://github.com/fricklerhandwerk"><strong>(@fricklerhandwerk)</strong></a></li>
<li>Winter <a href="https://github.com/winterqt"><strong>(@winterqt)</strong></a></li>
<li>jade <a href="https://github.com/lf-"><strong>(@lf-)</strong></a></li>
<li>kirillrdy <a href="https://github.com/kirillrdy"><strong>(@kirillrdy)</strong></a></li>
<li>pennae <a href="https://github.com/pennae"><strong>(@pennae)</strong></a></li>
<li>poweredbypie <a href="https://github.com/poweredbypie"><strong>(@poweredbypie)</strong></a></li>
<li>tomberek <a href="https://github.com/tomberek"><strong>(@tomberek)</strong></a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-2230-2024-06-03"><a class="header" href="#release-2230-2024-06-03">Release 2.23.0 (2024-06-03)</a></h1>
<ul>
<li>
<p>New builtin: <code>builtins.warn</code> <a href="https://github.com/NixOS/nix/issues/306026">#306026</a> <a href="https://github.com/NixOS/nix/pull/10592">#10592</a></p>
<p><code>builtins.warn</code> behaves like <code>builtins.trace "warning: ${msg}"</code>, has an accurate log level, and is controlled by the options
<a href="release-notes/../command-ref/conf-file.html#conf-debugger-on-trace"><code>debugger-on-trace</code></a>,
<a href="release-notes/../command-ref/conf-file.html#conf-debugger-on-warn"><code>debugger-on-warn</code></a> and
<a href="release-notes/../command-ref/conf-file.html#conf-abort-on-warn"><code>abort-on-warn</code></a>.</p>
</li>
<li>
<p>Make <code>nix build --keep-going</code> consistent with <code>nix-build --keep-going</code></p>
<p>This means that if e.g. multiple fixed-output derivations fail to
build, all hash mismatches are displayed.</p>
</li>
<li>
<p>Modify <code>nix derivation {add,show}</code> JSON format <a href="https://github.com/NixOS/nix/issues/9866">#9866</a> <a href="https://github.com/NixOS/nix/pull/10722">#10722</a></p>
<p>The JSON format for derivations has been slightly revised to better conform to our <a href="release-notes/../development/cli-guideline.html#returning-future-proof-json">JSON guidelines</a>.
In particular, the hash algorithm and content addressing method of content-addresed derivation outputs are now separated into two fields <code>hashAlgo</code> and <code>method</code>,
rather than one field with an arcane <code>:</code>-separated format.</p>
<p>This JSON format is only used by the experimental <code>nix derivation</code> family of commands, at this time.
Future revisions are expected as the JSON format is still not entirely in compliance even after these changes.</p>
</li>
<li>
<p>Warn on unknown settings anywhere in the command line <a href="https://github.com/NixOS/nix/pull/10701">#10701</a></p>
<p>All <code>nix</code> commands will now properly warn when an unknown option is specified anywhere in the command line.</p>
<p>Before:</p>
<pre><code class="language-console">$ nix-instantiate --option foobar baz --expr '{}'
warning: unknown setting 'foobar'
$ nix-instantiate '{}' --option foobar baz --expr
$ nix eval --expr '{}' --option foobar baz
{ }
</code></pre>
<p>After:</p>
<pre><code class="language-console">$ nix-instantiate --option foobar baz --expr '{}'
warning: unknown setting 'foobar'
$ nix-instantiate '{}' --option foobar baz --expr
warning: unknown setting 'foobar'
$ nix eval --expr '{}' --option foobar baz
warning: unknown setting 'foobar'
{ }
</code></pre>
</li>
<li>
<p><code>nix env shell</code> is the new <code>nix shell</code>, and <code>nix shell</code> remains an accepted alias <a href="https://github.com/NixOS/nix/issues/10504">#10504</a> <a href="https://github.com/NixOS/nix/pull/10807">#10807</a></p>
<p>This is part of an effort to bring more structure to the CLI subcommands.</p>
<p><code>nix env</code> will be about the process environment.
Future commands may include <code>nix env run</code> and <code>nix env print-env</code>.</p>
<p>It is also somewhat analogous to the <a href="https://github.com/NixOS/nix/issues/10504">planned</a> <code>nix dev shell</code> (currently <code>nix develop</code>), which is less about environment variables, and more about running a development shell, which is a more powerful command, but also requires more setup.</p>
</li>
<li>
<p>Flake operations that expect derivations now print the failing value and its type <a href="https://github.com/NixOS/nix/pull/10778">#10778</a></p>
<p>In errors like <code>flake output attribute 'nixosConfigurations.yuki.config' is not a derivation or path</code>, the message now includes the failing value and type.</p>
<p>Before:</p>
<pre><code>error: flake output attribute 'nixosConfigurations.yuki.config' is not a derivation or path
</code></pre>
<p>After:</p>
<pre><code>error: expected flake output attribute 'nixosConfigurations.yuki.config' to be a derivation or path but found a set: { appstream = «thunk»; assertions = «thunk»; boot = { bcache = «thunk»; binfmt = «thunk»; binfmtMiscRegistrations = «thunk»; blacklistedKernelModules = «thunk»; bootMount = «thunk»; bootspec = «thunk»; cleanTmpDir = «thunk»; consoleLogLevel = «thunk»; «43 attributes elided» }; «48 attributes elided» }
</code></pre>
</li>
<li>
<p><code>fetchTree</code> now fetches Git repositories shallowly by default <a href="https://github.com/NixOS/nix/pull/10028">#10028</a></p>
<p><code>builtins.fetchTree</code> now clones Git repositories shallowly by default, which reduces network traffic and disk usage significantly in many cases.</p>
<p>Previously, the default behavior was to clone the full history of a specific tag or branch (e.g. <code>ref</code>) and only afterwards extract the files of one specific revision.</p>
<p>From now on, the <code>ref</code> and <code>allRefs</code> arguments will be ignored, except if shallow cloning is disabled by setting <code>shallow = false</code>.</p>
<p>The defaults for <code>builtins.fetchGit</code> remain unchanged. Here, shallow cloning has to be enabled manually by passing <code>shallow = true</code>.</p>
</li>
<li>
<p>Store object info JSON format now uses <code>null</code> rather than omitting fields <a href="https://github.com/NixOS/nix/pull/9995">#9995</a></p>
<p>The <a href="release-notes/../protocols/json/store-object-info.html">store object info JSON format</a>, used for e.g. <code>nix path-info</code>, no longer omits fields to indicate absent information, but instead includes the fields with a <code>null</code> value.
For example, <code>"ca": null</code> is used to indicate a store object that isn't content-addressed rather than omitting the <code>ca</code> field entirely.
This makes records of this sort more self-describing, and easier to consume programmatically.</p>
<p>We will follow this design principle going forward;
the <a href="release-notes/../development/json-guideline.html">JSON guidelines</a> in the contributing section have been updated accordingly.</p>
</li>
<li>
<p>Large path warnings <a href="https://github.com/NixOS/nix/pull/10661">#10661</a></p>
<p>Nix can now warn when evaluation of a Nix expression causes a large
path to be copied to the Nix store. The threshold for this warning can
be configured using <a href="release-notes/../command-ref/conf-file.html#conf-warn-large-path-threshold">the <code>warn-large-path-threshold</code>
setting</a>,
e.g. <code>--warn-large-path-threshold 100M</code> will warn about paths larger
than 100 MiB.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-2220-2024-04-23"><a class="header" href="#release-2220-2024-04-23">Release 2.22.0 (2024-04-23)</a></h1>
<h3 id="significant-changes-1"><a class="header" href="#significant-changes-1">Significant changes</a></h3>
<ul>
<li>
<p>Remove experimental repl-flake <a href="https://github.com/NixOS/nix/issues/10103">#10103</a> <a href="https://github.com/NixOS/nix/pull/10299">#10299</a></p>
<p>The <code>repl-flake</code> experimental feature has been removed. The <code>nix repl</code> command now works like the rest of the new CLI in that <code>nix repl {path}</code> now tries to load a flake at <code>{path}</code> (or fails if the <code>flakes</code> experimental feature isn't enabled).</p>
</li>
</ul>
<h3 id="other-changes-1"><a class="header" href="#other-changes-1">Other changes</a></h3>
<ul>
<li>
<p><code>nix eval</code> prints derivations as <code>.drv</code> paths <a href="https://github.com/NixOS/nix/pull/10200">#10200</a></p>
<p><code>nix eval</code> will now print derivations as their <code>.drv</code> paths, rather than as
attribute sets. This makes commands like <code>nix eval nixpkgs#bash</code> terminate
instead of infinitely looping into recursive self-referential attributes:</p>
<pre><code class="language-ShellSession">$ nix eval nixpkgs#bash
«derivation /nix/store/m32cbgbd598f4w299g0hwyv7gbw6rqcg-bash-5.2p26.drv»
</code></pre>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-2210-2024-03-11"><a class="header" href="#release-2210-2024-03-11">Release 2.21.0 (2024-03-11)</a></h1>
<ul>
<li>
<p>Fix a fixed-output derivation sandbox escape (CVE-2024-27297)</p>
<p>Cooperating Nix derivations could send file descriptors to files in the Nix
store to each other via Unix domain sockets in the abstract namespace. This
allowed one derivation to modify the output of the other derivation, after Nix
has registered the path as "valid" and immutable in the Nix database.
In particular, this allowed the output of fixed-output derivations to be
modified from their expected content.</p>
<p>This isn't the case any more.</p>
</li>
<li>
<p>CLI options <code>--arg-from-file</code> and <code>--arg-from-stdin</code> <a href="https://github.com/NixOS/nix/pull/10122">#10122</a></p>
<p>The new CLI option <code>--arg-from-file</code> <em>name</em> <em>path</em> passes the contents
of file <em>path</em> as a string value via the function argument <em>name</em> to a
Nix expression. Similarly, the new option <code>--arg-from-stdin</code> <em>name</em>
reads the contents of the string from standard input.</p>
</li>
<li>
<p>Concise error printing in <code>nix repl</code> <a href="https://github.com/NixOS/nix/pull/9928">#9928</a></p>
<p>Previously, if an element of a list or attribute set threw an error while
evaluating, <code>nix repl</code> would print the entire error (including source location
information) inline. This output was clumsy and difficult to parse:</p>
<pre><code>nix-repl&gt; { err = builtins.throw "uh oh!"; }
{ err = «error:
       … while calling the 'throw' builtin
         at «string»:1:9:
            1| { err = builtins.throw "uh oh!"; }
             |         ^

       error: uh oh!»; }
</code></pre>
<p>Now, only the error message is displayed, making the output much more readable.</p>
<pre><code>nix-repl&gt; { err = builtins.throw "uh oh!"; }
{ err = «error: uh oh!»; }
</code></pre>
<p>However, if the whole expression being evaluated throws an error, source
locations and (if applicable) a stack trace are printed, just like you'd expect:</p>
<pre><code>nix-repl&gt; builtins.throw "uh oh!"
error:
       … while calling the 'throw' builtin
         at «string»:1:1:
            1| builtins.throw "uh oh!"
             | ^

       error: uh oh!
</code></pre>
</li>
<li>
<p><code>--debugger</code> can now access bindings from <code>let</code> expressions <a href="https://github.com/NixOS/nix/issues/8827">#8827</a> <a href="https://github.com/NixOS/nix/pull/9918">#9918</a></p>
<p>Breakpoints and errors in the bindings of a <code>let</code> expression can now access
those bindings in the debugger. Previously, only the body of <code>let</code> expressions
could access those bindings.</p>
</li>
<li>
<p>Enter the <code>--debugger</code> when <code>builtins.trace</code> is called if <code>debugger-on-trace</code> is set <a href="https://github.com/NixOS/nix/pull/9914">#9914</a></p>
<p>If the <code>debugger-on-trace</code> option is set and <code>--debugger</code> is given,
<code>builtins.trace</code> calls will behave similarly to <code>builtins.break</code> and will enter
the debug REPL. This is useful for determining where warnings are being emitted
from.</p>
</li>
<li>
<p>Debugger prints source position information <a href="https://github.com/NixOS/nix/pull/9913">#9913</a></p>
<p>The <code>--debugger</code> now prints source location information, instead of the
pointers of source location information. Before:</p>
<pre><code>nix-repl&gt; :bt
0: while evaluating the attribute 'python311.pythonForBuild.pkgs'
0x600001522598
</code></pre>
<p>After:</p>
<pre><code>0: while evaluating the attribute 'python311.pythonForBuild.pkgs'
/nix/store/hg65h51xnp74ikahns9hyf3py5mlbbqq-source/overrides/default.nix:132:27

   131|
   132|       bootstrappingBase = pkgs.${self.python.pythonAttr}.pythonForBuild.pkgs;
      |                           ^
   133|     in
</code></pre>
</li>
<li>
<p>The <code>--debugger</code> will start more reliably in <code>let</code> expressions and function calls <a href="https://github.com/NixOS/nix/issues/6649">#6649</a> <a href="https://github.com/NixOS/nix/pull/9917">#9917</a></p>
<p>Previously, if you attempted to evaluate this file with the debugger:</p>
<pre><code class="language-nix">let
  a = builtins.trace "before inner break" (
    builtins.break "hello"
  );
  b = builtins.trace "before outer break" (
    builtins.break a
  );
in
  b
</code></pre>
<p>Nix would correctly enter the debugger at <code>builtins.break a</code>, but if you asked
it to <code>:continue</code>, it would skip over the <code>builtins.break "hello"</code> expression
entirely.</p>
<p>Now, Nix will correctly enter the debugger at both breakpoints.</p>
</li>
<li>
<p>Nested debuggers are no longer supported <a href="https://github.com/NixOS/nix/pull/9920">#9920</a></p>
<p>Previously, evaluating an expression that throws an error in the debugger would
enter a second, nested debugger:</p>
<pre><code>nix-repl&gt; builtins.throw "what"
error: what


Starting REPL to allow you to inspect the current state of the evaluator.

Welcome to Nix 2.18.1. Type :? for help.

nix-repl&gt;
</code></pre>
<p>Now, it just prints the error message like <code>nix repl</code>:</p>
<pre><code>nix-repl&gt; builtins.throw "what"
error:
       … while calling the 'throw' builtin
         at «string»:1:1:
            1| builtins.throw "what"
             | ^

       error: what
</code></pre>
</li>
<li>
<p>Consistent order of function arguments in printed expressions <a href="https://github.com/NixOS/nix/pull/9874">#9874</a></p>
<p>Function arguments are now printed in lexicographic order rather than the internal, creation-time based symbol order.</p>
</li>
<li>
<p>Fix duplicate attribute error positions for <code>inherit</code> <a href="https://github.com/NixOS/nix/pull/9874">#9874</a></p>
<p>When an <code>inherit</code> caused a duplicate attribute error the position of the error was not reported correctly, placing the error with the inherit itself or at the start of the bindings block instead of the offending attribute name.</p>
</li>
<li>
<p><code>inherit (x) ...</code> evaluates <code>x</code> only once <a href="https://github.com/NixOS/nix/pull/9847">#9847</a></p>
<p><code>inherit (x) a b ...</code> now evaluates the expression <code>x</code> only once for all inherited attributes rather than once for each inherited attribute.
This does not usually have a measurable impact, but side-effects (such as <code>builtins.trace</code>) would be duplicated and expensive expressions (such as derivations) could cause a measurable slowdown.</p>
</li>
<li>
<p>Store paths are allowed to start with <code>.</code> <a href="https://github.com/NixOS/nix/issues/912">#912</a> <a href="https://github.com/NixOS/nix/pull/9091">#9091</a> <a href="https://github.com/NixOS/nix/pull/9095">#9095</a> <a href="https://github.com/NixOS/nix/pull/9120">#9120</a> <a href="https://github.com/NixOS/nix/pull/9121">#9121</a> <a href="https://github.com/NixOS/nix/pull/9122">#9122</a> <a href="https://github.com/NixOS/nix/pull/9130">#9130</a> <a href="https://github.com/NixOS/nix/pull/9219">#9219</a> <a href="https://github.com/NixOS/nix/pull/9224">#9224</a> <a href="https://github.com/NixOS/nix/pull/9867">#9867</a></p>
<p>Leading periods were allowed by accident in Nix 2.4. The Nix team has considered this to be a bug, but this behavior has since been relied on by users, leading to unnecessary difficulties.
From now on, leading periods are supported. The names <code>.</code> and <code>..</code> are disallowed, as well as those starting with <code>.-</code> or <code>..-</code>.</p>
<p>Nix versions that denied leading periods are documented <a href="https://github.com/NixOS/nix/issues/912#issuecomment-1919583286">in the issue</a>.</p>
</li>
<li>
<p><code>nix repl</code> pretty-prints values <a href="https://github.com/NixOS/nix/pull/9931">#9931</a></p>
<p><code>nix repl</code> will now pretty-print values:</p>
<pre><code>{
  attrs = {
    a = {
      b = {
        c = { };
      };
    };
  };
  list = [ 1 ];
  list' = [
    1
    2
    3
  ];
}
</code></pre>
</li>
<li>
<p>Introduction of <code>--regex</code> and <code>--all</code> in <code>nix profile remove</code> and <code>nix profile upgrade</code> <a href="https://github.com/NixOS/nix/pull/10166">#10166</a></p>
<p>Previously the command-line arguments for <code>nix profile remove</code> and <code>nix profile upgrade</code> matched the package entries using regular expression.
For instance:</p>
<pre><code>nix profile remove '.*vim.*'
</code></pre>
<p>This would remove all packages that contain <code>vim</code> in their name.</p>
<p>In most cases, only singular package names were used to remove and upgrade packages. Mixing this with regular expressions sometimes lead to unintended behavior. For instance, <code>python3.1</code> could match <code>python311</code>.</p>
<p>To avoid unintended behavior, the arguments are now only matching exact names.</p>
<p>Matching using regular expressions is still possible by using the new <code>--regex</code> flag:</p>
<pre><code>nix profile remove --regex '.*vim.*'
</code></pre>
<p>One of the most useful cases for using regular expressions was to upgrade all packages. This was previously accomplished by:</p>
<pre><code>nix profile upgrade '.*'
</code></pre>
<p>With the introduction of the <code>--all</code> flag, this now becomes more straightforward:</p>
<pre><code>nix profile upgrade --all
</code></pre>
</li>
<li>
<p>Visual clutter in <code>--debugger</code> is reduced <a href="https://github.com/NixOS/nix/pull/9919">#9919</a></p>
<p>Before:</p>
<pre><code>info: breakpoint reached


Starting REPL to allow you to inspect the current state of the evaluator.

Welcome to Nix 2.20.0pre20231222_dirty. Type :? for help.

nix-repl&gt; :continue
error: uh oh


Starting REPL to allow you to inspect the current state of the evaluator.

Welcome to Nix 2.20.0pre20231222_dirty. Type :? for help.

nix-repl&gt;
</code></pre>
<p>After:</p>
<pre><code>info: breakpoint reached

Nix 2.20.0pre20231222_dirty debugger
Type :? for help.
nix-repl&gt; :continue
error: uh oh

nix-repl&gt;
</code></pre>
</li>
<li>
<p>Cycle detection in <code>nix repl</code> is simpler and more reliable <a href="https://github.com/NixOS/nix/issues/8672">#8672</a> <a href="https://github.com/NixOS/nix/pull/9926">#9926</a></p>
<p>The cycle detection in <code>nix repl</code>, <code>nix eval</code>, <code>builtins.trace</code>, and everywhere
else values are printed is now simpler and matches the cycle detection in
<code>nix-instantiate --eval</code> output.</p>
<p>Before:</p>
<pre><code>nix eval --expr 'let self = { inherit self; }; in self'
{ self = { self = «repeated»; }; }
</code></pre>
<p>After:</p>
<pre><code>{ self = «repeated»; }
</code></pre>
</li>
<li>
<p>In the debugger, <code>while evaluating the attribute</code> errors now include position information <a href="https://github.com/NixOS/nix/pull/9915">#9915</a></p>
<p>Before:</p>
<pre><code>0: while evaluating the attribute 'python311.pythonForBuild.pkgs'
0x600001522598
</code></pre>
<p>After:</p>
<pre><code>0: while evaluating the attribute 'python311.pythonForBuild.pkgs'
/nix/store/hg65h51xnp74ikahns9hyf3py5mlbbqq-source/overrides/default.nix:132:27

   131|
   132|       bootstrappingBase = pkgs.${self.python.pythonAttr}.pythonForBuild.pkgs;
      |                           ^
   133|     in
</code></pre>
</li>
<li>
<p>Stack size is increased on macOS <a href="https://github.com/NixOS/nix/pull/9860">#9860</a></p>
<p>Previously, Nix would set the stack size to 64MiB on Linux, but would leave the
stack size set to the default (approximately 8KiB) on macOS. Now, the stack
size is correctly set to 64MiB on macOS as well, which should reduce stack
overflow segfaults in deeply-recursive Nix expressions.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-2200-2024-01-29"><a class="header" href="#release-2200-2024-01-29">Release 2.20.0 (2024-01-29)</a></h1>
<ul>
<li>
<p>Option <code>allowed-uris</code> can now match whole schemes in URIs without slashes <a href="https://github.com/NixOS/nix/pull/9547">#9547</a></p>
<p>If a scheme, such as <code>github:</code> is specified in the <code>allowed-uris</code> option, all URIs starting with <code>github:</code> are allowed.
Previously this only worked for schemes whose URIs used the <code>://</code> syntax.</p>
</li>
<li>
<p>Include cgroup stats when building through the daemon <a href="https://github.com/NixOS/nix/pull/9598">#9598</a></p>
<p>Nix now also reports cgroup statistics when building through the Nix daemon and when doing remote builds using <code>ssh-ng</code>,
if both sides of the connection are using Nix 2.20 or newer.</p>
</li>
<li>
<p>Disallow empty search regex in <code>nix search</code> <a href="https://github.com/NixOS/nix/pull/9481">#9481</a></p>
<p><a href="release-notes/../command-ref/new-cli/nix3-search.html"><code>nix search</code></a> now requires a search regex to be passed. To show all packages, use <code>^</code>.</p>
</li>
<li>
<p>Add new <code>eval-system</code> setting <a href="https://github.com/NixOS/nix/pull/4093">#4093</a></p>
<p>Add a new <code>eval-system</code> option.
Unlike <code>system</code>, it just overrides the value of <code>builtins.currentSystem</code>.
This is more useful than overriding <code>system</code>, because you can build these derivations on remote builders which can work on the given system.
In contrast, <code>system</code> also affects scheduling which will cause Nix to build those derivations locally even if that doesn't make sense.</p>
<p><code>eval-system</code> only takes effect if it is non-empty.
If empty (the default) <code>system</code> is used as before, so there is no breakage.</p>
</li>
<li>
<p>Import-from-derivation builds the derivation in the build store <a href="https://github.com/NixOS/nix/pull/9661">#9661</a></p>
<p>When using <code>--eval-store</code>, <code>import</code>ing from a derivation will now result in the derivation being built on the build store, i.e. the store specified in the <code>store</code> Nix option.</p>
<p>Because the resulting Nix expression must be copied back to the evaluation store in order to be imported, this requires the evaluation store to trust the build store's signatures.</p>
</li>
<li>
<p>Mounted SSH Store <a href="https://github.com/NixOS/nix/issues/7890">#7890</a> <a href="https://github.com/NixOS/nix/pull/7912">#7912</a></p>
<p>Introduced the store <a href="release-notes/../command-ref/new-cli/nix3-help-stores.html"><code>mounted-ssh-ng://</code></a>.
This store allows full access to a Nix store on a remote machine and additionally requires that the store be mounted in the local filesystem.</p>
</li>
<li>
<p>Rename <code>nix show-config</code> to <code>nix config show</code> <a href="https://github.com/NixOS/nix/issues/7672">#7672</a> <a href="https://github.com/NixOS/nix/pull/9477">#9477</a></p>
<p><code>nix show-config</code> was renamed to <code>nix config show</code>, and <code>nix doctor</code> was renamed to <code>nix config check</code>, to be more consistent with the rest of the command line interface.</p>
</li>
<li>
<p>Add command <code>nix hash convert</code> <a href="https://github.com/NixOS/nix/pull/9452">#9452</a></p>
<p>This replaces the old <code>nix hash to-*</code> commands, which are still available but will emit a deprecation warning. Please convert as follows:</p>
<ul>
<li><code>nix hash to-base16 $hash1 $hash2</code>: Use <code>nix hash convert --to base16 $hash1 $hash2</code> instead.</li>
<li><code>nix hash to-base32 $hash1 $hash2</code>: Use <code>nix hash convert --to nix32 $hash1 $hash2</code> instead.</li>
<li><code>nix hash to-base64 $hash1 $hash2</code>: Use <code>nix hash convert --to base64 $hash1 $hash2</code> instead.</li>
<li><code>nix hash to-sri $hash1 $hash2</code>: : Use <code>nix hash convert --to sri $hash1 $hash2</code> or even just <code>nix hash convert $hash1 $hash2</code> instead.</li>
</ul>
</li>
<li>
<p>Rename hash format <code>base32</code> to <code>nix32</code> <a href="https://github.com/NixOS/nix/pull/9452">#9452</a></p>
<p>Hash format <code>base32</code> was renamed to <code>nix32</code> since it used a special Nix-specific character set for
<a href="https://en.wikipedia.org/wiki/Base32">Base32</a>.</p>
</li>
<li>
<p><code>nix profile</code> now allows referring to elements by human-readable names <a href="https://github.com/NixOS/nix/pull/8678">#8678</a></p>
<p><a href="release-notes/../command-ref/new-cli/nix3-profile.html"><code>nix profile</code></a> now uses names to refer to installed packages when running <a href="release-notes/../command-ref/new-cli/nix3-profile-list.html"><code>list</code></a>, <a href="release-notes/../command-ref/new-cli/nix3-profile-remove.html"><code>remove</code></a> or <a href="release-notes/../command-ref/new-cli/nix3-profile-upgrade.html"><code>upgrade</code></a> as opposed to indices. Profile element names are generated when a package is installed and remain the same until the package is removed.</p>
<p><strong>Warning</strong>: The <code>manifest.nix</code> file used to record the contents of profiles has changed. Nix will automatically upgrade profiles to the new version when you modify the profile. After that, the profile can no longer be used by older versions of Nix.</p>
</li>
<li>
<p>Give <code>nix store add</code> a <code>--hash-algo</code> flag <a href="https://github.com/NixOS/nix/pull/9809">#9809</a></p>
<p>Adds a missing feature that was present in the old CLI, and matches our
plans to have similar flags for <code>nix hash convert</code> and <code>nix hash path</code>.</p>
</li>
<li>
<p>Coercion errors include the failing value</p>
<p>The <code>error: cannot coerce a &lt;TYPE&gt; to a string</code> message now includes the value
which caused the error.</p>
<p>Before:</p>
<pre><code>error: cannot coerce a set to a string
</code></pre>
<p>After:</p>
<pre><code>error: cannot coerce a set to a string: { aesSupport = «thunk»;
  avx2Support = «thunk»; avx512Support = «thunk»; avxSupport = «thunk»;
  canExecute = «thunk»; config = «thunk»; darwinArch = «thunk»; darwinMinVersion
  = «thunk»; darwinMinVersionVariable = «thunk»; darwinPlatform = «thunk»; «84
  attributes elided»}
</code></pre>
</li>
<li>
<p>Type errors include the failing value</p>
<p>In errors like <code>value is an integer while a list was expected</code>, the message now
includes the failing value.</p>
<p>Before:</p>
<pre><code>error: value is a set while a string was expected
</code></pre>
<p>After:</p>
<pre><code>error: expected a string but found a set: { ghc810 = «thunk»;
  ghc8102Binary = «thunk»; ghc8107 = «thunk»; ghc8107Binary = «thunk»;
  ghc865Binary = «thunk»; ghc90 = «thunk»; ghc902 = «thunk»; ghc92 = «thunk»;
  ghc924Binary = «thunk»; ghc925 = «thunk»;  «17 attributes elided»}
</code></pre>
</li>
<li>
<p>Source locations are printed more consistently in errors <a href="https://github.com/NixOS/nix/issues/561">#561</a> <a href="https://github.com/NixOS/nix/pull/9555">#9555</a></p>
<p>Source location information is now included in error messages more
consistently. Given this code:</p>
<pre><code class="language-nix">let
  attr = {foo = "bar";};
  key = {};
in
  attr.${key}
</code></pre>
<p>Previously, Nix would show this unhelpful message when attempting to evaluate
it:</p>
<pre><code>error:
       … while evaluating an attribute name

       error: value is a set while a string was expected
</code></pre>
<p>Now, the error message displays where the problematic value was found:</p>
<pre><code>error:
       … while evaluating an attribute name

         at bad.nix:4:11:

            3|   key = {};
            4| in attr.${key}
             |           ^
            5|

       error: expected a string but found a set
</code></pre>
</li>
<li>
<p>Some stack overflow segfaults are fixed <a href="https://github.com/NixOS/nix/issues/9616">#9616</a> <a href="https://github.com/NixOS/nix/pull/9617">#9617</a></p>
<p>The number of nested function calls has been restricted, to detect and report
infinite function call recursions. The default maximum call depth is 10,000 and
can be set with <a href="release-notes/../command-ref/conf-file.html#conf-max-call-depth">the <code>max-call-depth</code>
option</a>.</p>
<p>This replaces the <code>stack overflow (possible infinite recursion)</code> message.</p>
</li>
<li>
<p>Better error reporting for <code>with</code> expressions <a href="https://github.com/NixOS/nix/pull/9658">#9658</a></p>
<p><code>with</code> expressions using non-attrset values to resolve variables are now reported with proper positions, e.g.</p>
<pre><code>nix-repl&gt; with 1; a
error:
       … while evaluating the first subexpression of a with expression
         at «string»:1:1:
            1| with 1; a
             | ^

       error: expected a set but found an integer
</code></pre>
</li>
<li>
<p>Functions are printed with more detail <a href="https://github.com/NixOS/nix/issues/7145">#7145</a> <a href="https://github.com/NixOS/nix/pull/9606">#9606</a></p>
<p><code>nix repl</code>, <code>nix eval</code>, <code>builtins.trace</code>, and most other places values are
printed will now include function names and source location information:</p>
<pre><code>$ nix repl nixpkgs
nix-repl&gt; builtins.map
«primop map»

nix-repl&gt; builtins.map lib.id
«partially applied primop map»

nix-repl&gt; builtins.trace lib.id "my-value"
trace: «lambda id @ /nix/store/8rrzq23h2zq7sv5l2vhw44kls5w0f654-source/lib/trivial.nix:26:5»
"my-value"
</code></pre>
</li>
<li>
<p>Flake operations like <code>nix develop</code> will no longer fail when run in a Git
repository where the <code>flake.lock</code> file is <code>.gitignore</code>d
<a href="https://github.com/NixOS/nix/issues/8854">#8854</a>
<a href="https://github.com/NixOS/nix/pull/9324">#9324</a></p>
</li>
<li>
<p>Nix commands will now respect Ctrl-C
<a href="https://github.com/NixOS/nix/issues/7145">#7145</a>
<a href="https://github.com/NixOS/nix/pull/6995">#6995</a>
<a href="https://github.com/NixOS/nix/pull/9687">#9687</a></p>
<p>Previously, many Nix commands would hang indefinitely if Ctrl-C was pressed
while performing various operations (including <code>nix develop</code>, <code>nix flake update</code>, and so on). With several fixes to Nix's signal handlers, Nix
commands will now exit quickly after Ctrl-C is pressed.</p>
</li>
<li>
<p><code>nix copy</code> to a <code>ssh-ng</code> store now needs <code>--substitute-on-destination</code> (a.k.a. <code>-s</code>)
in order to substitute paths on the remote store instead of copying them.
The behavior is consistent with <code>nix copy</code> to a different kind of remote store.
Previously this behavior was controlled by the
<code>builders-use-substitutes</code> setting and <code>--substitute-on-destination</code> was ignored.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-219-2023-11-17"><a class="header" href="#release-219-2023-11-17">Release 2.19 (2023-11-17)</a></h1>
<ul>
<li>
<p>The experimental <code>nix</code> command can now act as a <a href="release-notes/../command-ref/new-cli/nix.html#shebang-interpreter">shebang interpreter</a>
by appending the contents of any <code>#! nix</code> lines and the script's location into a single call.</p>
</li>
<li>
<p><a href="release-notes/../command-ref/new-cli/nix3-flake.html#flake-references">URL flake references</a> now support <a href="https://datatracker.ietf.org/doc/html/rfc3986#section-2.1">percent-encoded</a> characters.</p>
</li>
<li>
<p><a href="release-notes/../command-ref/new-cli/nix3-flake.html#path-like-syntax">Path-like flake references</a> now accept arbitrary unicode characters (except <code>#</code> and <code>?</code>).</p>
</li>
<li>
<p>The experimental feature <code>repl-flake</code> is no longer needed, as its functionality is now part of the <code>flakes</code> experimental feature. To get the previous behavior, use the <code>--file/--expr</code> flags accordingly.</p>
</li>
<li>
<p>There is a new flake installable syntax <code>flakeref#.attrPath</code> where the "." prefix specifies that <code>attrPath</code> is interpreted from the root of the flake outputs, with no searching of default attribute prefixes like <code>packages.&lt;SYSTEM&gt;</code> or <code>legacyPackages.&lt;SYSTEM&gt;</code>.</p>
</li>
<li>
<p>Nix adds <code>apple-virt</code> to the default system features on macOS systems that support virtualization. This is similar to what's done for the <code>kvm</code> system feature on Linux hosts.</p>
</li>
<li>
<p>Add a new built-in function <a href="release-notes/../language/builtins.html#builtins-convertHash"><code>builtins.convertHash</code></a>.</p>
</li>
<li>
<p><code>nix-shell</code> shebang lines now support single-quoted arguments.</p>
</li>
<li>
<p><code>builtins.fetchTree</code> is now its own experimental feature, <a href="release-notes/../development/experimental-features.html#xp-fetch-tree"><code>fetch-tree</code></a>.
This allows stabilising it independently of the rest of what is encompassed by <a href="release-notes/../development/experimental-features.html#xp-fetch-tree"><code>flakes</code></a>.</p>
</li>
<li>
<p>The interface for creating and updating lock files has been overhauled:</p>
<ul>
<li>
<p><a href="release-notes/../command-ref/new-cli/nix3-flake-lock.html"><code>nix flake lock</code></a> only creates lock files and adds missing inputs now.
It will <em>never</em> update existing inputs.</p>
</li>
<li>
<p><a href="release-notes/../command-ref/new-cli/nix3-flake-update.html"><code>nix flake update</code></a> does the same, but <em>will</em> update inputs.</p>
<ul>
<li>Passing no arguments will update all inputs of the current flake, just like it already did.</li>
<li>Passing input names as arguments will ensure only those are updated. This replaces the functionality of <code>nix flake lock --update-input</code></li>
<li>To operate on a flake outside the current directory, you must now pass <code>--flake path/to/flake</code>.</li>
</ul>
</li>
<li>
<p>The flake-specific flags <code>--recreate-lock-file</code> and <code>--update-input</code> have been removed from all commands operating on installables.
They are superceded by <code>nix flake update</code>.</p>
</li>
</ul>
</li>
<li>
<p>Commit signature verification for the <a href="release-notes/../language/builtins.html#builtins-fetchGit"><code>builtins.fetchGit</code></a> is added as the new <a href="release-notes/../development/experimental-features.html#xp-feature-verified-fetches"><code>verified-fetches</code> experimental feature</a>.</p>
</li>
<li>
<p><a href="release-notes/../command-ref/new-cli/nix3-path-info.html"><code>nix path-info --json</code></a>
(experimental) now returns a JSON map rather than JSON list.
The <code>path</code> field of each object has instead become the key in the outer map, since it is unique.
The <code>valid</code> field also goes away because we just use <code>null</code> instead.</p>
<ul>
<li>
<p>Old way:</p>
<pre><code class="language-json5">[
  {
    "path": "/nix/store/8fv91097mbh5049i9rglc73dx6kjg3qk-bash-5.2-p15",
    "valid": true,
    // ...
  },
  {
    "path": "/nix/store/wffw7l0alvs3iw94cbgi1gmmbmw99sqb-home-manager-path",
    "valid": false
  }
]
</code></pre>
</li>
<li>
<p>New way</p>
<pre><code class="language-json5">{
  "/nix/store/8fv91097mbh5049i9rglc73dx6kjg3qk-bash-5.2-p15": {
    // ...
  },
  "/nix/store/wffw7l0alvs3iw94cbgi1gmmbmw99sqb-home-manager-path": null,
}
</code></pre>
</li>
</ul>
<p>This makes it match <code>nix derivation show</code>, which also maps store paths to information.</p>
</li>
<li>
<p>When Nix is installed using the <a href="release-notes/../installation/installing-binary.html">binary installer</a>, in supported shells (Bash, Zsh, Fish)
<a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html#variables"><code>XDG_DATA_DIRS</code></a> is now populated with the path to the <code>/share</code> subdirectory of the current profile.
This means that command completion scripts, <code>.desktop</code> files, and similar artifacts installed via <a href="release-notes/../command-ref/nix-env.html"><code>nix-env</code></a> or <a href="release-notes/../command-ref/new-cli/nix3-profile.html"><code>nix profile</code></a>
(experimental) can be found by any program that follows the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
</li>
<li>
<p>A new command <code>nix store add</code> has been added. It replaces <code>nix store add-file</code> and <code>nix store add-path</code> which are now deprecated.</p>
</li>
<li>
<p>A new option <a href="release-notes/../command-ref/conf-file.html#conf-always-allow-substitutes"><code>always-allow-substitutes</code></a> has been added.</p>
<p>When set to <code>true</code>, Nix will always try to substitute a derivation, even if it has the <a href="release-notes/rl-2.19.html#adv-attr-allowSubstitutes" id="adv-attr-allowSubstitutes"><code>allowSubstitutes</code></a> attribute set to <code>false</code>.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-218-2023-09-20"><a class="header" href="#release-218-2023-09-20">Release 2.18 (2023-09-20)</a></h1>
<ul>
<li>
<p>Two new builtin functions,
<a href="release-notes/../language/builtins.html#builtins-parseFlakeRef"><code>builtins.parseFlakeRef</code></a>
and
<a href="release-notes/../language/builtins.html#builtins-flakeRefToString"><code>builtins.flakeRefToString</code></a>,
have been added.
These functions are useful for converting between flake references encoded as attribute sets and URLs.</p>
</li>
<li>
<p><a href="release-notes/../language/builtins.html#builtins-parseFlakeRef"><code>builtins.toJSON</code></a> now prints <a href="release-notes/../command-ref/conf-file.html#conf-show-trace">--show-trace</a> items for the path in which it finds an evaluation error.</p>
</li>
<li>
<p>Error messages regarding malformed input to <a href="release-notes/../command-ref/new-cli/nix3-derivation-add.html"><code>nix derivation add</code></a> are now clearer and more detailed.</p>
</li>
<li>
<p>The <code>discard-references</code> feature has been stabilized.
This means that the
<a href="release-notes/../development/experimental-features.html#xp-feature-discard-references">unsafeDiscardReferences</a>
attribute is no longer guarded by an experimental flag and can be used
freely.</p>
</li>
<li>
<p>The JSON output for derived paths which are store paths is now a string, not an object with a single <code>path</code> field.
This only affects <code>nix-build --json</code> when "building" non-derivation things like fetched sources, which is a no-op.</p>
</li>
<li>
<p>A new builtin <a href="release-notes/../language/builtins.html#builtins-outputOf"><code>outputOf</code></a> has been added.
It is part of the <a href="release-notes/../development/experimental-features.html#xp-feature-dynamic-derivations"><code>dynamic-derivations</code></a> experimental feature.</p>
</li>
<li>
<p>Flake follow paths at depths greater than 2 are now handled correctly, preventing "follows a non-existent input" errors.</p>
</li>
<li>
<p><a href="release-notes/../command-ref/nix-store/query.html"><code>nix-store --query</code></a> gained a new type of query: <code>--valid-derivers</code>. It returns all <code>.drv</code> files in the local store that <em>can be</em> used to build the output passed in argument. This is in contrast to <code>--deriver</code>, which returns the single <code>.drv</code> file that <em>was actually</em> used to build the output passed in argument. In case the output was substituted from a binary cache, this <code>.drv</code> file may only exist on said binary cache and not locally.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-217-2023-07-24"><a class="header" href="#release-217-2023-07-24">Release 2.17 (2023-07-24)</a></h1>
<ul>
<li>
<p><a href="release-notes/../command-ref/nix-channel.html"><code>nix-channel</code></a> now supports a <code>--list-generations</code> subcommand.</p>
</li>
<li>
<p>The function <a href="release-notes/../language/builtins.html#builtins-fetchClosure"><code>builtins.fetchClosure</code></a> can now fetch input-addressed paths in <a href="release-notes/../command-ref/conf-file.html#conf-pure-eval">pure evaluation mode</a>, as those are not impure.</p>
</li>
<li>
<p>Nix now allows unprivileged/<a href="release-notes/../command-ref/conf-file.html#conf-allowed-users"><code>allowed-users</code></a> to sign paths.
Previously, only <a href="release-notes/../command-ref/conf-file.html#conf-trusted-users"><code>trusted-users</code></a> users could sign paths.</p>
</li>
<li>
<p>Nested dynamic attributes are now merged correctly by the parser. For example:</p>
<pre><code class="language-nix">{
  nested = {
    foo = 1;
  };
  nested = {
    ${"ba" + "r"} = 2;
  };
}
</code></pre>
<p>This used to silently discard <code>nested.bar</code>, but now behaves as one would expect and evaluates to:</p>
<pre><code class="language-nix">{ nested = { bar = 2; foo = 1; }; }
</code></pre>
<p>Note that the feature of merging multiple <em>full declarations</em> of attribute sets like <code>nested</code> in the example is of questionable value.
It allows writing expressions that are very hard to read, for instance when there are many lines of code between two declarations of the same attribute.
This has been around for a long time and is therefore supported for backwards compatibility, but should not be relied upon.</p>
<p>Instead, consider using the <em>nested attribute path</em> syntax:</p>
<pre><code class="language-nix">{
  nested.foo = 1;
  nested.${"ba" + "r"} = 2;
}
</code></pre>
</li>
<li>
<p>Tarball flakes can now redirect to an "immutable" URL that will be recorded in lock files. This allows the use of "mutable" tarball URLs like <code>https://example.org/hello/latest.tar.gz</code> in flakes. See the <a href="release-notes/../protocols/tarball-fetcher.html">tarball fetcher</a> for details.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-216-2023-05-31"><a class="header" href="#release-216-2023-05-31">Release 2.16 (2023-05-31)</a></h1>
<ul>
<li>
<p>Speed-up of downloads from binary caches.
The number of parallel downloads (also known as substitutions) has been separated from the <a href="release-notes/../command-ref/conf-file.html#conf-max-jobs"><code>--max-jobs</code> setting</a>.
The new setting is called <a href="release-notes/../command-ref/conf-file.html#conf-max-substitution-jobs"><code>max-substitution-jobs</code></a>.
The number of parallel downloads is now set to 16 by default (previously, the default was 1 due to the coupling to build jobs).</p>
</li>
<li>
<p>The function <a href="release-notes/../language/builtins.html#builtins-replaceStrings"><code>builtins.replaceStrings</code></a> is now lazy in the value of its second argument <code>to</code>. That is, <code>to</code> is only evaluated when its corresponding pattern in <code>from</code> is matched in the string <code>s</code>.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-215-2023-04-11"><a class="header" href="#release-215-2023-04-11">Release 2.15 (2023-04-11)</a></h1>
<ul>
<li>
<p>Commands which take installables on the command line can now read them from the standard input if
passed the <code>--stdin</code> flag. This is primarily useful when you have a large amount of paths which
exceed the OS argument limit.</p>
</li>
<li>
<p>The <code>nix-hash</code> command now supports Base64 and SRI. Use the flags <code>--base64</code>
or <code>--sri</code> to specify the format of output hash as Base64 or SRI, and <code>--to-base64</code>
or <code>--to-sri</code> to convert a hash to Base64 or SRI format, respectively.</p>
<p>As the choice of hash formats is no longer binary, the <code>--base16</code> flag is also added
to explicitly specify the Base16 format, which is still the default.</p>
</li>
<li>
<p>The special handling of an <a href="release-notes/../command-ref/new-cli/nix.html#installables">installable</a> with <code>.drv</code> suffix being interpreted as all of the given <a href="release-notes/../glossary.html#gloss-store-derivation">store derivation</a>'s output paths is removed, and instead taken as the literal store path that it represents.</p>
<p>The new <code>^</code> syntax for store paths introduced in Nix 2.13 allows explicitly referencing output paths of a derivation.
Using this is better and more clear than relying on the now-removed <code>.drv</code> special handling.</p>
<p>For example,</p>
<pre><code class="language-shell-session">$ nix path-info /nix/store/gzaflydcr6sb3567hap9q6srzx8ggdgg-glibc-2.33-78.drv
</code></pre>
<p>now gives info about the derivation itself, while</p>
<pre><code class="language-shell-session">$ nix path-info /nix/store/gzaflydcr6sb3567hap9q6srzx8ggdgg-glibc-2.33-78.drv^*
</code></pre>
<p>provides information about each of its outputs.</p>
</li>
<li>
<p>The experimental command <code>nix describe-stores</code> has been removed.</p>
</li>
<li>
<p>Nix stores and their settings are now documented in <a href="release-notes/../command-ref/new-cli/nix3-help-stores.html"><code>nix help-stores</code></a>.</p>
</li>
<li>
<p>Documentation for operations of <code>nix-store</code> and <code>nix-env</code> are now available on separate pages of the manual.
They include all common options that can be specified and common environment variables that affect these commands.</p>
<p>These pages can be viewed offline with <code>man</code> using</p>
<ul>
<li><code>man nix-store-&lt;operation&gt;</code> and <code>man nix-env-&lt;operation&gt;</code></li>
<li><code>nix-store --help --&lt;operation&gt;</code> and <code>nix-env --help --&lt;operation&gt;</code>.</li>
</ul>
</li>
<li>
<p>Nix when used as a client now checks whether the store (the server) trusts the client.
(The store always had to check whether it trusts the client, but now the client is informed of the store's decision.)
This is useful for scripting interactions with (non-legacy-ssh) remote Nix stores.</p>
<p><code>nix store ping</code> and <code>nix doctor</code> now display this information.</p>
</li>
<li>
<p>The new command <code>nix derivation add</code> allows adding derivations to the store without involving the Nix language.
It exists to round out our collection of basic utility/plumbing commands, and allow for a low barrier-to-entry way of experimenting with alternative front-ends to the Nix Store.
It uses the same JSON layout as <code>nix derivation show</code>, and is its inverse.</p>
</li>
<li>
<p><code>nix show-derivation</code> has been renamed to <code>nix derivation show</code>.
This matches <code>nix derivation add</code>, and avoids bloating the top-level namespace.
The old name is still kept as an alias for compatibility, however.</p>
</li>
<li>
<p>The <code>nix derivation {add,show}</code> JSON format now includes the derivation name as a top-level field.
This is useful in general, but especially necessary for the <code>add</code> direction, as otherwise we would need to pass in the name out of band for certain cases.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-214-2023-02-28"><a class="header" href="#release-214-2023-02-28">Release 2.14 (2023-02-28)</a></h1>
<ul>
<li>
<p>A new function <code>builtins.readFileType</code> is available. It is similar to
<code>builtins.readDir</code> but acts on a single file or directory.</p>
</li>
<li>
<p>In flakes, the <code>.outPath</code> attribute of a flake now always refers to
the directory containing the <code>flake.nix</code>. This was not the case for
when <code>flake.nix</code> was in a subdirectory of e.g. a Git repository.
The root of the source of a flake in a subdirectory is still
available in <code>.sourceInfo.outPath</code>.</p>
</li>
<li>
<p>In derivations that use structured attributes, you can now use <code>unsafeDiscardReferences</code>
to disable scanning a given output for runtime dependencies:</p>
<pre><code class="language-nix">__structuredAttrs = true;
unsafeDiscardReferences.out = true;
</code></pre>
<p>This is useful e.g. when generating self-contained filesystem images with
their own embedded Nix store: hashes found inside such an image refer
to the embedded store and not to the host's Nix store.</p>
<p>This requires the <code>discard-references</code> experimental feature.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-213-2023-01-17"><a class="header" href="#release-213-2023-01-17">Release 2.13 (2023-01-17)</a></h1>
<ul>
<li>
<p>The <code>repeat</code> and <code>enforce-determinism</code> options have been removed
since they had been broken under many circumstances for a long time.</p>
</li>
<li>
<p>You can now use <a href="release-notes/../command-ref/new-cli/nix3-flake.html#flake-references">flake references</a> in the <a href="release-notes/../command-ref/main-commands.html">old command line interface</a>, e.g.</p>
<pre><code class="language-shell-session"># nix-build flake:nixpkgs -A hello
# nix-build -I nixpkgs=flake:github:NixOS/nixpkgs/nixos-22.05 \
    '&lt;nixpkgs&gt;' -A hello
# NIX_PATH=nixpkgs=flake:nixpkgs nix-build '&lt;nixpkgs&gt;' -A hello
</code></pre>
</li>
<li>
<p>Instead of "antiquotation", the more common term <a href="release-notes/../language/string-interpolation.html">string interpolation</a> is now used consistently.
Historical release notes were not changed.</p>
</li>
<li>
<p>Error traces have been reworked to provide detailed explanations and more
accurate error locations. A short excerpt of the trace is now shown by
default when an error occurs.</p>
</li>
<li>
<p>Allow explicitly selecting outputs in a store derivation installable, just like we can do with other sorts of installables.
For example,</p>
<pre><code class="language-shell-session"># nix build /nix/store/gzaflydcr6sb3567hap9q6srzx8ggdgg-glibc-2.33-78.drv^dev
</code></pre>
<p>now works just as</p>
<pre><code class="language-shell-session"># nix build nixpkgs#glibc^dev
</code></pre>
<p>does already.</p>
</li>
<li>
<p>On Linux, <code>nix develop</code> now sets the
<a href="https://man7.org/linux/man-pages/man2/personality.2.html"><em>personality</em></a>
for the development shell in the same way as the actual build of the
derivation. This makes shells for <code>i686-linux</code> derivations work
correctly on <code>x86_64-linux</code>.</p>
</li>
<li>
<p>You can now disable the global flake registry by setting the <code>flake-registry</code>
configuration option to an empty string. The same can be achieved at runtime with
<code>--flake-registry ""</code>.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-212-2022-12-06"><a class="header" href="#release-212-2022-12-06">Release 2.12 (2022-12-06)</a></h1>
<ul>
<li>
<p>On Linux, Nix can now run builds in a user namespace where they run
as root (UID 0) and have 65,536 UIDs available.
This is primarily useful for running containers such as <code>systemd-nspawn</code>
inside a Nix build. For an example, see <a href="https://github.com/NixOS/nix/blob/67bcb99700a0da1395fa063d7c6586740b304598/tests/systemd-nspawn.nix."><code>tests/systemd-nspawn/nix</code></a>.</p>
<p>A build can enable this by setting the derivation attribute:</p>
<pre><code>requiredSystemFeatures = [ "uid-range" ];
</code></pre>
<p>The <code>uid-range</code> <a href="release-notes/../command-ref/conf-file.html#conf-system-features">system feature</a> requires the <a href="release-notes/../command-ref/conf-file.html#conf-auto-allocate-uids"><code>auto-allocate-uids</code></a>
setting to be enabled.</p>
</li>
<li>
<p>Nix can now automatically pick UIDs for builds, removing the need to
create <code>nixbld*</code> user accounts. See <a href="release-notes/../command-ref/conf-file.html#conf-auto-allocate-uids"><code>auto-allocate-uids</code></a>.</p>
</li>
<li>
<p>On Linux, Nix has experimental support for running builds inside a
cgroup. See
<a href="release-notes/../command-ref/conf-file.html#conf-use-cgroups"><code>use-cgroups</code></a>.</p>
</li>
<li>
<p><code>&lt;nix/fetchurl.nix&gt;</code> now accepts an additional argument <code>impure</code> which
defaults to <code>false</code>.  If it is set to <code>true</code>, the <code>hash</code> and <code>sha256</code>
arguments will be ignored and the resulting derivation will have
<code>__impure</code> set to <code>true</code>, making it an impure derivation.</p>
</li>
<li>
<p>If <code>builtins.readFile</code> is called on a file with context, then only
the parts of the context that appear in the content of the file are
retained.  This avoids a lot of spurious errors where strings end up
having a context just because they are read from a store path
(<a href="https://github.com/NixOS/nix/pull/7260">#7260</a>).</p>
</li>
<li>
<p><code>nix build --json</code> now prints some statistics about top-level
derivations, such as CPU statistics when cgroups are enabled.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-211-2022-08-24"><a class="header" href="#release-211-2022-08-24">Release 2.11 (2022-08-24)</a></h1>
<ul>
<li><code>nix copy</code> now copies the store paths in parallel as much as possible (again).
This doesn't apply for the <code>daemon</code> and <code>ssh-ng</code> stores which copy everything
in one batch to avoid latencies issues.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-210-2022-07-11"><a class="header" href="#release-210-2022-07-11">Release 2.10 (2022-07-11)</a></h1>
<ul>
<li>
<p><code>nix repl</code> now takes installables on the command line, unifying the usage
with other commands that use <code>--file</code> and <code>--expr</code>. Primary breaking change
is for the common usage of <code>nix repl '&lt;nixpkgs&gt;'</code> which can be recovered with
<code>nix repl --file '&lt;nixpkgs&gt;'</code> or <code>nix repl --expr 'import &lt;nixpkgs&gt;{}'</code>.</p>
<p>This is currently guarded by the <code>repl-flake</code> experimental feature.</p>
</li>
<li>
<p>A new function <code>builtins.traceVerbose</code> is available. It is similar
to <code>builtins.trace</code> if the <code>trace-verbose</code> setting is set to true,
and it is a no-op otherwise.</p>
</li>
<li>
<p><code>nix search</code> has a new flag <code>--exclude</code> to filter out packages.</p>
</li>
<li>
<p>On Linux, if <code>/nix</code> doesn't exist and cannot be created and you're
not running as root, Nix will automatically use
<code>~/.local/share/nix/root</code> as a chroot store. This enables non-root
users to download the statically linked Nix binary and have it work
out of the box, e.g.</p>
<pre><code># ~/nix run nixpkgs#hello
warning: '/nix' does not exists, so Nix will use '/home/ubuntu/.local/share/nix/root' as a chroot store
Hello, world!
</code></pre>
</li>
<li>
<p><code>flake-registry.json</code> is now fetched from <code>channels.nixos.org</code>.</p>
</li>
<li>
<p>Nix can now be built with LTO by passing <code>--enable-lto</code> to <code>configure</code>.
LTO is currently only supported when building with GCC.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-29-2022-05-30"><a class="header" href="#release-29-2022-05-30">Release 2.9 (2022-05-30)</a></h1>
<ul>
<li>
<p>Running Nix with the new <code>--debugger</code> flag will cause it to start a
repl session if an exception is thrown during evaluation, or if
<code>builtins.break</code> is called.  From there you can inspect the values
of variables and evaluate Nix expressions.  In debug mode, the
following new repl commands are available:</p>
<pre><code>:env          Show env stack
:bt           Show trace stack
:st           Show current trace
:st &lt;idx&gt;     Change to another trace in the stack
:c            Go until end of program, exception, or builtins.break().
:s            Go one step
</code></pre>
<p>Read more about the debugger
<a href="https://www.zknotes.com/note/5970">here</a>.</p>
</li>
<li>
<p>Nix now provides better integration with zsh's <code>run-help</code>
feature. It is now included in the Nix installation in the form of
an autoloadable shell function, <code>run-help-nix</code>. It picks up Nix
subcommands from the currently typed in command and directs the user
to the associated man pages.</p>
</li>
<li>
<p><code>nix repl</code> has a new build-and-link (<code>:bl</code>) command that builds a
derivation while creating GC root symlinks.</p>
</li>
<li>
<p>The path produced by <code>builtins.toFile</code> is now allowed to be imported
or read even with restricted evaluation. Note that this will not
work with a read-only store.</p>
</li>
<li>
<p><code>nix build</code> has a new <code>--print-out-paths</code> flag to print the
resulting output paths.  This matches the default behaviour of
<code>nix-build</code>.</p>
</li>
<li>
<p>You can now specify which outputs of a derivation <code>nix</code> should
operate on using the syntax <code>installable^outputs</code>,
e.g. <code>nixpkgs#glibc^dev,static</code> or <code>nixpkgs#glibc^*</code>. By default,
<code>nix</code> will use the outputs specified by the derivation's
<code>meta.outputsToInstall</code> attribute if it exists, or all outputs
otherwise.</p>
</li>
<li>
<p><code>builtins.fetchTree</code> (and flake inputs) can now be used to fetch
plain files over the <code>http(s)</code> and <code>file</code> protocols in addition to
directory tarballs.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-28-2022-04-19"><a class="header" href="#release-28-2022-04-19">Release 2.8 (2022-04-19)</a></h1>
<ul>
<li>
<p>New experimental command: <code>nix fmt</code>, which applies a formatter
defined by the <code>formatter.&lt;system&gt;</code> flake output to the Nix
expressions in a flake.</p>
</li>
<li>
<p>Various Nix commands can now read expressions from standard input
using <code>--file -</code>.</p>
</li>
<li>
<p>New experimental builtin function <code>builtins.fetchClosure</code> that
copies a closure from a binary cache at evaluation time and rewrites
it to content-addressed form (if it isn't already). Like
<code>builtins.storePath</code>, this allows importing pre-built store paths;
the difference is that it doesn't require the user to configure
binary caches and trusted public keys.</p>
<p>This function is only available if you enable the experimental
feature <code>fetch-closure</code>.</p>
</li>
<li>
<p>New experimental feature: <em>impure derivations</em>. These are
derivations that can produce a different result every time they're
built. Here is an example:</p>
<pre><code class="language-nix">stdenv.mkDerivation {
  name = "impure";
  __impure = true; # marks this derivation as impure
  buildCommand = "date &gt; $out";
}
</code></pre>
<p>Running <code>nix build</code> twice on this expression will build the
derivation twice, producing two different content-addressed store
paths. Like fixed-output derivations, impure derivations have access
to the network. Only fixed-output derivations and impure derivations
can depend on an impure derivation.</p>
</li>
<li>
<p><code>nix store make-content-addressable</code> has been renamed to <code>nix store make-content-addressed</code>.</p>
</li>
<li>
<p>The <code>nixosModule</code> flake output attribute has been renamed consistent
with the <code>.default</code> renames in Nix 2.7.</p>
<ul>
<li><code>nixosModule</code> → <code>nixosModules.default</code></li>
</ul>
<p>As before, the old output will continue to work, but <code>nix flake check</code> will
issue a warning about it.</p>
</li>
<li>
<p><code>nix run</code> is now stricter in what it accepts: members of the <code>apps</code>
flake output are now required to be apps (as defined in <a href="https://nixos.org/manual/nix/stable/command-ref/new-cli/nix3-run.html#apps">the
manual</a>),
and members of <code>packages</code> or <code>legacyPackages</code> must be derivations
(not apps).</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-27-2022-03-07"><a class="header" href="#release-27-2022-03-07">Release 2.7 (2022-03-07)</a></h1>
<ul>
<li>
<p>Nix will now make some helpful suggestions when you mistype
something on the command line. For instance, if you type <code>nix build nixpkgs#thunderbrd</code>, it will suggest <code>thunderbird</code>.</p>
</li>
<li>
<p>A number of "default" flake output attributes have been
renamed. These are:</p>
<ul>
<li><code>defaultPackage.&lt;system&gt;</code> → <code>packages.&lt;system&gt;.default</code></li>
<li><code>defaultApps.&lt;system&gt;</code> → <code>apps.&lt;system&gt;.default</code></li>
<li><code>defaultTemplate</code> → <code>templates.default</code></li>
<li><code>defaultBundler.&lt;system&gt;</code> → <code>bundlers.&lt;system&gt;.default</code></li>
<li><code>overlay</code> → <code>overlays.default</code></li>
<li><code>devShell.&lt;system&gt;</code> → <code>devShells.&lt;system&gt;.default</code></li>
</ul>
<p>The old flake output attributes still work, but <code>nix flake check</code>
will warn about them.</p>
</li>
<li>
<p>Breaking API change: <code>nix bundle</code> now supports bundlers of the form
<code>bundler.&lt;system&gt;.&lt;name&gt;= derivation: another-derivation;</code>. This
supports additional functionality to inspect evaluation information
during bundling. A new
<a href="https://github.com/NixOS/bundlers">repository</a> has various bundlers
implemented.</p>
</li>
<li>
<p><code>nix store ping</code> now reports the version of the remote Nix daemon.</p>
</li>
<li>
<p><code>nix flake {init,new}</code> now display information about which files have been
created.</p>
</li>
<li>
<p>Templates can now define a <code>welcomeText</code> attribute, which is printed out by
<code>nix flake {init,new} --template &lt;template&gt;</code>.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-26-2022-01-24"><a class="header" href="#release-26-2022-01-24">Release 2.6 (2022-01-24)</a></h1>
<ul>
<li>The Nix CLI now searches for a <code>flake.nix</code> up until the root of the current
Git repository or a filesystem boundary rather than just in the current
directory.</li>
<li>The TOML parser used by <code>builtins.fromTOML</code> has been replaced by <a href="https://github.com/ToruNiina/toml11">a
more compliant one</a>.</li>
<li>Added <code>:st</code>/<code>:show-trace</code> commands to <code>nix repl</code>, which are used to
set or toggle display of error traces.</li>
<li>New builtin function <code>builtins.zipAttrsWith</code> with the same
functionality as <code>lib.zipAttrsWith</code> from Nixpkgs, but much more
efficient.</li>
<li>New command <code>nix store copy-log</code> to copy build logs from one store
to another.</li>
<li>The <code>commit-lockfile-summary</code> option can be set to a non-empty
string to override the commit summary used when commiting an updated
lockfile.  This may be used in conjunction with the <code>nixConfig</code>
attribute in <code>flake.nix</code> to better conform to repository
conventions.</li>
<li><code>docker run -ti nixos/nix:master</code> will place you in the Docker
container with the latest version of Nix from the <code>master</code> branch.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-25-2021-12-13"><a class="header" href="#release-25-2021-12-13">Release 2.5 (2021-12-13)</a></h1>
<ul>
<li>
<p>The garbage collector no longer blocks new builds, so the message
<code>waiting for the big garbage collector lock...</code> is a thing of the
past.</p>
</li>
<li>
<p>Binary cache stores now have a setting <code>compression-level</code>.</p>
</li>
<li>
<p><code>nix develop</code> now has a flag <code>--unpack</code> to run <code>unpackPhase</code>.</p>
</li>
<li>
<p>Lists can now be compared lexicographically using the <code>&lt;</code> operator.</p>
</li>
<li>
<p>New built-in function: <code>builtins.groupBy</code>, with the same functionality as
Nixpkgs' <code>lib.groupBy</code>, but faster.</p>
</li>
<li>
<p><code>nix repl</code> now has a <code>:log</code> command.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-24-2021-11-01"><a class="header" href="#release-24-2021-11-01">Release 2.4 (2021-11-01)</a></h1>
<p>This is the first release in more than two years and is the result of
more than 2800 commits from 195 contributors since release 2.3.</p>
<h2 id="highlights"><a class="header" href="#highlights">Highlights</a></h2>
<ul>
<li>
<p>Nix's <strong>error messages</strong> have been improved a lot. For instance,
evaluation errors now point out the location of the error:</p>
<pre><code>$ nix build
error: undefined variable 'bzip3'

       at /nix/store/449lv242z0zsgwv95a8124xi11sp419f-source/flake.nix:88:13:

           87|           [ curl
           88|             bzip3 xz brotli editline
             |             ^
           89|             openssl sqlite
</code></pre>
</li>
<li>
<p>The <strong><code>nix</code> command</strong> has seen a lot of work and is now almost at
feature parity with the old command-line interface (the <code>nix-*</code>
commands). It aims to be <a href="release-notes/../development/cli-guideline.html">more modern, consistent and pleasant to
use</a> than the old CLI. It is still
marked as experimental but its interface should not change much
anymore in future releases.</p>
</li>
<li>
<p><strong>Flakes</strong> are a new format to package Nix-based projects in a more
discoverable, composable, consistent and reproducible way. A flake
is just a repository or tarball containing a file named <code>flake.nix</code>
that specifies dependencies on other flakes and returns any Nix
assets such as packages, Nixpkgs overlays, NixOS modules or CI
tests. The new <code>nix</code> CLI is primarily based around flakes; for
example, a command like <code>nix run nixpkgs#hello</code> runs the <code>hello</code>
application from the <code>nixpkgs</code> flake.</p>
<p>Flakes are currently marked as experimental. For an introduction,
see <a href="https://www.tweag.io/blog/2020-05-25-flakes/">this blog
post</a>. For detailed
information about flake syntax and semantics, see the <a href="release-notes/../command-ref/new-cli/nix3-flake.html"><code>nix flake</code>
manual page</a>.</p>
</li>
<li>
<p>Nix's store can now be <strong>content-addressed</strong>, meaning that the hash
component of a store path is the hash of the path's
contents. Previously Nix could only build <strong>input-addressed</strong> store
paths, where the hash is computed from the derivation dependency
graph. Content-addressing allows deduplication, early cutoff in
build systems, and unprivileged closure copying. This is still <a href="https://discourse.nixos.org/t/content-addressed-nix-call-for-testers/12881">an
experimental
feature</a>.</p>
</li>
<li>
<p>The Nix manual has been converted into Markdown, making it easier to
contribute. In addition, every <code>nix</code> subcommand now has a manual
page, documenting every option.</p>
</li>
<li>
<p>A new setting that allows <strong>experimental features</strong> to be enabled
selectively. This allows us to merge unstable features into Nix more
quickly and do more frequent releases.</p>
</li>
</ul>
<h2 id="other-features"><a class="header" href="#other-features">Other features</a></h2>
<ul>
<li>
<p>There are many new <code>nix</code> subcommands:</p>
<ul>
<li>
<p><code>nix develop</code> is intended to replace <code>nix-shell</code>. It has a number
of new features:</p>
<ul>
<li>
<p>It automatically sets the output environment variables (such as
<code>$out</code>) to writable locations (such as <code>./outputs/out</code>).</p>
</li>
<li>
<p>It can store the environment in a profile. This is useful for
offline work.</p>
</li>
<li>
<p>It can run specific phases directly. For instance, <code>nix develop --build</code> runs <code>buildPhase</code>.</p>
</li>
</ul>
<ul>
<li>It allows dependencies in the Nix store to be "redirected" to
arbitrary directories using the <code>--redirect</code> flag. This is
useful if you want to hack on a package <em>and</em> some of its
dependencies at the same time.</li>
</ul>
</li>
<li>
<p><code>nix print-dev-env</code> prints the environment variables and bash
functions defined by a derivation. This is useful for users of
other shells than bash (especially with <code>--json</code>).</p>
</li>
<li>
<p><code>nix shell</code> was previously named <code>nix run</code> and is intended to
replace <code>nix-shell -p</code>, but without the <code>stdenv</code> overhead. It
simply starts a shell where some packages have been added to
<code>$PATH</code>.</p>
</li>
<li>
<p><code>nix run</code> (not to be confused with the old subcommand that has
been renamed to <code>nix shell</code>) runs an "app", a flake output that
specifies a command to run, or an eponymous program from a
package. For example, <code>nix run nixpkgs#hello</code> runs the <code>hello</code>
program from the <code>hello</code> package in <code>nixpkgs</code>.</p>
</li>
<li>
<p><code>nix flake</code> is the container for flake-related operations, such as
creating a new flake, querying the contents of a flake or updating
flake lock files.</p>
</li>
<li>
<p><code>nix registry</code> allows you to query and update the flake registry,
which maps identifiers such as <code>nixpkgs</code> to concrete flake URLs.</p>
</li>
<li>
<p><code>nix profile</code> is intended to replace <code>nix-env</code>. Its main advantage
is that it keeps track of the provenance of installed packages
(e.g. exactly which flake version a package came from). It also
has some helpful subcommands:</p>
<ul>
<li>
<p><code>nix profile history</code> shows what packages were added, upgraded
or removed between each version of a profile.</p>
</li>
<li>
<p><code>nix profile diff-closures</code> shows the changes between the
closures of each version of a profile. This allows you to
discover the addition or removal of dependencies or size
changes.</p>
</li>
</ul>
<p><strong>Warning</strong>: after a profile has been updated using <code>nix profile</code>,
it is no longer usable with <code>nix-env</code>.</p>
</li>
<li>
<p><code>nix store diff-closures</code> shows the differences between the
closures of two store paths in terms of the versions and sizes of
dependencies in the closures.</p>
</li>
<li>
<p><code>nix store make-content-addressable</code> rewrites an arbitrary closure
to make it content-addressed. Such paths can be copied into other
stores without requiring signatures.</p>
</li>
<li>
<p><code>nix bundle</code> uses the <a href="https://github.com/matthewbauer/nix-bundle"><code>nix-bundle</code>
program</a> to convert a
closure into a self-extracting executable.</p>
</li>
<li>
<p>Various other replacements for the old CLI, e.g. <code>nix store gc</code>,
<code>nix store delete</code>, <code>nix store repair</code>, <code>nix nar dump-path</code>, <code>nix store prefetch-file</code>, <code>nix store prefetch-tarball</code>, <code>nix key</code> and
<code>nix daemon</code>.</p>
</li>
</ul>
</li>
<li>
<p>Nix now has an <strong>evaluation cache</strong> for flake outputs. For example,
a second invocation of the command <code>nix run nixpkgs#firefox</code> will
not need to evaluate the <code>firefox</code> attribute because it's already in
the evaluation cache. This is made possible by the hermetic
evaluation model of flakes.</p>
<p>Intermediate results are not cached.</p>
</li>
<li>
<p>The new <code>--offline</code> flag disables substituters and causes all
locally cached tarballs and repositories to be considered
up-to-date.</p>
</li>
<li>
<p>The new <code>--refresh</code> flag causes all locally cached tarballs and
repositories to be considered out-of-date.</p>
</li>
<li>
<p>Many <code>nix</code> subcommands now have a <code>--json</code> option to produce
machine-readable output.</p>
</li>
<li>
<p><code>nix repl</code> has a new <code>:doc</code> command to show documentation about
builtin functions (e.g. <code>:doc builtins.map</code>).</p>
</li>
<li>
<p>Binary cache stores now have an option <code>index-debug-info</code> to create
an index of DWARF debuginfo files for use by
<a href="https://github.com/edolstra/dwarffs"><code>dwarffs</code></a>.</p>
</li>
<li>
<p>To support flakes, Nix now has an extensible mechanism for fetching
source trees. Currently it has the following backends:</p>
<ul>
<li>
<p>Git repositories</p>
</li>
<li>
<p>Mercurial repositories</p>
</li>
<li>
<p>GitHub and GitLab repositories (an optimisation for faster
fetching than Git)</p>
</li>
<li>
<p>Tarballs</p>
</li>
<li>
<p>Arbitrary directories</p>
</li>
</ul>
<p>The fetcher infrastructure is exposed via flake input specifications
and via the <code>fetchTree</code> built-in.</p>
</li>
<li>
<p><strong>Languages changes</strong>: the only new language feature is that you can
now have antiquotations in paths, e.g. <code>./${foo}</code> instead of <code>./. + foo</code>.</p>
</li>
<li>
<p><strong>New built-in functions</strong>:</p>
<ul>
<li>
<p><code>builtins.fetchTree</code> allows fetching a source tree using any
backends supported by the fetcher infrastructure. It subsumes the
functionality of existing built-ins like <code>fetchGit</code>,
<code>fetchMercurial</code> and <code>fetchTarball</code>.</p>
</li>
<li>
<p><code>builtins.getFlake</code> fetches a flake and returns its output
attributes. This function should not be used inside flakes! Use
flake inputs instead.</p>
</li>
<li>
<p><code>builtins.floor</code> and <code>builtins.ceil</code> round a floating-point number
down and up, respectively.</p>
</li>
</ul>
</li>
<li>
<p>Experimental support for recursive Nix. This means that Nix
derivations can now call Nix to build other derivations. This is not
in a stable state yet and not well
<a href="https://github.com/NixOS/nix/commit/c4d7c76b641d82b2696fef73ce0ac160043c18da">documented</a>.</p>
</li>
<li>
<p>The new experimental feature <code>no-url-literals</code> disables URL
literals. This helps to implement <a href="https://github.com/NixOS/rfcs/pull/45">RFC
45</a>.</p>
</li>
<li>
<p>Nix now uses <code>libarchive</code> to decompress and unpack tarballs and zip
files, so <code>tar</code> is no longer required.</p>
</li>
<li>
<p>The priority of substituters can now be overridden using the
<code>priority</code> substituter setting (e.g. <code>--substituters 'http://cache.nixos.org?priority=100 daemon?priority=10'</code>).</p>
</li>
<li>
<p><code>nix edit</code> now supports non-derivation attributes, e.g. <code>nix edit .#nixosConfigurations.bla</code>.</p>
</li>
<li>
<p>The <code>nix</code> command now provides command line completion for <code>bash</code>,
<code>zsh</code> and <code>fish</code>. Since the support for getting completions is built
into <code>nix</code>, it's easy to add support for other shells.</p>
</li>
<li>
<p>The new <code>--log-format</code> flag selects what Nix's output looks like. It
defaults to a terse progress indicator. There is a new
<code>internal-json</code> output format for use by other programs.</p>
</li>
<li>
<p><code>nix eval</code> has a new <code>--apply</code> flag that applies a function to the
evaluation result.</p>
</li>
<li>
<p><code>nix eval</code> has a new <code>--write-to</code> flag that allows it to write a
nested attribute set of string leaves to a corresponding directory
tree.</p>
</li>
<li>
<p>Memory improvements: many operations that add paths to the store or
copy paths between stores now run in constant memory.</p>
</li>
<li>
<p>Many <code>nix</code> commands now support the flag <code>--derivation</code> to operate
on a <code>.drv</code> file itself instead of its outputs.</p>
</li>
<li>
<p>There is a new store called <code>dummy://</code> that does not support
building or adding paths. This is useful if you want to use the Nix
evaluator but don't have a Nix store.</p>
</li>
<li>
<p>The <code>ssh-ng://</code> store now allows substituting paths on the remote,
as <code>ssh://</code> already did.</p>
</li>
<li>
<p>When auto-calling a function with an ellipsis, all arguments are now
passed.</p>
</li>
<li>
<p>New <code>nix-shell</code> features:</p>
<ul>
<li>
<p>It preserves the <code>PS1</code> environment variable if
<code>NIX_SHELL_PRESERVE_PROMPT</code> is set.</p>
</li>
<li>
<p>With <code>-p</code>, it passes any <code>--arg</code>s as Nixpkgs arguments.</p>
</li>
<li>
<p>Support for structured attributes.</p>
</li>
</ul>
</li>
<li>
<p><code>nix-prefetch-url</code> has a new <code>--executable</code> flag.</p>
</li>
<li>
<p>On <code>x86_64</code> systems, <a href="https://lwn.net/Articles/844831/"><code>x86_64</code> microarchitecture
levels</a> are mapped to additional
system types (e.g. <code>x86_64-v1-linux</code>).</p>
</li>
<li>
<p>The new <code>--eval-store</code> flag allows you to use a different store for
evaluation than for building or storing the build result. This is
primarily useful when you want to query whether something exists in
a read-only store, such as a binary cache:</p>
<pre><code># nix path-info --json --store https://cache.nixos.org \
  --eval-store auto nixpkgs#hello
</code></pre>
<p>(Here <code>auto</code> indicates the local store.)</p>
</li>
<li>
<p>The Nix daemon has a new low-latency mechanism for copying
closures. This is useful when building on remote stores such as
<code>ssh-ng://</code>.</p>
</li>
<li>
<p>Plugins can now register <code>nix</code> subcommands.</p>
</li>
<li>
<p>The <code>--indirect</code> flag to <code>nix-store --add-root</code> has become a no-op.
<code>--add-root</code> will always generate indirect GC roots from now on.</p>
</li>
</ul>
<h2 id="incompatible-changes"><a class="header" href="#incompatible-changes">Incompatible changes</a></h2>
<ul>
<li>
<p>The <code>nix</code> command is now marked as an experimental feature. This
means that you need to add</p>
<pre><code>experimental-features = nix-command
</code></pre>
<p>to your <code>nix.conf</code> if you want to use it, or pass
<code>--extra-experimental-features nix-command</code> on the command line.</p>
</li>
<li>
<p>The <code>nix</code> command no longer has a syntax for referring to packages
in a channel. This means that the following no longer works:</p>
<pre><code class="language-console">nix build nixpkgs.hello # Nix 2.3
</code></pre>
<p>Instead, you can either use the <code>#</code> syntax to select a package from
a flake, e.g.</p>
<pre><code class="language-console">nix build nixpkgs#hello
</code></pre>
<p>Or, if you want to use the <code>nixpkgs</code> channel in the <code>NIX_PATH</code>
environment variable:</p>
<pre><code class="language-console">nix build -f '&lt;nixpkgs&gt;' hello
</code></pre>
</li>
<li>
<p>The old <code>nix run</code> has been renamed to <code>nix shell</code>, while there is a
new <code>nix run</code> that runs a default command. So instead of</p>
<pre><code class="language-console">nix run nixpkgs.hello -c hello # Nix 2.3
</code></pre>
<p>you should use</p>
<pre><code class="language-console">nix shell nixpkgs#hello -c hello
</code></pre>
<p>or just</p>
<pre><code class="language-console">nix run nixpkgs#hello
</code></pre>
<p>if the command you want to run has the same name as the package.</p>
</li>
<li>
<p>It is now an error to modify the <code>plugin-files</code> setting via a
command-line flag that appears after the first non-flag argument to
any command, including a subcommand to <code>nix</code>. For example,
<code>nix-instantiate default.nix --plugin-files ""</code> must now become
<code>nix-instantiate --plugin-files "" default.nix</code>.</p>
</li>
<li>
<p>We no longer release source tarballs. If you want to build from
source, please build from the tags in the Git repository.</p>
</li>
</ul>
<h2 id="contributors-5"><a class="header" href="#contributors-5">Contributors</a></h2>
<p>This release has contributions from
Adam Höse,
Albert Safin,
Alex Kovar,
Alex Zero,
Alexander Bantyev,
Alexandre Esteves,
Alyssa Ross,
Anatole Lucet,
Anders Kaseorg,
Andreas Rammhold,
Antoine Eiche,
Antoine Martin,
Arnout Engelen,
Arthur Gautier,
aszlig,
Ben Burdette,
Benjamin Hipple,
Bernardo Meurer,
Björn Gohla,
Bjørn Forsman,
Bob van der Linden,
Brian Leung,
Brian McKenna,
Brian Wignall,
Bruce Toll,
Bryan Richter,
Calle Rosenquist,
Calvin Loncaric,
Carlo Nucera,
Carlos D'Agostino,
Chaz Schlarp,
Christian Höppner,
Christian Kampka,
Chua Hou,
Chuck,
Cole Helbling,
Daiderd Jordan,
Dan Callahan,
Dani,
Daniel Fitzpatrick,
Danila Fedorin,
Daniël de Kok,
Danny Bautista,
DavHau,
David McFarland,
Dima,
Domen Kožar,
Dominik Schrempf,
Dominique Martinet,
dramforever,
Dustin DeWeese,
edef,
Eelco Dolstra,
Ellie Hermaszewska,
Emilio Karakey,
Emily,
Eric Culp,
Ersin Akinci,
Fabian Möller,
Farid Zakaria,
Federico Pellegrin,
Finn Behrens,
Florian Franzen,
Félix Baylac-Jacqué,
Gabriella Gonzalez,
Geoff Reedy,
Georges Dubus,
Graham Christensen,
Greg Hale,
Greg Price,
Gregor Kleen,
Gregory Hale,
Griffin Smith,
Guillaume Bouchard,
Harald van Dijk,
illustris,
Ivan Zvonimir Horvat,
Jade,
Jake Waksbaum,
jakobrs,
James Ottaway,
Jan Tojnar,
Janne Heß,
Jaroslavas Pocepko,
Jarrett Keifer,
Jeremy Schlatter,
Joachim Breitner,
Joe Pea,
John Ericson,
Jonathan Ringer,
Josef Kemetmüller,
Joseph Lucas,
Jude Taylor,
Julian Stecklina,
Julien Tanguy,
Jörg Thalheim,
Kai Wohlfahrt,
keke,
Keshav Kini,
Kevin Quick,
Kevin Stock,
Kjetil Orbekk,
Krzysztof Gogolewski,
kvtb,
Lars Mühmel,
Leonhard Markert,
Lily Ballard,
Linus Heckemann,
Lorenzo Manacorda,
Lucas Desgouilles,
Lucas Franceschino,
Lucas Hoffmann,
Luke Granger-Brown,
Madeline Haraj,
Marwan Aljubeh,
Mat Marini,
Mateusz Piotrowski,
Matthew Bauer,
Matthew Kenigsberg,
Mauricio Scheffer,
Maximilian Bosch,
Michael Adler,
Michael Bishop,
Michael Fellinger,
Michael Forney,
Michael Reilly,
mlatus,
Mykola Orliuk,
Nathan van Doorn,
Naïm Favier,
ng0,
Nick Van den Broeck,
Nicolas Stig124 Formichella,
Niels Egberts,
Niklas Hambüchen,
Nikola Knezevic,
oxalica,
p01arst0rm,
Pamplemousse,
Patrick Hilhorst,
Paul Opiyo,
Pavol Rusnak,
Peter Kolloch,
Philipp Bartsch,
Philipp Middendorf,
Piotr Szubiakowski,
Profpatsch,
Puck Meerburg,
Ricardo M. Correia,
Rickard Nilsson,
Robert Hensing,
Robin Gloster,
Rodrigo,
Rok Garbas,
Ronnie Ebrin,
Rovanion Luckey,
Ryan Burns,
Ryan Mulligan,
Ryne Everett,
Sam Doshi,
Sam Lidder,
Samir Talwar,
Samuel Dionne-Riel,
Sebastian Ullrich,
Sergei Trofimovich,
Sevan Janiyan,
Shao Cheng,
Shea Levy,
Silvan Mosberger,
Stefan Frijters,
Stefan Jaax,
sternenseemann,
Steven Shaw,
Stéphan Kochen,
SuperSandro2000,
Suraj Barkale,
Taeer Bar-Yam,
Thomas Churchman,
Théophane Hufschmitt,
Timothy DeHerrera,
Timothy Klim,
Tobias Möst,
Tobias Pflug,
Tom Bereknyei,
Travis A. Everett,
Ujjwal Jain,
Vladimír Čunát,
Wil Taylor,
Will Dietz,
Yaroslav Bolyukin,
Yestin L. Harrison,
YI,
Yorick van Pelt,
Yuriy Taraday and
zimbatm.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-23-2019-09-04"><a class="header" href="#release-23-2019-09-04">Release 2.3 (2019-09-04)</a></h1>
<p>This is primarily a bug fix release. However, it makes some incompatible
changes:</p>
<ul>
<li>Nix now uses BSD file locks instead of POSIX file locks. Because of
this, you should not use Nix 2.3 and previous releases at the same
time on a Nix store.</li>
</ul>
<p>It also has the following changes:</p>
<ul>
<li>
<p><code>builtins.fetchGit</code>'s <code>ref</code> argument now allows specifying an
absolute remote ref. Nix will automatically prefix <code>ref</code> with
<code>refs/heads</code> only if <code>ref</code> doesn't already begin with <code>refs/</code>.</p>
</li>
<li>
<p>The installer now enables sandboxing by default on Linux when the
system has the necessary kernel support.</p>
</li>
<li>
<p>The <code>max-jobs</code> setting now defaults to 1.</p>
</li>
<li>
<p>New builtin functions: <code>builtins.isPath</code>, <code>builtins.hashFile</code>.</p>
</li>
<li>
<p>The <code>nix</code> command has a new <code>--print-build-logs</code> (<code>-L</code>) flag to
print build log output to stderr, rather than showing the last log
line in the progress bar. To distinguish between concurrent builds,
log lines are prefixed by the name of the package.</p>
</li>
<li>
<p>Builds are now executed in a pseudo-terminal, and the <code>TERM</code>
environment variable is set to <code>xterm-256color</code>. This allows many
programs (e.g. <code>gcc</code>, <code>clang</code>, <code>cmake</code>) to print colorized log
output.</p>
</li>
<li>
<p>Add <code>--no-net</code> convenience flag. This flag disables substituters;
sets the <code>tarball-ttl</code> setting to infinity (ensuring that any
previously downloaded files are considered current); and disables
retrying downloads and sets the connection timeout to the minimum.
This flag is enabled automatically if there are no configured
non-loopback network interfaces.</p>
</li>
<li>
<p>Add a <code>post-build-hook</code> setting to run a program after a build has
succeeded.</p>
</li>
<li>
<p>Add a <code>trace-function-calls</code> setting to log the duration of Nix
function calls to stderr.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-22-2019-01-11"><a class="header" href="#release-22-2019-01-11">Release 2.2 (2019-01-11)</a></h1>
<p>This is primarily a bug fix release. It also has the following changes:</p>
<ul>
<li>
<p>In derivations that use structured attributes (i.e. that specify set
the <code>__structuredAttrs</code> attribute to <code>true</code> to cause all attributes
to be passed to the builder in JSON format), you can now specify
closure checks per output, e.g.:</p>
<pre><code>outputChecks."out" = {
  # The closure of 'out' must not be larger than 256 MiB.
  maxClosureSize = 256 * 1024 * 1024;

  # It must not refer to C compiler or to the 'dev' output.
  disallowedRequisites = [ stdenv.cc "dev" ];
};

outputChecks."dev" = {
  # The 'dev' output must not be larger than 128 KiB.
  maxSize = 128 * 1024;
};
</code></pre>
</li>
<li>
<p>The derivation attribute <code>requiredSystemFeatures</code> is now enforced
for local builds, and not just to route builds to remote builders.
The supported features of a machine can be specified through the
configuration setting <code>system-features</code>.</p>
<p>By default, <code>system-features</code> includes <code>kvm</code> if <code>/dev/kvm</code> exists.
For compatibility, it also includes the pseudo-features
<code>nixos-test</code>, <code>benchmark</code> and <code>big-parallel</code> which are used by
Nixpkgs to route builds to particular Hydra build machines.</p>
</li>
<li>
<p>Sandbox builds are now enabled by default on Linux.</p>
</li>
<li>
<p>The new command <code>nix doctor</code> shows potential issues with your Nix
installation.</p>
</li>
<li>
<p>The <code>fetchGit</code> builtin function now uses a caching scheme that puts
different remote repositories in distinct local repositories, rather
than a single shared repository. This may require more disk space
but is faster.</p>
</li>
<li>
<p>The <code>dirOf</code> builtin function now works on relative paths.</p>
</li>
<li>
<p>Nix now supports <a href="https://www.w3.org/TR/SRI/">SRI hashes</a>, allowing
the hash algorithm and hash to be specified in a single string. For
example, you can write:</p>
<pre><code>import &lt;nix/fetchurl.nix&gt; {
  url = https://nixos.org/releases/nix/nix-2.1.3/nix-2.1.3.tar.xz;
  hash = "sha256-XSLa0FjVyADWWhFfkZ2iKTjFDda6mMXjoYMXLRSYQKQ=";
};
</code></pre>
<p>instead of</p>
<pre><code>import &lt;nix/fetchurl.nix&gt; {
  url = https://nixos.org/releases/nix/nix-2.1.3/nix-2.1.3.tar.xz;
  sha256 = "5d22dad058d5c800d65a115f919da22938c50dd6ba98c5e3a183172d149840a4";
};
</code></pre>
<p>In fixed-output derivations, the <code>outputHashAlgo</code> attribute is no
longer mandatory if <code>outputHash</code> specifies the hash.</p>
<p><code>nix hash-file</code> and <code>nix                 hash-path</code> now print hashes in SRI format by default. They also use
SHA-256 by default instead of SHA-512 because that's what we use
most of the time in Nixpkgs.</p>
</li>
<li>
<p>Integers are now 64 bits on all platforms.</p>
</li>
<li>
<p>The evaluator now prints profiling statistics (enabled via the
<code>NIX_SHOW_STATS</code> and <code>NIX_COUNT_CALLS</code> environment variables) in
JSON format.</p>
</li>
<li>
<p>The option <code>--xml</code> in <code>nix-store                 --query</code> has been removed. Instead, there now is an option
<code>--graphml</code> to output the dependency graph in GraphML format.</p>
</li>
<li>
<p>All <code>nix-*</code> commands are now symlinks to <code>nix</code>. This saves a bit of
disk space.</p>
</li>
<li>
<p><code>nix repl</code> now uses <code>libeditline</code> or <code>libreadline</code>.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-21-2018-09-02"><a class="header" href="#release-21-2018-09-02">Release 2.1 (2018-09-02)</a></h1>
<p>This is primarily a bug fix release. It also reduces memory consumption
in certain situations. In addition, it has the following new features:</p>
<ul>
<li>
<p>The Nix installer will no longer default to the Multi-User
installation for macOS. You can still instruct the installer to
run in multi-user mode.</p>
</li>
<li>
<p>The Nix installer now supports performing a Multi-User
installation for Linux computers which are running systemd. You
can select a Multi-User installation by passing the <code>--daemon</code>
flag to the installer: <code>sh &lt;(curl -L https://nixos.org/nix/install) --daemon</code>.</p>
<p>The multi-user installer cannot handle systems with SELinux. If
your system has SELinux enabled, you can force the installer to
run in single-user mode.</p>
</li>
<li>
<p>New builtin functions: <code>builtins.bitAnd</code>, <code>builtins.bitOr</code>,
<code>builtins.bitXor</code>, <code>builtins.fromTOML</code>, <code>builtins.concatMap</code>,
<code>builtins.mapAttrs</code>.</p>
</li>
<li>
<p>The S3 binary cache store now supports uploading NARs larger than 5
GiB.</p>
</li>
<li>
<p>The S3 binary cache store now supports uploading to S3-compatible
services with the <code>endpoint</code> option.</p>
</li>
<li>
<p>The flag <code>--fallback</code> is no longer required to recover from
disappeared NARs in binary caches.</p>
</li>
<li>
<p><code>nix-daemon</code> now respects <code>--store</code>.</p>
</li>
<li>
<p><code>nix run</code> now respects <code>nix-support/propagated-user-env-packages</code>.</p>
</li>
</ul>
<p>This release has contributions from Adrien Devresse, Aleksandr Pashkov,
Alexandre Esteves, Amine Chikhaoui, Andrew Dunham, Asad Saeeduddin,
aszlig, Ben Challenor, Ben Gamari, Benjamin Hipple, Bogdan Seniuc, Corey
O'Connor, Daiderd Jordan, Daniel Peebles, Daniel Poelzleithner, Danylo
Hlynskyi, Dmitry Kalinkin, Domen Kožar, Doug Beardsley, Eelco Dolstra,
Erik Arvstedt, Félix Baylac-Jacqué, Gleb Peregud, Graham Christensen,
Guillaume Maudoux, Ivan Kozik, John Arnold, Justin Humm, Linus
Heckemann, Lorenzo Manacorda, Matthew Justin Bauer, Matthew O'Gorman,
Maximilian Bosch, Michael Bishop, Michael Fiano, Michael Mercier,
Michael Raskin, Michael Weiss, Nicolas Dudebout, Peter Simons, Ryan
Trinkle, Samuel Dionne-Riel, Sean Seefried, Shea Levy, Symphorien Gibol,
Tim Engler, Tim Sears, Tuomas Tynkkynen, volth, Will Dietz, Yorick van
Pelt and zimbatm.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-20-2018-02-22"><a class="header" href="#release-20-2018-02-22">Release 2.0 (2018-02-22)</a></h1>
<p>The following incompatible changes have been made:</p>
<ul>
<li>
<p>The manifest-based substituter mechanism
(<code>download-using-manifests</code>) has been
<a href="https://github.com/NixOS/nix/commit/867967265b80946dfe1db72d40324b4f9af988ed">removed</a>.
It has been superseded by the binary cache substituter mechanism
since several years. As a result, the following programs have been
removed:</p>
<ul>
<li>
<p><code>nix-pull</code></p>
</li>
<li>
<p><code>nix-generate-patches</code></p>
</li>
<li>
<p><code>bsdiff</code></p>
</li>
<li>
<p><code>bspatch</code></p>
</li>
</ul>
</li>
<li>
<p>The “copy from other stores” substituter mechanism
(<code>copy-from-other-stores</code> and the <code>NIX_OTHER_STORES</code> environment
variable) has been removed. It was primarily used by the NixOS
installer to copy available paths from the installation medium. The
replacement is to use a chroot store as a substituter (e.g.
<code>--substituters /mnt</code>), or to build into a chroot store (e.g.
<code>--store /mnt --substituters /</code>).</p>
</li>
<li>
<p>The command <code>nix-push</code> has been removed as part of the effort to
eliminate Nix's dependency on Perl. You can use <code>nix copy</code> instead,
e.g. <code>nix copy                 --to file:///tmp/my-binary-cache paths…</code></p>
</li>
<li>
<p>The “nested” log output feature (<code>--log-type                 pretty</code>) has been removed. As a result, <code>nix-log2xml</code> was also
removed.</p>
</li>
<li>
<p>OpenSSL-based signing has been
<a href="https://github.com/NixOS/nix/commit/f435f8247553656774dd1b2c88e9de5d59cab203">removed</a>.
This feature was never well-supported. A better alternative is
provided by the <code>secret-key-files</code> and <code>trusted-public-keys</code>
options.</p>
</li>
<li>
<p>Failed build caching has been
<a href="https://github.com/NixOS/nix/commit/8cffec84859cec8b610a2a22ab0c4d462a9351ff">removed</a>.
This feature was introduced to support the Hydra continuous build
system, but Hydra no longer uses it.</p>
</li>
<li>
<p><code>nix-mode.el</code> has been removed from Nix. It is now <a href="https://github.com/NixOS/nix-mode">a separate
repository</a> and can be installed
through the MELPA package repository.</p>
</li>
</ul>
<p>This release has the following new features:</p>
<ul>
<li>
<p>It introduces a new command named <code>nix</code>, which is intended to
eventually replace all <code>nix-*</code> commands with a more consistent and
better designed user interface. It currently provides replacements
for some (but not all) of the functionality provided by <code>nix-store</code>,
<code>nix-build</code>, <code>nix-shell -p</code>, <code>nix-env -qa</code>, <code>nix-instantiate --eval</code>, <code>nix-push</code> and <code>nix-copy-closure</code>. It has the following
major features:</p>
<ul>
<li>
<p>Unlike the legacy commands, it has a consistent way to refer to
packages and package-like arguments (like store paths). For
example, the following commands all copy the GNU Hello package
to a remote machine:</p>
<pre><code>nix copy --to ssh://machine nixpkgs.hello

nix copy --to ssh://machine /nix/store/0i2jd68mp5g6h2sa5k9c85rb80sn8hi9-hello-2.10

nix copy --to ssh://machine '(with import &lt;nixpkgs&gt; {}; hello)'
</code></pre>
<p>By contrast, <code>nix-copy-closure</code> only accepted store paths as
arguments.</p>
</li>
<li>
<p>It is self-documenting: <code>--help</code> shows all available
command-line arguments. If <code>--help</code> is given after a subcommand,
it shows examples for that subcommand. <code>nix                                                                 --help-config</code> shows all configuration options.</p>
</li>
<li>
<p>It is much less verbose. By default, it displays a single-line
progress indicator that shows how many packages are left to be
built or downloaded, and (if there are running builds) the most
recent line of builder output. If a build fails, it shows the
last few lines of builder output. The full build log can be
retrieved using <code>nix                                                                 log</code>.</p>
</li>
<li>
<p>It
<a href="https://github.com/NixOS/nix/commit/b8283773bd64d7da6859ed520ee19867742a03ba">provides</a>
all <code>nix.conf</code> configuration options as command line flags. For
example, instead of <code>--option                                                                 http-connections 100</code> you can write <code>--http-connections 100</code>.
Boolean options can be written as <code>--foo</code> or <code>--no-foo</code> (e.g.
<code>--no-auto-optimise-store</code>).</p>
</li>
<li>
<p>Many subcommands have a <code>--json</code> flag to write results to stdout
in JSON format.</p>
</li>
</ul>
<blockquote>
<p><strong>Warning</strong></p>
<p>Please note that the <code>nix</code> command is a work in progress and the
interface is subject to change.</p>
</blockquote>
<p>It provides the following high-level (“porcelain”) subcommands:</p>
<ul>
<li>
<p><code>nix build</code> is a replacement for <code>nix-build</code>.</p>
</li>
<li>
<p><code>nix run</code> executes a command in an environment in which the
specified packages are available. It is (roughly) a replacement
for <code>nix-shell                                                                 -p</code>. Unlike that command, it does not execute the command in a
shell, and has a flag (<code>-c</code>) that specifies the unquoted command
line to be executed.</p>
<p>It is particularly useful in conjunction with chroot stores,
allowing Linux users who do not have permission to install Nix
in <code>/nix/store</code> to still use binary substitutes that assume
<code>/nix/store</code>. For example,</p>
<pre><code>nix run --store ~/my-nix nixpkgs.hello -c hello --greeting 'Hi everybody!'
</code></pre>
<p>downloads (or if not substitutes are available, builds) the GNU
Hello package into <code>~/my-nix/nix/store</code>, then runs <code>hello</code> in a
mount namespace where <code>~/my-nix/nix/store</code> is mounted onto
<code>/nix/store</code>.</p>
</li>
<li>
<p><code>nix search</code> replaces <code>nix-env                                                                 -qa</code>. It searches the available packages for occurrences of a
search string in the attribute name, package name or
description. Unlike <code>nix-env -qa</code>, it has a cache to speed up
subsequent searches.</p>
</li>
<li>
<p><code>nix copy</code> copies paths between arbitrary Nix stores,
generalising <code>nix-copy-closure</code> and <code>nix-push</code>.</p>
</li>
<li>
<p><code>nix repl</code> replaces the external program <code>nix-repl</code>. It provides
an interactive environment for evaluating and building Nix
expressions. Note that it uses <code>linenoise-ng</code> instead of GNU
Readline.</p>
</li>
<li>
<p><code>nix upgrade-nix</code> upgrades Nix to the latest stable version.
This requires that Nix is installed in a profile. (Thus it won’t
work on NixOS, or if it’s installed outside of the Nix store.)</p>
</li>
<li>
<p><code>nix verify</code> checks whether store paths are unmodified and/or
“trusted” (see below). It replaces <code>nix-store --verify</code> and
<code>nix-store                                                                 --verify-path</code>.</p>
</li>
<li>
<p><code>nix log</code> shows the build log of a package or path. If the
build log is not available locally, it will try to obtain it
from the configured substituters (such as
<a href="https://cache.nixos.org/">cache.nixos.org</a>, which now
provides build logs).</p>
</li>
<li>
<p><code>nix edit</code> opens the source code of a package in your editor.</p>
</li>
<li>
<p><code>nix eval</code> replaces <code>nix-instantiate --eval</code>.</p>
</li>
<li>
<p><code>nix                                                                 why-depends</code> shows why one store path has another in its
closure. This is primarily useful to finding the causes of
closure bloat. For example,</p>
<pre><code>nix why-depends nixpkgs.vlc nixpkgs.libdrm.dev
</code></pre>
<p>shows a chain of files and fragments of file contents that cause
the VLC package to have the “dev” output of <code>libdrm</code> in its
closure — an undesirable situation.</p>
</li>
<li>
<p><code>nix path-info</code> shows information about store paths, replacing
<code>nix-store -q</code>. A useful feature is the option <code>--closure-size</code>
(<code>-S</code>). For example, the following command show the closure
sizes of every path in the current NixOS system closure, sorted
by size:</p>
<pre><code>nix path-info -rS /run/current-system | sort -nk2
</code></pre>
</li>
<li>
<p><code>nix optimise-store</code> replaces <code>nix-store --optimise</code>. The main
difference is that it has a progress indicator.</p>
</li>
</ul>
<p>A number of low-level (“plumbing”) commands are also available:</p>
<ul>
<li>
<p><code>nix ls-store</code> and <code>nix                                                                 ls-nar</code> list the contents of a store path or NAR file. The
former is primarily useful in conjunction with remote stores,
e.g.</p>
<pre><code>nix ls-store --store https://cache.nixos.org/ -lR /nix/store/0i2jd68mp5g6h2sa5k9c85rb80sn8hi9-hello-2.10
</code></pre>
<p>lists the contents of path in a binary cache.</p>
</li>
<li>
<p><code>nix cat-store</code> and <code>nix                                                                 cat-nar</code> allow extracting a file from a store path or NAR file.</p>
</li>
<li>
<p><code>nix dump-path</code> writes the contents of a store path to stdout in
NAR format. This replaces <code>nix-store --dump</code>.</p>
</li>
<li>
<p><code>nix                                                                 show-derivation</code> displays a store derivation in JSON format.
This is an alternative to <code>pp-aterm</code>.</p>
</li>
<li>
<p><code>nix                                                                 add-to-store</code> replaces <code>nix-store                                                                 --add</code>.</p>
</li>
<li>
<p><code>nix sign-paths</code> signs store paths.</p>
</li>
<li>
<p><code>nix copy-sigs</code> copies signatures from one store to another.</p>
</li>
<li>
<p><code>nix show-config</code> shows all configuration options and their
current values.</p>
</li>
</ul>
</li>
<li>
<p>The store abstraction that Nix has had for a long time to support
store access via the Nix daemon has been extended
significantly. In particular, substituters (which used to be
external programs such as <code>download-from-binary-cache</code>) are now
subclasses of the abstract <code>Store</code> class. This allows many Nix
commands to operate on such store types. For example, <code>nix path-info</code> shows information about paths in your local Nix store,
while <code>nix path-info --store https://cache.nixos.org/</code> shows
information about paths in the specified binary cache. Similarly,
<code>nix-copy-closure</code>, <code>nix-push</code> and substitution are all instances
of the general notion of copying paths between different kinds of
Nix stores.</p>
<p>Stores are specified using an URI-like syntax, e.g.
<a href="https://cache.nixos.org/">https://cache.nixos.org/</a> or <a href="ssh://machine">ssh://machine</a>. The following store
types are supported:</p>
<ul>
<li>
<p><code>LocalStore</code> (stori URI <code>local</code> or an absolute path) and the
misnamed <code>RemoteStore</code> (<code>daemon</code>) provide access to a local Nix
store, the latter via the Nix daemon. You can use <code>auto</code> or the
empty string to auto-select a local or daemon store depending on
whether you have write permission to the Nix store. It is no
longer necessary to set the <code>NIX_REMOTE</code> environment variable to
use the Nix daemon.</p>
<p>As noted above, <code>LocalStore</code> now supports chroot builds,
allowing the “physical” location of the Nix store (e.g.
<code>/home/alice/nix/store</code>) to differ from its “logical” location
(typically <code>/nix/store</code>). This allows non-root users to use Nix
while still getting the benefits from prebuilt binaries from
<a href="https://cache.nixos.org/">cache.nixos.org</a>.</p>
</li>
<li>
<p><code>BinaryCacheStore</code> is the abstract superclass of all binary
cache stores. It supports writing build logs and NAR content
listings in JSON format.</p>
</li>
<li>
<p><code>HttpBinaryCacheStore</code> (<code>http://</code>, <code>https://</code>) supports binary
caches via HTTP or HTTPS. If the server supports <code>PUT</code> requests,
it supports uploading store paths via commands such as <code>nix                                                                 copy</code>.</p>
</li>
<li>
<p><code>LocalBinaryCacheStore</code> (<code>file://</code>) supports binary caches in
the local filesystem.</p>
</li>
<li>
<p><code>S3BinaryCacheStore</code> (<code>s3://</code>) supports binary caches stored in
Amazon S3, if enabled at compile time.</p>
</li>
<li>
<p><code>LegacySSHStore</code> (<code>ssh://</code>) is used to implement remote builds
and <code>nix-copy-closure</code>.</p>
</li>
<li>
<p><code>SSHStore</code> (<code>ssh-ng://</code>) supports arbitrary Nix operations on a
remote machine via the same protocol used by <code>nix-daemon</code>.</p>
</li>
</ul>
</li>
<li>
<p>Security has been improved in various ways:</p>
<ul>
<li>
<p>Nix now stores signatures for local store paths. When paths are
copied between stores (e.g., copied from a binary cache to a
local store), signatures are propagated.</p>
<p>Locally-built paths are signed automatically using the secret
keys specified by the <code>secret-key-files</code> store option.
Secret/public key pairs can be generated using <code>nix-store                                                                 --generate-binary-cache-key</code>.</p>
<p>In addition, locally-built store paths are marked as “ultimately
trusted”, but this bit is not propagated when paths are copied
between stores.</p>
</li>
<li>
<p>Content-addressable store paths no longer require signatures —
they can be imported into a store by unprivileged users even if
they lack signatures.</p>
</li>
<li>
<p>The command <code>nix verify</code> checks whether the specified paths are
trusted, i.e., have a certain number of trusted signatures, are
ultimately trusted, or are content-addressed.</p>
</li>
<li>
<p>Substitutions from binary caches
<a href="https://github.com/NixOS/nix/commit/ecbc3fedd3d5bdc5a0e1a0a51b29062f2874ac8b">now</a>
require signatures by default. This was already the case on
NixOS.</p>
</li>
<li>
<p>In Linux sandbox builds, we
<a href="https://github.com/NixOS/nix/commit/eba840c8a13b465ace90172ff76a0db2899ab11b">now</a>
use <code>/build</code> instead of <code>/tmp</code> as the temporary build directory.
This fixes potential security problems when a build accidentally
stores its <code>TMPDIR</code> in some security-sensitive place, such as an
RPATH.</p>
</li>
</ul>
</li>
<li>
<p><em>Pure evaluation mode</em>. With the <code>--pure-eval</code> flag, Nix enables a
variant of the existing restricted evaluation mode that forbids
access to anything that could cause different evaluations of the
same command line arguments to produce a different result. This
includes builtin functions such as <code>builtins.getEnv</code>, but more
importantly, <em>all</em> filesystem or network access unless a content
hash or commit hash is specified. For example, calls to
<code>builtins.fetchGit</code> are only allowed if a <code>rev</code> attribute is
specified.</p>
<p>The goal of this feature is to enable true reproducibility and
traceability of builds (including NixOS system configurations) at
the evaluation level. For example, in the future, <code>nixos-rebuild</code>
might build configurations from a Nix expression in a Git repository
in pure mode. That expression might fetch other repositories such as
Nixpkgs via <code>builtins.fetchGit</code>. The commit hash of the top-level
repository then uniquely identifies a running system, and, in
conjunction with that repository, allows it to be reproduced or
modified.</p>
</li>
<li>
<p>There are several new features to support binary reproducibility
(i.e. to help ensure that multiple builds of the same derivation
produce exactly the same output). When <code>enforce-determinism</code> is set
to <code>false</code>, it’s <a href="https://github.com/NixOS/nix/commit/8bdf83f936adae6f2c907a6d2541e80d4120f051">no
longer</a>
a fatal error if build rounds produce different output. Also, a hook
named <code>diff-hook</code> is
<a href="https://github.com/NixOS/nix/commit/9a313469a4bdea2d1e8df24d16289dc2a172a169">provided</a>
to allow you to run tools such as <code>diffoscope</code> when build rounds
produce different output.</p>
</li>
<li>
<p>Configuring remote builds is a lot easier now. Provided you are not
using the Nix daemon, you can now just specify a remote build
machine on the command line, e.g. <code>--option builders                 'ssh://my-mac x86_64-darwin'</code>. The environment variable
<code>NIX_BUILD_HOOK</code> has been removed and is no longer needed. The
environment variable <code>NIX_REMOTE_SYSTEMS</code> is still supported for
compatibility, but it is also possible to specify builders in
<code>nix.conf</code> by setting the option <code>builders =                 @path</code>.</p>
</li>
<li>
<p>If a fixed-output derivation produces a result with an incorrect
hash, the output path is moved to the location corresponding to the
actual hash and registered as valid. Thus, a subsequent build of the
fixed-output derivation with the correct hash is unnecessary.</p>
</li>
<li>
<p><code>nix-shell</code>
<a href="https://github.com/NixOS/nix/commit/ea59f39326c8e9dc42dfed4bcbf597fbce58797c">now</a>
sets the <code>IN_NIX_SHELL</code> environment variable during evaluation and
in the shell itself. This can be used to perform different actions
depending on whether you’re in a Nix shell or in a regular build.
Nixpkgs provides <code>lib.inNixShell</code> to check this variable during
evaluation.</p>
</li>
<li>
<p><code>NIX_PATH</code> is now lazy, so URIs in the path are only downloaded if
they are needed for evaluation.</p>
</li>
<li>
<p>You can now use <code>channel:</code> as a short-hand for
<a href="https://nixos.org/channels//nixexprs.tar.xz">https://nixos.org/channels//nixexprs.tar.xz</a>. For example,
<code>nix-build channel:nixos-15.09 -A hello</code> will build the GNU Hello
package from the <code>nixos-15.09</code> channel. In the future, this may
use Git to fetch updates more efficiently.</p>
</li>
<li>
<p>When <code>--no-build-output</code> is given, the last 10 lines of the build
log will be shown if a build fails.</p>
</li>
<li>
<p>Networking has been improved:</p>
<ul>
<li>
<p>HTTP/2 is now supported. This makes binary cache lookups <a href="https://github.com/NixOS/nix/commit/90ad02bf626b885a5dd8967894e2eafc953bdf92">much
more
efficient</a>.</p>
</li>
<li>
<p>We now retry downloads on many HTTP errors, making binary caches
substituters more resilient to temporary failures.</p>
</li>
<li>
<p>HTTP credentials can now be configured via the standard <code>netrc</code>
mechanism.</p>
</li>
<li>
<p>If S3 support is enabled at compile time, <a href="s3://">s3://</a> URIs are
<a href="https://github.com/NixOS/nix/commit/9ff9c3f2f80ba4108e9c945bbfda2c64735f987b">supported</a>
in all places where Nix allows URIs.</p>
</li>
<li>
<p>Brotli compression is now supported. In particular,
<a href="https://cache.nixos.org/">cache.nixos.org</a> build logs are now compressed
using Brotli.</p>
</li>
</ul>
</li>
<li>
<p><code>nix-env</code>
<a href="https://github.com/NixOS/nix/commit/b0cb11722626e906a73f10dd9a0c9eea29faf43a">now</a>
ignores packages with bad derivation names (in particular those
starting with a digit or containing a dot).</p>
</li>
<li>
<p>Many configuration options have been renamed, either because they
were unnecessarily verbose (e.g. <code>build-use-sandbox</code> is now just
<code>sandbox</code>) or to reflect generalised behaviour (e.g. <code>binary-caches</code>
is now <code>substituters</code> because it allows arbitrary store URIs). The
old names are still supported for compatibility.</p>
</li>
<li>
<p>The <code>max-jobs</code> option can
<a href="https://github.com/NixOS/nix/commit/7251d048fa812d2551b7003bc9f13a8f5d4c95a5">now</a>
be set to <code>auto</code> to use the number of CPUs in the system.</p>
</li>
<li>
<p>Hashes can
<a href="https://github.com/NixOS/nix/commit/c0015e87af70f539f24d2aa2bc224a9d8b84276b">now</a>
be specified in base-64 format, in addition to base-16 and the
non-standard base-32.</p>
</li>
<li>
<p><code>nix-shell</code> now uses <code>bashInteractive</code> from Nixpkgs, rather than the
<code>bash</code> command that happens to be in the caller’s <code>PATH</code>. This is
especially important on macOS where the <code>bash</code> provided by the
system is seriously outdated and cannot execute <code>stdenv</code>’s setup
script.</p>
</li>
<li>
<p>Nix can now automatically trigger a garbage collection if free disk
space drops below a certain level during a build. This is configured
using the <code>min-free</code> and <code>max-free</code> options.</p>
</li>
<li>
<p><code>nix-store -q --roots</code> and <code>nix-store --gc --print-roots</code> now show
temporary and in-memory roots.</p>
</li>
<li>
<p>Nix can now be extended with plugins. See the documentation of the
<code>plugin-files</code> option for more details.</p>
</li>
</ul>
<p>The Nix language has the following new features:</p>
<ul>
<li>
<p>It supports floating point numbers. They are based on the C++
<code>float</code> type and are supported by the existing numerical operators.
Export and import to and from JSON and XML works, too.</p>
</li>
<li>
<p>Derivation attributes can now reference the outputs of the
derivation using the <code>placeholder</code> builtin function. For example,
the attribute</p>
<pre><code>configureFlags = "--prefix=${placeholder "out"} --includedir=${placeholder "dev"}";
</code></pre>
<p>will cause the <code>configureFlags</code> environment variable to contain the
actual store paths corresponding to the <code>out</code> and <code>dev</code> outputs.</p>
</li>
</ul>
<p>The following builtin functions are new or extended:</p>
<ul>
<li>
<p><code>builtins.fetchGit</code> allows Git repositories to be fetched at
evaluation time. Thus it differs from the <code>fetchgit</code> function in
Nixpkgs, which fetches at build time and cannot be used to fetch Nix
expressions during evaluation. A typical use case is to import
external NixOS modules from your configuration, e.g.</p>
<pre><code>imports = [ (builtins.fetchGit https://github.com/edolstra/dwarffs + "/module.nix") ];
</code></pre>
</li>
<li>
<p>Similarly, <code>builtins.fetchMercurial</code> allows you to fetch Mercurial
repositories.</p>
</li>
<li>
<p><code>builtins.path</code> generalises <code>builtins.filterSource</code> and path
literals (e.g. <code>./foo</code>). It allows specifying a store path name that
differs from the source path name (e.g. <code>builtins.path { path = ./foo; name = "bar";                 }</code>) and also supports filtering out unwanted files.</p>
</li>
<li>
<p><code>builtins.fetchurl</code> and <code>builtins.fetchTarball</code> now support <code>sha256</code>
and <code>name</code> attributes.</p>
</li>
<li>
<p><code>builtins.split</code> splits a string using a POSIX extended regular
expression as the separator.</p>
</li>
<li>
<p><code>builtins.partition</code> partitions the elements of a list into two
lists, depending on a Boolean predicate.</p>
</li>
<li>
<p><code>&lt;nix/fetchurl.nix&gt;</code> now uses the content-addressable tarball cache
at <a href="http://tarballs.nixos.org/">http://tarballs.nixos.org/</a>, just like <code>fetchurl</code> in Nixpkgs.
(f2682e6e18a76ecbfb8a12c17e3a0ca15c084197)</p>
</li>
<li>
<p>In restricted and pure evaluation mode, builtin functions that
download from the network (such as <code>fetchGit</code>) are permitted to
fetch underneath a list of URI prefixes specified in the option
<code>allowed-uris</code>.</p>
</li>
</ul>
<p>The Nix build environment has the following changes:</p>
<ul>
<li>
<p>Values such as Booleans, integers, (nested) lists and attribute sets
can
<a href="https://github.com/NixOS/nix/commit/6de33a9c675b187437a2e1abbcb290981a89ecb1">now</a>
be passed to builders in a non-lossy way. If the special attribute
<code>__structuredAttrs</code> is set to <code>true</code>, the other derivation
attributes are serialised in JSON format and made available to the
builder via the file <code>.attrs.json</code> in the builder’s temporary
directory. This obviates the need for <code>passAsFile</code> since JSON files
have no size restrictions, unlike process environments.</p>
<p><a href="https://github.com/NixOS/nix/commit/2d5b1b24bf70a498e4c0b378704cfdb6471cc699">As a convenience to Bash
builders</a>,
Nix writes a script named <code>.attrs.sh</code> to the builder’s directory
that initialises shell variables corresponding to all attributes
that are representable in Bash. This includes non-nested
(associative) arrays. For example, the attribute <code>hardening.format =                 true</code> ends up as the Bash associative array element
<code>${hardening[format]}</code>.</p>
</li>
<li>
<p>Builders can
<a href="https://github.com/NixOS/nix/commit/88e6bb76de5564b3217be9688677d1c89101b2a3">now</a>
communicate what build phase they are in by writing messages to the
file descriptor specified in <code>NIX_LOG_FD</code>. The current phase is
shown by the <code>nix</code> progress indicator.</p>
</li>
<li>
<p>In Linux sandbox builds, we
<a href="https://github.com/NixOS/nix/commit/a2d92bb20e82a0957067ede60e91fab256948b41">now</a>
provide a default <code>/bin/sh</code> (namely <code>ash</code> from BusyBox).</p>
</li>
<li>
<p>In structured attribute mode, <code>exportReferencesGraph</code>
<a href="https://github.com/NixOS/nix/commit/c2b0d8749f7e77afc1c4b3e8dd36b7ee9720af4a">exports</a>
extended information about closures in JSON format. In particular,
it includes the sizes and hashes of paths. This is primarily useful
for NixOS image builders.</p>
</li>
<li>
<p>Builds are
<a href="https://github.com/NixOS/nix/commit/21948deed99a3295e4d5666e027a6ca42dc00b40">now</a>
killed as soon as Nix receives EOF on the builder’s stdout or
stderr. This fixes a bug that allowed builds to hang Nix
indefinitely, regardless of timeouts.</p>
</li>
<li>
<p>The <code>sandbox-paths</code> configuration option can now specify optional
paths by appending a <code>?</code>, e.g. <code>/dev/nvidiactl?</code> will bind-mount
<code>/dev/nvidiactl</code> only if it exists.</p>
</li>
<li>
<p>On Linux, builds are now executed in a user namespace with UID 1000
and GID 100.</p>
</li>
</ul>
<p>A number of significant internal changes were made:</p>
<ul>
<li>
<p>Nix no longer depends on Perl and all Perl components have been
rewritten in C++ or removed. The Perl bindings that used to be part
of Nix have been moved to a separate package, <code>nix-perl</code>.</p>
</li>
<li>
<p>All <code>Store</code> classes are now thread-safe. <code>RemoteStore</code> supports
multiple concurrent connections to the daemon. This is primarily
useful in multi-threaded programs such as <code>hydra-queue-runner</code>.</p>
</li>
</ul>
<p>This release has contributions from Adrien Devresse, Alexander Ried,
Alex Cruice, Alexey Shmalko, AmineChikhaoui, Andy Wingo, Aneesh Agrawal,
Anthony Cowley, Armijn Hemel, aszlig, Ben Gamari, Benjamin Hipple,
Benjamin Staffin, Benno Fünfstück, Bjørn Forsman, Brian McKenna, Charles
Strahan, Chase Adams, Chris Martin, Christian Theune, Chris Warburton,
Daiderd Jordan, Dan Connolly, Daniel Peebles, Dan Peebles, davidak,
David McFarland, Dmitry Kalinkin, Domen Kožar, Eelco Dolstra, Emery
Hemingway, Eric Litak, Eric Wolf, Fabian Schmitthenner, Frederik
Rietdijk, Gabriel Gonzalez, Giorgio Gallo, Graham Christensen, Guillaume
Maudoux, Harmen, Iavael, James Broadhead, James Earl Douglas, Janus
Troelsen, Jeremy Shaw, Joachim Schiele, Joe Hermaszewski, Joel Moberg,
Johannes 'fish' Ziemke, Jörg Thalheim, Jude Taylor, kballou, Keshav
Kini, Kjetil Orbekk, Langston Barrett, Linus Heckemann, Ludovic Courtès,
Manav Rathi, Marc Scholten, Markus Hauck, Matt Audesse, Matthew Bauer,
Matthias Beyer, Matthieu Coudron, N1X, Nathan Zadoks, Neil Mayhew,
Nicolas B. Pierron, Niklas Hambüchen, Nikolay Amiantov, Ole Jørgen
Brønner, Orivej Desh, Peter Simons, Peter Stuart, Pyry Jahkola, regnat,
Renzo Carbonara, Rhys, Robert Vollmert, Scott Olson, Scott R. Parish,
Sergei Trofimovich, Shea Levy, Sheena Artrip, Spencer Baugh, Stefan
Junker, Susan Potter, Thomas Tuegel, Timothy Allen, Tristan Hume, Tuomas
Tynkkynen, tv, Tyson Whitehead, Vladimír Čunát, Will Dietz, wmertens,
Wout Mertens, zimbatm and Zoran Plesivčak.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-11110-2017-06-12"><a class="header" href="#release-11110-2017-06-12">Release 1.11.10 (2017-06-12)</a></h1>
<p>This release fixes a security bug in Nix’s “build user” build isolation
mechanism. Previously, Nix builders had the ability to create setuid
binaries owned by a <code>nixbld</code> user. Such a binary could then be used by
an attacker to assume a <code>nixbld</code> identity and interfere with subsequent
builds running under the same UID.</p>
<p>To prevent this issue, Nix now disallows builders to create setuid and
setgid binaries. On Linux, this is done using a seccomp BPF filter. Note
that this imposes a small performance penalty (e.g. 1% when building GNU
Hello). Using seccomp, we now also prevent the creation of extended
attributes and POSIX ACLs since these cannot be represented in the NAR
format and (in the case of POSIX ACLs) allow bypassing regular Nix store
permissions. On macOS, the restriction is implemented using the existing
sandbox mechanism, which now uses a minimal “allow all except the
creation of setuid/setgid binaries” profile when regular sandboxing is
disabled. On other platforms, the “build user” mechanism is now
disabled.</p>
<p>Thanks go to Linus Heckemann for discovering and reporting this bug.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-111-2016-01-19"><a class="header" href="#release-111-2016-01-19">Release 1.11 (2016-01-19)</a></h1>
<p>This is primarily a bug fix release. It also has a number of new
features:</p>
<ul>
<li>
<p><code>nix-prefetch-url</code> can now download URLs specified in a Nix
expression. For example,</p>
<pre><code>$ nix-prefetch-url -A hello.src
</code></pre>
<p>will prefetch the file specified by the <code>fetchurl</code> call in the
attribute <code>hello.src</code> from the Nix expression in the current
directory, and print the cryptographic hash of the resulting file on
stdout. This differs from <code>nix-build -A                 hello.src</code> in that it doesn't verify the hash, and is thus useful
when you’re updating a Nix expression.</p>
<p>You can also prefetch the result of functions that unpack a tarball,
such as <code>fetchFromGitHub</code>. For example:</p>
<pre><code>$ nix-prefetch-url --unpack https://github.com/NixOS/patchelf/archive/0.8.tar.gz
</code></pre>
<p>or from a Nix expression:</p>
<pre><code>$ nix-prefetch-url -A nix-repl.src
</code></pre>
</li>
<li>
<p>The builtin function <code>&lt;nix/fetchurl.nix&gt;</code> now supports downloading
and unpacking NARs. This removes the need to have multiple downloads
in the Nixpkgs stdenv bootstrap process (like a separate busybox
binary for Linux, or curl/mkdir/sh/bzip2 for Darwin). Now all those
files can be combined into a single NAR, optionally compressed using
<code>xz</code>.</p>
</li>
<li>
<p>Nix now supports SHA-512 hashes for verifying fixed-output
derivations, and in <code>builtins.hashString</code>.</p>
</li>
<li>
<p>The new flag <code>--option build-repeat                         N</code> will cause every build to be executed <em>N</em>+1 times. If the build
output differs between any round, the build is rejected, and the
output paths are not registered as valid. This is primarily useful
to verify build determinism. (We already had a <code>--check</code> option to
repeat a previously succeeded build. However, with <code>--check</code>,
non-deterministic builds are registered in the DB. Preventing that
is useful for Hydra to ensure that non-deterministic builds don't
end up getting published to the binary cache.)</p>
</li>
<li>
<p>The options <code>--check</code> and <code>--option                         build-repeat N</code>, if they detect a difference between two runs of the
same derivation and <code>-K</code> is given, will make the output of the other
run available under <code>store-path-check</code>. This makes it easier to
investigate the non-determinism using tools like <code>diffoscope</code>, e.g.,</p>
<pre><code>$ nix-build pkgs/stdenv/linux -A stage1.pkgs.zlib --check -K
error: derivation ‘/nix/store/l54i8wlw2265…-zlib-1.2.8.drv’ may not
be deterministic: output ‘/nix/store/11a27shh6n2i…-zlib-1.2.8’
differs from ‘/nix/store/11a27shh6n2i…-zlib-1.2.8-check’

$ diffoscope /nix/store/11a27shh6n2i…-zlib-1.2.8 /nix/store/11a27shh6n2i…-zlib-1.2.8-check
…
├── lib/libz.a
│   ├── metadata
│   │ @@ -1,15 +1,15 @@
│   │ -rw-r--r-- 30001/30000   3096 Jan 12 15:20 2016 adler32.o
…
│   │ +rw-r--r-- 30001/30000   3096 Jan 12 15:28 2016 adler32.o
…
</code></pre>
</li>
<li>
<p>Improved FreeBSD support.</p>
</li>
<li>
<p><code>nix-env -qa --xml --meta</code> now prints license information.</p>
</li>
<li>
<p>The maximum number of parallel TCP connections that the binary cache
substituter will use has been decreased from 150 to 25. This should
prevent upsetting some broken NAT routers, and also improves
performance.</p>
</li>
<li>
<p>All "chroot"-containing strings got renamed to "sandbox". In
particular, some Nix options got renamed, but the old names are
still accepted as lower-priority aliases.</p>
</li>
</ul>
<p>This release has contributions from Anders Claesson, Anthony Cowley,
Bjørn Forsman, Brian McKenna, Danny Wilson, davidak, Eelco Dolstra,
Fabian Schmitthenner, FrankHB, Ilya Novoselov, janus, Jim Garrison, John
Ericson, Jude Taylor, Ludovic Courtès, Manuel Jacob, Mathnerd314, Pascal
Wittmann, Peter Simons, Philip Potter, Preston Bennes, Rommel M.
Martinez, Sander van der Burg, Shea Levy, Tim Cuthbertson, Tuomas
Tynkkynen, Utku Demir and Vladimír Čunát.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-110-2015-09-03"><a class="header" href="#release-110-2015-09-03">Release 1.10 (2015-09-03)</a></h1>
<p>This is primarily a bug fix release. It also has a number of new
features:</p>
<ul>
<li>
<p>A number of builtin functions have been added to reduce
Nixpkgs/NixOS evaluation time and memory consumption: <code>all</code>, <code>any</code>,
<code>concatStringsSep</code>, <code>foldl’</code>, <code>genList</code>, <code>replaceStrings</code>, <code>sort</code>.</p>
</li>
<li>
<p>The garbage collector is more robust when the disk is full.</p>
</li>
<li>
<p>Nix supports a new API for building derivations that doesn’t require
a <code>.drv</code> file to be present on disk; it only requires an in-memory
representation of the derivation. This is used by the Hydra
continuous build system to make remote builds more efficient.</p>
</li>
<li>
<p>The function <code>&lt;nix/fetchurl.nix&gt;</code> now uses a <em>builtin</em> builder (i.e.
it doesn’t require starting an external process; the download is
performed by Nix itself). This ensures that derivation paths don’t
change when Nix is upgraded, and obviates the need for ugly hacks to
support chroot execution.</p>
</li>
<li>
<p><code>--version -v</code> now prints some configuration information, in
particular what compile-time optional features are enabled, and the
paths of various directories.</p>
</li>
<li>
<p>Build users have their supplementary groups set correctly.</p>
</li>
</ul>
<p>This release has contributions from Eelco Dolstra, Guillaume Maudoux,
Iwan Aucamp, Jaka Hudoklin, Kirill Elagin, Ludovic Courtès, Manolis
Ragkousis, Nicolas B. Pierron and Shea Levy.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-19-2015-06-12"><a class="header" href="#release-19-2015-06-12">Release 1.9 (2015-06-12)</a></h1>
<p>In addition to the usual bug fixes, this release has the following new
features:</p>
<ul>
<li>
<p>Signed binary cache support. You can enable signature checking by
adding the following to <code>nix.conf</code>:</p>
<pre><code>signed-binary-caches = *
binary-cache-public-keys = cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY=
</code></pre>
<p>This will prevent Nix from downloading any binary from the cache
that is not signed by one of the keys listed in
<code>binary-cache-public-keys</code>.</p>
<p>Signature checking is only supported if you built Nix with the
<code>libsodium</code> package.</p>
<p>Note that while Nix has had experimental support for signed binary
caches since version 1.7, this release changes the signature format
in a backwards-incompatible way.</p>
</li>
<li>
<p>Automatic downloading of Nix expression tarballs. In various places,
you can now specify the URL of a tarball containing Nix expressions
(such as Nixpkgs), which will be downloaded and unpacked
automatically. For example:</p>
<ul>
<li>
<p>In <code>nix-env</code>:</p>
<pre><code>$ nix-env -f https://github.com/NixOS/nixpkgs-channels/archive/nixos-14.12.tar.gz -iA firefox
</code></pre>
<p>This installs Firefox from the latest tested and built revision
of the NixOS 14.12 channel.</p>
</li>
<li>
<p>In <code>nix-build</code> and <code>nix-shell</code>:</p>
<pre><code>$ nix-build https://github.com/NixOS/nixpkgs/archive/master.tar.gz -A hello
</code></pre>
<p>This builds GNU Hello from the latest revision of the Nixpkgs
master branch.</p>
</li>
<li>
<p>In the Nix search path (as specified via <code>NIX_PATH</code> or <code>-I</code>).
For example, to start a shell containing the Pan package from a
specific version of Nixpkgs:</p>
<pre><code>$ nix-shell -p pan -I nixpkgs=https://github.com/NixOS/nixpkgs-channels/archive/8a3eea054838b55aca962c3fbde9c83c102b8bf2.tar.gz
</code></pre>
</li>
<li>
<p>In <code>nixos-rebuild</code> (on NixOS):</p>
<pre><code>$ nixos-rebuild test -I nixpkgs=https://github.com/NixOS/nixpkgs-channels/archive/nixos-unstable.tar.gz
</code></pre>
</li>
<li>
<p>In Nix expressions, via the new builtin function <code>fetchTarball</code>:</p>
<pre><code>with import (fetchTarball https://github.com/NixOS/nixpkgs-channels/archive/nixos-14.12.tar.gz) {}; …
</code></pre>
<p>(This is not allowed in restricted mode.)</p>
</li>
</ul>
</li>
<li>
<p><code>nix-shell</code> improvements:</p>
<ul>
<li>
<p><code>nix-shell</code> now has a flag <code>--run</code> to execute a command in the
<code>nix-shell</code> environment, e.g. <code>nix-shell --run make</code>. This is
like the existing <code>--command</code> flag, except that it uses a
non-interactive shell (ensuring that hitting Ctrl-C won’t drop
you into the child shell).</p>
</li>
<li>
<p><code>nix-shell</code> can now be used as a <code>#!</code>-interpreter. This allows
you to write scripts that dynamically fetch their own
dependencies. For example, here is a Haskell script that, when
invoked, first downloads GHC and the Haskell packages on which
it depends:</p>
<pre><code>#! /usr/bin/env nix-shell
#! nix-shell -i runghc -p haskellPackages.ghc haskellPackages.HTTP

import Network.HTTP

main = do
  resp &lt;- Network.HTTP.simpleHTTP (getRequest "http://nixos.org/")
  body &lt;- getResponseBody resp
  print (take 100 body)
</code></pre>
<p>Of course, the dependencies are cached in the Nix store, so the
second invocation of this script will be much faster.</p>
</li>
</ul>
</li>
<li>
<p>Chroot improvements:</p>
<ul>
<li>
<p>Chroot builds are now supported on Mac OS X (using its sandbox
mechanism).</p>
</li>
<li>
<p>If chroots are enabled, they are now used for all derivations,
including fixed-output derivations (such as <code>fetchurl</code>). The
latter do have network access, but can no longer access the host
filesystem. If you need the old behaviour, you can set the
option <code>build-use-chroot</code> to <code>relaxed</code>.</p>
</li>
<li>
<p>On Linux, if chroots are enabled, builds are performed in a
private PID namespace once again. (This functionality was lost
in Nix 1.8.)</p>
</li>
<li>
<p>Store paths listed in <code>build-chroot-dirs</code> are now automatically
expanded to their closure. For instance, if you want
<code>/nix/store/…-bash/bin/sh</code> mounted in your chroot as <code>/bin/sh</code>,
you only need to say <code>build-chroot-dirs =                                                 /bin/sh=/nix/store/…-bash/bin/sh</code>; it is no longer necessary to
specify the dependencies of Bash.</p>
</li>
</ul>
</li>
<li>
<p>The new derivation attribute <code>passAsFile</code> allows you to specify that
the contents of derivation attributes should be passed via files
rather than environment variables. This is useful if you need to
pass very long strings that exceed the size limit of the
environment. The Nixpkgs function <code>writeTextFile</code> uses this.</p>
</li>
<li>
<p>You can now use <code>~</code> in Nix file names to refer to your home
directory, e.g. <code>import         ~/.nixpkgs/config.nix</code>.</p>
</li>
<li>
<p>Nix has a new option <code>restrict-eval</code> that allows limiting what paths
the Nix evaluator has access to. By passing <code>--option restrict-eval true</code> to Nix, the evaluator will throw an exception if an attempt is
made to access any file outside of the Nix search path. This is
primarily intended for Hydra to ensure that a Hydra jobset only
refers to its declared inputs (and is therefore reproducible).</p>
</li>
<li>
<p><code>nix-env</code> now only creates a new “generation” symlink in
<code>/nix/var/nix/profiles</code> if something actually changed.</p>
</li>
<li>
<p>The environment variable <code>NIX_PAGER</code> can now be set to override
<code>PAGER</code>. You can set it to <code>cat</code> to disable paging for Nix commands
only.</p>
</li>
<li>
<p>Failing <code>&lt;...&gt;</code> lookups now show position information.</p>
</li>
<li>
<p>Improved Boehm GC use: we disabled scanning for interior pointers,
which should reduce the “<code>Repeated         allocation of very large block</code>” warnings and associated retention
of memory.</p>
</li>
</ul>
<p>This release has contributions from aszlig, Benjamin Staffin, Charles
Strahan, Christian Theune, Daniel Hahler, Danylo Hlynskyi Daniel
Peebles, Dan Peebles, Domen Kožar, Eelco Dolstra, Harald van Dijk, Hoang
Xuan Phu, Jaka Hudoklin, Jeff Ramnani, j-keck, Linquize, Luca Bruno,
Michael Merickel, Oliver Dunkl, Rob Vermaas, Rok Garbas, Shea Levy,
Tobias Geerinckx-Rice and William A. Kennington III.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-18-2014-12-14"><a class="header" href="#release-18-2014-12-14">Release 1.8 (2014-12-14)</a></h1>
<ul>
<li>
<p>Breaking change: to address a race condition, the remote build hook
mechanism now uses <code>nix-store         --serve</code> on the remote machine. This requires build slaves to be
updated to Nix 1.8.</p>
</li>
<li>
<p>Nix now uses HTTPS instead of HTTP to access the default binary
cache, <code>cache.nixos.org</code>.</p>
</li>
<li>
<p><code>nix-env</code> selectors are now regular expressions. For instance, you
can do</p>
<pre><code>$ nix-env -qa '.*zip.*'
</code></pre>
<p>to query all packages with a name containing <code>zip</code>.</p>
</li>
<li>
<p><code>nix-store --read-log</code> can now fetch remote build logs. If a build
log is not available locally, then ‘nix-store -l’ will now try to
download it from the servers listed in the ‘log-servers’ option in
nix.conf. For instance, if you have the configuration option</p>
<pre><code>log-servers = http://hydra.nixos.org/log
</code></pre>
<p>then it will try to get logs from <code>http://hydra.nixos.org/log/base name of the store path</code>. This allows you to do things like:</p>
<pre><code>$ nix-store -l $(which xterm)
</code></pre>
<p>and get a log even if <code>xterm</code> wasn't built locally.</p>
</li>
<li>
<p>New builtin functions: <code>attrValues</code>, <code>deepSeq</code>, <code>fromJSON</code>,
<code>readDir</code>, <code>seq</code>.</p>
</li>
<li>
<p><code>nix-instantiate --eval</code> now has a <code>--json</code> flag to print the
resulting value in JSON format.</p>
</li>
<li>
<p><code>nix-copy-closure</code> now uses <code>nix-store --serve</code> on the remote side
to send or receive closures. This fixes a race condition between
<code>nix-copy-closure</code> and the garbage collector.</p>
</li>
<li>
<p>Derivations can specify the new special attribute
<code>allowedRequisites</code>, which has a similar meaning to
<code>allowedReferences</code>. But instead of only enforcing to explicitly
specify the immediate references, it requires the derivation to
specify all the dependencies recursively (hence the name,
requisites) that are used by the resulting output.</p>
</li>
<li>
<p>On Mac OS X, Nix now handles case collisions when importing closures
from case-sensitive file systems. This is mostly useful for running
NixOps on Mac OS X.</p>
</li>
<li>
<p>The Nix daemon has new configuration options <code>allowed-users</code>
(specifying the users and groups that are allowed to connect to the
daemon) and <code>trusted-users</code> (specifying the users and groups that
can perform privileged operations like specifying untrusted binary
caches).</p>
</li>
<li>
<p>The configuration option <code>build-cores</code> now defaults to the number of
available CPU cores.</p>
</li>
<li>
<p>Build users are now used by default when Nix is invoked as root.
This prevents builds from accidentally running as root.</p>
</li>
<li>
<p>Nix now includes systemd units and Upstart jobs.</p>
</li>
<li>
<p>Speed improvements to <code>nix-store         --optimise</code>.</p>
</li>
<li>
<p>Language change: the <code>==</code> operator now ignores string contexts (the
“dependencies” of a string).</p>
</li>
<li>
<p>Nix now filters out Nix-specific ANSI escape sequences on standard
error. They are supposed to be invisible, but some terminals show
them anyway.</p>
</li>
<li>
<p>Various commands now automatically pipe their output into the pager
as specified by the <code>PAGER</code> environment variable.</p>
</li>
<li>
<p>Several improvements to reduce memory consumption in the evaluator.</p>
</li>
</ul>
<p>This release has contributions from Adam Szkoda, Aristid Breitkreuz, Bob
van der Linden, Charles Strahan, darealshinji, Eelco Dolstra, Gergely
Risko, Joel Taylor, Ludovic Courtès, Marko Durkovic, Mikey Ariel, Paul
Colomiets, Ricardo M. Correia, Ricky Elrod, Robert Helgesson, Rob
Vermaas, Russell O'Connor, Shea Levy, Shell Turner, Sönke Hahn, Steve
Purcell, Vladimír Čunát and Wout Mertens.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-17-2014-04-11"><a class="header" href="#release-17-2014-04-11">Release 1.7 (2014-04-11)</a></h1>
<p>In addition to the usual bug fixes, this release has the following new
features:</p>
<ul>
<li>
<p>Antiquotation is now allowed inside of quoted attribute names (e.g.
<code>set."${foo}"</code>). In the case where the attribute name is just a
single antiquotation, the quotes can be dropped (e.g. the above
example can be written <code>set.${foo}</code>). If an attribute name inside of
a set declaration evaluates to <code>null</code> (e.g. <code>{ ${null} = false; }</code>),
then that attribute is not added to the set.</p>
</li>
<li>
<p>Experimental support for cryptographically signed binary caches. See
<a href="https://github.com/NixOS/nix/commit/0fdf4da0e979f992db75cc17376e455ddc5a96d8">the commit for
details</a>.</p>
</li>
<li>
<p>An experimental new substituter, <code>download-via-ssh</code>, that fetches
binaries from remote machines via SSH. Specifying the flags
<code>--option                 use-ssh-substituter true --option ssh-substituter-hosts                 user@hostname</code> will cause Nix to download binaries from the
specified machine, if it has them.</p>
</li>
<li>
<p><code>nix-store -r</code> and <code>nix-build</code> have a new flag, <code>--check</code>, that
builds a previously built derivation again, and prints an error
message if the output is not exactly the same. This helps to verify
whether a derivation is truly deterministic. For example:</p>
<pre><code>$ nix-build '&lt;nixpkgs&gt;' -A patchelf
…
$ nix-build '&lt;nixpkgs&gt;' -A patchelf --check
…
error: derivation `/nix/store/1ipvxs…-patchelf-0.6' may not be deterministic:
  hash mismatch in output `/nix/store/4pc1dm…-patchelf-0.6.drv'
</code></pre>
</li>
<li>
<p>The <code>nix-instantiate</code> flags <code>--eval-only</code> and <code>--parse-only</code> have
been renamed to <code>--eval</code> and <code>--parse</code>, respectively.</p>
</li>
<li>
<p><code>nix-instantiate</code>, <code>nix-build</code> and <code>nix-shell</code> now have a flag
<code>--expr</code> (or <code>-E</code>) that allows you to specify the expression to be
evaluated as a command line argument. For instance, <code>nix-instantiate --eval -E                 '1 + 2'</code> will print <code>3</code>.</p>
</li>
<li>
<p><code>nix-shell</code> improvements:</p>
<ul>
<li>
<p>It has a new flag, <code>--packages</code> (or <code>-p</code>), that sets up a build
environment containing the specified packages from Nixpkgs. For
example, the command</p>
<pre><code>$ nix-shell -p sqlite xorg.libX11 hello
</code></pre>
<p>will start a shell in which the given packages are present.</p>
</li>
<li>
<p>It now uses <code>shell.nix</code> as the default expression, falling back
to <code>default.nix</code> if the former doesn’t exist. This makes it
convenient to have a <code>shell.nix</code> in your project to set up a
nice development environment.</p>
</li>
<li>
<p>It evaluates the derivation attribute <code>shellHook</code>, if set. Since
<code>stdenv</code> does not normally execute this hook, it allows you to
do <code>nix-shell</code>-specific setup.</p>
</li>
<li>
<p>It preserves the user’s timezone setting.</p>
</li>
</ul>
</li>
<li>
<p>In chroots, Nix now sets up a <code>/dev</code> containing only a minimal set
of devices (such as <code>/dev/null</code>). Note that it only does this if you
<em>don’t</em> have <code>/dev</code> listed in your <code>build-chroot-dirs</code> setting;
otherwise, it will bind-mount the <code>/dev</code> from outside the chroot.</p>
<p>Similarly, if you don’t have <code>/dev/pts</code> listed in
<code>build-chroot-dirs</code>, Nix will mount a private <code>devpts</code> filesystem on
the chroot’s <code>/dev/pts</code>.</p>
</li>
<li>
<p>New built-in function: <code>builtins.toJSON</code>, which returns a JSON
representation of a value.</p>
</li>
<li>
<p><code>nix-env -q</code> has a new flag <code>--json</code> to print a JSON representation
of the installed or available packages.</p>
</li>
<li>
<p><code>nix-env</code> now supports meta attributes with more complex values,
such as attribute sets.</p>
</li>
<li>
<p>The <code>-A</code> flag now allows attribute names with dots in them, e.g.</p>
<pre><code>$ nix-instantiate --eval '&lt;nixos&gt;' -A 'config.systemd.units."nscd.service".text'
</code></pre>
</li>
<li>
<p>The <code>--max-freed</code> option to <code>nix-store --gc</code> now accepts a unit
specifier. For example, <code>nix-store --gc --max-freed                 1G</code> will free up to 1 gigabyte of disk space.</p>
</li>
<li>
<p><code>nix-collect-garbage</code> has a new flag <code>--delete-older-than</code> <em>N</em><code>d</code>,
which deletes all user environment generations older than <em>N</em> days.
Likewise, <code>nix-env                 --delete-generations</code> accepts a <em>N</em><code>d</code> age limit.</p>
</li>
<li>
<p>Nix now heuristically detects whether a build failure was due to a
disk-full condition. In that case, the build is not flagged as
“permanently failed”. This is mostly useful for Hydra, which needs
to distinguish between permanent and transient build failures.</p>
</li>
<li>
<p>There is a new symbol <code>__curPos</code> that expands to an attribute set
containing its file name and line and column numbers, e.g. <code>{ file = "foo.nix"; line = 10;                 column = 5; }</code>. There also is a new builtin function,
<code>unsafeGetAttrPos</code>, that returns the position of an attribute. This
is used by Nixpkgs to provide location information in error
messages, e.g.</p>
<pre><code>$ nix-build '&lt;nixpkgs&gt;' -A libreoffice --argstr system x86_64-darwin
error: the package ‘libreoffice-4.0.5.2’ in ‘.../applications/office/libreoffice/default.nix:263’
  is not supported on ‘x86_64-darwin’
</code></pre>
</li>
<li>
<p>The garbage collector is now more concurrent with other Nix
processes because it releases certain locks earlier.</p>
</li>
<li>
<p>The binary tarball installer has been improved. You can now install
Nix by running:</p>
<pre><code>$ bash &lt;(curl -L https://nixos.org/nix/install)
</code></pre>
</li>
<li>
<p>More evaluation errors include position information. For instance,
selecting a missing attribute will print something like</p>
<pre><code>error: attribute `nixUnstabl' missing, at /etc/nixos/configurations/misc/eelco/mandark.nix:216:15
</code></pre>
</li>
<li>
<p>The command <code>nix-setuid-helper</code> is gone.</p>
</li>
<li>
<p>Nix no longer uses Automake, but instead has a non-recursive, GNU
Make-based build system.</p>
</li>
<li>
<p>All installed libraries now have the prefix <code>libnix</code>. In particular,
this gets rid of <code>libutil</code>, which could clash with libraries with
the same name from other packages.</p>
</li>
<li>
<p>Nix now requires a compiler that supports C++11.</p>
</li>
</ul>
<p>This release has contributions from Danny Wilson, Domen Kožar, Eelco
Dolstra, Ian-Woo Kim, Ludovic Courtès, Maxim Ivanov, Petr Rockai,
Ricardo M. Correia and Shea Levy.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-161-2013-10-28"><a class="header" href="#release-161-2013-10-28">Release 1.6.1 (2013-10-28)</a></h1>
<p>This is primarily a bug fix release. Changes of interest are:</p>
<ul>
<li>
<p>Nix 1.6 accidentally changed the semantics of antiquoted paths in
strings, such as <code>"${/foo}/bar"</code>. This release reverts to the Nix
1.5.3 behaviour.</p>
</li>
<li>
<p>Previously, Nix optimised expressions such as <code>"${expr}"</code> to <em>expr</em>.
Thus it neither checked whether <em>expr</em> could be coerced to a string,
nor applied such coercions. This meant that <code>"${123}"</code> evaluatued to
<code>123</code>, and <code>"${./foo}"</code> evaluated to <code>./foo</code> (even though <code>"${./foo} "</code> evaluates to <code>"/nix/store/hash-foo "</code>). Nix now checks the type
of antiquoted expressions and applies coercions.</p>
</li>
<li>
<p>Nix now shows the exact position of undefined variables. In
particular, undefined variable errors in a <code>with</code> previously didn't
show <em>any</em> position information, so this makes it a lot easier to
fix such errors.</p>
</li>
<li>
<p>Undefined variables are now treated consistently. Previously, the
<code>tryEval</code> function would catch undefined variables inside a <code>with</code>
but not outside. Now <code>tryEval</code> never catches undefined variables.</p>
</li>
<li>
<p>Bash completion in <code>nix-shell</code> now works correctly.</p>
</li>
<li>
<p>Stack traces are less verbose: they no longer show calls to builtin
functions and only show a single line for each derivation on the
call stack.</p>
</li>
<li>
<p>New built-in function: <code>builtins.typeOf</code>, which returns the type of
its argument as a string.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-16-2013-09-10"><a class="header" href="#release-16-2013-09-10">Release 1.6 (2013-09-10)</a></h1>
<p>In addition to the usual bug fixes, this release has several new
features:</p>
<ul>
<li>
<p>The command <code>nix-build --run-env</code> has been renamed to <code>nix-shell</code>.</p>
</li>
<li>
<p><code>nix-shell</code> now sources <code>$stdenv/setup</code> <em>inside</em> the interactive
shell, rather than in a parent shell. This ensures that shell
functions defined by <code>stdenv</code> can be used in the interactive shell.</p>
</li>
<li>
<p><code>nix-shell</code> has a new flag <code>--pure</code> to clear the environment, so you
get an environment that more closely corresponds to the “real” Nix
build.</p>
</li>
<li>
<p><code>nix-shell</code> now sets the shell prompt (<code>PS1</code>) to ensure that Nix
shells are distinguishable from your regular shells.</p>
</li>
<li>
<p><code>nix-env</code> no longer requires a <code>*</code> argument to match all packages,
so <code>nix-env -qa</code> is equivalent to <code>nix-env                 -qa '*'</code>.</p>
</li>
<li>
<p><code>nix-env -i</code> has a new flag <code>--remove-all</code> (<code>-r</code>) to remove all
previous packages from the profile. This makes it easier to do
declarative package management similar to NixOS’s
<code>environment.systemPackages</code>. For instance, if you have a
specification <code>my-packages.nix</code> like this:</p>
<pre><code>with import &lt;nixpkgs&gt; {};
[ thunderbird
  geeqie
  ...
]
</code></pre>
<p>then after any change to this file, you can run:</p>
<pre><code>$ nix-env -f my-packages.nix -ir
</code></pre>
<p>to update your profile to match the specification.</p>
</li>
<li>
<p>The ‘<code>with</code>’ language construct is now more lazy. It only evaluates
its argument if a variable might actually refer to an attribute in
the argument. For instance, this now works:</p>
<pre><code>let
  pkgs = with pkgs; { foo = "old"; bar = foo; } // overrides;
  overrides = { foo = "new"; };
in pkgs.bar
</code></pre>
<p>This evaluates to <code>"new"</code>, while previously it gave an “infinite
recursion” error.</p>
</li>
<li>
<p>Nix now has proper integer arithmetic operators. For instance, you
can write <code>x + y</code> instead of <code>builtins.add x y</code>, or <code>x &lt;                 y</code> instead of <code>builtins.lessThan x y</code>. The comparison operators also
work on strings.</p>
</li>
<li>
<p>On 64-bit systems, Nix integers are now 64 bits rather than 32 bits.</p>
</li>
<li>
<p>When using the Nix daemon, the <code>nix-daemon</code> worker process now runs
on the same CPU as the client, on systems that support setting CPU
affinity. This gives a significant speedup on some systems.</p>
</li>
<li>
<p>If a stack overflow occurs in the Nix evaluator, you now get a
proper error message (rather than “Segmentation fault”) on some
systems.</p>
</li>
<li>
<p>In addition to directories, you can now bind-mount regular files in
chroots through the (now misnamed) option <code>build-chroot-dirs</code>.</p>
</li>
</ul>
<p>This release has contributions from Domen Kožar, Eelco Dolstra, Florian
Friesdorf, Gergely Risko, Ivan Kozik, Ludovic Courtès and Shea Levy.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-152-2013-05-13"><a class="header" href="#release-152-2013-05-13">Release 1.5.2 (2013-05-13)</a></h1>
<p>This is primarily a bug fix release. It has contributions from Eelco
Dolstra, Lluís Batlle i Rossell and Shea Levy.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-15-2013-02-27"><a class="header" href="#release-15-2013-02-27">Release 1.5 (2013-02-27)</a></h1>
<p>This is a brown paper bag release to fix a regression introduced by the
hard link security fix in 1.4.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-14-2013-02-26"><a class="header" href="#release-14-2013-02-26">Release 1.4 (2013-02-26)</a></h1>
<p>This release fixes a security bug in multi-user operation. It was
possible for derivations to cause the mode of files outside of the Nix
store to be changed to 444 (read-only but world-readable) by creating
hard links to those files
(<a href="https://github.com/NixOS/nix/commit/5526a282b5b44e9296e61e07d7d2626a79141ac4">details</a>).</p>
<p>There are also the following improvements:</p>
<ul>
<li>
<p>New built-in function: <code>builtins.hashString</code>.</p>
</li>
<li>
<p>Build logs are now stored in <code>/nix/var/log/nix/drvs/XX/</code>, where <em>XX</em>
is the first two characters of the derivation. This is useful on
machines that keep a lot of build logs (such as Hydra servers).</p>
</li>
<li>
<p>The function <code>corepkgs/fetchurl</code> can now make the downloaded file
executable. This will allow getting rid of all bootstrap binaries in
the Nixpkgs source tree.</p>
</li>
<li>
<p>Language change: The expression <code>"${./path}         ..."</code> now evaluates to a string instead of a path.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-13-2013-01-04"><a class="header" href="#release-13-2013-01-04">Release 1.3 (2013-01-04)</a></h1>
<p>This is primarily a bug fix release. When this version is first run on
Linux, it removes any immutable bits from the Nix store and increases
the schema version of the Nix store. (The previous release removed
support for setting the immutable bit; this release clears any remaining
immutable bits to make certain operations more efficient.)</p>
<p>This release has contributions from Eelco Dolstra and Stuart
Pernsteiner.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-12-2012-12-06"><a class="header" href="#release-12-2012-12-06">Release 1.2 (2012-12-06)</a></h1>
<p>This release has the following improvements and changes:</p>
<ul>
<li>
<p>Nix has a new binary substituter mechanism: the <em>binary cache</em>. A
binary cache contains pre-built binaries of Nix packages. Whenever
Nix wants to build a missing Nix store path, it will check a set of
binary caches to see if any of them has a pre-built binary of that
path. The configuration setting <code>binary-caches</code> contains a list of
URLs of binary caches. For instance, doing</p>
<pre><code>$ nix-env -i thunderbird --option binary-caches http://cache.nixos.org
</code></pre>
<p>will install Thunderbird and its dependencies, using the available
pre-built binaries in <a href="http://cache.nixos.org">http://cache.nixos.org</a>. The main advantage
over the old “manifest”-based method of getting pre-built binaries
is that you don’t have to worry about your manifest being in sync
with the Nix expressions you’re installing from; i.e., you don’t
need to run <code>nix-pull</code> to update your manifest. It’s also more
scalable because you don’t need to redownload a giant manifest file
every time.</p>
<p>A Nix channel can provide a binary cache URL that will be used
automatically if you subscribe to that channel. If you use the
Nixpkgs or NixOS channels (<a href="http://nixos.org/channels">http://nixos.org/channels</a>) you
automatically get the cache <a href="http://cache.nixos.org">http://cache.nixos.org</a>.</p>
<p>Binary caches are created using <code>nix-push</code>. For details on the
operation and format of binary caches, see the <code>nix-push</code> manpage.
More details are provided in <a href="https://nixos.org/nix-dev/2012-September/009826.html">this nix-dev
posting</a>.</p>
</li>
<li>
<p>Multiple output support should now be usable. A derivation can
declare that it wants to produce multiple store paths by saying
something like</p>
<pre><code>outputs = [ "lib" "headers" "doc" ];
</code></pre>
<p>This will cause Nix to pass the intended store path of each output
to the builder through the environment variables <code>lib</code>, <code>headers</code>
and <code>doc</code>. Other packages can refer to a specific output by
referring to <code>pkg.output</code>, e.g.</p>
<pre><code>buildInputs = [ pkg.lib pkg.headers ];
</code></pre>
<p>If you install a package with multiple outputs using <code>nix-env</code>, each
output path will be symlinked into the user environment.</p>
</li>
<li>
<p>Dashes are now valid as part of identifiers and attribute names.</p>
</li>
<li>
<p>The new operation <code>nix-store --repair-path</code> allows corrupted or
missing store paths to be repaired by redownloading them. <code>nix-store --verify --check-contents                 --repair</code> will scan and repair all paths in the Nix store.
Similarly, <code>nix-env</code>, <code>nix-build</code>, <code>nix-instantiate</code> and <code>nix-store --realise</code> have a <code>--repair</code> flag to detect and fix bad paths by
rebuilding or redownloading them.</p>
</li>
<li>
<p>Nix no longer sets the immutable bit on files in the Nix store.
Instead, the recommended way to guard the Nix store against
accidental modification on Linux is to make it a read-only bind
mount, like this:</p>
<pre><code>$ mount --bind /nix/store /nix/store
$ mount -o remount,ro,bind /nix/store
</code></pre>
<p>Nix will automatically make <code>/nix/store</code> writable as needed (using a
private mount namespace) to allow modifications.</p>
</li>
<li>
<p>Store optimisation (replacing identical files in the store with hard
links) can now be done automatically every time a path is added to
the store. This is enabled by setting the configuration option
<code>auto-optimise-store</code> to <code>true</code> (disabled by default).</p>
</li>
<li>
<p>Nix now supports <code>xz</code> compression for NARs in addition to <code>bzip2</code>.
It compresses about 30% better on typical archives and decompresses
about twice as fast.</p>
</li>
<li>
<p>Basic Nix expression evaluation profiling: setting the environment
variable <code>NIX_COUNT_CALLS</code> to <code>1</code> will cause Nix to print how many
times each primop or function was executed.</p>
</li>
<li>
<p>New primops: <code>concatLists</code>, <code>elem</code>, <code>elemAt</code> and <code>filter</code>.</p>
</li>
<li>
<p>The command <code>nix-copy-closure</code> has a new flag <code>--use-substitutes</code>
(<code>-s</code>) to download missing paths on the target machine using the
substitute mechanism.</p>
</li>
<li>
<p>The command <code>nix-worker</code> has been renamed to <code>nix-daemon</code>. Support
for running the Nix worker in “slave” mode has been removed.</p>
</li>
<li>
<p>The <code>--help</code> flag of every Nix command now invokes <code>man</code>.</p>
</li>
<li>
<p>Chroot builds are now supported on systemd machines.</p>
</li>
</ul>
<p>This release has contributions from Eelco Dolstra, Florian Friesdorf,
Mats Erik Andersson and Shea Levy.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-11-2012-07-18"><a class="header" href="#release-11-2012-07-18">Release 1.1 (2012-07-18)</a></h1>
<p>This release has the following improvements:</p>
<ul>
<li>
<p>On Linux, when doing a chroot build, Nix now uses various namespace
features provided by the Linux kernel to improve build isolation.
Namely:</p>
<ul>
<li>
<p>The private network namespace ensures that builders cannot talk
to the outside world (or vice versa): each build only sees a
private loopback interface. This also means that two concurrent
builds can listen on the same port (e.g. as part of a test)
without conflicting with each other.</p>
</li>
<li>
<p>The PID namespace causes each build to start as PID 1. Processes
outside of the chroot are not visible to those on the inside. On
the other hand, processes inside the chroot <em>are</em> visible from
the outside (though with different PIDs).</p>
</li>
<li>
<p>The IPC namespace prevents the builder from communicating with
outside processes using SysV IPC mechanisms (shared memory,
message queues, semaphores). It also ensures that all IPC
objects are destroyed when the builder exits.</p>
</li>
<li>
<p>The UTS namespace ensures that builders see a hostname of
<code>localhost</code> rather than the actual hostname.</p>
</li>
<li>
<p>The private mount namespace was already used by Nix to ensure
that the bind-mounts used to set up the chroot are cleaned up
automatically.</p>
</li>
</ul>
</li>
<li>
<p>Build logs are now compressed using <code>bzip2</code>. The command <code>nix-store                 -l</code> decompresses them on the fly. This can be disabled by setting
the option <code>build-compress-log</code> to <code>false</code>.</p>
</li>
<li>
<p>The creation of build logs in <code>/nix/var/log/nix/drvs</code> can be
disabled by setting the new option <code>build-keep-log</code> to <code>false</code>. This
is useful, for instance, for Hydra build machines.</p>
</li>
<li>
<p>Nix now reserves some space in <code>/nix/var/nix/db/reserved</code> to ensure
that the garbage collector can run successfully if the disk is full.
This is necessary because SQLite transactions fail if the disk is
full.</p>
</li>
<li>
<p>Added a basic <code>fetchurl</code> function. This is not intended to replace
the <code>fetchurl</code> in Nixpkgs, but is useful for bootstrapping; e.g., it
will allow us to get rid of the bootstrap binaries in the Nixpkgs
source tree and download them instead. You can use it by doing
<code>import &lt;nix/fetchurl.nix&gt; { url =                 url; sha256 =                 "hash"; }</code>. (Shea Levy)</p>
</li>
<li>
<p>Improved RPM spec file. (Michel Alexandre Salim)</p>
</li>
<li>
<p>Support for on-demand socket-based activation in the Nix daemon with
<code>systemd</code>.</p>
</li>
<li>
<p>Added a manpage for nix.conf5.</p>
</li>
<li>
<p>When using the Nix daemon, the <code>-s</code> flag in <code>nix-env -qa</code> is now
much faster.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-10-2012-05-11"><a class="header" href="#release-10-2012-05-11">Release 1.0 (2012-05-11)</a></h1>
<p>There have been numerous improvements and bug fixes since the previous
release. Here are the most significant:</p>
<ul>
<li>
<p>Nix can now optionally use the Boehm garbage collector. This
significantly reduces the Nix evaluator’s memory footprint,
especially when evaluating large NixOS system configurations. It can
be enabled using the <code>--enable-gc</code> configure option.</p>
</li>
<li>
<p>Nix now uses SQLite for its database. This is faster and more
flexible than the old <em>ad hoc</em> format. SQLite is also used to cache
the manifests in <code>/nix/var/nix/manifests</code>, resulting in a
significant speedup.</p>
</li>
<li>
<p>Nix now has an search path for expressions. The search path is set
using the environment variable <code>NIX_PATH</code> and the <code>-I</code> command line
option. In Nix expressions, paths between angle brackets are used to
specify files that must be looked up in the search path. For
instance, the expression <code>&lt;nixpkgs/default.nix&gt;</code> looks for a file
<code>nixpkgs/default.nix</code> relative to every element in the search path.</p>
</li>
<li>
<p>The new command <code>nix-build --run-env</code> builds all dependencies of a
derivation, then starts a shell in an environment containing all
variables from the derivation. This is useful for reproducing the
environment of a derivation for development.</p>
</li>
<li>
<p>The new command <code>nix-store --verify-path</code> verifies that the contents
of a store path have not changed.</p>
</li>
<li>
<p>The new command <code>nix-store --print-env</code> prints out the environment
of a derivation in a format that can be evaluated by a shell.</p>
</li>
<li>
<p>Attribute names can now be arbitrary strings. For instance, you can
write <code>{ "foo-1.2" = …; "bla bla" = …; }."bla                 bla"</code>.</p>
</li>
<li>
<p>Attribute selection can now provide a default value using the <code>or</code>
operator. For instance, the expression <code>x.y.z or e</code> evaluates to the
attribute <code>x.y.z</code> if it exists, and <code>e</code> otherwise.</p>
</li>
<li>
<p>The right-hand side of the <code>?</code> operator can now be an attribute
path, e.g., <code>attrs ?                 a.b.c</code>.</p>
</li>
<li>
<p>On Linux, Nix will now make files in the Nix store immutable on
filesystems that support it. This prevents accidental modification
of files in the store by the root user.</p>
</li>
<li>
<p>Nix has preliminary support for derivations with multiple outputs.
This is useful because it allows parts of a package to be deployed
and garbage-collected separately. For instance, development parts of
a package such as header files or static libraries would typically
not be part of the closure of an application, resulting in reduced
disk usage and installation time.</p>
</li>
<li>
<p>The Nix store garbage collector is faster and holds the global lock
for a shorter amount of time.</p>
</li>
<li>
<p>The option <code>--timeout</code> (corresponding to the configuration setting
<code>build-timeout</code>) allows you to set an absolute timeout on builds —
if a build runs for more than the given number of seconds, it is
terminated. This is useful for recovering automatically from builds
that are stuck in an infinite loop but keep producing output, and
for which <code>--max-silent-time</code> is ineffective.</p>
</li>
<li>
<p>Nix development has moved to GitHub
(<a href="https://github.com/NixOS/nix">https://github.com/NixOS/nix</a>).</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-016-2010-08-17"><a class="header" href="#release-016-2010-08-17">Release 0.16 (2010-08-17)</a></h1>
<p>This release has the following improvements:</p>
<ul>
<li>
<p>The Nix expression evaluator is now much faster in most cases:
typically, <a href="http://www.mail-archive.com/nix-dev@cs.uu.nl/msg04113.html">3 to 8 times compared to the old
implementation</a>.
It also uses less memory. It no longer depends on the ATerm library.</p>
</li>
<li>
<p>Support for configurable parallelism inside builders. Build scripts
have always had the ability to perform multiple build actions in
parallel (for instance, by running <code>make -j                         2</code>), but this was not desirable because the number of actions to be
performed in parallel was not configurable. Nix now has an option
<code>--cores                         N</code> as well as a configuration setting <code>build-cores =                         N</code> that causes the environment variable <code>NIX_BUILD_CORES</code> to be set
to <em>N</em> when the builder is invoked. The builder can use this at its
discretion to perform a parallel build, e.g., by calling <code>make -j                         N</code>. In Nixpkgs, this can be enabled on a per-package basis by
setting the derivation attribute <code>enableParallelBuilding</code> to <code>true</code>.</p>
</li>
<li>
<p><code>nix-store -q</code> now supports XML output through the <code>--xml</code> flag.</p>
</li>
<li>
<p>Several bug fixes.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-015-2010-03-17"><a class="header" href="#release-015-2010-03-17">Release 0.15 (2010-03-17)</a></h1>
<p>This is a bug-fix release. Among other things, it fixes building on Mac
OS X (Snow Leopard), and improves the contents of <code>/etc/passwd</code> and
<code>/etc/group</code> in <code>chroot</code> builds.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-014-2010-02-04"><a class="header" href="#release-014-2010-02-04">Release 0.14 (2010-02-04)</a></h1>
<p>This release has the following improvements:</p>
<ul>
<li>
<p>The garbage collector now starts deleting garbage much faster than
before. It no longer determines liveness of all paths in the store,
but does so on demand.</p>
</li>
<li>
<p>Added a new operation, <code>nix-store --query                 --roots</code>, that shows the garbage collector roots that directly or
indirectly point to the given store paths.</p>
</li>
<li>
<p>Removed support for converting Berkeley DB-based Nix databases to
the new schema.</p>
</li>
<li>
<p>Removed the <code>--use-atime</code> and <code>--max-atime</code> garbage collector
options. They were not very useful in practice.</p>
</li>
<li>
<p>On Windows, Nix now requires Cygwin 1.7.x.</p>
</li>
<li>
<p>A few bug fixes.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-013-2009-11-05"><a class="header" href="#release-013-2009-11-05">Release 0.13 (2009-11-05)</a></h1>
<p>This is primarily a bug fix release. It has some new features:</p>
<ul>
<li>
<p>Syntactic sugar for writing nested attribute sets. Instead of</p>
<pre><code>{
  foo = {
    bar = 123;
    xyzzy = true;
  };
  a = { b = { c = "d"; }; };
}
</code></pre>
<p>you can write</p>
<pre><code>{
  foo.bar = 123;
  foo.xyzzy = true;
  a.b.c = "d";
}
</code></pre>
<p>This is useful, for instance, in NixOS configuration files.</p>
</li>
<li>
<p>Support for Nix channels generated by Hydra, the Nix-based
continuous build system. (Hydra generates NAR archives on the fly,
so the size and hash of these archives isn’t known in advance.)</p>
</li>
<li>
<p>Support <code>i686-linux</code> builds directly on <code>x86_64-linux</code> Nix
installations. This is implemented using the <code>personality()</code>
syscall, which causes <code>uname</code> to return <code>i686</code> in child processes.</p>
</li>
<li>
<p>Various improvements to the <code>chroot</code> support. Building in a <code>chroot</code>
works quite well now.</p>
</li>
<li>
<p>Nix no longer blocks if it tries to build a path and another process
is already building the same path. Instead it tries to build another
buildable path first. This improves parallelism.</p>
</li>
<li>
<p>Support for large (&gt; 4 GiB) files in NAR archives.</p>
</li>
<li>
<p>Various (performance) improvements to the remote build mechanism.</p>
</li>
<li>
<p>New primops: <code>builtins.addErrorContext</code> (to add a string to stack
traces — useful for debugging), <code>builtins.isBool</code>,
<code>builtins.isString</code>, <code>builtins.isInt</code>, <code>builtins.intersectAttrs</code>.</p>
</li>
<li>
<p>OpenSolaris support (Sander van der Burg).</p>
</li>
<li>
<p>Stack traces are no longer displayed unless the <code>--show-trace</code>
option is used.</p>
</li>
<li>
<p>The scoping rules for <code>inherit                 (e) ...</code> in recursive attribute sets have changed. The expression
<em>e</em> can now refer to the attributes defined in the containing set.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-012-2008-11-20"><a class="header" href="#release-012-2008-11-20">Release 0.12 (2008-11-20)</a></h1>
<ul>
<li>
<p>Nix no longer uses Berkeley DB to store Nix store metadata. The
principal advantages of the new storage scheme are: it works
properly over decent implementations of NFS (allowing Nix stores to
be shared between multiple machines); no recovery is needed when a
Nix process crashes; no write access is needed for read-only
operations; no more running out of Berkeley DB locks on certain
operations.</p>
<p>You still need to compile Nix with Berkeley DB support if you want
Nix to automatically convert your old Nix store to the new schema.
If you don’t need this, you can build Nix with the <code>configure</code>
option <code>--disable-old-db-compat</code>.</p>
<p>After the automatic conversion to the new schema, you can delete the
old Berkeley DB files:</p>
<pre><code>$ cd /nix/var/nix/db
$ rm __db* log.* derivers references referrers reserved validpaths DB_CONFIG
</code></pre>
<p>The new metadata is stored in the directories <code>/nix/var/nix/db/info</code>
and <code>/nix/var/nix/db/referrer</code>. Though the metadata is stored in
human-readable plain-text files, they are not intended to be
human-editable, as Nix is rather strict about the format.</p>
<p>The new storage schema may or may not require less disk space than
the Berkeley DB environment, mostly depending on the cluster size of
your file system. With 1 KiB clusters (which seems to be the <code>ext3</code>
default nowadays) it usually takes up much less space.</p>
</li>
<li>
<p>There is a new substituter that copies paths directly from other
(remote) Nix stores mounted somewhere in the filesystem. For
instance, you can speed up an installation by mounting some remote
Nix store that already has the packages in question via NFS or
<code>sshfs</code>. The environment variable <code>NIX_OTHER_STORES</code> specifies the
locations of the remote Nix directories, e.g. <code>/mnt/remote-fs/nix</code>.</p>
</li>
<li>
<p>New <code>nix-store</code> operations <code>--dump-db</code> and <code>--load-db</code> to dump and
reload the Nix database.</p>
</li>
<li>
<p>The garbage collector has a number of new options to allow only some
of the garbage to be deleted. The option <code>--max-freed N</code> tells the
collector to stop after at least <em>N</em> bytes have been deleted. The
option <code>--max-links         N</code> tells it to stop after the link count on <code>/nix/store</code> has dropped
below <em>N</em>. This is useful for very large Nix stores on filesystems
with a 32000 subdirectories limit (like <code>ext3</code>). The option
<code>--use-atime</code> causes store paths to be deleted in order of ascending
last access time. This allows non-recently used stuff to be deleted.
The option <code>--max-atime time</code> specifies an upper limit to the last
accessed time of paths that may be deleted. For instance,</p>
<pre><code>    $ nix-store --gc -v --max-atime $(date +%s -d "2 months ago")
</code></pre>
<p>deletes everything that hasn’t been accessed in two months.</p>
</li>
<li>
<p><code>nix-env</code> now uses optimistic profile locking when performing an
operation like installing or upgrading, instead of setting an
exclusive lock on the profile. This allows multiple <code>nix-env -i / -u / -e</code> operations on the same profile in parallel. If a <code>nix-env</code>
operation sees at the end that the profile was changed in the
meantime by another process, it will just restart. This is generally
cheap because the build results are still in the Nix store.</p>
</li>
<li>
<p>The option <code>--dry-run</code> is now supported by <code>nix-store -r</code> and
<code>nix-build</code>.</p>
</li>
<li>
<p>The information previously shown by <code>--dry-run</code> (i.e., which
derivations will be built and which paths will be substituted) is
now always shown by <code>nix-env</code>, <code>nix-store -r</code> and <code>nix-build</code>. The
total download size of substitutable paths is now also shown. For
instance, a build will show something like</p>
<pre><code>the following derivations will be built:
  /nix/store/129sbxnk5n466zg6r1qmq1xjv9zymyy7-activate-configuration.sh.drv
  /nix/store/7mzy971rdm8l566ch8hgxaf89x7lr7ik-upstart-jobs.drv
  ...
the following paths will be downloaded/copied (30.02 MiB):
  /nix/store/4m8pvgy2dcjgppf5b4cj5l6wyshjhalj-samba-3.2.4
  /nix/store/7h1kwcj29ip8vk26rhmx6bfjraxp0g4l-libunwind-0.98.6
  ...
</code></pre>
</li>
<li>
<p>Language features:</p>
<ul>
<li>
<p>@-patterns as in Haskell. For instance, in a function definition</p>
<pre><code>f = args @ {x, y, z}: ...;
</code></pre>
<p><code>args</code> refers to the argument as a whole, which is further
pattern-matched against the attribute set pattern <code>{x, y, z}</code>.</p>
</li>
<li>
<p>“<code>...</code>” (ellipsis) patterns. An attribute set pattern can now
say <code>...</code> at the end of the attribute name list to specify that
the function takes <em>at least</em> the listed attributes, while
ignoring additional attributes. For instance,</p>
<pre><code>{stdenv, fetchurl, fuse, ...}: ...
</code></pre>
<p>defines a function that accepts any attribute set that includes
at least the three listed attributes.</p>
</li>
<li>
<p>New primops: <code>builtins.parseDrvName</code> (split a package name
string like <code>"nix-0.12pre12876"</code> into its name and version
components, e.g. <code>"nix"</code> and <code>"0.12pre12876"</code>),
<code>builtins.compareVersions</code> (compare two version strings using
the same algorithm that <code>nix-env</code> uses), <code>builtins.length</code>
(efficiently compute the length of a list), <code>builtins.mul</code>
(integer multiplication), <code>builtins.div</code> (integer division).</p>
</li>
</ul>
</li>
<li>
<p><code>nix-prefetch-url</code> now supports <code>mirror://</code> URLs, provided that the
environment variable <code>NIXPKGS_ALL</code> points at a Nixpkgs tree.</p>
</li>
<li>
<p>Removed the commands <code>nix-pack-closure</code> and <code>nix-unpack-closure</code>.
You can do almost the same thing but much more efficiently by doing
<code>nix-store --export         $(nix-store -qR paths) &gt; closure</code> and <code>nix-store --import &lt;         closure</code>.</p>
</li>
<li>
<p>Lots of bug fixes, including a big performance bug in the handling
of <code>with</code>-expressions.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-011-2007-12-31"><a class="header" href="#release-011-2007-12-31">Release 0.11 (2007-12-31)</a></h1>
<p>Nix 0.11 has many improvements over the previous stable release. The
most important improvement is secure multi-user support. It also
features many usability enhancements and language extensions, many of
them prompted by NixOS, the purely functional Linux distribution based
on Nix. Here is an (incomplete) list:</p>
<ul>
<li>
<p>Secure multi-user support. A single Nix store can now be shared
between multiple (possible untrusted) users. This is an important
feature for NixOS, where it allows non-root users to install
software. The old setuid method for sharing a store between multiple
users has been removed. Details for setting up a multi-user store
can be found in the manual.</p>
</li>
<li>
<p>The new command <code>nix-copy-closure</code> gives you an easy and efficient
way to exchange software between machines. It copies the missing
parts of the closure of a set of store path to or from a remote
machine via <code>ssh</code>.</p>
</li>
<li>
<p>A new kind of string literal: strings between double single-quotes
(<code>''</code>) have indentation “intelligently” removed. This allows large
strings (such as shell scripts or configuration file fragments in
NixOS) to cleanly follow the indentation of the surrounding
expression. It also requires much less escaping, since <code>''</code> is less
common in most languages than <code>"</code>.</p>
</li>
<li>
<p><code>nix-env</code> <code>--set</code> modifies the current generation of a profile so
that it contains exactly the specified derivation, and nothing else.
For example, <code>nix-env -p /nix/var/nix/profiles/browser --set         firefox</code> lets the profile named <code>browser</code> contain just Firefox.</p>
</li>
<li>
<p><code>nix-env</code> now maintains meta-information about installed packages in
profiles. The meta-information is the contents of the <code>meta</code>
attribute of derivations, such as <code>description</code> or <code>homepage</code>. The
command <code>nix-env -q --xml         --meta</code> shows all meta-information.</p>
</li>
<li>
<p><code>nix-env</code> now uses the <code>meta.priority</code> attribute of derivations to
resolve filename collisions between packages. Lower priority values
denote a higher priority. For instance, the GCC wrapper package and
the Binutils package in Nixpkgs both have a file <code>bin/ld</code>, so
previously if you tried to install both you would get a collision.
Now, on the other hand, the GCC wrapper declares a higher priority
than Binutils, so the former’s <code>bin/ld</code> is symlinked in the user
environment.</p>
</li>
<li>
<p><code>nix-env -i / -u</code>: instead of breaking package ties by version,
break them by priority and version number. That is, if there are
multiple packages with the same name, then pick the package with the
highest priority, and only use the version if there are multiple
packages with the same priority.</p>
<p>This makes it possible to mark specific versions/variant in Nixpkgs
more or less desirable than others. A typical example would be a
beta version of some package (e.g., <code>gcc-4.2.0rc1</code>) which should not
be installed even though it is the highest version, except when it
is explicitly selected (e.g., <code>nix-env -i         gcc-4.2.0rc1</code>).</p>
</li>
<li>
<p><code>nix-env --set-flag</code> allows meta attributes of installed packages to
be modified. There are several attributes that can be usefully
modified, because they affect the behaviour of <code>nix-env</code> or the user
environment build script:</p>
<ul>
<li>
<p><code>meta.priority</code> can be changed to resolve filename clashes (see
above).</p>
</li>
<li>
<p><code>meta.keep</code> can be set to <code>true</code> to prevent the package from
being upgraded or replaced. Useful if you want to hang on to an
older version of a package.</p>
</li>
<li>
<p><code>meta.active</code> can be set to <code>false</code> to “disable” the package.
That is, no symlinks will be generated to the files of the
package, but it remains part of the profile (so it won’t be
garbage-collected). Set it back to <code>true</code> to re-enable the
package.</p>
</li>
</ul>
</li>
<li>
<p><code>nix-env -q</code> now has a flag <code>--prebuilt-only</code> (<code>-b</code>) that causes
<code>nix-env</code> to show only those derivations whose output is already in
the Nix store or that can be substituted (i.e., downloaded from
somewhere). In other words, it shows the packages that can be
installed “quickly”, i.e., don’t need to be built from source. The
<code>-b</code> flag is also available in <code>nix-env -i</code> and <code>nix-env -u</code> to
filter out derivations for which no pre-built binary is available.</p>
</li>
<li>
<p>The new option <code>--argstr</code> (in <code>nix-env</code>, <code>nix-instantiate</code> and
<code>nix-build</code>) is like <code>--arg</code>, except that the value is a string. For
example, <code>--argstr system         i686-linux</code> is equivalent to <code>--arg system         \"i686-linux\"</code> (note that <code>--argstr</code> prevents annoying quoting
around shell arguments).</p>
</li>
<li>
<p><code>nix-store</code> has a new operation <code>--read-log</code> (<code>-l</code>) <code>paths</code> that
shows the build log of the given paths.</p>
</li>
<li>
<p>Nix now uses Berkeley DB 4.5. The database is upgraded
automatically, but you should be careful not to use old versions of
Nix that still use Berkeley DB 4.4.</p>
</li>
<li>
<p>The option <code>--max-silent-time</code> (corresponding to the configuration
setting <code>build-max-silent-time</code>) allows you to set a timeout on
builds — if a build produces no output on <code>stdout</code> or <code>stderr</code> for
the given number of seconds, it is terminated. This is useful for
recovering automatically from builds that are stuck in an infinite
loop.</p>
</li>
<li>
<p><code>nix-channel</code>: each subscribed channel is its own attribute in the
top-level expression generated for the channel. This allows
disambiguation (e.g. <code>nix-env         -i -A nixpkgs_unstable.firefox</code>).</p>
</li>
<li>
<p>The substitutes table has been removed from the database. This makes
operations such as <code>nix-pull</code> and <code>nix-channel --update</code> much, much
faster.</p>
</li>
<li>
<p><code>nix-pull</code> now supports bzip2-compressed manifests. This speeds up
channels.</p>
</li>
<li>
<p><code>nix-prefetch-url</code> now has a limited form of caching. This is used
by <code>nix-channel</code> to prevent unnecessary downloads when the channel
hasn’t changed.</p>
</li>
<li>
<p><code>nix-prefetch-url</code> now by default computes the SHA-256 hash of the
file instead of the MD5 hash. In calls to <code>fetchurl</code> you should pass
the <code>sha256</code> attribute instead of <code>md5</code>. You can pass either a
hexadecimal or a base-32 encoding of the hash.</p>
</li>
<li>
<p>Nix can now perform builds in an automatically generated “chroot”.
This prevents a builder from accessing stuff outside of the Nix
store, and thus helps ensure purity. This is an experimental
feature.</p>
</li>
<li>
<p>The new command <code>nix-store         --optimise</code> reduces Nix store disk space usage by finding identical
files in the store and hard-linking them to each other. It typically
reduces the size of the store by something like 25-35%.</p>
</li>
<li>
<p><code>~/.nix-defexpr</code> can now be a directory, in which case the Nix
expressions in that directory are combined into an attribute set,
with the file names used as the names of the attributes. The command
<code>nix-env         --import</code> (which set the <code>~/.nix-defexpr</code> symlink) is removed.</p>
</li>
<li>
<p>Derivations can specify the new special attribute
<code>allowedReferences</code> to enforce that the references in the output of
a derivation are a subset of a declared set of paths. For example,
if <code>allowedReferences</code> is an empty list, then the output must not
have any references. This is used in NixOS to check that generated
files such as initial ramdisks for booting Linux don’t have any
dependencies.</p>
</li>
<li>
<p>The new attribute <code>exportReferencesGraph</code> allows builders access to
the references graph of their inputs. This is used in NixOS for
tasks such as generating ISO-9660 images that contain a Nix store
populated with the closure of certain paths.</p>
</li>
<li>
<p>Fixed-output derivations (like <code>fetchurl</code>) can define the attribute
<code>impureEnvVars</code> to allow external environment variables to be passed
to builders. This is used in Nixpkgs to support proxy configuration,
among other things.</p>
</li>
<li>
<p>Several new built-in functions: <code>builtins.attrNames</code>,
<code>builtins.filterSource</code>, <code>builtins.isAttrs</code>, <code>builtins.isFunction</code>,
<code>builtins.listToAttrs</code>, <code>builtins.stringLength</code>, <code>builtins.sub</code>,
<code>builtins.substring</code>, <code>throw</code>, <code>builtins.trace</code>,
<code>builtins.readFile</code>.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-0101-2006-10-11"><a class="header" href="#release-0101-2006-10-11">Release 0.10.1 (2006-10-11)</a></h1>
<p>This release fixes two somewhat obscure bugs that occur when evaluating
Nix expressions that are stored inside the Nix store (<code>NIX-67</code>). These
do not affect most users.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-010-2006-10-06"><a class="header" href="#release-010-2006-10-06">Release 0.10 (2006-10-06)</a></h1>
<blockquote>
<p><strong>Note</strong></p>
<p>This version of Nix uses Berkeley DB 4.4 instead of 4.3. The database
is upgraded automatically, but you should be careful not to use old
versions of Nix that still use Berkeley DB 4.3. In particular, if you
use a Nix installed through Nix, you should run</p>
<pre><code>$ nix-store --clear-substitutes
</code></pre>
<p>first.</p>
</blockquote>
<blockquote>
<p><strong>Warning</strong></p>
<p>Also, the database schema has changed slighted to fix a performance
issue (see below). When you run any Nix 0.10 command for the first
time, the database will be upgraded automatically. This is
irreversible.</p>
</blockquote>
<ul>
<li>
<p><code>nix-env</code> usability improvements:</p>
<ul>
<li>
<p>An option <code>--compare-versions</code> (or <code>-c</code>) has been added to
<code>nix-env                                                 --query</code> to allow you to compare installed versions of packages
to available versions, or vice versa. An easy way to see if you
are up to date with what’s in your subscribed channels is
<code>nix-env -qc \*</code>.</p>
</li>
<li>
<p><code>nix-env --query</code> now takes as arguments a list of package names
about which to show information, just like <code>--install</code>, etc.:
for example, <code>nix-env -q gcc</code>. Note that to show all
derivations, you need to specify <code>\*</code>.</p>
</li>
<li>
<p><code>nix-env -i                                                 pkgname</code> will now install the highest available version of
<em>pkgname</em>, rather than installing all available versions (which
would probably give collisions) (<code>NIX-31</code>).</p>
</li>
<li>
<p><code>nix-env (-i|-u) --dry-run</code> now shows exactly which missing
paths will be built or substituted.</p>
</li>
<li>
<p><code>nix-env -qa --description</code> shows human-readable descriptions of
packages, provided that they have a <code>meta.description</code> attribute
(which most packages in Nixpkgs don’t have yet).</p>
</li>
</ul>
</li>
<li>
<p>New language features:</p>
<ul>
<li>
<p>Reference scanning (which happens after each build) is much
faster and takes a constant amount of memory.</p>
</li>
<li>
<p>String interpolation. Expressions like</p>
<pre><code>"--with-freetype2-library=" + freetype + "/lib"
</code></pre>
<p>can now be written as</p>
<pre><code>"--with-freetype2-library=${freetype}/lib"
</code></pre>
<p>You can write arbitrary expressions within <code>${...}</code>, not just
identifiers.</p>
</li>
<li>
<p>Multi-line string literals.</p>
</li>
<li>
<p>String concatenations can now involve derivations, as in the
example <code>"--with-freetype2-library="                                                 + freetype + "/lib"</code>. This was not previously possible because
we need to register that a derivation that uses such a string is
dependent on <code>freetype</code>. The evaluator now properly propagates
this information. Consequently, the subpath operator (<code>~</code>) has
been deprecated.</p>
</li>
<li>
<p>Default values of function arguments can now refer to other
function arguments; that is, all arguments are in scope in the
default values (<code>NIX-45</code>).</p>
</li>
<li>
<p>Lots of new built-in primitives, such as functions for list
manipulation and integer arithmetic. See the manual for a
complete list. All primops are now available in the set
<code>builtins</code>, allowing one to test for the availability of primop
in a backwards-compatible way.</p>
</li>
<li>
<p>Real let-expressions: <code>let x = ...;                                                 ... z = ...; in ...</code>.</p>
</li>
</ul>
</li>
<li>
<p>New commands <code>nix-pack-closure</code> and <code>nix-unpack-closure</code> than can be
used to easily transfer a store path with all its dependencies to
another machine. Very convenient whenever you have some package on
your machine and you want to copy it somewhere else.</p>
</li>
<li>
<p>XML support:</p>
<ul>
<li>
<p><code>nix-env -q --xml</code> prints the installed or available packages in
an XML representation for easy processing by other tools.</p>
</li>
<li>
<p><code>nix-instantiate --eval-only                                                 --xml</code> prints an XML representation of the resulting term. (The
new flag <code>--strict</code> forces ‘deep’ evaluation of the result,
i.e., list elements and attributes are evaluated recursively.)</p>
</li>
<li>
<p>In Nix expressions, the primop <code>builtins.toXML</code> converts a term
to an XML representation. This is primarily useful for passing
structured information to builders.</p>
</li>
</ul>
</li>
<li>
<p>You can now unambiguously specify which derivation to build or
install in <code>nix-env</code>, <code>nix-instantiate</code> and <code>nix-build</code> using the
<code>--attr</code> / <code>-A</code> flags, which takes an attribute name as argument.
(Unlike symbolic package names such as <code>subversion-1.4.0</code>, attribute
names in an attribute set are unique.) For instance, a quick way to
perform a test build of a package in Nixpkgs is <code>nix-build         pkgs/top-level/all-packages.nix -A         foo</code>. <code>nix-env -q         --attr</code> shows the attribute names corresponding to each derivation.</p>
</li>
<li>
<p>If the top-level Nix expression used by <code>nix-env</code>, <code>nix-instantiate</code>
or <code>nix-build</code> evaluates to a function whose arguments all have
default values, the function will be called automatically. Also, the
new command-line switch <code>--arg         name         value</code> can be used to specify function arguments on the command
line.</p>
</li>
<li>
<p><code>nix-install-package --url         URL</code> allows a package to be installed directly from the given URL.</p>
</li>
<li>
<p>Nix now works behind an HTTP proxy server; just set the standard
environment variables <code>http_proxy</code>, <code>https_proxy</code>, <code>ftp_proxy</code> or
<code>all_proxy</code> appropriately. Functions such as <code>fetchurl</code> in Nixpkgs
also respect these variables.</p>
</li>
<li>
<p><code>nix-build -o         symlink</code> allows the symlink to the build result to be named
something other than <code>result</code>.</p>
</li>
<li>
<p>Platform support:</p>
<ul>
<li>
<p>Support for 64-bit platforms, provided a <a href="http://bugzilla.sen.cwi.nl:8080/show_bug.cgi?id=606">suitably patched ATerm
library</a> is
used. Also, files larger than 2 GiB are now supported.</p>
</li>
<li>
<p>Added support for Cygwin (Windows, <code>i686-cygwin</code>), Mac OS X on
Intel (<code>i686-darwin</code>) and Linux on PowerPC (<code>powerpc-linux</code>).</p>
</li>
<li>
<p>Users of SMP and multicore machines will appreciate that the
number of builds to be performed in parallel can now be
specified in the configuration file in the <code>build-max-jobs</code>
setting.</p>
</li>
</ul>
</li>
<li>
<p>Garbage collector improvements:</p>
<ul>
<li>
<p>Open files (such as running programs) are now used as roots of
the garbage collector. This prevents programs that have been
uninstalled from being garbage collected while they are still
running. The script that detects these additional runtime roots
(<code>find-runtime-roots.pl</code>) is inherently system-specific, but it
should work on Linux and on all platforms that have the <code>lsof</code>
utility.</p>
</li>
<li>
<p><code>nix-store --gc</code> (a.k.a. <code>nix-collect-garbage</code>) prints out the
number of bytes freed on standard output. <code>nix-store                                                 --gc --print-dead</code> shows how many bytes would be freed by an
actual garbage collection.</p>
</li>
<li>
<p><code>nix-collect-garbage -d</code> removes all old generations of <em>all</em>
profiles before calling the actual garbage collector (<code>nix-store                                                 --gc</code>). This is an easy way to get rid of all old packages in
the Nix store.</p>
</li>
<li>
<p><code>nix-store</code> now has an operation <code>--delete</code> to delete specific
paths from the Nix store. It won’t delete reachable
(non-garbage) paths unless <code>--ignore-liveness</code> is specified.</p>
</li>
</ul>
</li>
<li>
<p>Berkeley DB 4.4’s process registry feature is used to recover from
crashed Nix processes.</p>
</li>
<li>
<p>A performance issue has been fixed with the <code>referer</code> table, which
stores the inverse of the <code>references</code> table (i.e., it tells you
what store paths refer to a given path). Maintaining this table
could take a quadratic amount of time, as well as a quadratic amount
of Berkeley DB log file space (in particular when running the
garbage collector) (<code>NIX-23</code>).</p>
</li>
<li>
<p>Nix now catches the <code>TERM</code> and <code>HUP</code> signals in addition to the
<code>INT</code> signal. So you can now do a <code>killall         nix-store</code> without triggering a database recovery.</p>
</li>
<li>
<p><code>bsdiff</code> updated to version 4.3.</p>
</li>
<li>
<p>Substantial performance improvements in expression evaluation and
<code>nix-env -qa</code>, all thanks to <a href="http://valgrind.org/">Valgrind</a>.
Memory use has been reduced by a factor 8 or so. Big speedup by
memoisation of path hashing.</p>
</li>
<li>
<p>Lots of bug fixes, notably:</p>
<ul>
<li>
<p>Make sure that the garbage collector can run successfully when
the disk is full (<code>NIX-18</code>).</p>
</li>
<li>
<p><code>nix-env</code> now locks the profile to prevent races between
concurrent <code>nix-env</code> operations on the same profile (<code>NIX-7</code>).</p>
</li>
<li>
<p>Removed misleading messages from <code>nix-env -i</code> (e.g.,
<code>installing                                                 `foo'</code> followed by <code>uninstalling                                                 `foo'</code>) (<code>NIX-17</code>).</p>
</li>
</ul>
</li>
<li>
<p>Nix source distributions are a lot smaller now since we no longer
include a full copy of the Berkeley DB source distribution (but only
the bits we need).</p>
</li>
<li>
<p>Header files are now installed so that external programs can use the
Nix libraries.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-092-2005-09-21"><a class="header" href="#release-092-2005-09-21">Release 0.9.2 (2005-09-21)</a></h1>
<p>This bug fix release fixes two problems on Mac OS X:</p>
<ul>
<li>
<p>If Nix was linked against statically linked versions of the ATerm or
Berkeley DB library, there would be dynamic link errors at runtime.</p>
</li>
<li>
<p><code>nix-pull</code> and <code>nix-push</code> intermittently failed due to race
conditions involving pipes and child processes with error messages
such as <code>open2: open(GLOB(0x180b2e4), &gt;&amp;=9) failed: Bad         file descriptor at /nix/bin/nix-pull line 77</code> (issue <code>NIX-14</code>).</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-091-2005-09-20"><a class="header" href="#release-091-2005-09-20">Release 0.9.1 (2005-09-20)</a></h1>
<p>This bug fix release addresses a problem with the ATerm library when the
<code>--with-aterm</code> flag in <code>configure</code> was <em>not</em> used.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-09-2005-09-16"><a class="header" href="#release-09-2005-09-16">Release 0.9 (2005-09-16)</a></h1>
<p>NOTE: this version of Nix uses Berkeley DB 4.3 instead of 4.2. The
database is upgraded automatically, but you should be careful not to use
old versions of Nix that still use Berkeley DB 4.2. In particular, if
you use a Nix installed through Nix, you should run</p>
<pre><code>$ nix-store --clear-substitutes
</code></pre>
<p>first.</p>
<ul>
<li>
<p>Unpacking of patch sequences is much faster now since we no longer
do redundant unpacking and repacking of intermediate paths.</p>
</li>
<li>
<p>Nix now uses Berkeley DB 4.3.</p>
</li>
<li>
<p>The <code>derivation</code> primitive is lazier. Attributes of dependent
derivations can mutually refer to each other (as long as there are
no data dependencies on the <code>outPath</code> and <code>drvPath</code> attributes
computed by <code>derivation</code>).</p>
<p>For example, the expression <code>derivation         attrs</code> now evaluates to (essentially)</p>
<pre><code>attrs // {
  type = "derivation";
  outPath = derivation! attrs;
  drvPath = derivation! attrs;
}
</code></pre>
<p>where <code>derivation!</code> is a primop that does the actual derivation
instantiation (i.e., it does what <code>derivation</code> used to do). The
advantage is that it allows commands such as <code>nix-env -qa</code> and
<code>nix-env -i</code> to be much faster since they no longer need to
instantiate all derivations, just the <code>name</code> attribute.</p>
<p>Also, it allows derivations to cyclically reference each other, for
example,</p>
<pre><code>webServer = derivation {
  ...
  hostName = "svn.cs.uu.nl";
  services = [svnService];
};
 
svnService = derivation {
  ...
  hostName = webServer.hostName;
};
</code></pre>
<p>Previously, this would yield a black hole (infinite recursion).</p>
</li>
<li>
<p><code>nix-build</code> now defaults to using <code>./default.nix</code> if no Nix
expression is specified.</p>
</li>
<li>
<p><code>nix-instantiate</code>, when applied to a Nix expression that evaluates
to a function, will call the function automatically if all its
arguments have defaults.</p>
</li>
<li>
<p>Nix now uses libtool to build dynamic libraries. This reduces the
size of executables.</p>
</li>
<li>
<p>A new list concatenation operator <code>++</code>. For example, <code>[1 2 3] ++ [4 5         6]</code> evaluates to <code>[1 2 3 4 5         6]</code>.</p>
</li>
<li>
<p>Some currently undocumented primops to support low-level build
management using Nix (i.e., using Nix as a Make replacement). See
the commit messages for <code>r3578</code> and <code>r3580</code>.</p>
</li>
<li>
<p>Various bug fixes and performance improvements.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-081-2005-04-13"><a class="header" href="#release-081-2005-04-13">Release 0.8.1 (2005-04-13)</a></h1>
<p>This is a bug fix release.</p>
<ul>
<li>
<p>Patch downloading was broken.</p>
</li>
<li>
<p>The garbage collector would not delete paths that had references
from invalid (but substitutable) paths.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-08-2005-04-11"><a class="header" href="#release-08-2005-04-11">Release 0.8 (2005-04-11)</a></h1>
<p>NOTE: the hashing scheme in Nix 0.8 changed (as detailed below). As a
result, <code>nix-pull</code> manifests and channels built for Nix 0.7 and below
will not work anymore. However, the Nix expression language has not
changed, so you can still build from source. Also, existing user
environments continue to work. Nix 0.8 will automatically upgrade the
database schema of previous installations when it is first run.</p>
<p>If you get the error message</p>
<pre><code>you have an old-style manifest `/nix/var/nix/manifests/[...]'; please
delete it
</code></pre>
<p>you should delete previously downloaded manifests:</p>
<pre><code>$ rm /nix/var/nix/manifests/*
</code></pre>
<p>If <code>nix-channel</code> gives the error message</p>
<pre><code>manifest `http://catamaran.labs.cs.uu.nl/dist/nix/channels/[channel]/MANIFEST'
is too old (i.e., for Nix &lt;= 0.7)
</code></pre>
<p>then you should unsubscribe from the offending channel (<code>nix-channel --remove URL</code>; leave out <code>/MANIFEST</code>), and subscribe to the same URL, with
<code>channels</code> replaced by <code>channels-v3</code> (e.g.,
<a href="http://catamaran.labs.cs.uu.nl/dist/nix/channels-v3/nixpkgs-unstable">http://catamaran.labs.cs.uu.nl/dist/nix/channels-v3/nixpkgs-unstable</a>).</p>
<p>Nix 0.8 has the following improvements:</p>
<ul>
<li>
<p>The cryptographic hashes used in store paths are now 160 bits long,
but encoded in base-32 so that they are still only 32 characters
long (e.g.,
<code>/nix/store/csw87wag8bqlqk7ipllbwypb14xainap-atk-1.9.0</code>). (This is
actually a 160 bit truncation of a SHA-256 hash.)</p>
</li>
<li>
<p>Big cleanups and simplifications of the basic store semantics. The
notion of “closure store expressions” is gone (and so is the notion
of “successors”); the file system references of a store path are now
just stored in the database.</p>
<p>For instance, given any store path, you can query its closure:</p>
<pre><code>$ nix-store -qR $(which firefox)
... lots of paths ...
</code></pre>
<p>Also, Nix now remembers for each store path the derivation that
built it (the “deriver”):</p>
<pre><code>$ nix-store -qR $(which firefox)
/nix/store/4b0jx7vq80l9aqcnkszxhymsf1ffa5jd-firefox-1.0.1.drv
</code></pre>
<p>So to see the build-time dependencies, you can do</p>
<pre><code>$ nix-store -qR $(nix-store -qd $(which firefox))
</code></pre>
<p>or, in a nicer format:</p>
<pre><code>$ nix-store -q --tree $(nix-store -qd $(which firefox))
</code></pre>
<p>File system references are also stored in reverse. For instance, you
can query all paths that directly or indirectly use a certain Glibc:</p>
<pre><code>$ nix-store -q --referrers-closure \
    /nix/store/8lz9yc6zgmc0vlqmn2ipcpkjlmbi51vv-glibc-2.3.4
</code></pre>
</li>
<li>
<p>The concept of fixed-output derivations has been formalised.
Previously, functions such as <code>fetchurl</code> in Nixpkgs used a hack
(namely, explicitly specifying a store path hash) to prevent changes
to, say, the URL of the file from propagating upwards through the
dependency graph, causing rebuilds of everything. This can now be
done cleanly by specifying the <code>outputHash</code> and <code>outputHashAlgo</code>
attributes. Nix itself checks that the content of the output has the
specified hash. (This is important for maintaining certain
invariants necessary for future work on secure shared stores.)</p>
</li>
<li>
<p>One-click installation :-) It is now possible to install any
top-level component in Nixpkgs directly, through the web — see,
e.g., <a href="http://catamaran.labs.cs.uu.nl/dist/nixpkgs-0.8/">http://catamaran.labs.cs.uu.nl/dist/nixpkgs-0.8/</a>. All you
have to do is associate <code>/nix/bin/nix-install-package</code> with the MIME
type <code>application/nix-package</code> (or the extension <code>.nixpkg</code>), and
clicking on a package link will cause it to be installed, with all
appropriate dependencies. If you just want to install some specific
application, this is easier than subscribing to a channel.</p>
</li>
<li>
<p><code>nix-store -r         PATHS</code> now builds all the derivations PATHS in parallel. Previously
it did them sequentially (though exploiting possible parallelism
between subderivations). This is nice for build farms.</p>
</li>
<li>
<p><code>nix-channel</code> has new operations <code>--list</code> and <code>--remove</code>.</p>
</li>
<li>
<p>New ways of installing components into user environments:</p>
<ul>
<li>
<p>Copy from another user environment:</p>
<pre><code>$ nix-env -i --from-profile .../other-profile firefox
</code></pre>
</li>
<li>
<p>Install a store derivation directly (bypassing the Nix
expression language entirely):</p>
<pre><code>$ nix-env -i /nix/store/z58v41v21xd3...-aterm-2.3.1.drv
</code></pre>
<p>(This is used to implement <code>nix-install-package</code>, which is
therefore immune to evolution in the Nix expression language.)</p>
</li>
<li>
<p>Install an already built store path directly:</p>
<pre><code>$ nix-env -i /nix/store/hsyj5pbn0d9i...-aterm-2.3.1
</code></pre>
</li>
<li>
<p>Install the result of a Nix expression specified as a
command-line argument:</p>
<pre><code>$ nix-env -f .../i686-linux.nix -i -E 'x: x.firefoxWrapper'
</code></pre>
<p>The difference with the normal installation mode is that <code>-E</code>
does not use the <code>name</code> attributes of derivations. Therefore,
this can be used to disambiguate multiple derivations with the
same name.</p>
</li>
</ul>
</li>
<li>
<p>A hash of the contents of a store path is now stored in the database
after a successful build. This allows you to check whether store
paths have been tampered with: <code>nix-store         --verify --check-contents</code>.</p>
</li>
<li>
<p>Implemented a concurrent garbage collector. It is now always safe to
run the garbage collector, even if other Nix operations are
happening simultaneously.</p>
<p>However, there can still be GC races if you use <code>nix-instantiate</code>
and <code>nix-store                 --realise</code> directly to build things. To prevent races, use the
<code>--add-root</code> flag of those commands.</p>
</li>
<li>
<p>The garbage collector now finally deletes paths in the right order
(i.e., topologically sorted under the “references” relation), thus
making it safe to interrupt the collector without risking a store
that violates the closure invariant.</p>
</li>
<li>
<p>Likewise, the substitute mechanism now downloads files in the right
order, thus preserving the closure invariant at all times.</p>
</li>
<li>
<p>The result of <code>nix-build</code> is now registered as a root of the garbage
collector. If the <code>./result</code> link is deleted, the GC root disappears
automatically.</p>
</li>
<li>
<p>The behaviour of the garbage collector can be changed globally by
setting options in <code>/nix/etc/nix/nix.conf</code>.</p>
<ul>
<li>
<p><code>gc-keep-derivations</code> specifies whether deriver links should be
followed when searching for live paths.</p>
</li>
<li>
<p><code>gc-keep-outputs</code> specifies whether outputs of derivations
should be followed when searching for live paths.</p>
</li>
<li>
<p><code>env-keep-derivations</code> specifies whether user environments
should store the paths of derivations when they are added (thus
keeping the derivations alive).</p>
</li>
</ul>
</li>
<li>
<p>New <code>nix-env</code> query flags <code>--drv-path</code> and <code>--out-path</code>.</p>
</li>
<li>
<p><code>fetchurl</code> allows SHA-1 and SHA-256 in addition to MD5. Just specify
the attribute <code>sha1</code> or <code>sha256</code> instead of <code>md5</code>.</p>
</li>
<li>
<p>Manual updates.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-07-2005-01-12"><a class="header" href="#release-07-2005-01-12">Release 0.7 (2005-01-12)</a></h1>
<ul>
<li>
<p>Binary patching. When upgrading components using pre-built binaries
(through nix-pull / nix-channel), Nix can automatically download and
apply binary patches to already installed components instead of full
downloads. Patching is “smart”: if there is a <em>sequence</em> of patches
to an installed component, Nix will use it. Patches are currently
generated automatically between Nixpkgs (pre-)releases.</p>
</li>
<li>
<p>Simplifications to the substitute mechanism.</p>
</li>
<li>
<p>Nix-pull now stores downloaded manifests in
<code>/nix/var/nix/manifests</code>.</p>
</li>
<li>
<p>Metadata on files in the Nix store is canonicalised after builds:
the last-modified timestamp is set to 0 (00:00:00 1/1/1970), the
mode is set to 0444 or 0555 (readable and possibly executable by
all; setuid/setgid bits are dropped), and the group is set to the
default. This ensures that the result of a build and an installation
through a substitute is the same; and that timestamp dependencies
are revealed.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-06-2004-11-14"><a class="header" href="#release-06-2004-11-14">Release 0.6 (2004-11-14)</a></h1>
<ul>
<li>
<p>Rewrite of the normalisation engine.</p>
<ul>
<li>
<p>Multiple builds can now be performed in parallel (option <code>-j</code>).</p>
</li>
<li>
<p>Distributed builds. Nix can now call a shell script to forward
builds to Nix installations on remote machines, which may or may
not be of the same platform type.</p>
</li>
<li>
<p>Option <code>--fallback</code> allows recovery from broken substitutes.</p>
</li>
<li>
<p>Option <code>--keep-going</code> causes building of other (unaffected)
derivations to continue if one failed.</p>
</li>
</ul>
</li>
<li>
<p>Improvements to the garbage collector (i.e., it should actually work
now).</p>
</li>
<li>
<p>Setuid Nix installations allow a Nix store to be shared among
multiple users.</p>
</li>
<li>
<p>Substitute registration is much faster now.</p>
</li>
<li>
<p>A utility <code>nix-build</code> to build a Nix expression and create a symlink
to the result int the current directory; useful for testing Nix
derivations.</p>
</li>
<li>
<p>Manual updates.</p>
</li>
<li>
<p><code>nix-env</code> changes:</p>
<ul>
<li>
<p>Derivations for other platforms are filtered out (which can be
overridden using <code>--system-filter</code>).</p>
</li>
<li>
<p><code>--install</code> by default now uninstall previous derivations with
the same name.</p>
</li>
<li>
<p><code>--upgrade</code> allows upgrading to a specific version.</p>
</li>
<li>
<p>New operation <code>--delete-generations</code> to remove profile
generations (necessary for effective garbage collection).</p>
</li>
<li>
<p>Nicer output (sorted, columnised).</p>
</li>
</ul>
</li>
<li>
<p>More sensible verbosity levels all around (builder output is now
shown always, unless <code>-Q</code> is given).</p>
</li>
<li>
<p>Nix expression language changes:</p>
<ul>
<li>
<p>New language construct: <code>with                                                 E1;                                                 E2</code> brings all attributes defined in the attribute set <em>E1</em> in
scope in <em>E2</em>.</p>
</li>
<li>
<p>Added a <code>map</code> function.</p>
</li>
<li>
<p>Various new operators (e.g., string concatenation).</p>
</li>
</ul>
</li>
<li>
<p>Expression evaluation is much faster.</p>
</li>
<li>
<p>An Emacs mode for editing Nix expressions (with syntax highlighting
and indentation) has been added.</p>
</li>
<li>
<p>Many bug fixes.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-05-and-earlier"><a class="header" href="#release-05-and-earlier">Release 0.5 and earlier</a></h1>
<p>Please refer to the Subversion commit log messages.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="redirects.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
